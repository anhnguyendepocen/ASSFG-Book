<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1 Analyzing and Modeling Spatial Point Pattern Data | Applied Spatial Statistics for Geographers</title>
  <meta name="description" content="1 Analyzing and Modeling Spatial Point Pattern Data | Applied Spatial Statistics for Geographers" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="1 Analyzing and Modeling Spatial Point Pattern Data | Applied Spatial Statistics for Geographers" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1 Analyzing and Modeling Spatial Point Pattern Data | Applied Spatial Statistics for Geographers" />
  
  
  

<meta name="author" content="James B. Elsner" />


<meta name="date" content="2020-05-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>

<script src="libs/header-attrs-2.1/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html"><i class="fa fa-check"></i><b>1</b> Analyzing and Modeling Spatial Point Pattern Data</a>
<ul>
<li class="chapter" data-level="1.1" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#kansas-tornadoes-as-point-pattern-data"><i class="fa fa-check"></i><b>1.1</b> Kansas tornadoes as point pattern data</a></li>
<li class="chapter" data-level="1.2" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#definitions"><i class="fa fa-check"></i><b>1.2</b> Definitions</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#stationarity-and-isotropy"><i class="fa fa-check"></i><b>1.2.1</b> Stationarity and isotropy</a></li>
<li class="chapter" data-level="1.2.2" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#spatial-poisson-process"><i class="fa fa-check"></i><b>1.2.2</b> Spatial Poisson process</a></li>
<li class="chapter" data-level="1.2.3" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#heterogeneous-poisson-process"><i class="fa fa-check"></i><b>1.2.3</b> Heterogeneous Poisson process</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#point-pattern-objects-in-the-spatstat-package"><i class="fa fa-check"></i><b>1.3</b> Point pattern objects in the {spatstat} package</a></li>
<li class="chapter" data-level="1.4" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#spatial-varying-intensity"><i class="fa fa-check"></i><b>1.4</b> Spatial varying intensity</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#kernel-density"><i class="fa fa-check"></i><b>1.4.1</b> Kernel density</a></li>
<li class="chapter" data-level="1.4.2" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#example-1-tropical-trees"><i class="fa fa-check"></i><b>1.4.2</b> Example 1: Tropical trees</a></li>
<li class="chapter" data-level="1.4.3" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#example-2-kansas-tornadoes"><i class="fa fa-check"></i><b>1.4.3</b> Example 2: Kansas tornadoes</a></li>
<li class="chapter" data-level="1.4.4" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#tornado-reports-as-a-function-of-distance-from-nearest-town"><i class="fa fa-check"></i><b>1.4.4</b> Tornado reports as a function of distance from nearest town</a></li>
<li class="chapter" data-level="1.4.5" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#challenge-problem-tornado-reports-as-a-function-of-distance-to-nearest-citytown"><i class="fa fa-check"></i><b>1.4.5</b> Challenge problem: Tornado reports as a function of distance to nearest city/town</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#conditional-probability"><i class="fa fa-check"></i><b>1.5</b> Conditional probability</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#texas-tornadoes"><i class="fa fa-check"></i><b>1.5.1</b> Texas tornadoes</a></li>
<li class="chapter" data-level="1.5.2" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#conditional-probability-1"><i class="fa fa-check"></i><b>1.5.2</b> Conditional probability</a></li>
<li class="chapter" data-level="1.5.3" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#another-example-given-a-wildfire-anywhere-in-florida-what-is-the-probability-is-was-started-by-lightning"><i class="fa fa-check"></i><b>1.5.3</b> Another example: Given a wildfire anywhere in Florida what is the probability is was started by lightning?</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#clustering-through-interaction"><i class="fa fa-check"></i><b>1.6</b> Clustering through interaction</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#statistical-significance"><i class="fa fa-check"></i><b>1.6.1</b> Statistical significance</a></li>
<li class="chapter" data-level="1.6.2" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#more-on-ripleys-k"><i class="fa fa-check"></i><b>1.6.2</b> More on Ripley’s K</a></li>
<li class="chapter" data-level="1.6.3" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#caution-when-interpreting-these-clustering-functions"><i class="fa fa-check"></i><b>1.6.3</b> Caution when interpreting these clustering functions</a></li>
<li class="chapter" data-level="1.6.4" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#example-wildfires-in-florida"><i class="fa fa-check"></i><b>1.6.4</b> Example: Wildfires in Florida</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cluster-models"><i class="fa fa-check"></i><b>1.7</b> Cluster models</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#thinned-processes"><i class="fa fa-check"></i><b>1.7.1</b> Thinned processes</a></li>
<li class="chapter" data-level="1.7.2" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#markov-point-process-models"><i class="fa fa-check"></i><b>1.7.2</b> Markov point process models</a></li>
<li class="chapter" data-level="1.7.3" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#fitting-models-to-point-pattern-data"><i class="fa fa-check"></i><b>1.7.3</b> Fitting models to point pattern data</a></li>
<li class="chapter" data-level="1.7.4" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#steps-in-fitting-a-point-process-model"><i class="fa fa-check"></i><b>1.7.4</b> Steps in fitting a point process model</a></li>
<li class="chapter" data-level="1.7.5" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#model-diagnostics"><i class="fa fa-check"></i><b>1.7.5</b> Model diagnostics</a></li>
<li class="chapter" data-level="1.7.6" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#example-1-tropical-trees-1"><i class="fa fa-check"></i><b>1.7.6</b> Example 1: Tropical trees</a></li>
<li class="chapter" data-level="1.7.7" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#example-2-violent-tornado-occurrence"><i class="fa fa-check"></i><b>1.7.7</b> Example 2: Violent tornado occurrence</a></li>
<li class="chapter" data-level="1.7.8" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#example-3-does-terrain-roughness-affect-tornado-occurrence-rates"><i class="fa fa-check"></i><b>1.7.8</b> Example 3: Does terrain roughness affect tornado occurrence rates?</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#spatial-logistic-regression"><i class="fa fa-check"></i><b>1.8</b> Spatial logistic regression</a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#example-copper-ore-deposits"><i class="fa fa-check"></i><b>1.8.1</b> Example: Copper ore deposits</a></li>
<li class="chapter" data-level="1.8.2" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#challenge-problem"><i class="fa fa-check"></i><b>1.8.2</b> Challenge problem</a></li>
</ul></li>
<li class="chapter" data-level="1.9" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#machine-learning-on-spatial-data"><i class="fa fa-check"></i><b>1.9</b> Machine learning on spatial data</a></li>
<li class="chapter" data-level="1.10" data-path="analyzing-and-modeling-spatial-point-pattern-data.html"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#problem-set-4"><i class="fa fa-check"></i><b>1.10</b> Problem Set #4</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Applied Spatial Statistics for Geographers</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="analyzing-and-modeling-spatial-point-pattern-data" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Analyzing and Modeling Spatial Point Pattern Data</h1>
<p><strong>“Programming is the art of doing one thing at a time”</strong> — Michael Feathers</p>
<p>We naturally tend to assign order to things. We seek patterns in a collection of events. Stars in the night sky as constellations.</p>
<p>One pattern that tends to catch our attention is the spatial grouping of events. Groups of events in a particular region trigger us to look for an explanation. Why do events occur more often in this particular region?</p>
<div id="kansas-tornadoes-as-point-pattern-data" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Kansas tornadoes as point pattern data</h2>
<p>We motivate the study of point pattern data further by examining Kansas tornadoes. Let the genesis of a tornado be an event location and the maximum EF rating provide a mark for the event. We consider only events with marks of 1, 2, 3, 4, and 5.</p>
<p>Import the data.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb1-1"></a><span class="kw">library</span>(sf)</span></code></pre></div>
<pre><code>## Linking to GEOS 3.7.2, GDAL 2.4.2, PROJ 5.2.0</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb3-1"></a><span class="kw">library</span>(dplyr)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb7-1"></a>Torn.sf &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="dt">dsn =</span> <span class="st">&quot;1950-2018-torn-initpoint&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb7-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb7-2"></a><span class="st">             </span><span class="kw">filter</span>(st <span class="op">==</span><span class="st"> &quot;KS&quot;</span>, yr <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2007</span>, mag <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) </span></code></pre></div>
<pre><code>## Reading layer `1950-2018-torn-initpoint&#39; from data source `/Users/jelsner/Desktop/Projects/ASSFG-Book/1950-2018-torn-initpoint&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 63645 features and 22 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -163.53 ymin: 18.13 xmax: -64.9 ymax: 61.02
## CRS:            4326</code></pre>
<p>Then create a map using the functions in the {tmap} package. The state border is obtained as a simple feature data frame. The polygon geometry is plotted first with <code>tm_borders()</code> then the event locations are plotted with the <code>tm_bubbles()</code> and <code>size = "mag"</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb9-1"></a><span class="kw">library</span>(tmap) </span>
<span id="cb9-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb9-2"></a><span class="kw">library</span>(USAboundaries)</span>
<span id="cb9-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb9-3"></a></span>
<span id="cb9-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb9-4"></a>KS.sf &lt;-<span class="st"> </span><span class="kw">us_states</span>(<span class="dt">states =</span> <span class="st">&quot;Kansas&quot;</span>)</span>
<span id="cb9-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb9-5"></a></span>
<span id="cb9-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb9-6"></a><span class="kw">tm_shape</span>(KS.sf) <span class="op">+</span></span>
<span id="cb9-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb9-7"></a><span class="st">   </span><span class="kw">tm_borders</span>(<span class="dt">col =</span> <span class="st">&quot;grey70&quot;</span>) <span class="op">+</span></span>
<span id="cb9-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb9-8"></a><span class="kw">tm_shape</span>(Torn.sf) <span class="op">+</span></span>
<span id="cb9-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb9-9"></a><span class="st">   </span><span class="kw">tm_bubbles</span>(<span class="dt">size =</span> <span class="st">&quot;mag&quot;</span>, </span>
<span id="cb9-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb9-10"></a>              <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb9-11"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb9-11"></a>              <span class="dt">alpha =</span> <span class="fl">.4</span>,</span>
<span id="cb9-12"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb9-12"></a>              <span class="dt">title.size =</span> <span class="st">&quot;EF Rating&quot;</span>) <span class="op">+</span></span>
<span id="cb9-13"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb9-13"></a><span class="kw">tm_layout</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;top&quot;</span>),</span>
<span id="cb9-14"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb9-14"></a>           <span class="dt">legend.outside =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>For comparison we create a map using the functions in the {ggplot2} package. We use <code>geom_sf()</code> with county borders as a simple feature data frame and then adding another <code>geom_sf()</code> with the tornado genesis as a simple feature and the size aesthetic set to the EF rating.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb10-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb10-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb10-2"></a></span>
<span id="cb10-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb10-3"></a><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb10-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb10-4"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> KS.sf,</span>
<span id="cb10-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb10-5"></a>          <span class="dt">fill =</span> <span class="st">&quot;gray90&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb10-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb10-6"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data =</span> Torn.sf, </span>
<span id="cb10-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb10-7"></a>          <span class="kw">aes</span>(<span class="dt">size =</span> mag), </span>
<span id="cb10-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb10-8"></a>          <span class="dt">alpha =</span> <span class="fl">.4</span>,</span>
<span id="cb10-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb10-9"></a>          <span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb10-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb10-10"></a><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs =</span> <span class="dv">4326</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb10-11"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb10-11"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>Based on this display of tornado genesis locations as spatial events we ask: (1) Are certain areas of the state more likely to get a tornado? (2) Do tornadoes tend to cluster? (3) Are there places in the state that are safe from tornadoes?</p>
<p>These questions are similar but not identical. We explore these canonical questions about point pattern data in the next few lessons.</p>
</div>
<div id="definitions" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Definitions</h2>
<p>We need some definitions to get started.</p>
<ul>
<li>Event: An occurrence of interest (e.g., tornado, accident, wildfire).</li>
<li>Event location: Location of event (e.g., genesis latitude/longitude).</li>
<li>Point: Any location in the study area where an event could occur. Note: Event location is a particular point where an event did occur.</li>
<li>Point pattern data: A collection of observed (or simulated) event locations and a spatial domain of interest.</li>
<li>Domain: Defined by data availability (e.g., state or county boundary) or by the extent of the events.</li>
</ul>
<p>Complete spatial randomness (CSR; not to be confused with CRS–coordinate reference system) defines the situation where an event has an equal chance of occurring at any point in the domain regardless of other nearby events. In this case we say they event locations have a uniform probability distribution (uniformly distributed) across space. Note: uniform chance does not necessarily mean that the events have an ordered pattern (e.g., trees in an orchard). Some parts of the domain may get lucky (or unlucky).</p>
<p>Consider a set of event locations that are randomly but uniformly distributed within the unit plane.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb11-1"></a>x &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dt">n =</span> <span class="dv">50</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">1</span>)</span>
<span id="cb11-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb11-2"></a>y &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dt">n =</span> <span class="dv">50</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">1</span>)</span>
<span id="cb11-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb11-3"></a>df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(x, y, <span class="dt">name =</span> <span class="st">&quot;Point Pattern 1&quot;</span>)</span>
<span id="cb11-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb11-4"></a><span class="kw">ggplot</span>(df1, <span class="kw">aes</span>(x, y)) <span class="op">+</span></span>
<span id="cb11-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb11-5"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>This is one realization (sample) from a spatial point pattern process. A spatial point process is a mechanism for producing a set of event locations across space. The pattern of locations produced by the point process is described as CSR. There are groups of event locations and some gaps.</p>
<p>Let’s repeat to create a set of four realizations. Here we concatenate them into a single data frame with the <code>rbind()</code> function and then plot a four-panel figure using the <code>facet_wrap()</code> function.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb12-1"></a>df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">runif</span>(<span class="dt">n =</span> <span class="dv">30</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">1</span>),</span>
<span id="cb12-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb12-2"></a>                  <span class="dt">y =</span> <span class="kw">runif</span>(<span class="dt">n =</span> <span class="dv">30</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">1</span>),</span>
<span id="cb12-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb12-3"></a>                  <span class="dt">name =</span> <span class="st">&quot;Point Pattern 2&quot;</span>)</span>
<span id="cb12-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb12-4"></a>df3 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">runif</span>(<span class="dt">n =</span> <span class="dv">30</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">1</span>),</span>
<span id="cb12-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb12-5"></a>                  <span class="dt">y =</span> <span class="kw">runif</span>(<span class="dt">n =</span> <span class="dv">30</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">1</span>),</span>
<span id="cb12-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb12-6"></a>                  <span class="dt">name =</span> <span class="st">&quot;Point Pattern 3&quot;</span>)</span>
<span id="cb12-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb12-7"></a>df4 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">runif</span>(<span class="dt">n =</span> <span class="dv">30</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">1</span>),</span>
<span id="cb12-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb12-8"></a>                  <span class="dt">y =</span> <span class="kw">runif</span>(<span class="dt">n =</span> <span class="dv">30</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">1</span>),</span>
<span id="cb12-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb12-9"></a>                  <span class="dt">name =</span> <span class="st">&quot;Point Pattern 4&quot;</span>)</span>
<span id="cb12-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb12-10"></a>df &lt;-<span class="st"> </span><span class="kw">rbind</span>(df1, df2, df3, df4)</span>
<span id="cb12-11"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb12-11"></a><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(x, y)) <span class="op">+</span></span>
<span id="cb12-12"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb12-12"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb12-13"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb12-13"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>name)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Groups of nearby events illustrate that a certain degree of clustering occurs by chance (without cause) making visual assessment of clustering difficult.</p>
<p>Patterns of event locations that are described as completely spatially random are patterns that sit between event locations that are described as clustered and event locations that are described as ‘regular’.</p>
<p>To illustrate this idea we generate point pattern data that are more regular than CSR and point pattern data that are more clustered than CSR. Event locations are generated using the <code>rMaternI()</code> and <code>rMaternClust()</code> functions from the {spatstat} package. More about these later.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb13-1"></a><span class="kw">library</span>(spatstat)</span></code></pre></div>
<pre><code>## Loading required package: spatstat.data</code></pre>
<pre><code>## Loading required package: nlme</code></pre>
<pre><code>## 
## Attaching package: &#39;nlme&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     collapse</code></pre>
<pre><code>## Loading required package: rpart</code></pre>
<pre><code>## 
## spatstat 1.63-3       (nickname: &#39;Wet paint&#39;) 
## For an introduction to spatstat, type &#39;beginner&#39;</code></pre>
<pre><code>## 
## Attaching package: &#39;spatstat&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     marginSums</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb22-1"></a>m1 &lt;-<span class="st"> </span><span class="kw">rMaternI</span>(<span class="dt">kappa =</span> <span class="dv">100</span>, <span class="dt">r =</span> <span class="fl">.02</span>)</span>
<span id="cb22-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb22-2"></a>df1 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> m1<span class="op">$</span>x, <span class="dt">y =</span> m1<span class="op">$</span>y, <span class="dt">name =</span> <span class="st">&quot;Regular Pattern 1&quot;</span>)</span>
<span id="cb22-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb22-3"></a>m2 &lt;-<span class="st"> </span><span class="kw">rMaternI</span>(<span class="dt">kappa =</span> <span class="dv">100</span>, <span class="dt">r =</span> <span class="fl">.02</span>)</span>
<span id="cb22-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb22-4"></a>df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> m2<span class="op">$</span>x, <span class="dt">y =</span> m2<span class="op">$</span>y, <span class="dt">name =</span> <span class="st">&quot;Regular Pattern 2&quot;</span>)</span>
<span id="cb22-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb22-5"></a>m3 &lt;-<span class="st"> </span><span class="kw">rMatClust</span>(<span class="dt">kappa =</span> <span class="dv">30</span>, <span class="dt">r =</span> <span class="fl">.15</span>, <span class="dt">mu =</span> <span class="dv">4</span>)</span>
<span id="cb22-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb22-6"></a>df3 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> m3<span class="op">$</span>x, <span class="dt">y =</span> m3<span class="op">$</span>y, <span class="dt">name =</span> <span class="st">&quot;Cluster Pattern 1&quot;</span>)</span>
<span id="cb22-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb22-7"></a>m4 &lt;-<span class="st"> </span><span class="kw">rMatClust</span>(<span class="dt">kappa =</span> <span class="dv">30</span>, <span class="dt">r =</span> <span class="fl">.15</span>, <span class="dt">mu =</span> <span class="dv">4</span>)</span>
<span id="cb22-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb22-8"></a>df4 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> m4<span class="op">$</span>x, <span class="dt">y =</span> m4<span class="op">$</span>y, <span class="dt">name =</span> <span class="st">&quot;Cluster Pattern 2&quot;</span>)</span>
<span id="cb22-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb22-9"></a>df &lt;-<span class="st"> </span><span class="kw">rbind</span>(df1, df2, df3, df4)</span>
<span id="cb22-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb22-10"></a><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(x, y)) <span class="op">+</span></span>
<span id="cb22-11"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb22-11"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb22-12"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb22-12"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>name)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>The difference in the arrangement of event locations between a regular and a cluster process is a bit more clear. But the difference between CSR and either of them is usually not.</p>
<p>And spatial scale matters. A set of event locations can be regular on a small scale but clustered on a larger scale.</p>
<p>Probability models for spatial patterns motivate methods for detecting event clustering. A probability model generates a stochastic process.</p>
<p>For example, we can think of crime as a stochastic process defined by location and influenced by environmental factors. The probability of a crime occurring at a particular location is the random variable and we can estimate the probability of a crime event at any location given factors that influence crime.</p>
<p>A spatial point process is a stochastic process where event location is the random variable. A realization of the process is a collection of events generated under the probability model. The theory of spatial point processes is developed by Ripley (1981), Diggle (1983), and Cressie (1993).</p>
<p>The theory requires a few more definitions.</p>
<div id="stationarity-and-isotropy" class="section level3" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> Stationarity and isotropy</h3>
<p>A spatial point process is said to be <em>stationary</em> if the statistical properties of the events are invariant to translation across the domain. This means that the relationship between two events depends only on the relative event locations (not on where the events occur in the domain). Relative location (or spatial lag) refers to distance and orientation.</p>
<p>In the case where the statistical properties do not depend on the orientation of event pairs the process is said to be <em>isotropic</em>.</p>
<p>Stationarity and isotropy allow for replication within a data set. Under the assumption that the point pattern is generated from a stationary process, two event pairs that are separated by the same distance should have the same relatedness. This is analogous to the assumption we make when we define our weights matrix for spatially aggregated data. The assumptions of stationarity and isotropy are starting points for modeling point pattern data.</p>
</div>
<div id="spatial-poisson-process" class="section level3" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> Spatial Poisson process</h3>
<p>The Poisson distribution defines a simple model for complete spatial randomness (CSR). A point process is said to be ‘homogeneous Poisson’ under the following two criteria:</p>
<ol style="list-style-type: decimal">
<li>The number of events, N, occurring within a finite domain A is a random variable described by a Poisson distribution with mean <span class="math inline">\(\lambda\)</span>|A| for some positive constant <span class="math inline">\(\lambda\)</span>, with |A| denoting the area of the domain, and</li>
<li>The locations of the N events represent a random sample where each point in A is <em>equally likely</em> to be chosen as an event location.</li>
</ol>
<p>The first criteria of a Poisson distribution refers to a probability model describing the number of events. It expresses the probability of a given number of events occurring in a fixed interval of space when the events occur with a known constant rate.</p>
<p>The Poisson parameter defines the <em>intensity</em> of the point process. Given a set of events, an estimate for the mean (rate) parameter of the Poisson distribution is given by the number of events divided by the domain area.</p>
<p>The second criteria ensures the events are scattered about the domain without clustering or regularity.</p>
<p>The procedure to create a homogeneous Poisson point process follows directly from its definition. Step 1: Sample the total number of events from a Poisson distribution with a mean that is proportional to the domain area. Step 2: Place each event within the domain with coordinates given by a <em>uniform distribution</em>.</p>
<p>For example, let area |A| = 1, and the rate of occurrence <span class="math inline">\(\lambda\)</span> = 20, then</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb23-1"></a>lambda &lt;-<span class="st"> </span><span class="dv">20</span></span>
<span id="cb23-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb23-2"></a>N &lt;-<span class="st"> </span><span class="kw">rpois</span>(<span class="dv">1</span>, lambda)</span>
<span id="cb23-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb23-3"></a>x &lt;-<span class="st"> </span><span class="kw">runif</span>(N)</span>
<span id="cb23-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb23-4"></a>y &lt;-<span class="st"> </span><span class="kw">runif</span>(N)</span>
<span id="cb23-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb23-5"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(x, y)</span>
<span id="cb23-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb23-6"></a><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(x, y)) <span class="op">+</span></span>
<span id="cb23-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb23-7"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>) </span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>The set of events represents a realization (sample) from a homogeneous Poisson point process. The intensity of the events is specified first then the locations are placed uniformly inside the domain. The domain need not be regular. The actual number of events varies from one realization to the next.</p>
<p>By construction this point pattern is CSR. However, we are typically in the opposite position. We observe a set of events and we want to know if the events are regular or clustered. Our null hypothesis is CSR and we need a test statistic that will guide our inference. The null models are simple so we can use Monte Carlo methods to generate many realizations.</p>
</div>
<div id="heterogeneous-poisson-process" class="section level3" number="1.2.3">
<h3><span class="header-section-number">1.2.3</span> Heterogeneous Poisson process</h3>
<p>In many cases the homogeneous Poisson model as the null hypothesis is not restrictive enough. This means that we can easily reject the null hypothesis but not learn anything interesting about our data. For example, often with health events (locations of people with heart disease) CSR is not an appropriate model because a null hypothesis that incidences are equally likely does not consider that people cluster (locations at risk are not uniform).</p>
<p>Each person has the same risk of heart disease regardless of location, and we expect more cases in areas with more people at risk. Clusters of cases in high population areas violate the CSR but not necessarily the constant risk hypothesis. The constant risk hypothesis requires the intensity of the spatial process be defined as a spatially varying function. That is, we define the intensity as <span class="math inline">\(\lambda(s)\)</span>, where <span class="math inline">\(s\)</span> denotes location.</p>
<p>The intensity (density) function is a first-order property of the random process. If intensity varies (significantly) across the domain the process is said to be heterogeneous. The intensity function describes the expected number of events at any location of the region. Events might be independent of one another, but groups of events appear because of the changing intensity.</p>
</div>
</div>
<div id="point-pattern-objects-in-the-spatstat-package" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Point pattern objects in the {spatstat} package</h2>
<p>We will use functions from the {spatstat} package to analyze and model point pattern data. Point pattern data are represented in {spatstat} by an object of class <code>ppp</code> (for planar point pattern) which contains the coordinates of the events, optional values attached to the events (called ‘marks’), and a description of the domain or ‘window’ over which the events are observed. See <code>?ppp.object()</code> for details.</p>
<p>Spatial statistics computed on a <code>ppp</code> object will be somewhat sensitive to the choice of the window (domain), so some thought should go into deciding what it should be.</p>
<p>As an example, the data <code>swedishpines</code> is available in the package as a <code>ppp</code> object.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb24-1"></a><span class="kw">library</span>(spatstat)</span>
<span id="cb24-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb24-2"></a></span>
<span id="cb24-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb24-3"></a><span class="kw">class</span>(swedishpines)</span></code></pre></div>
<pre><code>## [1] &quot;ppp&quot;</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb26-1"></a>swedishpines</span></code></pre></div>
<pre><code>## Planar point pattern: 71 points
## window: rectangle = [0, 96] x [0, 100] units (one unit = 0.1 metres)</code></pre>
<p>The data is a planar point pattern object with 71 events. Caution: Unfortunately called the events are called ‘points’ because as was explained above, the theory was developed using the definition that a point represented a potential event not necessarily an actual event location.</p>
<p>All the events are contained within a rectangle window of size 9.6 by 10 meters.</p>
<p>There is a <code>plot()</code> method for <code>ppp</code> objects that provides an easy way to view the data and the window.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb28-1"></a><span class="kw">plot</span>(swedishpines)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Events are plotted as open circles inside a window. The plot is labeled with the name of the <code>ppp</code> object.</p>
<p>The function <code>convexhull()</code> creates a convex hull around the events. Here we add the convex hull to our plot.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb29-1"></a><span class="kw">plot</span>(swedishpines)</span>
<span id="cb29-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb29-2"></a><span class="kw">plot</span>(<span class="kw">convexhull</span>(swedishpines), </span>
<span id="cb29-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb29-3"></a>     <span class="dt">add =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Recall that the hull defines the minimum area convex polygon that contains all the events.</p>
<p>The domain (window) for analysis and modeling should be somewhat larger than the convex hull. The function <code>ripras()</code> computes a spatial domain based on the event locations alone assuming the locations are independent and identically distributed. Here we add this polygon to our plot.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb30-1"></a><span class="kw">plot</span>(swedishpines)</span>
<span id="cb30-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb30-2"></a><span class="kw">plot</span>(<span class="kw">convexhull</span>(swedishpines), </span>
<span id="cb30-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb30-3"></a>     <span class="dt">add =</span> <span class="ot">TRUE</span>)</span>
<span id="cb30-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb30-4"></a><span class="kw">plot</span>(<span class="kw">ripras</span>(swedishpines), </span>
<span id="cb30-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb30-5"></a>     <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">lty =</span> <span class="st">&quot;dotted&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>The window can have an arbitrary shape. A rectangle, a polygon, a collection of polygons including holes, or a binary image (mask). A window can be stored as a separate object of class <code>owin</code>. See <code>?owin.object()</code> for details.</p>
<p>Each event may carry information called a ‘mark’. A mark can be continuous (e.g. tree height) or discrete (tree species).</p>
<p>A multitype point pattern is one in which the events are marked using a factor (e.g., tree species). The mark values are given in a vector of the same length as the vector of locations. That is, <code>marks[i]</code> is the mark attached to the point (<code>x[i]</code>, <code>y[i]</code>).</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb31-1"></a><span class="kw">plot</span>(demopat)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb32-1"></a><span class="kw">marks</span>(demopat)</span></code></pre></div>
<pre><code>##   [1] A B B A B B B A A A B A A B B A A A B B A A A A B B B A A B B B B B A A B
##  [38] A A B B A A B B B B A B B B B B B B A A A B A B A B B B B B A B B A A B B
##  [75] B B B A B B A A B A B B B A B A B B B B B A A B A B B B B B A A A B A B B
## [112] A
## Levels: A B</code></pre>
<p>Here the domain is defined as an irregular concave polygon with a hole. The distinction between inside and outside is important for all spatial statistics computed using the events.</p>
<p>For a multitype pattern (where the marks are factors) we use the <code>split()</code> function to separate the point pattern objects by mark type. Consider the Lansing Woods data set (<code>lansing</code>) with marks corresponding to tree species.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb34-1"></a><span class="kw">data</span>(lansing)</span>
<span id="cb34-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb34-2"></a>LW &lt;-<span class="st"> </span>lansing</span>
<span id="cb34-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb34-3"></a></span>
<span id="cb34-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb34-4"></a><span class="kw">plot</span>(<span class="kw">split</span>(LW))</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
<div id="spatial-varying-intensity" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Spatial varying intensity</h2>
<p>Given a set of events, how do we estimate the intensity function? Quadrat counting is a simple way. The spatial domain is divided into a grid of rectangular cells and the number of events in each cell is counted.</p>
<p>Quadrat counting is done with the <code>quadratcount()</code> function.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb35-1"></a><span class="kw">quadratcount</span>(swedishpines)</span></code></pre></div>
<pre><code>##           x
## y          [0,19.2) [19.2,38.4) [38.4,57.6) [57.6,76.8) [76.8,96]
##   [80,100]        3           1           2           3         3
##   [60,80)         4           4           3           1         2
##   [40,60)         3           5           3           7         3
##   [20,40)         1           1           2           3         3
##   [0,20)          1           2           2           4         5</code></pre>
<p>The default divides the data into a 5 x 5 grid. The event count in each grid cell is produced.</p>
<p>To change the default number of cells in x and y directions we use the <code>nx =</code> and <code>ny =</code> arguments.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb37-1"></a><span class="kw">quadratcount</span>(swedishpines, </span>
<span id="cb37-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb37-2"></a>             <span class="dt">nx =</span> <span class="dv">2</span>, </span>
<span id="cb37-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb37-3"></a>             <span class="dt">ny =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##              x
## y             [0,48) [48,96]
##   [66.7,100]      10      11
##   [33.3,66.7)     14      14
##   [0,33.3)         7      15</code></pre>
<p>We can plot the quadrat counts with the plot method.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb39-1"></a><span class="kw">plot</span>(<span class="kw">quadratcount</span>(swedishpines))</span>
<span id="cb39-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb39-2"></a><span class="kw">plot</span>(swedishpines, <span class="dt">pty =</span> <span class="dv">19</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>, </span>
<span id="cb39-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb39-3"></a>     <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>Note that the cell areas will not be equal when the domain boundaries are irregular.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb40-1"></a><span class="kw">plot</span>(<span class="kw">quadratcount</span>(demopat))</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>When the number of events is large, hexagon cells are useful. The process is: (1) tessellate the domain by a regular grid of hexagons, (2) count the number of events in each hexagon, and (3) use a color ramp to display the events per hexagon.</p>
<p>Here we generate 20K random values from the standard normal distribution for the x coordinate and repeat for the y coordinate. We then use the <code>hexbin()</code> function from the {hexbin} package and specify 10 bins in the x direction to count the number of events in each hexagon and assign the result to the object <code>hbin</code>.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb41-1"></a><span class="kw">library</span>(hexbin)</span>
<span id="cb41-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb41-2"></a></span>
<span id="cb41-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb41-3"></a>x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">20000</span>)</span>
<span id="cb41-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb41-4"></a>y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">20000</span>)</span>
<span id="cb41-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb41-5"></a>hbin &lt;-<span class="st"> </span><span class="kw">hexbin</span>(x, y, <span class="dt">xbins =</span> <span class="dv">10</span>) </span>
<span id="cb41-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb41-6"></a><span class="kw">str</span>(hbin)</span></code></pre></div>
<pre><code>## Formal class &#39;hexbin&#39; [package &quot;hexbin&quot;] with 16 slots
##   ..@ cell  : int [1:90] 4 5 6 14 15 16 17 18 19 24 ...
##   ..@ count : int [1:90] 1 2 4 5 13 20 16 5 3 1 ...
##   ..@ xcm   : num [1:90] -1.3108 -0.752 -0.0365 -2.14 -1.1957 ...
##   ..@ ycm   : num [1:90] -3.64 -3.66 -3.49 -2.76 -2.9 ...
##   ..@ xbins : num 10
##   ..@ shape : num 1
##   ..@ xbnds : num [1:2] -4.12 4.06
##   ..@ ybnds : num [1:2] -3.7 4.42
##   ..@ dimen : num [1:2] 14 11
##   ..@ n     : int 20000
##   ..@ ncells: int 90
##   ..@ call  : language hexbin(x = x, y = y, xbins = 10)
##   ..@ xlab  : chr &quot;x&quot;
##   ..@ ylab  : chr &quot;y&quot;
##   ..@ cID   : NULL
##   ..@ cAtt  : int(0)</code></pre>
<p>The package uses S4 data classes so the output is stored in slots.</p>
<p>There is a plot method.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb43-1"></a><span class="kw">plot</span>(hbin)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Hexagons have symmetric nearest neighbors (there is only rook contiguity). They have the most sides of any polygon that can tessellate the plane. They are generally more efficient than rectangles at covering the events. In other words it takes fewer of them to cover the same number of events. They are visually less biased for displaying densities compared to squares/rectangles.</p>
<p>As another example, generate a large number of random events in the two-dimensional plane. Use a normal distribution in the x-direction and a student t-distribution in the y-direction.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb44-1"></a><span class="kw">set.seed</span>(<span class="dv">131</span>)</span>
<span id="cb44-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb44-2"></a>x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">7777</span>)</span>
<span id="cb44-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb44-3"></a>y &lt;-<span class="st"> </span><span class="kw">rt</span>(<span class="dv">7777</span>, <span class="dt">df =</span> <span class="dv">3</span>)</span>
<span id="cb44-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb44-4"></a>hbin2 &lt;-<span class="st"> </span><span class="kw">hexbin</span>(x, y, <span class="dt">xbins =</span> <span class="dv">25</span>)</span>
<span id="cb44-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb44-5"></a><span class="kw">plot</span>(hbin2)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>The {ggplot2} package has the <code>stat_binhex()</code> function so that also can be used for display.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb45-1"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(x, y)</span>
<span id="cb45-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb45-2"></a><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(x, y)) <span class="op">+</span></span>
<span id="cb45-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb45-3"></a><span class="st">  </span><span class="kw">stat_binhex</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<div id="kernel-density" class="section level3" number="1.4.1">
<h3><span class="header-section-number">1.4.1</span> Kernel density</h3>
<p>Another way to quantify the spatial intensity of the process is with kernel density. A kernel density estimator is a smoothing function that gives the average number of events at any location in the domain.</p>
<p>Here we generate 100 events uniformly on the real number line between 0 and 1. The kernel density estimator is applied using different bandwidths.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb46-1"></a>e &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">100</span>)</span>
<span id="cb46-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb46-2"></a>dd1 &lt;-<span class="st"> </span><span class="kw">density</span>(e, <span class="dt">bw =</span> <span class="fl">.025</span>)</span>
<span id="cb46-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb46-3"></a>dd2 &lt;-<span class="st"> </span><span class="kw">density</span>(e, <span class="dt">bw =</span> <span class="fl">.05</span>)</span>
<span id="cb46-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb46-4"></a>dd3 &lt;-<span class="st"> </span><span class="kw">density</span>(e, <span class="dt">bw =</span> <span class="fl">.1</span>)</span>
<span id="cb46-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb46-5"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">c</span>(dd1<span class="op">$</span>x, dd2<span class="op">$</span>x, dd3<span class="op">$</span>x), </span>
<span id="cb46-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb46-6"></a>                 <span class="dt">y =</span> <span class="kw">c</span>(dd1<span class="op">$</span>y, dd2<span class="op">$</span>y, dd3<span class="op">$</span>y),</span>
<span id="cb46-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb46-7"></a>                <span class="dt">bw =</span> <span class="kw">c</span>(<span class="kw">rep</span>(<span class="st">&quot;Bandwidth = .025&quot;</span>, <span class="dv">512</span>), </span>
<span id="cb46-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb46-8"></a>                       <span class="kw">rep</span>(<span class="st">&quot;Bandwidth = .05&quot;</span>, <span class="dv">512</span>),</span>
<span id="cb46-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb46-9"></a>                       <span class="kw">rep</span>(<span class="st">&quot;Bandwidth = .1&quot;</span>, <span class="dv">512</span>)))</span>
<span id="cb46-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb46-10"></a>df2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> e, <span class="dt">y =</span> <span class="dv">0</span>)</span>
<span id="cb46-11"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb46-11"></a><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(x, y)) <span class="op">+</span></span>
<span id="cb46-12"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb46-12"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb46-13"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb46-13"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>bw, <span class="dt">nrow =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb46-14"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb46-14"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(x, y), <span class="dt">data =</span> df2, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>As the bandwidth increases the curve indicated by the black line becomes smoother. The density is estimated at every location on the number line, not just at the location of the event.</p>
<p>The density is a summation of the kernels with one kernel centered on top of each event location. Event locations are marked with a point along the x-axis and the kernel is a Gaussian (normal) density. It is placed on each event and the bandwidth specifies the distance between the inflection points of the kernel. The one-dimensional density estimate extends to two (or more) dimensions.</p>
</div>
<div id="example-1-tropical-trees" class="section level3" number="1.4.2">
<h3><span class="header-section-number">1.4.2</span> Example 1: Tropical trees</h3>
<p>The object <code>bei</code> is a planar point pattern object with the locations of 3605 trees in a tropical rain forest. The data are part of the {spatstat} package.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb47-1"></a><span class="kw">plot</span>(bei)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>The point pattern data is accompanied by a data set (<code>bei.extra</code>) of elevation (<code>elev</code>) and slope of elevation (<code>grad</code>) across the region.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb48-1"></a><span class="kw">plot</span>(bei.extra)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>These data are given as <code>im</code> (image) objects in a list format.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb49-1"></a><span class="kw">class</span>(bei.extra<span class="op">$</span>elev)</span></code></pre></div>
<pre><code>## [1] &quot;im&quot;</code></pre>
<p>An image object contains a list with 10 elements including the matrix of values (<code>v</code>).</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb51-1"></a><span class="kw">str</span>(bei.extra<span class="op">$</span>elev)</span></code></pre></div>
<pre><code>## List of 10
##  $ v     : num [1:101, 1:201] 121 121 121 121 121 ...
##  $ dim   : int [1:2] 101 201
##  $ xrange: num [1:2] -2.5 1002.5
##  $ yrange: num [1:2] -2.5 502.5
##  $ xstep : num 5
##  $ ystep : num 5
##  $ xcol  : num [1:201] 0 5 10 15 20 25 30 35 40 45 ...
##  $ yrow  : num [1:101] 0 5 10 15 20 25 30 35 40 45 ...
##  $ type  : chr &quot;real&quot;
##  $ units :List of 3
##   ..$ singular  : chr &quot;metre&quot;
##   ..$ plural    : chr &quot;metres&quot;
##   ..$ multiplier: num 1
##   ..- attr(*, &quot;class&quot;)= chr &quot;unitname&quot;
##  - attr(*, &quot;class&quot;)= chr &quot;im&quot;</code></pre>
<p>The window focuses the analysis on a particular region. Suppose you want to model locations of a certain tree type but only for trees located at elevations above 145 meters. The <code>levelset()</code> function creates a window from an image object as follows:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb53-1"></a>W &lt;-<span class="st"> </span><span class="kw">levelset</span>(bei.extra<span class="op">$</span>elev, </span>
<span id="cb53-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb53-2"></a>              <span class="dt">thresh =</span> <span class="dv">145</span>, </span>
<span id="cb53-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb53-3"></a>              <span class="dt">compare =</span> <span class="st">&quot;&gt;&quot;</span>)</span>
<span id="cb53-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb53-4"></a><span class="kw">class</span>(W)</span></code></pre></div>
<pre><code>## [1] &quot;owin&quot;</code></pre>
<p>The result is an object of class <code>owin</code>. The plot method displays the window which is the region in black.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb55-1"></a><span class="kw">plot</span>(W)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>We subset the point pattern data by the window using the bracket operator (<code>[]</code>) as we do with a data frame.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb56-1"></a>beiW &lt;-<span class="st"> </span>bei[W]</span>
<span id="cb56-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb56-2"></a><span class="kw">plot</span>(beiW)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>Now the analysis window is white and the event locations are plotted on top.</p>
<p>As another example we create a window where altitude is lower than 145 m and slope exceeds .1 degrees. In this case we use the <code>solutionset()</code> function.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb57-1"></a>V &lt;-<span class="st"> </span><span class="kw">solutionset</span>(bei.extra<span class="op">$</span>elev <span class="op">&lt;=</span><span class="st"> </span><span class="dv">145</span> <span class="op">&amp;</span><span class="st"> </span></span>
<span id="cb57-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb57-2"></a><span class="st">                 </span>bei.extra<span class="op">$</span>grad <span class="op">&gt;</span><span class="st"> </span><span class="fl">.1</span>)</span>
<span id="cb57-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb57-3"></a>beiV &lt;-<span class="st"> </span>bei[V]</span>
<span id="cb57-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb57-4"></a><span class="kw">plot</span>(beiV)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>We compute the spatial intensity over the domain with the <code>density()</code> method using the default Gaussian kernel and fixed bandwidth determined by the window size.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb58-1"></a>den &lt;-<span class="st"> </span><span class="kw">density</span>(beiV)</span>
<span id="cb58-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb58-2"></a><span class="kw">plot</span>(den)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>The units of intensity are events per unit area (here square meters). The intensity values are computed on a grid (<span class="math inline">\(v\)</span>) and are returned as a pixel image.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb59-1"></a><span class="kw">sum</span>(<span class="kw">is.na</span>(den<span class="op">$</span>v))</span></code></pre></div>
<pre><code>## [1] 16020</code></pre>
<p>There are over 16K of the cells that have a value of <code>NA</code>.</p>
</div>
<div id="example-2-kansas-tornadoes" class="section level3" number="1.4.3">
<h3><span class="header-section-number">1.4.3</span> Example 2: Kansas tornadoes</h3>
<p>Let’s return to the Kansas tornadoes. One of the first issues I encountered in the field of tornado climatology was reporting ‘bias’.</p>
<p>Here we are interested in the intensity of tornado genesis locations in Kansas. Import the data as a simple features data frame and transform the geographic CRS to a web Mercator.</p>
<p>We did this to start the class but here we get all the tornadoes.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb61-1"></a><span class="kw">library</span>(sf)</span>
<span id="cb61-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb61-2"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb61-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb61-3"></a></span>
<span id="cb61-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb61-4"></a>Torn.sf &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="dt">dsn =</span> <span class="st">&quot;1950-2018-torn-initpoint&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb61-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb61-5"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> <span class="dv">3857</span>) <span class="op">%&gt;%</span></span>
<span id="cb61-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb61-6"></a><span class="st">  </span><span class="kw">filter</span>(st <span class="op">==</span><span class="st"> &quot;KS&quot;</span>, mag <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb61-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb61-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">EF =</span> <span class="kw">as.factor</span>(mag)) <span class="op">%&gt;%</span></span>
<span id="cb61-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb61-8"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(EF)</span></code></pre></div>
<pre><code>## Reading layer `1950-2018-torn-initpoint&#39; from data source `/Users/jelsner/Desktop/Projects/ASSFG-Book/1950-2018-torn-initpoint&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 63645 features and 22 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -163.53 ymin: 18.13 xmax: -64.9 ymax: 61.02
## CRS:            4326</code></pre>
<p>Plot them.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb63-1"></a><span class="kw">plot</span>(Torn.sf)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>Q: What is wrong?</p>
<p>Instead of filtering by column name we should subset by geometry. We saw how to do this in Lesson 6 with the <code>st_contains()</code> (<code>st_intersection()</code>) function. Here since we are using the functions in the {spatstat} package we do this by defining the window.</p>
<p>Import the data again, this time keeping all the events with an EF rating. Here we project the geographic CRS to a Lambert conic conformal centered on Kansas (EPSG:6922).</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb64-1"></a>Torn.sf &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="dt">dsn =</span> <span class="st">&quot;1950-2018-torn-initpoint&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb64-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb64-2"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> <span class="dv">6922</span>) <span class="op">%&gt;%</span></span>
<span id="cb64-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb64-3"></a><span class="st">  </span><span class="kw">filter</span>(mag <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb64-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb64-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">EF =</span> <span class="kw">as.factor</span>(mag)) <span class="op">%&gt;%</span></span>
<span id="cb64-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb64-5"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(EF)</span></code></pre></div>
<pre><code>## Reading layer `1950-2018-torn-initpoint&#39; from data source `/Users/jelsner/Desktop/Projects/ASSFG-Book/1950-2018-torn-initpoint&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 63645 features and 22 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -163.53 ymin: 18.13 xmax: -64.9 ymax: 61.02
## CRS:            4326</code></pre>
<p>Next create a spatial window as an <code>owin</code> object. We first obtain the Kansas border as a simple feature data frame from the {USAboundaries} package and transform the CRS to that of the tornadoes. We then convert the simple feature object to an S4 <code>SpatialPolygons</code> object before converting it to an <code>owin</code> object with the <code>as.owin()</code> function. Make sure functions from the {maptools} package are available to the current session.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb66-1"></a><span class="kw">library</span>(USAboundaries)</span>
<span id="cb66-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb66-2"></a><span class="kw">library</span>(maptools)</span></code></pre></div>
<pre><code>## Loading required package: sp</code></pre>
<pre><code>## Checking rgeos availability: TRUE</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb69-1"></a>KS.sf &lt;-<span class="st"> </span><span class="kw">us_states</span>(<span class="dt">states =</span> <span class="st">&quot;Kansas&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb69-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb69-2"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> <span class="kw">st_crs</span>(Torn.sf))</span>
<span id="cb69-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb69-3"></a></span>
<span id="cb69-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb69-4"></a>KS.sp &lt;-<span class="st"> </span><span class="kw">as</span>(KS.sf, <span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb69-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb69-5"></a>KS.win &lt;-<span class="st"> </span><span class="kw">as</span>(KS.sp, <span class="st">&#39;owin&#39;</span>)</span></code></pre></div>
<p>Next convert the tornado simple feature data frame to a <code>ppp</code> object with the EF rating as the marks. Again we need to first convert to an S4 class spatial object.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb70-1"></a>Torn.sp &lt;-<span class="st"> </span><span class="kw">as</span>(Torn.sf, <span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb70-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb70-2"></a></span>
<span id="cb70-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb70-3"></a>T.ppp &lt;-<span class="st"> </span><span class="kw">as</span>(Torn.sp[<span class="st">&quot;EF&quot;</span>], <span class="st">&quot;ppp&quot;</span>)</span>
<span id="cb70-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb70-4"></a><span class="kw">plot</span>(T.ppp)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>Finally subset the event locations by the Kansas border using the subset operator (<code>[]</code>).</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb71-1"></a>T.ppp &lt;-<span class="st"> </span>T.ppp[KS.win]</span>
<span id="cb71-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb71-2"></a><span class="kw">plot</span>(T.ppp)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>Rescale the units from meters to kilometers. Recall that the spatial unit is given in the CRS of the simple feature.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb72-1"></a>T.ppp &lt;-<span class="st"> </span>spatstat<span class="op">::</span><span class="kw">rescale</span>(T.ppp, </span>
<span id="cb72-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb72-2"></a>                           <span class="dt">s =</span> <span class="dv">1000</span>, </span>
<span id="cb72-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb72-3"></a>                           <span class="dt">unitname =</span> <span class="st">&quot;km&quot;</span>)</span>
<span id="cb72-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb72-4"></a><span class="kw">summary</span>(T.ppp)</span></code></pre></div>
<pre><code>## Marked planar point pattern:  4234 points
## Average intensity 0.01986229 points per square km
## 
## *Pattern contains duplicated points*
## 
## Coordinates are given to 5 decimal places
## 
## Multitype:
##   frequency  proportion    intensity
## 0      2512 0.593292400 1.178414e-02
## 1      1044 0.246575300 4.897550e-03
## 2       449 0.106046300 2.106322e-03
## 3       185 0.043693910 8.678609e-04
## 4        38 0.008974965 1.782633e-04
## 5         6 0.001417100 2.814684e-05
## 
## Window: polygonal boundary
## single connected closed polygon with 170 vertices
## enclosing rectangle: [62.4467, 723.2754] x [110.7986, 451.0722] km
##                      (660.8 x 340.3 km)
## Window area = 213168 square km
## Unit of length: 1 km
## Fraction of frame area: 0.948</code></pre>
<p>Caution here about recycling names. If we rerun the above code chunk the scale will change again!</p>
<p>There are 4234 tornado reports with an average intensity of .02 tornadoes per square km over this time period. Nearly 60% of all Kansas tornadoes have been EF0. Only about 1% of tornadoes in Kansas have been ‘violent’ (EF4 or EF5). The area of the state is 213,168 square km.</p>
<p>We plot the events by magnitude using the <code>plot()</code> method together with the <code>split()</code> function.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb74-1"></a><span class="kw">plot</span>(<span class="kw">split</span>(T.ppp))</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<p>The number of events varies across the state (see EF4 events for example) but it’s difficult to say whether this is due to sampling variation.</p>
<p>To illustrate this here we compare the EF1 tornado locations with a sample of events generated under the null hypothesis of CSR.</p>
<p>We first create <code>Y</code> as an unmarked <code>ppp</code> object of our tornadoes. We do this by subsetting on the marks and using the <code>unmark()</code> function. The spatial intensity of the EF1 tornado events is obtained from the <code>summary()</code> method. Make a plot to check if things look correct.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb75-1"></a>Y &lt;-<span class="st"> </span><span class="kw">unmark</span>(T.ppp[T.ppp<span class="op">$</span>marks <span class="op">==</span><span class="st"> </span><span class="dv">1</span>])</span>
<span id="cb75-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb75-2"></a><span class="kw">summary</span>(Y)</span></code></pre></div>
<pre><code>## Planar point pattern:  1044 points
## Average intensity 0.00489755 points per square km
## 
## *Pattern contains duplicated points*
## 
## Coordinates are given to 5 decimal places
## 
## Window: polygonal boundary
## single connected closed polygon with 170 vertices
## enclosing rectangle: [62.4467, 723.2754] x [110.7986, 451.0722] km
##                      (660.8 x 340.3 km)
## Window area = 213168 square km
## Unit of length: 1 km
## Fraction of frame area: 0.948</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb77-1"></a><span class="kw">plot</span>(Y)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>There are 1044 EF1 tornadoes over the state.</p>
<p>Let <code>X</code> be a set of events generated from a homogeneous Poisson process (a model for CSR). Let the intensity of the events be equal to that of the data. Here we use the <code>rpoispp()</code> function to generate the event locations and we set <code>lambda</code> equal to the intensity of the object <code>Y</code> using the same window as <code>Y</code>.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb78-1"></a>X &lt;-<span class="st"> </span><span class="kw">rpoispp</span>(<span class="dt">lambda =</span> <span class="kw">summary</span>(Y)<span class="op">$</span>intensity, </span>
<span id="cb78-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb78-2"></a>             <span class="dt">win =</span> <span class="kw">window</span>(Y))</span>
<span id="cb78-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb78-3"></a><span class="kw">summary</span>(X)<span class="op">$</span>intensity</span></code></pre></div>
<pre><code>## [1] 0.00493977</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb80-1"></a><span class="kw">plot</span>(X)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<p>There appears to be some difference.</p>
<p>The <code>superimpose()</code> function is used to create a single <code>ppp</code> object with marks <code>Y</code> and <code>X</code>.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb81-1"></a>Z &lt;-<span class="st"> </span><span class="kw">superimpose</span>(<span class="dt">Y =</span> Y, <span class="dt">X =</span> X)</span></code></pre></div>
<pre><code>## Warning: data contain duplicated points</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb83-1"></a><span class="kw">plot</span>(<span class="kw">density</span>(<span class="kw">split</span>(Z)))</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<p>The range of local intensity variations is similar. So we don’t have much evidence against the null model of CSR as defined by a homogeneous Poisson process.</p>
</div>
<div id="tornado-reports-as-a-function-of-distance-from-nearest-town" class="section level3" number="1.4.4">
<h3><span class="header-section-number">1.4.4</span> Tornado reports as a function of distance from nearest town</h3>
<p>We know that tornado reports are more common near cities and towns. This is especially true in the earlier years of the record. This knowledge is available from the literature on tornadoes (not from the data). It is a well-known artifact of the data set, but it had never been quantified until we did it in 2013 <a href="http://myweb.fsu.edu/jelsner/PDF/Research/ElsnerMichaelsScheitlinElsner2013.pdf" class="uri">http://myweb.fsu.edu/jelsner/PDF/Research/ElsnerMichaelsScheitlinElsner2013.pdf</a>.</p>
<p>Here we estimate the intensity as a function of distance from nearest town.</p>
<p>Import the spatial data frame of city locations. Set and convert the CRS. Filter to exclude cities with fewer than 1000 people.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb84-1"></a><span class="kw">download.file</span>(<span class="st">&quot;http://myweb.fsu.edu/jelsner/temp/data/ci08au12.zip&quot;</span>,</span>
<span id="cb84-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb84-2"></a>              <span class="st">&quot;ci08au12.zip&quot;</span>)</span>
<span id="cb84-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb84-3"></a><span class="kw">unzip</span>(<span class="st">&quot;ci08au12.zip&quot;</span>)</span>
<span id="cb84-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb84-4"></a></span>
<span id="cb84-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb84-5"></a>C.sf &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="dt">dsn =</span> <span class="st">&quot;.&quot;</span>,</span>
<span id="cb84-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb84-6"></a>                <span class="dt">layer =</span> <span class="st">&quot;ci08au12&quot;</span>,</span>
<span id="cb84-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb84-7"></a>                <span class="dt">quiet =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb84-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb84-8"></a><span class="st">  </span><span class="kw">st_set_crs</span>(<span class="dv">4326</span>) <span class="op">%&gt;%</span></span>
<span id="cb84-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb84-9"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> <span class="kw">st_crs</span>(Torn.sf)) <span class="op">%&gt;%</span></span>
<span id="cb84-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb84-10"></a><span class="st">  </span><span class="kw">filter</span>(POP_<span class="dv">1990</span> <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1000</span>)</span></code></pre></div>
<p>Or instead from the {USAboundariesData} package.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb85-1"></a>C.sf &lt;-<span class="st"> </span>USAboundaries<span class="op">::</span><span class="kw">us_cities</span>() <span class="op">%&gt;%</span></span>
<span id="cb85-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb85-2"></a><span class="st">  </span><span class="kw">filter</span>(population <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1000</span>) <span class="op">%&gt;%</span></span>
<span id="cb85-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb85-3"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> <span class="kw">st_crs</span>(Torn.sf))</span></code></pre></div>
<pre><code>## City populations for contemporary data come from the 2010 census.</code></pre>
<p>Create a <code>ppp</code> object of events from the city/town locations given in the <code>SpatialPointsDataFrame</code>. Remove the marks and include only events inside the window object (<code>KS.own</code>). Convert the spatial units from meters to kilometers.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb87-1"></a>C.sp &lt;-<span class="st"> </span><span class="kw">as</span>(C.sf, <span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb87-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb87-2"></a></span>
<span id="cb87-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb87-3"></a>C.ppp &lt;-<span class="st"> </span><span class="kw">as</span>(C.sp, <span class="st">&quot;ppp&quot;</span>) </span>
<span id="cb87-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb87-4"></a>C.ppp &lt;-<span class="st"> </span><span class="kw">unmark</span>(C.ppp[KS.win])</span>
<span id="cb87-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb87-5"></a>C.ppp &lt;-<span class="st"> </span>spatstat<span class="op">::</span><span class="kw">rescale</span>(C.ppp, </span>
<span id="cb87-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb87-6"></a>                           <span class="dt">s =</span> <span class="dv">1000</span>, </span>
<span id="cb87-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb87-7"></a>                           <span class="dt">unitname =</span> <span class="st">&quot;km&quot;</span>)</span>
<span id="cb87-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb87-8"></a><span class="kw">plot</span>(C.ppp)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<p>Next we compute a ‘distance map’. A distance map of a set of events A is the function f whose value f(x) is defined for any point x as the shortest distance from x to any event in A.</p>
<p>This is done with the <code>distmap()</code> function and the points are the intersections of a 128 x 128 regular grid (default).</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb88-1"></a>Zc &lt;-<span class="st"> </span><span class="kw">distmap</span>(C.ppp)</span>
<span id="cb88-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb88-2"></a><span class="kw">plot</span>(Zc)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p>The result is an object of class image (<code>im</code>). Distances are in kilometers. Distance-to-nearest town can be used to quantify the population bias in the tornado data.</p>
<p>Other distance functions include <code>pairdist()</code>, which is the pairwise distance between all event pairs and <code>crossdist()</code>, which is the distance between events from two point patterns. The <code>nndist()</code> computes the distance between an event and its nearest neighbor event.</p>
<p>Compute a smoothed estimate of the tornado report intensity as a function of distance to nearest city with the <code>rhohat()</code> method. The method assumes the events are a realization from a Poisson process with intensity function <span class="math inline">\(\lambda(u)\)</span> of the form
<span class="math display">\[
\lambda(u) = \rho[Z(u)]
\]</span>
where <span class="math inline">\(Z\)</span> is the spatial explanatory variable (covariate) function (with continuous values) and <span class="math inline">\(\rho(z)\)</span> is a function to be estimated.</p>
<p>The function <code>rhohat()</code> estimates the relationship between the point process intensity and a given spatial explanatory variable. Such a relationship is sometimes called a ‘resource selection’ function (if the events are organisms and the variable is a descriptor of habitat) or a ‘prospectivity index’ (if the events are mineral deposits and the variable is a geological variable).</p>
<p>The function does not assume a particular form for the relationship between the point pattern and the variable (thus it is said to be ‘non-parametric’).</p>
<p>The first argument in <code>rhohat()</code> is the <code>ppp</code> object for which we want the intensity estimate and the second argument is the spatial variable (<code>covariate</code>), here as object of class <code>im</code>. By default, smoothing is done using kernel density.</p>
<p>With <code>method = "transform"</code> the smoothing method is variable-bandwidth kernel smoothing, implemented by applying the Probability Integral Transform to the covariate values, yielding values in the range 0 to 1, then applying edge-corrected density estimation on the interval [0, 1], and back-transforming. The <code>adjust =</code> argument increases the amount of smoothing when it’s greater than one.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb89-1"></a>rhat &lt;-<span class="st"> </span><span class="kw">rhohat</span>(Y, </span>
<span id="cb89-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb89-2"></a>               <span class="dt">covariate =</span> Zc,</span>
<span id="cb89-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb89-3"></a>               <span class="dt">adjust =</span> <span class="dv">2</span>,</span>
<span id="cb89-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb89-4"></a>               <span class="dt">method =</span> <span class="st">&quot;transform&quot;</span>)</span></code></pre></div>
<p>The resulting object (<code>rhat</code>) has three classes including a data frame. The data frame contains the explanatory variable as a single vector (<code>Zc</code>), an estimate of the intensity at the distances (<code>rho</code>), the variance (<code>var</code>) and upper (<code>hi</code>) and lower (<code>lo</code>) uncertainty values (point-wise).</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb90-1"></a><span class="kw">head</span>(<span class="kw">data.frame</span>(rhat))</span></code></pre></div>
<pre><code>##          Zc         rho          var          hi          lo
## 1 0.1416211 0.006697845 1.440303e-07 0.007441678 0.005954013
## 2 0.3409340 0.006690796 1.433002e-07 0.007432740 0.005948851
## 3 0.5402469 0.006683400 1.425395e-07 0.007423373 0.005943427
## 4 0.7395597 0.006675695 1.417479e-07 0.007413610 0.005937779
## 5 0.9388726 0.006667569 1.409187e-07 0.007403323 0.005931816
## 6 1.1381855 0.006659109 1.400608e-07 0.007392620 0.005925598</code></pre>
<p>Here we put these into a new data frame (<code>df</code>) multiplying the intensities by 10,000 (so units are in 100 sq. km) then use <code>ggplot()</code> method with a <code>geom_ribbon()</code> layer for the uncertainty band.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb92-1"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">dist =</span> rhat<span class="op">$</span>Zc, </span>
<span id="cb92-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb92-2"></a>                 <span class="dt">rho =</span> rhat<span class="op">$</span>rho <span class="op">*</span><span class="st"> </span><span class="dv">10000</span>, </span>
<span id="cb92-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb92-3"></a>                 <span class="dt">hi =</span> rhat<span class="op">$</span>hi <span class="op">*</span><span class="st"> </span><span class="dv">10000</span>, </span>
<span id="cb92-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb92-4"></a>                 <span class="dt">lo =</span> rhat<span class="op">$</span>lo <span class="op">*</span><span class="st"> </span><span class="dv">10000</span>)</span>
<span id="cb92-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb92-5"></a></span>
<span id="cb92-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb92-6"></a><span class="kw">ggplot</span>(df) <span class="op">+</span></span>
<span id="cb92-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb92-7"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dist, <span class="dt">ymin =</span> lo , <span class="dt">ymax =</span> hi), <span class="dt">alpha =</span> <span class="fl">.3</span>) <span class="op">+</span></span>
<span id="cb92-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb92-8"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dist, <span class="dt">y =</span> rho), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st">  </span></span>
<span id="cb92-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb92-9"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">49</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></span>
<span id="cb92-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb92-10"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="op">+</span></span>
<span id="cb92-11"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb92-11"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Tornado Reports (EF1) per 100 sq. km&quot;</span>) <span class="op">+</span></span>
<span id="cb92-12"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb92-12"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance from Nearest Town Center (km)&quot;</span>) <span class="op">+</span></span>
<span id="cb92-13"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb92-13"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
<p>The vertical axis is the tornado report intensity in units of number per 100 square kilometer. Intensity is greatest nearest to towns as anticipated.</p>
<p>Compare the functional intensity with the statewide rate of 1044/213168 = .0049 (or 49 tornadoes per 100 sq. km). At zero distance from a town, this number is more than 1.5 times higher (76 tornadoes per 100 sq. km). At distances greater than 30 km from the nearest town the tornado report rate is about 36 tornadoes per 100 sq. km.</p>
<p>The 95% uncertainty band is shown in gray.</p>
<p>The spatial scale is about 10 km (distance along the spatial axis where the red line falls below the blue line).</p>
<p>At this point in our analysis we need to think. The plot look reasonable based on our expectations of a population bias in the tornado reports, but could this result be an artifact of the smoothing algorithm? This is where critical thinking comes in.</p>
<p>We need to know how to apply statistical tools to accomplish specific tasks. But we also need to question the legitimacy of the results from the tool. This allows us to interpret results in a critical and analytical fashion.</p>
<p>For example, the method should give us a different answer on events that are randomly generated. What would you expect to find?</p>
<p>We’ve already generated a set of events from a homogeneous Poisson model so we can check simply by applying the <code>rhohat()</code> function to these events using the same set of city/town locations.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb93-1"></a>rhat0 &lt;-<span class="st"> </span><span class="kw">rhohat</span>(X, </span>
<span id="cb93-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb93-2"></a>               <span class="dt">covariate =</span> Zc,</span>
<span id="cb93-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb93-3"></a>               <span class="dt">adjust =</span> <span class="dv">2</span>,</span>
<span id="cb93-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb93-4"></a>               <span class="dt">method =</span> <span class="st">&quot;transform&quot;</span>)</span>
<span id="cb93-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb93-5"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">dist =</span> rhat0<span class="op">$</span>Zc, </span>
<span id="cb93-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb93-6"></a>                 <span class="dt">rho =</span> rhat0<span class="op">$</span>rho <span class="op">*</span><span class="st"> </span><span class="dv">10000</span>, </span>
<span id="cb93-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb93-7"></a>                 <span class="dt">hi =</span> rhat0<span class="op">$</span>hi <span class="op">*</span><span class="st"> </span><span class="dv">10000</span>, </span>
<span id="cb93-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb93-8"></a>                 <span class="dt">lo =</span> rhat0<span class="op">$</span>lo <span class="op">*</span><span class="st"> </span><span class="dv">10000</span>)</span>
<span id="cb93-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb93-9"></a><span class="kw">ggplot</span>(df) <span class="op">+</span></span>
<span id="cb93-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb93-10"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dist, <span class="dt">ymin =</span> lo , <span class="dt">ymax =</span> hi), <span class="dt">alpha =</span> <span class="fl">.3</span>) <span class="op">+</span></span>
<span id="cb93-11"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb93-11"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dist, <span class="dt">y =</span> rho), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st">  </span></span>
<span id="cb93-12"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb93-12"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">49</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></span>
<span id="cb93-13"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb93-13"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="op">+</span></span>
<span id="cb93-14"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb93-14"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Tornado Reports (EF1) per 100 sq. km&quot;</span>) <span class="op">+</span></span>
<span id="cb93-15"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb93-15"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance from Nearest Town Center (km)&quot;</span>) <span class="op">+</span></span>
<span id="cb93-16"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb93-16"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<p>The difference between the two point pattern data sets can be explained by the clustering of reports in the vicinity of towns.</p>
</div>
<div id="challenge-problem-tornado-reports-as-a-function-of-distance-to-nearest-citytown" class="section level3" number="1.4.5">
<h3><span class="header-section-number">1.4.5</span> Challenge problem: Tornado reports as a function of distance to nearest city/town</h3>
<p>Repeat for another state of your choice. (1) Determine the average EF1+ (EF1 or more damaging) tornado intensity per square kilometer over the state during the period 1950-2017. (2) Plot the spatial varying intensity of these tornadoes using (a) quadrats (10 x 10) and (b) a kernel density smoother. (3) Plot the spatial intensity as a smoothed function of distance to nearest town or city (with populations exceeding 500). Is there a significant population bias in tornado reports? If so, what is the spatial scale of this bias?</p>
</div>
</div>
<div id="conditional-probability" class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> Conditional probability</h2>
<div id="texas-tornadoes" class="section level3" number="1.5.1">
<h3><span class="header-section-number">1.5.1</span> Texas tornadoes</h3>
<p>Consider EF1 or worse tornadoes occurring over the state of Texas. The EPSG code is for a Texas centric Lambert conic conformal.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb94-1"></a><span class="kw">library</span>(sf)</span>
<span id="cb94-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb94-2"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb94-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb94-3"></a><span class="kw">library</span>(spatstat)</span>
<span id="cb94-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb94-4"></a><span class="kw">library</span>(maptools)</span>
<span id="cb94-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb94-5"></a></span>
<span id="cb94-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb94-6"></a>Torn.sf &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="dt">dsn =</span> <span class="st">&quot;1950-2018-torn-initpoint&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb94-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb94-7"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> <span class="dv">3082</span>) <span class="op">%&gt;%</span></span>
<span id="cb94-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb94-8"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(mag <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></span>
<span id="cb94-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb94-9"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">EF =</span> <span class="kw">as.factor</span>(mag)) <span class="op">%&gt;%</span></span>
<span id="cb94-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb94-10"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(EF)</span></code></pre></div>
<pre><code>## Reading layer `1950-2018-torn-initpoint&#39; from data source `/Users/jelsner/Desktop/Projects/ASSFG-Book/1950-2018-torn-initpoint&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 63645 features and 22 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -163.53 ymin: 18.13 xmax: -64.9 ymax: 61.02
## CRS:            4326</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb96-1"></a>Torn.sp &lt;-<span class="st"> </span><span class="kw">as</span>(Torn.sf, <span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb96-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb96-2"></a>T.ppp &lt;-<span class="st"> </span><span class="kw">as</span>(Torn.sp[<span class="st">&quot;EF&quot;</span>], <span class="st">&quot;ppp&quot;</span>)</span></code></pre></div>
<p>Create the spatial domain (called a ‘window’ in the {spatstat} parlance) over which the analysis will be done. Here we use the state border of Texas as a simple feature data frame from the <strong>USAboundaries</strong> package.</p>
<p>We transform the CRS accordingly and convert the simple feature object to an S4 <code>SpatialPolygons</code> object before converting it to an <code>owin</code> object with the <code>as.owin()</code> function. We then subset the tornado events by the <code>owin</code> object.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb97-1"></a><span class="kw">library</span>(USAboundaries)</span>
<span id="cb97-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb97-2"></a></span>
<span id="cb97-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb97-3"></a>W.sf &lt;-<span class="st"> </span><span class="kw">us_states</span>(<span class="dt">states =</span> <span class="st">&quot;Texas&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb97-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb97-4"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> <span class="kw">st_crs</span>(Torn.sf))</span>
<span id="cb97-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb97-5"></a></span>
<span id="cb97-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb97-6"></a>W.sp &lt;-<span class="st"> </span><span class="kw">as</span>(W.sf, <span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb97-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb97-7"></a>W &lt;-<span class="st"> </span><span class="kw">as</span>(W.sp, <span class="st">&#39;owin&#39;</span>)</span>
<span id="cb97-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb97-8"></a></span>
<span id="cb97-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb97-9"></a>T.ppp &lt;-<span class="st"> </span>T.ppp[W]</span>
<span id="cb97-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb97-10"></a><span class="kw">summary</span>(T.ppp)</span></code></pre></div>
<pre><code>## Marked planar point pattern:  8736 points
## Average intensity 1.264744e-08 points per square unit
## 
## *Pattern contains duplicated points*
## 
## Coordinates are given to 1 decimal place
## i.e. rounded to the nearest multiple of 0.1 units
## 
## Multitype:
##   frequency   proportion    intensity
## 0      4674 0.5350275000 6.766725e-09
## 1      2495 0.2855998000 3.612105e-09
## 2      1199 0.1372482000 1.735837e-09
## 3       314 0.0359432200 4.545896e-10
## 4        48 0.0054945050 6.949140e-11
## 5         6 0.0006868132 8.686426e-12
## 
## Window: polygonal boundary
## single connected closed polygon with 555 vertices
## enclosing rectangle: [873763.8, 2116649.8] x [5881245, 7063086] units
##                      (1243000 x 1182000 units)
## Window area = 6.90733e+11 square units
## Fraction of frame area: 0.47</code></pre>
<p>There are 8,736 Texas tornadoes of which 368 are EF3+ on the damage-rating scale.</p>
<p>The spatial unit is one meter. The average intensity is 1.2647e-08 (.000000012647) events per square meter. There are 1e+09 (1 million) square meters in a square kilometer so this works out to 12.6 tornadoes per square kilometer over this 69-year period (1950-2018).</p>
<p>Next we plot the spatial varying intensity using a kernel smoother.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb99-1"></a>T.int &lt;-<span class="st"> </span><span class="kw">density</span>(T.ppp)</span>
<span id="cb99-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb99-2"></a><span class="kw">plot</span>(T.int)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<p>It is clear from this map that the averge spatial intensity of 12.6 tornadoes per square km is too high in southwestern parts of the state and too low in the northern parts. Recall from Lesson 13 that there was not much a spatial trend in tornadoes across Kansas.</p>
<p>Next we compute and plot the spatial intensity as a smoothed function of distance to nearest town or city.</p>
<p>We start by removing the marks on the tornado events.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb100-1"></a>Tum.ppp &lt;-<span class="st"> </span><span class="kw">unmark</span>(T.ppp)</span></code></pre></div>
<p>Then we use of the spatial data frame of city locations. Import the data, set the CRS, and transform the CRS to match that of the tornadoes. Exclude cities with fewer than 3000 people.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb101-1"></a><span class="kw">download.file</span>(<span class="st">&quot;http://myweb.fsu.edu/jelsner/temp/data/ci08au12.zip&quot;</span>,</span>
<span id="cb101-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb101-2"></a>              <span class="st">&quot;ci08au12.zip&quot;</span>)</span>
<span id="cb101-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb101-3"></a><span class="kw">unzip</span>(<span class="st">&quot;ci08au12.zip&quot;</span>)</span>
<span id="cb101-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb101-4"></a></span>
<span id="cb101-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb101-5"></a>C.sf &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="dt">dsn =</span> <span class="st">&quot;.&quot;</span>,</span>
<span id="cb101-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb101-6"></a>                <span class="dt">layer =</span> <span class="st">&quot;ci08au12&quot;</span>,</span>
<span id="cb101-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb101-7"></a>                <span class="dt">quiet =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb101-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb101-8"></a><span class="st">  </span><span class="kw">st_set_crs</span>(<span class="dv">4326</span>) <span class="op">%&gt;%</span></span>
<span id="cb101-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb101-9"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> <span class="kw">st_crs</span>(Torn.sf)) <span class="op">%&gt;%</span></span>
<span id="cb101-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb101-10"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(POP_<span class="dv">1990</span> <span class="op">&gt;=</span><span class="st"> </span><span class="dv">3000</span>)</span></code></pre></div>
<p>Then create a <code>ppp</code> object of events from the city/town locations. First create an S4 class spatial data frame and convert this data frame to a <code>ppp</code> object before removing the marks. Then subset the events by the window.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb102-1"></a>C.sp &lt;-<span class="st"> </span><span class="kw">as</span>(C.sf, <span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb102-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb102-2"></a>C.ppp &lt;-<span class="st"> </span><span class="kw">as</span>(C.sp, <span class="st">&quot;ppp&quot;</span>)</span>
<span id="cb102-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb102-3"></a>C.ppp &lt;-<span class="st"> </span><span class="kw">unmark</span>(C.ppp[W])</span>
<span id="cb102-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb102-4"></a><span class="kw">plot</span>(C.ppp)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<p>Next create a distance map of the city/town locations using the <code>distmap()</code> function.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb103-1"></a>Zc &lt;-<span class="st"> </span><span class="kw">distmap</span>(C.ppp)</span>
<span id="cb103-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb103-2"></a><span class="kw">plot</span>(Zc)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
<p>The resulting object an <code>im</code> class indicating a pixeled image. Pixel values are distances is meters. Blue indicates locations that are less than 20 km from a city or town with a population of at least 3000.</p>
<p>Finally we compute the spatial varying intensity of tornadoes as a smoothed function of distance to nearest town/city with the <code>rhohat()</code> function. We then prepare the output and make a plot.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb104-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb104-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb104-2"></a></span>
<span id="cb104-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb104-3"></a>rhat &lt;-<span class="st"> </span><span class="kw">rhohat</span>(Tum.ppp, </span>
<span id="cb104-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb104-4"></a>               <span class="dt">covariate =</span> Zc,</span>
<span id="cb104-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb104-5"></a>               <span class="dt">adjust =</span> <span class="fl">1.3</span>,</span>
<span id="cb104-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb104-6"></a>               <span class="dt">method =</span> <span class="st">&quot;transform&quot;</span>)</span>
<span id="cb104-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb104-7"></a></span>
<span id="cb104-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb104-8"></a><span class="kw">data.frame</span>(<span class="dt">dist =</span> rhat<span class="op">$</span>Zc <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>, </span>
<span id="cb104-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb104-9"></a>           <span class="dt">rho =</span> rhat<span class="op">$</span>rho <span class="op">*</span><span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">9</span>, </span>
<span id="cb104-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb104-10"></a>           <span class="dt">hi =</span> rhat<span class="op">$</span>hi <span class="op">*</span><span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">9</span>, </span>
<span id="cb104-11"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb104-11"></a>           <span class="dt">lo =</span> rhat<span class="op">$</span>lo <span class="op">*</span><span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">9</span>) <span class="op">%&gt;%</span></span>
<span id="cb104-12"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb104-12"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb104-13"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb104-13"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dist, <span class="dt">ymin =</span> lo , <span class="dt">ymax =</span> hi), <span class="dt">alpha =</span> <span class="fl">.3</span>) <span class="op">+</span></span>
<span id="cb104-14"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb104-14"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dist, <span class="dt">y =</span> rho), <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st">  </span></span>
<span id="cb104-15"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb104-15"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="ot">NA</span>)) <span class="op">+</span></span>
<span id="cb104-16"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb104-16"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">summary</span>(Tum.ppp)<span class="op">$</span>intensity <span class="op">*</span><span class="st"> </span><span class="dv">10</span><span class="op">^</span><span class="dv">9</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></span>
<span id="cb104-17"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb104-17"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Tornado Reports per sq. km&quot;</span>) <span class="op">+</span></span>
<span id="cb104-18"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb104-18"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance from Nearest Town Center (km)&quot;</span>) <span class="op">+</span></span>
<span id="cb104-19"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb104-19"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
<p>We see that tornado reports are higher than the overall mean in the vicinity of towns and cities.</p>
<p>However this result is confounded by the trend we saw above. The increasing trend of tornadoes moving from southwest to northeast across the state mirrors the trend in the occurrence of cities/towns.</p>
<p>We can quantify this effect by using a function as the covariate. Here we specify a plane with <code>x,y</code> as arguments and <code>x + y</code> inside the function.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb105-1"></a><span class="kw">plot</span>(<span class="kw">rhohat</span>(T.ppp, </span>
<span id="cb105-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb105-2"></a>            <span class="dt">covariate =</span> <span class="cf">function</span>(x,y){x <span class="op">+</span><span class="st"> </span>y},</span>
<span id="cb105-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb105-3"></a>            <span class="dt">adjust =</span> <span class="dv">2</span>,</span>
<span id="cb105-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb105-4"></a>            <span class="dt">method =</span> <span class="st">&quot;transform&quot;</span>))</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-59-1.png" width="672" /></p>
<p>The spatial varying tornado event intensity increases nonlinearly along the functional axis labeled <code>X</code> starting at a value of 7,400,000. At value of <code>X</code> equal to about 8,200,000 the spatial intensity stops increasing.</p>
<p>Units along the horizontal axis are meters but the reference (intercept) distance is at the far left. So we interpret the increase in spatial intensity going from southwest to northeast as a change across about 800 km (8200000 - 7400000)/1000).</p>
<p>The spatial varying intensity of cities has the same property (increasing from southwest to northeast then leveling off).</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb106-1"></a><span class="kw">plot</span>(<span class="kw">rhohat</span>(C.ppp, </span>
<span id="cb106-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb106-2"></a>            <span class="dt">covariate =</span> <span class="cf">function</span>(x,y){x <span class="op">+</span><span class="st"> </span>y},</span>
<span id="cb106-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb106-3"></a>            <span class="dt">adjust =</span> <span class="dv">2</span>,</span>
<span id="cb106-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb106-4"></a>            <span class="dt">method =</span> <span class="st">&quot;transform&quot;</span>))</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<p>So the population bias towards more reports near towns/cities is confounded by the fact that there tends to be more cities and towns in areas that have conditions more favorable for tornadoes.</p>
<p>Thus we can only get so far by examining intensity estimates if our interest lies in inferring the cause of spatial variation in the intensity. We will need to look at second order properties of the events.</p>
</div>
<div id="conditional-probability-1" class="section level3" number="1.5.2">
<h3><span class="header-section-number">1.5.2</span> Conditional probability</h3>
<p>Even if we can’t use a map showing the spatial varying intensity of event to make inferences about causes, combining such maps allow us to map estimates of relative risks of events. More generally the relative risk is a conditional probability.</p>
<p>For example given a tornado occurring in Texas what is the chance that it will cause EF3 or worse damage? How can we answer that? For the state as a whole we have the answer from our summary of the <code>ppp</code> object.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb107-1"></a><span class="kw">summary</span>(T.ppp)</span></code></pre></div>
<pre><code>## Marked planar point pattern:  8736 points
## Average intensity 1.264744e-08 points per square unit
## 
## *Pattern contains duplicated points*
## 
## Coordinates are given to 1 decimal place
## i.e. rounded to the nearest multiple of 0.1 units
## 
## Multitype:
##   frequency   proportion    intensity
## 0      4674 0.5350275000 6.766725e-09
## 1      2495 0.2855998000 3.612105e-09
## 2      1199 0.1372482000 1.735837e-09
## 3       314 0.0359432200 4.545896e-10
## 4        48 0.0054945050 6.949140e-11
## 5         6 0.0006868132 8.686426e-12
## 
## Window: polygonal boundary
## single connected closed polygon with 555 vertices
## enclosing rectangle: [873763.8, 2116649.8] x [5881245, 7063086] units
##                      (1243000 x 1182000 units)
## Window area = 6.90733e+11 square units
## Fraction of frame area: 0.47</code></pre>
<p>The chance that a tornado anywhere in Texas will be at least EF3 or worse is the sum of the proportions for these types: .03594 + .00549 + .00069 = .042 (or 4.2%). Or the sum of the intensities for these types divided by the overall intensity (1.264744e-08).</p>
<p>But as we saw the intensity varies spatially.</p>
<p>We create two <code>ppp</code> objects the first one being the set of all tornado locations with damage ratings 0, 1, or 2 and the other the set of all tornado locations with damage ratings 3, 4, or 5.</p>
<p>First we split the object then merge them and assign names as marks.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb109-1"></a>H.ppp &lt;-<span class="st"> </span><span class="kw">unmark</span>(T.ppp[T.ppp<span class="op">$</span>marks <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">|</span><span class="st"> </span>T.ppp<span class="op">$</span>marks <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">|</span><span class="st"> </span>T.ppp<span class="op">$</span>marks <span class="op">==</span><span class="st"> </span><span class="dv">0</span>])</span>
<span id="cb109-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb109-2"></a>I.ppp &lt;-<span class="st"> </span><span class="kw">unmark</span>(T.ppp[T.ppp<span class="op">$</span>marks <span class="op">==</span><span class="st"> </span><span class="dv">3</span> <span class="op">|</span><span class="st"> </span>T.ppp<span class="op">$</span>marks <span class="op">==</span><span class="st"> </span><span class="dv">4</span> <span class="op">|</span><span class="st"> </span>T.ppp<span class="op">$</span>marks <span class="op">==</span><span class="st"> </span><span class="dv">5</span>])</span>
<span id="cb109-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb109-3"></a>T2.ppp &lt;-<span class="st"> </span><span class="kw">superimpose</span>(<span class="dt">H =</span> H.ppp, <span class="dt">I =</span> I.ppp)</span></code></pre></div>
<pre><code>## Warning: data contain duplicated points</code></pre>
<p>The probability that a tornado picked at random is intense (EF3+) is 4%. Plot touchdown locations for the set of intense tornadoes.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb111-1"></a><span class="kw">plot</span>(I.ppp, <span class="dt">pch =</span> <span class="dv">25</span>, <span class="dt">cols =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">main=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb111-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb111-2"></a><span class="kw">plot</span>(T.ppp, <span class="dt">add=</span><span class="ot">TRUE</span>, <span class="dt">lwd =</span> <span class="fl">.1</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-63-1.png" width="672" /></p>
<p>To obtain the relative risk we use the <code>relrisk()</code> function. If X is a bivariate point pattern (a multitype point pattern consisting of two types of events) then by default, the events of the first type (the first level of <code>marks(X)</code>) are treated as controls or non-events, and events of the second type are treated as cases.</p>
<p>Then the function <code>relrisk()</code> computes the spatially-varying probability of a case, (i.e. the probability <span class="math inline">\(p(u)\)</span> that a point at location <span class="math inline">\(u\)</span> will be a case). If <code>relative = TRUE</code>, it computes the spatially-varying relative risk of a case relative to a control, <span class="math inline">\(r(u) = p(u)/(1 - p(u))\)</span>.</p>
<p>Here we compute the relative risk on a 128 by 128 grid. It takes a few seconds.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb112-1"></a>rr &lt;-<span class="st"> </span><span class="kw">relrisk</span>(T2.ppp, </span>
<span id="cb112-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb112-2"></a>              <span class="dt">dimyx =</span> <span class="kw">c</span>(<span class="dv">128</span>, <span class="dv">128</span>))</span></code></pre></div>
<pre><code>## Warning: Likelihood Cross-Validation criterion was optimised at right-hand
## end of interval [273, 130000]; use arguments &#39;hmin&#39;, &#39;hmax&#39; to specify a wider
## interval for bandwidth &#39;sigma&#39;</code></pre>
<p>The result is again an object of class <code>im</code> (a pixel object with values we can interpret as the conditional probability of an ‘intense’ tornado, see <a href="https://en.wikipedia.org/wiki/Enhanced_Fujita_scale" class="uri">https://en.wikipedia.org/wiki/Enhanced_Fujita_scale</a>).</p>
<p>We retrieve the range of probabilities with the <code>range()</code> function. Note that many of the values are <code>NA</code> corresponding pixels that are outside the window so we set <code>na.rm = TRUE</code>.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb114-1"></a><span class="kw">range</span>(rr, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 0.007785304 0.061021803</code></pre>
<p>The probabilities range from a low of .77% to a high of 6.1%.</p>
<p>County borders from the {map} package (automatically installed with {ggplot2}). It provides maps of the USA, with state and county borders, that can be retrieved and converted as sf objects.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb116-1"></a><span class="kw">library</span>(maps)</span>
<span id="cb116-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb116-2"></a></span>
<span id="cb116-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb116-3"></a>TX.sf &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="st">&quot;county&quot;</span>, <span class="dt">regions =</span> <span class="st">&quot;Texas&quot;</span>, <span class="dt">plot =</span> <span class="ot">FALSE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb116-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb116-4"></a><span class="st">  </span><span class="kw">st_as_sf</span>() <span class="op">%&gt;%</span></span>
<span id="cb116-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb116-5"></a><span class="st">  </span><span class="kw">st_buffer</span>(<span class="dt">dist =</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## Warning in st_buffer.sfc(st_geometry(x), dist, nQuadSegs, endCapStyle =
## endCapStyle, : st_buffer does not correctly buffer longitude/latitude data</code></pre>
<pre><code>## dist is assumed to be in decimal degrees (arc_degrees).</code></pre>
<p>Create a map. To facilitate plotting the results we convert the resulting <code>im</code> object to a raster and set the CRS accordingly.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb119-1"></a><span class="kw">library</span>(raster)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;raster&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:spatstat&#39;:
## 
##     area, rotate, shift</code></pre>
<pre><code>## The following object is masked from &#39;package:nlme&#39;:
## 
##     getData</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     select</code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb124-1"></a>rr.r &lt;-<span class="st"> </span><span class="kw">raster</span>(rr)</span>
<span id="cb124-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb124-2"></a><span class="kw">crs</span>(rr.r) &lt;-<span class="st"> </span><span class="kw">st_crs</span>(Torn.sf)<span class="op">$</span>proj4string</span>
<span id="cb124-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb124-3"></a></span>
<span id="cb124-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb124-4"></a><span class="kw">library</span>(tmap)</span>
<span id="cb124-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb124-5"></a></span>
<span id="cb124-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb124-6"></a><span class="kw">tm_shape</span>(rr.r) <span class="op">+</span></span>
<span id="cb124-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb124-7"></a><span class="st">  </span><span class="kw">tm_raster</span>(<span class="dt">title =</span> <span class="st">&quot;Probability&quot;</span>) <span class="op">+</span></span>
<span id="cb124-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb124-8"></a><span class="kw">tm_shape</span>(TX.sf) <span class="op">+</span></span>
<span id="cb124-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb124-9"></a><span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">col =</span> <span class="st">&quot;gray70&quot;</span>) <span class="op">+</span></span>
<span id="cb124-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb124-10"></a><span class="kw">tm_layout</span>(<span class="dt">frame =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb124-11"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb124-11"></a><span class="st">  </span><span class="kw">tm_credits</span>(<span class="dt">text =</span> <span class="st">&quot;Chance that a random tornado</span><span class="ch">\n</span><span class="st">does at least EF3 damage&quot;</span>,</span>
<span id="cb124-12"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb124-12"></a>             <span class="dt">size =</span> <span class="dv">1</span>,</span>
<span id="cb124-13"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb124-13"></a>             <span class="dt">position =</span> <span class="kw">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>)) </span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
<p>It is of considerable interest to extract these probabilities for specific cities.</p>
<p>Here we use the data frame <code>us.cities</code> from the {map} package has a list of US cities with population greater than about 40,000. Also included are state capitals of any population size.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb125-1"></a>Cities.sf &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(us.cities, </span>
<span id="cb125-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb125-2"></a>                      <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;long&quot;</span>, <span class="st">&quot;lat&quot;</span>),</span>
<span id="cb125-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb125-3"></a>                      <span class="dt">crs =</span> <span class="dv">4326</span>) <span class="op">%&gt;%</span></span>
<span id="cb125-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb125-4"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> <span class="kw">st_crs</span>(Torn.sf)) <span class="op">%&gt;%</span></span>
<span id="cb125-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb125-5"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(country.etc <span class="op">==</span><span class="st"> &quot;TX&quot;</span>)</span></code></pre></div>
<p>We use the <code>extract()</code> function from the <strong>raster</strong> package to get a single value for each city. We put these values into the simple feature data frame.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb126-1"></a>Cities.sf<span class="op">$</span>rr &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw">extract</span>(rr.r, Cities.sf)</span>
<span id="cb126-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb126-2"></a></span>
<span id="cb126-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb126-3"></a>Cities.sf <span class="op">%&gt;%</span></span>
<span id="cb126-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb126-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">arrange</span>(<span class="kw">desc</span>(rr)) </span></code></pre></div>
<pre><code>## Simple feature collection with 71 features and 5 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: 892089.1 ymin: 5891060 xmax: 2084881 ymax: 6916236
## CRS:            EPSG:3082
## First 10 features:
##             name country.etc    pop capital         rr                geometry
## 1    Longview TX          TX  76372       0 0.06049421 POINT (1991211 6629569)
## 2       Tyler TX          TX  92155       0 0.05930445 POINT (1941518 6606280)
## 3   MacKinney TX          TX 108976       0 0.05715841 POINT (1811823 6697921)
## 4     Rowlett TX          TX  57174       0 0.05706093 POINT (1822132 6666114)
## 5       Allen TX          TX  84467       0 0.05699254 POINT (1810262 6687903)
## 6    Mesquite TX          TX 132746       0 0.05675272 POINT (1817942 6650477)
## 7  Richardson TX          TX 107481       0 0.05666746 POINT (1806999 6672297)
## 8      Frisco TX          TX  80192       0 0.05661100 POINT (1797126 6690838)
## 9     Garland TX          TX 217609       0 0.05650525 POINT (1814664 6665883)
## 10      Plano TX          TX 260415       0 0.05643495 POINT (1803006 6681041)</code></pre>
<p>To put the finishing touch on this analysis we create a chart using the <code>geom_lollipop()</code> function from the <strong>ggalt</strong> package.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb128-1"></a><span class="kw">library</span>(ggalt)</span></code></pre></div>
<pre><code>## Registered S3 methods overwritten by &#39;ggalt&#39;:
##   method                  from   
##   grid.draw.absoluteGrob  ggplot2
##   grobHeight.absoluteGrob ggplot2
##   grobWidth.absoluteGrob  ggplot2
##   grobX.absoluteGrob      ggplot2
##   grobY.absoluteGrob      ggplot2</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb130-1"></a><span class="kw">library</span>(scales)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;scales&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:spatstat&#39;:
## 
##     rescale</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb133-1"></a>Cities.sf &lt;-<span class="st"> </span>Cities.sf <span class="op">%&gt;%</span></span>
<span id="cb133-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb133-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(rr <span class="op">&gt;</span><span class="st"> </span><span class="fl">.042</span>)</span>
<span id="cb133-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb133-3"></a></span>
<span id="cb133-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb133-4"></a><span class="kw">ggplot</span>(Cities.sf, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(name, rr), <span class="dt">y =</span> rr)) <span class="op">+</span></span>
<span id="cb133-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb133-5"></a><span class="st">    </span><span class="kw">geom_lollipop</span>(<span class="dt">point.colour =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="dt">point.size =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb133-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb133-6"></a><span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> percent) <span class="op">+</span></span>
<span id="cb133-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb133-7"></a><span class="st">    </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb133-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb133-8"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="ot">NULL</span>, </span>
<span id="cb133-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb133-9"></a>         <span class="dt">title =</span> <span class="st">&quot;Chance that a random tornado will do at least EF3 damage&quot;</span>,</span>
<span id="cb133-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb133-10"></a>         <span class="dt">subtitle =</span> <span class="st">&quot;Cities in Texas with a 2010 population &gt; 40,000&quot;</span>,</span>
<span id="cb133-11"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb133-11"></a>         <span class="dt">caption =</span> <span class="st">&quot;Data from SPC&quot;</span>) <span class="op">+</span></span>
<span id="cb133-12"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb133-12"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
</div>
<div id="another-example-given-a-wildfire-anywhere-in-florida-what-is-the-probability-is-was-started-by-lightning" class="section level3" number="1.5.3">
<h3><span class="header-section-number">1.5.3</span> Another example: Given a wildfire anywhere in Florida what is the probability is was started by lightning?</h3>
<p>The spatial wildfire occurrence data for the United States, 1992-2015 [FPA_FOD_20170508]. Data publication contains GIS data (Karen C. Short). It is available here: <a href="https://www.fs.usda.gov/rds/archive/catalog/RDS-2013-0009.4" class="uri">https://www.fs.usda.gov/rds/archive/catalog/RDS-2013-0009.4</a>.</p>
<p>I download the GPKG data. GeoPackage is an open, standards-based, platform-independent, portable, self-describing, compact format for transferring geospatial information. Of the 8 million or so wildfires in the U.S. over the period 1992-2015 I extracted those occurring in Florida and saved it as a ESRI Shapefile.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb134-1"></a><span class="kw">library</span>(sf)</span>
<span id="cb134-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb134-2"></a></span>
<span id="cb134-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb134-3"></a><span class="kw">unzip</span>(<span class="st">&quot;RDS-2013-0009.4_GPKG.zip&quot;</span>)</span>
<span id="cb134-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb134-4"></a></span>
<span id="cb134-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb134-5"></a><span class="kw">st_layers</span>(<span class="dt">dsn =</span> <span class="st">&quot;Data/FPA_FOD_20170508.gpkg&quot;</span>)</span>
<span id="cb134-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb134-6"></a>Fires.sf &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="dt">dsn =</span> <span class="st">&quot;Data/FPA_FOD_20170508.gpkg&quot;</span>,</span>
<span id="cb134-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb134-7"></a>                    <span class="dt">layer =</span> <span class="st">&quot;Fires&quot;</span>)</span>
<span id="cb134-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb134-8"></a></span>
<span id="cb134-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb134-9"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb134-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb134-10"></a></span>
<span id="cb134-11"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb134-11"></a>FL_Fires.sf &lt;-<span class="st"> </span>Fires.sf <span class="op">%&gt;%</span></span>
<span id="cb134-12"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb134-12"></a><span class="st">  </span><span class="kw">filter</span>(STATE <span class="op">==</span><span class="st"> &quot;FL&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb134-13"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb134-13"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> <span class="dv">3857</span>)</span>
<span id="cb134-14"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb134-14"></a></span>
<span id="cb134-15"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb134-15"></a><span class="kw">st_write</span>(FL_Fires.sf, </span>
<span id="cb134-16"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb134-16"></a>         <span class="dt">dsn =</span> <span class="st">&quot;FL_Fires&quot;</span>, </span>
<span id="cb134-17"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb134-17"></a>         <span class="dt">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>)</span>
<span id="cb134-18"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb134-18"></a></span>
<span id="cb134-19"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb134-19"></a><span class="kw">zip</span>(<span class="dt">files =</span> <span class="st">&quot;FL_Fires&quot;</span>,</span>
<span id="cb134-20"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb134-20"></a>    <span class="dt">zipfile =</span> <span class="st">&quot;FL_Fires.zip&quot;</span>)</span></code></pre></div>
<p>We import the Florida wildfire data as a simple feature data frame.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb135-1"></a>FL_Fires.sf &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="dt">dsn =</span> <span class="st">&quot;FL_Fires&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `FL_Fires&#39; from data source `/Users/jelsner/Desktop/Projects/ASSFG-Book/FL_Fires&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 90261 features and 37 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -9750382 ymin: 2824449 xmax: -8908899 ymax: 3632749
## proj4string:    +proj=merc +lon_0=0 +lat_ts=0 +x_0=0 +y_0=0 +a=6378137 +b=6378137 +units=m +no_defs</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb137-1"></a><span class="kw">dim</span>(FL_Fires.sf)</span></code></pre></div>
<pre><code>## [1] 90261    38</code></pre>
<p>There are over 90K events in Florida. To make things run faster here we analyze a random sample of the events. We first create a random sample of 1000 row numbers and assign the row numbers to the vector <code>index</code>. We then subset the <code>FL_Fires.sf</code> sf data frame by this index.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb139-1"></a><span class="kw">set.seed</span>(<span class="dv">78732</span>)</span>
<span id="cb139-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb139-2"></a>index &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">nrow</span>(FL_Fires.sf), <span class="dt">size =</span> <span class="dv">1000</span>)</span>
<span id="cb139-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb139-3"></a>FL_FiresS.sf &lt;-<span class="st"> </span>FL_Fires.sf[index, ]</span>
<span id="cb139-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb139-4"></a><span class="kw">dim</span>(FL_FiresS.sf)</span></code></pre></div>
<pre><code>## [1] 1000   38</code></pre>
<p>We then convert the event set to a <code>ppp</code> object over a window defined by the state boundaries as we’ve done before.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb141-1"></a>FL_FiresS.sp &lt;-<span class="st"> </span><span class="kw">as</span>(FL_FiresS.sf, <span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb141-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb141-2"></a>Fires.ppp &lt;-<span class="st"> </span><span class="kw">as</span>(FL_FiresS.sp[<span class="st">&quot;STAT_CAU_1&quot;</span>], <span class="st">&quot;ppp&quot;</span>)</span>
<span id="cb141-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb141-3"></a></span>
<span id="cb141-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb141-4"></a>W.sf &lt;-<span class="st"> </span><span class="kw">us_states</span>(<span class="dt">states =</span> <span class="st">&quot;Florida&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb141-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb141-5"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> <span class="kw">st_crs</span>(FL_Fires.sf))</span>
<span id="cb141-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb141-6"></a></span>
<span id="cb141-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb141-7"></a>W.sp &lt;-<span class="st"> </span><span class="kw">as</span>(W.sf, <span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb141-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb141-8"></a>W &lt;-<span class="st"> </span><span class="kw">as</span>(W.sp, <span class="st">&#39;owin&#39;</span>)</span>
<span id="cb141-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb141-9"></a></span>
<span id="cb141-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb141-10"></a>Fires.ppp &lt;-<span class="st"> </span>Fires.ppp[W]</span>
<span id="cb141-11"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb141-11"></a><span class="kw">summary</span>(Fires.ppp)</span></code></pre></div>
<pre><code>## Marked planar point pattern:  1000 points
## Average intensity 4.976646e-09 points per square unit
## 
## *Pattern contains duplicated points*
## 
## Coordinates are given to 1 decimal place
## i.e. rounded to the nearest multiple of 0.1 units
## 
## marks are of type &#39;character&#39;
## Summary:
##    Length     Class      Mode 
##      1000 character character 
## 
## Window: polygonal boundary
## 4 separate polygons (no holes)
##            vertices        area relative.area
## polygon 1        15 9.79340e+08      0.004870
## polygon 2         5 1.33445e+08      0.000664
## polygon 3         5 9.06224e+07      0.000451
## polygon 4       356 1.99735e+11      0.994000
## enclosing rectangle: [-9755477, -8909135] x [2814226, 3632839] units
##                      (846300 x 818600 units)
## Window area = 2.00939e+11 square units
## Fraction of frame area: 0.29</code></pre>
<p>The probability that a wildfire picked at random is caused by lightning is about 25% (proportion column of the frequency versus type table). How does this probability vary over the state?</p>
<p>First we split the object then merge them and assign names as marks.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb143-1"></a>L.ppp &lt;-<span class="st"> </span><span class="kw">unmark</span>(Fires.ppp[Fires.ppp<span class="op">$</span>marks <span class="op">==</span><span class="st"> &quot;Lightning&quot;</span>])</span>
<span id="cb143-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb143-2"></a>NL.ppp &lt;-<span class="st"> </span><span class="kw">unmark</span>(Fires.ppp[Fires.ppp<span class="op">$</span>marks <span class="op">!=</span><span class="st"> &quot;Lightning&quot;</span>])</span>
<span id="cb143-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb143-3"></a></span>
<span id="cb143-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb143-4"></a>LNL.ppp &lt;-<span class="st"> </span><span class="kw">superimpose</span>(<span class="dt">NL =</span> NL.ppp, <span class="dt">L =</span> L.ppp)</span></code></pre></div>
<pre><code>## Warning: data contain duplicated points</code></pre>
<p>The function <code>relrisk()</code> computes the spatially-varying probability of a case, (i.e. the probability <span class="math inline">\(p(u)\)</span> that a point at location <span class="math inline">\(u\)</span> will be a case).</p>
<p>Here we compute the relative risk on a 256 by 256 grid.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb145-1"></a>wfr &lt;-<span class="st"> </span><span class="kw">relrisk</span>(LNL.ppp, </span>
<span id="cb145-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb145-2"></a>              <span class="dt">dimyx =</span> <span class="kw">c</span>(<span class="dv">256</span>, <span class="dv">256</span>))</span></code></pre></div>
<p>We map the raster as before first converting the image object to a raster object and assigning the CRS. We add the county borders for reference.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb146-1"></a>wfr.r &lt;-<span class="st"> </span><span class="kw">raster</span>(wfr)</span>
<span id="cb146-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb146-2"></a></span>
<span id="cb146-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb146-3"></a><span class="kw">crs</span>(wfr.r) &lt;-<span class="st"> </span><span class="kw">st_crs</span>(FL_Fires.sf)<span class="op">$</span>proj4string</span>
<span id="cb146-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb146-4"></a></span>
<span id="cb146-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb146-5"></a>FL.sf &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="st">&quot;county&quot;</span>, <span class="dt">regions =</span> <span class="st">&quot;Florida&quot;</span>, <span class="dt">plot =</span> <span class="ot">FALSE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb146-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb146-6"></a><span class="st">  </span><span class="kw">st_as_sf</span>()</span>
<span id="cb146-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb146-7"></a></span>
<span id="cb146-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb146-8"></a><span class="kw">tm_shape</span>(wfr.r) <span class="op">+</span></span>
<span id="cb146-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb146-9"></a><span class="st">  </span><span class="kw">tm_raster</span>(<span class="dt">title =</span> <span class="st">&quot;Probability&quot;</span>) <span class="op">+</span></span>
<span id="cb146-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb146-10"></a><span class="kw">tm_shape</span>(FL.sf) <span class="op">+</span></span>
<span id="cb146-11"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb146-11"></a><span class="st">  </span><span class="kw">tm_borders</span>(<span class="dt">col =</span> <span class="st">&quot;gray70&quot;</span>) <span class="op">+</span></span>
<span id="cb146-12"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb146-12"></a><span class="kw">tm_legend</span>(<span class="dt">position =</span> <span class="kw">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>) ) <span class="op">+</span></span>
<span id="cb146-13"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb146-13"></a><span class="kw">tm_credits</span>(<span class="dt">text =</span> <span class="st">&quot;Chance that a random wildfire</span><span class="ch">\n</span><span class="st">was caused by lightning&quot;</span>,</span>
<span id="cb146-14"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb146-14"></a>             <span class="dt">position =</span> <span class="kw">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>)) </span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
</div>
</div>
<div id="clustering-through-interaction" class="section level2" number="1.6">
<h2><span class="header-section-number">1.6</span> Clustering through interaction</h2>
<p>The first-order spatial intensity function describes the distribution on a scale across the domain (trend and/or covariate terms). Clustering is a second-order property of point pattern data. It answers the question: is the probability of an event in the proximity of another event higher than expected by chance?</p>
<p>What physical processes can you think of where this question might be relevant?</p>
<p>Let <span class="math inline">\(r\)</span> be the distance between two events or the distance between an event and an arbitrary point within the domain of a spatial point pattern data set, then functions to describe clustering are:</p>
<p>The nearest neighbor distance function <span class="math inline">\(G(r)\)</span> : The cumulative distribution of the distances from an event to the nearest other event (event-to-event function). It summarizes the distances between nearest neighbors.</p>
<p>The empty space function <span class="math inline">\(F(r)\)</span> : The cumulative distribution of the distances from a point in the domain to the nearest event (point-to-event function). It summarizes the distance gaps between events (lacunarity–amount of gappiness).</p>
<p>The reduced second moment function (Ripley’s <span class="math inline">\(K\)</span>) <span class="math inline">\(K(r)\)</span> : Defined such that <span class="math inline">\(\lambda \times K(r)\)</span> is the expected number of additional events within a distance <span class="math inline">\(r\)</span> of an event, where <span class="math inline">\(\lambda\)</span> is the average intensity of the events. It is a measure of the spatial autocorrelation among the events.</p>
<p>To help evaluate clustering estimates of <span class="math inline">\(G\)</span>, <span class="math inline">\(F\)</span>, and <span class="math inline">\(K\)</span> computed on point pattern data (empirical estimates) are compared to theoretical curves assuming a homogeneous Poisson process. These theoretical curves are well defined for homogeneous point patterns (CSR–complete spatial randomness). A deviation of the empirical estimate from the theoretical curve is evidence against CSR.</p>
<p>The theoretical functions assuming a homogeneous Poisson process are:</p>
<p><span class="math inline">\(K(r) = \pi r^2\)</span>
<span class="math inline">\(F(r) = G(r) = 1 - \exp(-\lambda \pi r^2)\)</span></p>
<p>Where <span class="math inline">\(\lambda\)</span> is the spatial intensity.</p>
<p>Recall the Swedish pine saplings data from the <strong>spatstat</strong> package.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb147-1"></a><span class="kw">library</span>(spatstat)</span>
<span id="cb147-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb147-2"></a></span>
<span id="cb147-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb147-3"></a><span class="kw">data</span>(swedishpines)</span>
<span id="cb147-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb147-4"></a><span class="kw">class</span>(swedishpines)</span></code></pre></div>
<pre><code>## [1] &quot;ppp&quot;</code></pre>
<p>Here we first assign the data to an object called <code>SP</code>. We then compute the nearest neighbor distance function using <code>Gest()</code> and assign the output of this computation to an object called <code>G</code>. List the output.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb149-1"></a>SP &lt;-<span class="st"> </span>swedishpines</span>
<span id="cb149-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb149-2"></a>( G &lt;-<span class="st"> </span><span class="kw">Gest</span>(SP) )</span></code></pre></div>
<pre><code>## Function value object (class &#39;fv&#39;)
## for the function r -&gt; G(r)
## .....................................................................
##         Math.label      Description                                  
## r       r               distance argument r                          
## theo    G[pois](r)      theoretical Poisson G(r)                     
## han     hat(G)[han](r)  Hanisch estimate of G(r)                     
## rs      hat(G)[bord](r) border corrected estimate of G(r)            
## km      hat(G)[km](r)   Kaplan-Meier estimate of G(r)                
## hazard  hat(h)[km](r)   Kaplan-Meier estimate of hazard function h(r)
## theohaz h[pois](r)      theoretical Poisson hazard function h(r)     
## .....................................................................
## Default plot formula:  .~r
## where &quot;.&quot; stands for &#39;km&#39;, &#39;rs&#39;, &#39;han&#39;, &#39;theo&#39;
## Recommended range of argument r: [0, 11]
## Available range of argument r: [0, 22.26]
## Unit of length: 0.1 metres</code></pre>
<p>Output includes the distance <code>r</code> and estimates for the cumulative event-to-event distances. With many events the different estimates (e.g., Kaplan-Meier, border corrected, etc) will be similiar.</p>
<p>The output also includes theoretical values under the assumption of a homogeneous Poisson process (read: CSR). The <code>plot()</code> method makes it easy to compare the estimates against CSR.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb151-1"></a><span class="kw">plot</span>(G)</span>
<span id="cb151-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb151-2"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="kw">c</span>(.<span class="dv">2</span>, <span class="fl">.5</span>), </span>
<span id="cb151-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb151-3"></a>       <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb151-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb151-4"></a>       <span class="dt">lty =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<p>The graph shows <span class="math inline">\(G\)</span> as a function of distance <span class="math inline">\(r\)</span> starting at zero distance. We add two horizontal lines to help with interpretation.</p>
<p>The horizontal dashed line at <span class="math inline">\(G\)</span> = .2 intersects the black line at a distance of .5 meter (<span class="math inline">\(r\)</span>) [unit of length is .1 meters]. This means that 20% of the pairwise distances between saplings are within .5 meter. The horizontal dashed line at <span class="math inline">\(G\)</span> = .5 intersects the black line at .8 meters indicating that 50% of the pairwise distances are within .8 meter.</p>
<p>The blue dashed-dotted line is the theoretical homogeneous Poisson process model with the same intensity as the Swedish pines. We see that for a given radius, the actual value of <span class="math inline">\(G\)</span> is less than the theoretical value of <span class="math inline">\(G\)</span>. There are fewer saplings in the vicinity of other saplings than expected by chance. For example, if the saplings were arranged under the model of CRS we would expect 20% of the pairwise distances to be within .3 meter and 50% of them to be within .55 meter.</p>
<p>For publication we should convert the object <code>G</code> to a data frame and then use <strong>ggplot2</strong> functions. Here we do this then remove estimates for distances greater than 1.1 meter and convert the units to meters.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb152-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb152-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb152-2"></a></span>
<span id="cb152-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb152-3"></a>G.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(G) <span class="op">%&gt;%</span></span>
<span id="cb152-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb152-4"></a><span class="st">  </span><span class="kw">filter</span>(r <span class="op">&lt;</span><span class="st"> </span><span class="dv">11</span>) <span class="op">%&gt;%</span></span>
<span id="cb152-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb152-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">r =</span> r <span class="op">*</span><span class="st"> </span><span class="fl">.1</span>)</span>
<span id="cb152-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb152-6"></a></span>
<span id="cb152-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb152-7"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb152-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb152-8"></a></span>
<span id="cb152-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb152-9"></a><span class="kw">ggplot</span>(G.df, <span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">y =</span> km)) <span class="op">+</span></span>
<span id="cb152-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb152-10"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb152-11"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb152-11"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> theo), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></span>
<span id="cb152-12"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb152-12"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">c</span>(.<span class="dv">2</span>, <span class="fl">.5</span>), <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb152-13"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb152-13"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance (m)&quot;</span>) <span class="op">+</span><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;G(r): Cumulative % of distances within a distance r of another event&quot;</span>) <span class="op">+</span></span>
<span id="cb152-14"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb152-14"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-81-1.png" width="672" /></p>
<p>The empty space function (<span class="math inline">\(F\)</span>) is a bit harder to interpret. It is the percent of the domain within a distance from any event. Here again we add some lines to help with interpretation.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb153-1"></a>F.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">Fest</span>(SP)) <span class="op">%&gt;%</span></span>
<span id="cb153-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb153-2"></a><span class="st">    </span><span class="kw">filter</span>(r <span class="op">&lt;</span><span class="st"> </span><span class="dv">11</span>) <span class="op">%&gt;%</span></span>
<span id="cb153-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb153-3"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">r =</span> r <span class="op">*</span><span class="st"> </span><span class="fl">.1</span>)</span>
<span id="cb153-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb153-4"></a></span>
<span id="cb153-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb153-5"></a><span class="kw">ggplot</span>(F.df, <span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">y =</span> km)) <span class="op">+</span></span>
<span id="cb153-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb153-6"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb153-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb153-7"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> theo), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></span>
<span id="cb153-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb153-8"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="kw">c</span>(.<span class="dv">7</span>, <span class="fl">.58</span>), <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb153-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb153-9"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="fl">.61</span>, <span class="dt">lty =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb153-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb153-10"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance (m)&quot;</span>) <span class="op">+</span><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Percent of domain within a distance r&quot;</span>) <span class="op">+</span></span>
<span id="cb153-11"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb153-11"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-82-1.png" width="672" /></p>
<p>The horizontal dashed line at <span class="math inline">\(F\)</span> = .7 intersects the black line at a distance of .6 meter. This means that 70% of the spatial domain is less than .6 meters from a sapling. The blue line is the theoretical homogeneous Poisson process model. If the process was CSR slightly less than 58% (<span class="math inline">\(F\)</span> = .58) of the domain would be less than .6 meter from a sapling. In words, the saplings display less “gappiness” (more regularity) than expected by chance.</p>
<p>The <span class="math inline">\(J\)</span> function is the ratio of the <span class="math inline">\(F\)</span> to the <span class="math inline">\(G\)</span> function. For a CSR processes the value of <span class="math inline">\(J\)</span> is one. Here we see a large and systematic departure of <span class="math inline">\(J\)</span> from unity for distances greater than about .5 meter, due to the regularity.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb154-1"></a>J.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">Jest</span>(SP)) <span class="op">%&gt;%</span></span>
<span id="cb154-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb154-2"></a><span class="st">    </span><span class="kw">filter</span>(r <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span></span>
<span id="cb154-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb154-3"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">r =</span> r <span class="op">*</span><span class="st"> </span><span class="fl">.1</span>)</span>
<span id="cb154-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb154-4"></a></span>
<span id="cb154-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb154-5"></a><span class="kw">ggplot</span>(J.df, <span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">y =</span> km)) <span class="op">+</span></span>
<span id="cb154-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb154-6"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb154-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb154-7"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> theo), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></span>
<span id="cb154-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb154-8"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance (m)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;&quot;</span>) <span class="op">+</span></span>
<span id="cb154-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb154-9"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-83-1.png" width="672" /></p>
<p>The <code>Kest()</code> function estimates the <span class="math inline">\(K(d)\)</span> (Ripley’s reduced second moment function) from a point pattern. The function is defined as
<span class="math display">\[
\hat K(r) = \frac{1}{\hat \lambda} \sum_{j \ne i} \frac{I(r_{ij} &lt; r)}{n}
\]</span>
where <span class="math inline">\(r_{ij}\)</span> is the euclidean distance between event <span class="math inline">\(i\)</span> and event <span class="math inline">\(j\)</span>, <span class="math inline">\(r\)</span> is the search radius, and <span class="math inline">\(\hat \lambda\)</span> is an estimate of the intensity <span class="math inline">\((\hat \lambda = n/|A|)\)</span> where <span class="math inline">\(|A|\)</span> is the window area and <span class="math inline">\(n\)</span> is the number of events. <span class="math inline">\(I(.)\)</span> is an indicator function equal to 1 when the expression inside the parentheses is true, and 0 otherwise. If the events are homogeneous, <span class="math inline">\(\hat{K}(r)\)</span> increases at a rate proportional to <span class="math inline">\(\pi r^2\)</span>.</p>
<div id="another-example-bramble-canes" class="section level4" number="1.6.0.1">
<h4><span class="header-section-number">1.6.0.1</span> Another example: Bramble canes</h4>
<p>The locations of bramble canes are available as a marked <code>ppp</code> object in the {spatstat} package. A bramble is any rough (usually wild) tangled prickly shrub with thorny stems.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb155-1"></a><span class="kw">data</span>(bramblecanes)</span>
<span id="cb155-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb155-2"></a><span class="kw">summary</span>(bramblecanes)</span></code></pre></div>
<pre><code>## Marked planar point pattern:  823 points
## Average intensity 823 points per square unit (one unit = 9 metres)
## 
## Coordinates are given to 3 decimal places
## i.e. rounded to the nearest multiple of 0.001 units (one unit = 9 metres)
## 
## Multitype:
##   frequency proportion intensity
## 0       359 0.43620900       359
## 1       385 0.46780070       385
## 2        79 0.09599028        79
## 
## Window: rectangle = [0, 1] x [0, 1] units
## Window area = 1 square unit
## Unit of length: 9 metres</code></pre>
<p>The marks represent the different cane ages as an ordered factor. The unit of length is 9 meters.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb157-1"></a><span class="kw">plot</span>(bramblecanes)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-85-1.png" width="672" /></p>
<p>Here we consider the point pattern for all canes.</p>
<p>We estimate the <span class="math inline">\(K\)</span> function on these point pattern data and make a plot. Here we plot the empirical estimate of <span class="math inline">\(K\)</span> with isotropic correction at the domain borders (<code>iso</code>).</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb158-1"></a>K.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">Kest</span>(bramblecanes)) <span class="op">%&gt;%</span></span>
<span id="cb158-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb158-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">r =</span> r <span class="op">*</span><span class="st"> </span><span class="dv">9</span>)</span>
<span id="cb158-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb158-3"></a></span>
<span id="cb158-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb158-4"></a><span class="kw">ggplot</span>(K.df, <span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">y =</span> iso)) <span class="op">+</span></span>
<span id="cb158-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb158-5"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb158-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb158-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> theo), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></span>
<span id="cb158-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb158-7"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance (m)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;K(r)&quot;</span>) <span class="op">+</span></span>
<span id="cb158-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb158-8"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-86-1.png" width="672" /></p>
<p>The empirical estimate of <span class="math inline">\(K\)</span> (black line) is to the left of the theoretical function under CSR (blue line). This means that for any distance between 0 and 2 m from any event there tends to be more events within this distance (larger <span class="math inline">\(K\)</span>). We say that the bramble canes are more clustered than CRS.</p>
<p>The expected number of additional events is multiplied by the total number of events (823) so a value of .1 indicates that at a distance of about 1.6 meters we would expect to see about 82 additional events.</p>
</div>
<div id="example-kansas-tornadoes" class="section level4" number="1.6.0.2">
<h4><span class="header-section-number">1.6.0.2</span> Example: Kansas tornadoes</h4>
<p>Last week we mapped the intensity of tornadoes across Kansas by considering the genesis locations as point pattern data. Here we return to these data and consider only tornadoes since 1994.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb159-1"></a><span class="kw">library</span>(sf)</span>
<span id="cb159-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb159-2"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb159-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb159-3"></a></span>
<span id="cb159-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb159-4"></a>Torn.sf &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="dt">dsn =</span> <span class="st">&quot;1950-2018-torn-initpoint&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb159-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb159-5"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> <span class="dv">3082</span>) <span class="op">%&gt;%</span></span>
<span id="cb159-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb159-6"></a><span class="st">  </span><span class="kw">filter</span>(mag <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>, yr <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1994</span>) <span class="op">%&gt;%</span></span>
<span id="cb159-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb159-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">EF =</span> <span class="kw">as.factor</span>(mag)) <span class="op">%&gt;%</span></span>
<span id="cb159-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb159-8"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(EF)</span></code></pre></div>
<pre><code>## Reading layer `1950-2018-torn-initpoint&#39; from data source `/Users/jelsner/Desktop/Projects/ASSFG-Book/1950-2018-torn-initpoint&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 63645 features and 22 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -163.53 ymin: 18.13 xmax: -64.9 ymax: 61.02
## CRS:            4326</code></pre>
<p>Convert the simple feature data frame to a <code>ppp</code> object. First we need to convert the simple feature to a <code>SpatialPointsDataFrame</code>.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb161-1"></a><span class="kw">library</span>(maptools)</span>
<span id="cb161-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb161-2"></a>Torn.sp &lt;-<span class="st"> </span><span class="kw">as</span>(Torn.sf, <span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb161-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb161-3"></a>T.ppp &lt;-<span class="st"> </span><span class="kw">as</span>(Torn.sp[<span class="st">&quot;EF&quot;</span>], <span class="st">&quot;ppp&quot;</span>)</span></code></pre></div>
<p>Create the analysis window using the state boundary then subset the tornado locations by the border. We use the <code>rescale()</code> function with scale (<code>s =</code>) set to 1000. We compute the average intensity of the point pattern.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb162-1"></a><span class="kw">library</span>(USAboundaries)</span>
<span id="cb162-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb162-2"></a><span class="kw">library</span>(maptools)</span>
<span id="cb162-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb162-3"></a></span>
<span id="cb162-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb162-4"></a>KS.sf &lt;-<span class="st"> </span><span class="kw">us_states</span>(<span class="dt">states =</span> <span class="st">&quot;Kansas&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb162-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb162-5"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> <span class="kw">st_crs</span>(Torn.sf)<span class="op">$</span>proj4string)</span>
<span id="cb162-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb162-6"></a></span>
<span id="cb162-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb162-7"></a>KS.sp &lt;-<span class="st"> </span><span class="kw">as</span>(KS.sf, <span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb162-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb162-8"></a>KS.win &lt;-<span class="st"> </span><span class="kw">as</span>(KS.sp, <span class="st">&#39;owin&#39;</span>)</span>
<span id="cb162-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb162-9"></a></span>
<span id="cb162-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb162-10"></a>T.ppp &lt;-<span class="st"> </span>T.ppp[KS.win]</span>
<span id="cb162-11"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb162-11"></a></span>
<span id="cb162-12"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb162-12"></a>T.ppp &lt;-<span class="st"> </span>spatstat<span class="op">::</span><span class="kw">rescale</span>(T.ppp, </span>
<span id="cb162-13"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb162-13"></a>                           <span class="dt">s =</span> <span class="dv">1000</span>, </span>
<span id="cb162-14"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb162-14"></a>                           <span class="dt">unitname =</span> <span class="st">&quot;km&quot;</span>)</span>
<span id="cb162-15"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb162-15"></a><span class="kw">plot</span>(T.ppp)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-89-1.png" width="672" /></p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb163-1"></a><span class="kw">summary</span>(T.ppp)<span class="op">$</span>intensity</span></code></pre></div>
<pre><code>## [1] 0.01010672</code></pre>
<p>There are 2181 events with an average intensity of .01 events per square km (1 tornado per 10 square km over the 24-year period 1994–2018).</p>
<p>Ripley’s K function.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb165-1"></a>K.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">Kest</span>(T.ppp))</span>
<span id="cb165-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb165-2"></a><span class="kw">ggplot</span>(K.df, <span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">y =</span> iso <span class="op">*</span><span class="st"> </span><span class="kw">summary</span>(T.ppp)<span class="op">$</span>intensity)) <span class="op">+</span></span>
<span id="cb165-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb165-3"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb165-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb165-4"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> theo <span class="op">*</span><span class="st"> </span><span class="kw">summary</span>(T.ppp)<span class="op">$</span>intensity), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></span>
<span id="cb165-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb165-5"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">60</span>, <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb165-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb165-6"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">129</span>, <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb165-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb165-7"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">115</span>, <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb165-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb165-8"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance (km)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;K(r), Expected number of additional tornadoes</span><span class="ch">\n</span><span class="st"> within a distance r of any tornado&quot;</span>) <span class="op">+</span></span>
<span id="cb165-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb165-9"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-90-1.png" width="672" /></p>
<p>Interpretation: Consider 60 km along the horizontal axis. If we draw a line up from there we can see that the line intersects the black curve at a height of about 129. This value indicates that at a distance of 60 km from a random tornado we find, on average, about 129 other tornadoes. Imagine placing a disc with radius 60 km around centered on each event then averaging the number of events under the disc over all events.</p>
<p>The blue line is the curve under the assumption that the tornadoes are CSR across the state. We can see that if this was the case we would expect to see on average about 115 tornadoes within a distance 60 km from any tornado. Since there are MORE tornadoes than expected within a given 60 km radius we say there is evidence for clustering at this scale.</p>
<p>The black line lies above the blue line across distances from 0 to greater than 100 km.</p>
<p>How do we interpret the output from the nearest neighbor distance function applied to the set of Kansas tornadoes? Here we create a data frame from the output of the <code>Gest()</code> function and remove distances exceeding 8 km.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb166-1"></a>G.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">Gest</span>(T.ppp)) <span class="op">%&gt;%</span></span>
<span id="cb166-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb166-2"></a><span class="st">  </span><span class="kw">filter</span>(r <span class="op">&lt;</span><span class="st"> </span><span class="dv">8</span>)</span>
<span id="cb166-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb166-3"></a></span>
<span id="cb166-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb166-4"></a><span class="kw">ggplot</span>(G.df, <span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">y =</span> km)) <span class="op">+</span></span>
<span id="cb166-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb166-5"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb166-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb166-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> theo), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></span>
<span id="cb166-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb166-7"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">.4</span>, <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb166-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb166-8"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="kw">c</span>(<span class="fl">3.2</span>, <span class="dv">4</span>), <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb166-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb166-9"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance (m)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;G(r): Cumulative % of distances</span><span class="ch">\n</span><span class="st"> within a distance r of another tornado&quot;</span>) <span class="op">+</span></span>
<span id="cb166-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb166-10"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-91-1.png" width="672" /></p>
<p>The interpretation is that 40% (<span class="math inline">\(G\)</span> = .4) of all tornado locations have another tornado within a distance of just about 3.2 km on average. If the reports where homogeneous Poisson then the distance would be 4 km. We conclude they are more clustered.</p>
<p>Note: With this many events the difference between the raw and border-corrected estimates is small.</p>
</div>
<div id="statistical-significance" class="section level3" number="1.6.1">
<h3><span class="header-section-number">1.6.1</span> Statistical significance</h3>
<p>We see the separation between the black solid line and the blue dashed line, but is this separation large relative to the sample size? More to the point, is the above difference between the empirical and theoretical distance functions (e.g., <span class="math inline">\(G\)</span>) large enough to conclude there is significant clustering?</p>
<p>In general, there are two ways to approach inference. 1) Compare the statistic of interest against many cases generated from the null hypothesis and ask: does the statistic fall outside the envelope of the null cases? 2) Get estimates of uncertainty on the statistic of interest and ask: does the uncertainty interval contain the null case?</p>
<p>The <code>envelope()</code> function takes a <code>ppp</code> object and computes the cluster statistic of interest for <code>nsim</code> cases under the null hypothesis of a homogeneous Poisson process (CSR). This is inference in the 1st way.</p>
<p>Because the computation takes time with this many events we consider a subset of all the tornadoes that have an EF rating of 2 or higher. These are called ‘significant’ tornadoes (strong and violent).</p>
<p>Here we create a new <code>ppp</code> object that contains only tornadoes rated at least EF2. Note since the marks is a factor vector we can’t use <code>&gt;=</code>.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb167-1"></a>ST.ppp &lt;-<span class="st"> </span><span class="kw">unmark</span>(T.ppp[T.ppp<span class="op">$</span>marks <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">|</span><span class="st"> </span></span>
<span id="cb167-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb167-2"></a><span class="st">                       </span>T.ppp<span class="op">$</span>marks <span class="op">==</span><span class="st"> </span><span class="dv">3</span> <span class="op">|</span><span class="st"> </span></span>
<span id="cb167-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb167-3"></a><span class="st">                       </span>T.ppp<span class="op">$</span>marks <span class="op">==</span><span class="st"> </span><span class="dv">4</span> <span class="op">|</span></span>
<span id="cb167-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb167-4"></a><span class="st">                       </span>T.ppp<span class="op">$</span>marks <span class="op">==</span><span class="st"> </span><span class="dv">5</span>])</span>
<span id="cb167-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb167-5"></a>Kenv &lt;-<span class="st"> </span><span class="kw">envelope</span>(ST.ppp, </span>
<span id="cb167-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb167-6"></a>                 <span class="dt">fun =</span> Kest, </span>
<span id="cb167-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb167-7"></a>                 <span class="dt">nsim =</span> <span class="dv">99</span>)</span></code></pre></div>
<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
## 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80,
## 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.</code></pre>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb169-1"></a>Kenv.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(Kenv)</span>
<span id="cb169-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb169-2"></a></span>
<span id="cb169-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb169-3"></a><span class="kw">ggplot</span>(Kenv.df, <span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">y =</span> obs)) <span class="op">+</span></span>
<span id="cb169-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb169-4"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lo, <span class="dt">ymax =</span> hi), <span class="dt">fill =</span> <span class="st">&quot;gray70&quot;</span>) <span class="op">+</span></span>
<span id="cb169-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb169-5"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb169-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb169-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> theo), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb169-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb169-7"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance (km)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;K(r)&quot;</span>) <span class="op">+</span></span>
<span id="cb169-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb169-8"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-92-1.png" width="672" /></p>
<p>Here we see the <span class="math inline">\(K\)</span> function computed on the data in the black line and the theoretical estimate of <span class="math inline">\(K\)</span> under CSR in the blue dashed line. The uncertainty ribbon (gray band) connects the point-wise minimum and maximum values of the 99 simulated values where the simulations are done using the theoretical model. The default option in the <code>envelope()</code> function is the minimum and maximum value (<code>rank = 1</code>).</p>
<p>We can confidently conclude that (significant) tornadoes are more clustered across Kansas than one would expect by chance.</p>
<p>If the specific intention is to test a null hypothesis of CSR, then a single number measuring the departure of the estimated <span class="math inline">\(K\)</span> from the <span class="math inline">\(K\)</span> computed from a CSR model is appropriate. One such number is the maximum absolute deviation implemented with the <code>mad.test()</code> function.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb170-1"></a><span class="kw">mad.test</span>(ST.ppp, </span>
<span id="cb170-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb170-2"></a>         <span class="dt">fun =</span> Kest, </span>
<span id="cb170-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb170-3"></a>         <span class="dt">nsim =</span> <span class="dv">99</span>)</span></code></pre></div>
<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
## 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80,
## 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.</code></pre>
<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: K(r)
##  Reference function: theoretical
##  Alternative: two.sided
##  Interval of distance values: [0, 85.9002061915644] km
##  Test statistic: Maximum absolute deviation
##  Deviation = observed minus theoretical
## 
## data:  ST.ppp
## mad = 7449.1, rank = 1, p-value = 0.01</code></pre>
<p>Since there are 99 simulations the lowest <span class="math inline">\(p\)</span>-value is .01.</p>
<p>Another test statistic is related to the sum of the squared deviations between the estimated and theoretical functions. It is implemented with the <code>dclf.test()</code> function.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb173-1"></a><span class="kw">dclf.test</span>(ST.ppp, </span>
<span id="cb173-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb173-2"></a>          <span class="dt">fun =</span> Kest, </span>
<span id="cb173-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb173-3"></a>          <span class="dt">nsim =</span> <span class="dv">99</span>)</span></code></pre></div>
<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
## 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80,
## 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.</code></pre>
<pre><code>## 
##  Diggle-Cressie-Loosmore-Ford test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: K(r)
##  Reference function: theoretical
##  Alternative: two.sided
##  Interval of distance values: [0, 85.9002061915644] km
##  Test statistic: Integral of squared absolute deviation
##  Deviation = observed minus theoretical
## 
## data:  ST.ppp
## u = 1601197032, rank = 1, p-value = 0.01</code></pre>
<p>In both cases the <span class="math inline">\(p\)</span>-value on the test statistic against the one-sided alternative is less than .01 (Note, the reported <span class="math inline">\(p\)</span>-value is two-sided) indicating conclusive evidence of clustering.</p>
<p>Let us repeat this using the Swedish pine sapling data set (<code>swedishpines</code>).</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb176-1"></a>Kenv &lt;-<span class="st"> </span><span class="kw">envelope</span>(SP, </span>
<span id="cb176-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb176-2"></a>                 <span class="dt">fun =</span> Kest, </span>
<span id="cb176-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb176-3"></a>                 <span class="dt">nsim =</span> <span class="dv">99</span>)</span></code></pre></div>
<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
## 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80,
## 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.</code></pre>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb178-1"></a>Kenv.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(Kenv)</span>
<span id="cb178-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb178-2"></a></span>
<span id="cb178-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb178-3"></a><span class="kw">ggplot</span>(Kenv.df, <span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">y =</span> obs <span class="op">*</span><span class="st"> </span><span class="kw">summary</span>(SP)<span class="op">$</span>intensity)) <span class="op">+</span></span>
<span id="cb178-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb178-4"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lo <span class="op">*</span><span class="st"> </span><span class="kw">summary</span>(SP)<span class="op">$</span>intensity,</span>
<span id="cb178-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb178-5"></a>                  <span class="dt">ymax =</span> hi <span class="op">*</span><span class="st"> </span><span class="kw">summary</span>(SP)<span class="op">$</span>intensity), <span class="dt">fill =</span> <span class="st">&quot;gray70&quot;</span>) <span class="op">+</span></span>
<span id="cb178-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb178-6"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> theo <span class="op">*</span><span class="st"> </span><span class="kw">summary</span>(SP)<span class="op">$</span>intensity), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb178-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb178-7"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance (km)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;K(r), Expected number of additional saplings</span><span class="ch">\n</span><span class="st"> within a distance r of a sapling&quot;</span>) <span class="op">+</span></span>
<span id="cb178-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb178-8"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-95-1.png" width="672" /></p>
<p>Q: How do we interpret this? Scale matters.</p>
<p>Based on the fact that much of the black line is within the gray envelope indicates that a formal test against the null hypothesis of CSR will likely fail.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb179-1"></a><span class="kw">mad.test</span>(swedishpines, </span>
<span id="cb179-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb179-2"></a>         <span class="dt">fun =</span> Kest, </span>
<span id="cb179-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb179-3"></a>         <span class="dt">nsim =</span> <span class="dv">99</span>)</span></code></pre></div>
<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
## 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80,
## 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.</code></pre>
<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: K(r)
##  Reference function: theoretical
##  Alternative: two.sided
##  Interval of distance values: [0, 24] units (one unit = 0.1 metres)
##  Test statistic: Maximum absolute deviation
##  Deviation = observed minus theoretical
## 
## data:  swedishpines
## mad = 150.69, rank = 23, p-value = 0.23</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb182-1"></a><span class="kw">dclf.test</span>(swedishpines, </span>
<span id="cb182-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb182-2"></a>          <span class="dt">fun =</span> Kest, </span>
<span id="cb182-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb182-3"></a>          <span class="dt">nsim =</span> <span class="dv">99</span>)</span></code></pre></div>
<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
## 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80,
## 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.</code></pre>
<pre><code>## 
##  Diggle-Cressie-Loosmore-Ford test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: K(r)
##  Reference function: theoretical
##  Alternative: two.sided
##  Interval of distance values: [0, 24] units (one unit = 0.1 metres)
##  Test statistic: Integral of squared absolute deviation
##  Deviation = observed minus theoretical
## 
## data:  swedishpines
## u = 106917, rank = 19, p-value = 0.19</code></pre>
<p>We see that this is in fact the case.</p>
<p>The 2nd way to approach inference is through resampling. The <code>lohboot()</code> function estimates the uncertainty on the computed statistic using a bootstrap procedure of Loh (2008) with modifications of Baddley et al. (2015).</p>
<p>By default the uncertainty (confidence) interval is 95%. It works by computing the local version of the function (e.g., <code>localK()</code>) on the set of resampled events.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb185-1"></a>Kboot.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">lohboot</span>(ST.ppp, </span>
<span id="cb185-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb185-2"></a>                                  <span class="dt">fun =</span> Kest))</span></code></pre></div>
<pre><code>## 1, 2, 3, 4.6.8.10.12.14.16.18.20.22.24.26.28.30.32.34.36.38.40
## .42.44.46.48.50.52.54.56.58.60.62.64.66.68.70.72.74.76.78.80
## .82.84.86.88.90.92.94.96.98.100.102.104.106.108.110.112.114.116.118.120
## .122.124.126.128.130.132.134.136.138.140.142.144.146.148.150.152.154.156.158.160
## .162.164.166.168.170.172 173.</code></pre>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb187-1"></a><span class="kw">ggplot</span>(Kboot.df, <span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">y =</span> iso)) <span class="op">+</span></span>
<span id="cb187-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb187-2"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lo, <span class="dt">ymax =</span> hi), <span class="dt">fill =</span> <span class="st">&quot;gray70&quot;</span>) <span class="op">+</span></span>
<span id="cb187-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb187-3"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb187-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb187-4"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> theo), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb187-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb187-5"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance (km)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;K(r)&quot;</span>) <span class="op">+</span></span>
<span id="cb187-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb187-6"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-97-1.png" width="672" /></p>
<p>Now the uncertainty band is plotted about the estimated <span class="math inline">\(K\)</span> function rather than about the null model. We see that the 95% uncertainty band does to include the CSR model (blue line). We confidently conclude that the significant tornadoes in Kansas are more clustered than chance.</p>
<p>Again for the Swedish pine saplings.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb188-1"></a>Kboot.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">lohboot</span>(SP, </span>
<span id="cb188-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb188-2"></a>                          <span class="dt">fun =</span> Kest))</span></code></pre></div>
<pre><code>## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
## 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70,  71.</code></pre>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb190-1"></a><span class="kw">ggplot</span>(Kboot.df, <span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">y =</span> iso)) <span class="op">+</span></span>
<span id="cb190-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb190-2"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lo, <span class="dt">ymax =</span> hi), <span class="dt">fill =</span> <span class="st">&quot;gray70&quot;</span>) <span class="op">+</span></span>
<span id="cb190-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb190-3"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb190-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb190-4"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> theo), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb190-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb190-5"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance (km)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;K(r)&quot;</span>) <span class="op">+</span></span>
<span id="cb190-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb190-6"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-98-1.png" width="672" /></p>
<div id="multitype-clustering" class="section level4" number="1.6.1.1">
<h4><span class="header-section-number">1.6.1.1</span> Multitype clustering</h4>
<p>Analogues of the <span class="math inline">\(G\)</span> and <span class="math inline">\(K\)</span> functions are available for ‘multitype’ point patterns. Multitype patterns have factor marks. Interest focuses on whether the occurrence of one type of event influences the occurrence of another type of event. For example, does the occurrence of species X over this domain influence the occurrence of species Y? Physically what might cause this?</p>
<p>The most common statistic for examining ‘cross correlation’ of event type occurrences is the <span class="math inline">\(K\)</span> cross function <span class="math inline">\(K_{ij}(r)\)</span>, which estimates the expected number of events of type j within a distance r of type i.</p>
<p>The <code>lansing</code> <code>ppp</code> contains the locations of 2,251 trees in a wooded lot.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb191-1"></a><span class="kw">data</span>(lansing)</span>
<span id="cb191-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb191-2"></a><span class="kw">summary</span>(lansing)</span></code></pre></div>
<pre><code>## Marked planar point pattern:  2251 points
## Average intensity 2251 points per square unit (one unit = 924 feet)
## 
## *Pattern contains duplicated points*
## 
## Coordinates are given to 3 decimal places
## i.e. rounded to the nearest multiple of 0.001 units (one unit = 924 feet)
## 
## Multitype:
##          frequency proportion intensity
## blackoak       135 0.05997335       135
## hickory        703 0.31230560       703
## maple          514 0.22834300       514
## misc           105 0.04664594       105
## redoak         346 0.15370950       346
## whiteoak       448 0.19902270       448
## 
## Window: rectangle = [0, 1] x [0, 1] units
## Window area = 1 square unit
## Unit of length: 924 feet</code></pre>
<p>The data are a multitype planar point pattern with marks indicating tree species. There are 135 black oaks, 703 hickories, etc. The spatial unit is 924 feet.</p>
<p>Compute and plot the cross <span class="math inline">\(K\)</span> function for Maple and Hickory trees.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb193-1"></a>Kc &lt;-<span class="st"> </span><span class="kw">Kcross</span>(lansing, <span class="dt">i =</span> <span class="st">&quot;maple&quot;</span>, <span class="dt">j =</span> <span class="st">&quot;hickory&quot;</span>)</span>
<span id="cb193-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb193-2"></a></span>
<span id="cb193-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb193-3"></a>Kc.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(Kc)</span>
<span id="cb193-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb193-4"></a><span class="kw">ggplot</span>(Kc.df, <span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">y =</span> iso)) <span class="op">+</span></span>
<span id="cb193-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb193-5"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb193-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb193-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> theo), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></span>
<span id="cb193-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb193-7"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="fl">.2</span>, <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb193-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb193-8"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">.093</span>, <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb193-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb193-9"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">.125</span>, <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb193-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb193-10"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Kc(r)&quot;</span>) <span class="op">+</span></span>
<span id="cb193-11"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb193-11"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-100-1.png" width="672" /></p>
<p>The vertical axis is the number of hickory trees within a radius r of a maple tree divided by the average intensity of the hickories. So at a distance of .2 (.2 x 924 ft = 180 ft) from a random maple there is an average of roughly 65 hickories (.093 x 703 hickories). If hickory and maple trees are CSR we would expect about 88 maples (.125 * 703) within that distance.</p>
<p>The presence of a hickory tree reduces the likelihood that a maple tree will be nearby.</p>
<p>Do the same for your EF1 and EF3 tornadoes.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb194-1"></a><span class="kw">plot</span>(<span class="kw">Kcross</span>(T.ppp, </span>
<span id="cb194-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb194-2"></a>            <span class="dt">i =</span> <span class="st">&quot;1&quot;</span>, </span>
<span id="cb194-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb194-3"></a>            <span class="dt">j =</span> <span class="st">&quot;3&quot;</span>))</span>
<span id="cb194-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb194-4"></a><span class="kw">abline</span>(<span class="dt">v =</span> <span class="dv">70</span>)</span>
<span id="cb194-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb194-5"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">19000</span>)</span>
<span id="cb194-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb194-6"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">15000</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-101-1.png" width="672" /></p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb195-1"></a>Kc &lt;-<span class="st"> </span><span class="kw">Kcross</span>(T.ppp, </span>
<span id="cb195-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb195-2"></a>             <span class="dt">i =</span> <span class="st">&quot;1&quot;</span>, </span>
<span id="cb195-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb195-3"></a>             <span class="dt">j =</span> <span class="st">&quot;3&quot;</span>)</span>
<span id="cb195-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb195-4"></a></span>
<span id="cb195-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb195-5"></a>Kc.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(Kc)</span>
<span id="cb195-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb195-6"></a><span class="kw">ggplot</span>(Kc.df, <span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">y =</span> iso)) <span class="op">+</span></span>
<span id="cb195-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb195-7"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb195-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb195-8"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> theo), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></span>
<span id="cb195-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb195-9"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">70</span>, <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb195-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb195-10"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">19000</span>, <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb195-11"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb195-11"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">15000</span>, <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb195-12"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb195-12"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Kc(r)&quot;</span>) <span class="op">+</span></span>
<span id="cb195-13"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb195-13"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-101-2.png" width="672" /></p>
<p>The vertical axis is the number of EF3 tornadoes within a radius r of an EF1 tornado divided by the average intensity of the EF3 tornadoes. At a distance of 70 km from a random EF1 tornado there are on average 19000 x .000277 = 5.3 EF3 tornadoes. If EF1 and EF3 tornadoes are CSR then we would expect, on average, somewhat fewer EF3 tornadoes in the vicinity of EF1 tornadoes (15000 x .000277 = 4.2).</p>
<p>We can see this more directly by using the <code>envelope()</code> function with the <code>fun = Kross</code>. We first use the <code>subset()</code> method with <code>drop = TRUE</code> to make a new <code>ppp</code> object with only those two groups.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb196-1"></a>T.ppp13 &lt;-<span class="st"> </span><span class="kw">subset</span>(T.ppp,</span>
<span id="cb196-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb196-2"></a>                  marks <span class="op">==</span><span class="st"> &quot;1&quot;</span> <span class="op">|</span></span>
<span id="cb196-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb196-3"></a><span class="st">                  </span>marks <span class="op">==</span><span class="st"> &quot;3&quot;</span>,</span>
<span id="cb196-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb196-4"></a>                  <span class="dt">drop =</span> <span class="ot">TRUE</span>)</span>
<span id="cb196-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb196-5"></a></span>
<span id="cb196-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb196-6"></a></span>
<span id="cb196-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb196-7"></a>Kcenv &lt;-<span class="st"> </span><span class="kw">envelope</span>(T.ppp13, </span>
<span id="cb196-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb196-8"></a>                 <span class="dt">fun =</span> Kcross, </span>
<span id="cb196-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb196-9"></a>                 <span class="dt">nsim =</span> <span class="dv">99</span>)</span></code></pre></div>
<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
## 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80,
## 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.</code></pre>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb198-1"></a>Kcenv.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(Kcenv)</span>
<span id="cb198-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb198-2"></a></span>
<span id="cb198-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb198-3"></a><span class="kw">ggplot</span>(Kcenv.df, <span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">y =</span> obs)) <span class="op">+</span></span>
<span id="cb198-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb198-4"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lo, <span class="dt">ymax =</span> hi), <span class="dt">fill =</span> <span class="st">&quot;gray70&quot;</span>) <span class="op">+</span></span>
<span id="cb198-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb198-5"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb198-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb198-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> theo), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb198-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb198-7"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance (km)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Kc(r)&quot;</span>) <span class="op">+</span></span>
<span id="cb198-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb198-8"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-102-1.png" width="672" /></p>
<p>And we can formally test as before using the <code>mad.test()</code> function.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb199-1"></a><span class="kw">mad.test</span>(T.ppp13, <span class="dt">fun =</span> Kcross, <span class="dt">nsim =</span> <span class="dv">99</span>)</span></code></pre></div>
<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
## 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80,
## 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.</code></pre>
<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: Kcross[&quot;1&quot;, &quot;3&quot;](r)
##  Reference function: theoretical
##  Alternative: two.sided
##  Interval of distance values: [0, 85.9002061915644] km
##  Test statistic: Maximum absolute deviation
##  Deviation = observed minus theoretical
## 
## data:  T.ppp13
## mad = 4162.6, rank = 1, p-value = 0.01</code></pre>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb202-1"></a><span class="kw">dclf.test</span>(T.ppp13, <span class="dt">fun =</span> Kcross, <span class="dt">nsim =</span> <span class="dv">99</span>)</span></code></pre></div>
<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
## 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80,
## 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.</code></pre>
<pre><code>## 
##  Diggle-Cressie-Loosmore-Ford test of CSR
##  Monte Carlo test based on 99 simulations
##  Summary function: Kcross[&quot;1&quot;, &quot;3&quot;](r)
##  Reference function: theoretical
##  Alternative: two.sided
##  Interval of distance values: [0, 85.9002061915644] km
##  Test statistic: Integral of squared absolute deviation
##  Deviation = observed minus theoretical
## 
## data:  T.ppp13
## u = 361332496, rank = 1, p-value = 0.01</code></pre>
<p>Both tests lead us to conclude EF3 tornadoes are more likely near EF1 tornadoes than would be expected if they were independently CSR. What is the cause?</p>
</div>
</div>
<div id="more-on-ripleys-k" class="section level3" number="1.6.2">
<h3><span class="header-section-number">1.6.2</span> More on Ripley’s K</h3>
<p>Ripley’s <span class="math inline">\(K\)</span> function (Ripley, 1976) is a descriptive statistic used to detect deviations from CSR. It is used to help determine whether events have a random, dispersed or clustered pattern.</p>
<p>Compute Ripley’s <span class="math inline">\(K\)</span> and look at the classes of the resulting object.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb205-1"></a>K &lt;-<span class="st"> </span><span class="kw">Kest</span>(T.ppp)</span>
<span id="cb205-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb205-2"></a><span class="kw">class</span>(K)</span></code></pre></div>
<pre><code>## [1] &quot;fv&quot;         &quot;data.frame&quot;</code></pre>
<p>It has two classes <code>fv</code> and <code>data.frame</code>. It is a data frame but with addtional attribute information. We focus on the data frame portion.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb207-1"></a>K.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(K)</span>
<span id="cb207-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb207-2"></a><span class="kw">head</span>(K.df)</span></code></pre></div>
<pre><code>##           r       theo   border    trans      iso
## 1 0.0000000 0.00000000 0.000000 0.000000 0.000000
## 2 0.1677738 0.08842974 5.897632 5.900337 5.900337
## 3 0.3355477 0.35371897 6.368816 6.354209 6.354209
## 4 0.5033215 0.79586769 7.031561 7.080404 7.080404
## 5 0.6710954 1.41487589 7.579475 7.625051 7.625051
## 6 0.8388692 2.21074358 8.222502 8.260472 8.260472</code></pre>
<p>In particular we want the values of <code>r</code> and <code>iso</code>. The value of <code>iso</code> times average intensity is the number of tornadoes within a distance <code>r</code>.</p>
<p>We add this information to the data frame.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb209-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb209-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb209-2"></a></span>
<span id="cb209-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb209-3"></a>K.df &lt;-<span class="st"> </span>K.df <span class="op">%&gt;%</span></span>
<span id="cb209-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb209-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">nT =</span> <span class="kw">summary</span>(T.ppp)<span class="op">$</span>intensity <span class="op">*</span><span class="st"> </span>iso)</span></code></pre></div>
<p>Suppose we are interested in the average number of tornadoes at a distance of exactly 50 km. We use the <code>approx()</code> function to interpolate the value of <code>nT</code> at a distance of 50 km.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb210-1"></a><span class="kw">approx</span>(<span class="dt">x =</span> K.df<span class="op">$</span>r, </span>
<span id="cb210-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb210-2"></a>       <span class="dt">y =</span> K.df<span class="op">$</span>nT,</span>
<span id="cb210-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb210-3"></a>       <span class="dt">xout =</span> <span class="dv">50</span>)<span class="op">$</span>y</span></code></pre></div>
<pre><code>## [1] 89.95065</code></pre>
<p>The variance stabilized Ripley <span class="math inline">\(K\)</span> function called the <span class="math inline">\(L\)</span> function is often used instead of <span class="math inline">\(K\)</span>. The sample version of the <span class="math inline">\(L\)</span> function is defined as
<span class="math display">\[
\hat{L}(r) = \Big( \hat{K}(r)/\pi\Big)^{1/2}.
\]</span></p>
<p>For data that is CSR, the <span class="math inline">\(L\)</span> function has expected value <span class="math inline">\(r\)</span> and its variance is approximately constant in <span class="math inline">\(r\)</span>. A common plot is a graph of <span class="math inline">\(r - \hat{L}(r)\)</span> against <span class="math inline">\(r\)</span>, which approximately follows the horizontal zero-axis with constant dispersion if the data follow a homogeneous Poisson process.</p>
</div>
<div id="caution-when-interpreting-these-clustering-functions" class="section level3" number="1.6.3">
<h3><span class="header-section-number">1.6.3</span> Caution when interpreting these clustering functions</h3>
<p>The clustering functions are defined and estimated under the assumption that the point process is stationary (homogeneous). If the process is inhomogeneous (trending) then deviations from the theoretical model do not necessarily imply interaction clustering. Also, the clustering functions characterize the process ‘on average’ so variability in the interaction process as a function of scale will not be detected.</p>
<p>As an example of the latter, we generate a random point pattern with local clustering but with regularity on the scale of the entire window. Thus it is CSR on average as indicated by the <span class="math inline">\(K\)</span> function.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb212-1"></a><span class="kw">set.seed</span>(<span class="dv">0112</span>)</span>
<span id="cb212-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb212-2"></a>X &lt;-<span class="st"> </span><span class="kw">rcell</span>(<span class="dt">nx =</span> <span class="dv">15</span>)</span>
<span id="cb212-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb212-3"></a><span class="kw">plot</span>(X, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-108-1.png" width="672" /></p>
<p>We see two clusters one in the north and one in the south. But overall the events appear to be more regular than CSR.</p>
<p>Your interpretation based on Ripley’s <span class="math inline">\(K\)</span> function would be that this pattern is CSR.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb213-1"></a>K.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">Kest</span>(X))</span>
<span id="cb213-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb213-2"></a><span class="kw">ggplot</span>(K.df, <span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">y =</span> iso)) <span class="op">+</span></span>
<span id="cb213-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb213-3"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb213-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb213-4"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> theo), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></span>
<span id="cb213-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb213-5"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance (km)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;K(r)&quot;</span>) <span class="op">+</span></span>
<span id="cb213-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb213-6"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-109-1.png" width="672" /></p>
<p>The empirical curve (black line) coincides with the theoretical CSR line (blue line).</p>
<p>And the maximum absolute deviation test under the null hypothesis of CSR returns a large <span class="math inline">\(p\)</span>-value.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb214-1"></a><span class="kw">mad.test</span>(X, <span class="dt">fun =</span> Kest, <span class="dt">nsim =</span> <span class="dv">999</span>)</span></code></pre></div>
<pre><code>## Generating 999 simulations of CSR  ...
## 1, 2, 3, ......10.........20.........30.........40.........50.........60........
## .70.........80.........90.........100.........110.........120.........130......
## ...140.........150.........160.........170.........180.........190.........200....
## .....210.........220.........230.........240.........250.........260.........270..
## .......280.........290.........300.........310.........320.........330.........340
## .........350.........360.........370.........380.........390.........400........
## .410.........420.........430.........440.........450.........460.........470......
## ...480.........490.........500.........510.........520.........530.........540....
## .....550.........560.........570.........580.........590.........600.........610..
## .......620.........630.........640.........650.........660.........670.........680
## .........690.........700.........710.........720.........730.........740........
## .750.........760.........770.........780.........790.........800.........810......
## ...820.........830.........840.........850.........860.........870.........880....
## .....890.........900.........910.........920.........930.........940.........950..
## .......960.........970.........980.........990........ 999.
## 
## Done.</code></pre>
<pre><code>## 
##  Maximum absolute deviation test of CSR
##  Monte Carlo test based on 999 simulations
##  Summary function: K(r)
##  Reference function: theoretical
##  Alternative: two.sided
##  Interval of distance values: [0, 0.25]
##  Test statistic: Maximum absolute deviation
##  Deviation = observed minus theoretical
## 
## data:  X
## mad = 0.0023931, rank = 871, p-value = 0.871</code></pre>
<p>As an example of the former (process is inhomogeneous), here we generate a point process as inhomogeneous without clustering.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb217-1"></a>X &lt;-<span class="st"> </span><span class="kw">rpoispp</span>(<span class="cf">function</span>(x, y){ <span class="dv">300</span> <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span><span class="dv">3</span> <span class="op">*</span><span class="st"> </span>x) })</span>
<span id="cb217-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb217-2"></a><span class="kw">plot</span>(X, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>) </span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-111-1.png" width="672" /></p>
<p>There is a clear trend toward fewer events going from west to east.</p>
<p>The <span class="math inline">\(K\)</span> function indicates clustering but this is an artifact of this trend.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb218-1"></a>K.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">Kest</span>(X))</span>
<span id="cb218-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb218-2"></a></span>
<span id="cb218-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb218-3"></a><span class="kw">ggplot</span>(K.df, <span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">y =</span> iso)) <span class="op">+</span></span>
<span id="cb218-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb218-4"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb218-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb218-5"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> theo), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></span>
<span id="cb218-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb218-6"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance (km)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;K(r)&quot;</span>) <span class="op">+</span></span>
<span id="cb218-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb218-7"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-112-1.png" width="672" /></p>
<p>In the case of a known trend we use the <code>Kinhom()</code> function instead of <code>Kest()</code>. For example, compare the uncertainty envelopes from a homogeneous and inhomogeneous Poisson process.</p>
<p>We start by plotting the output from the <code>envelope()</code> function with <code>fun = Kest</code>. The <code>global = TRUE</code> argument indicates that the envelopes are simultaneous rather than pointwise (<code>global = FALSE</code> which is the default). Pointwise envelopes assume the estimates are independent (usually not a good assumption) across the range of distances so the standard errors will be smaller resulting in narrower bands.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb219-1"></a>Kenv &lt;-<span class="st"> </span><span class="kw">envelope</span>(X, </span>
<span id="cb219-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb219-2"></a>              <span class="dt">fun =</span> Kest, </span>
<span id="cb219-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb219-3"></a>              <span class="dt">nsim =</span> <span class="dv">39</span>, </span>
<span id="cb219-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb219-4"></a>              <span class="dt">rank =</span> <span class="dv">1</span>, </span>
<span id="cb219-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb219-5"></a>              <span class="dt">global =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## Generating 39 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38,  39.
## 
## Done.</code></pre>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb221-1"></a>Kenv.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(Kenv)</span>
<span id="cb221-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb221-2"></a></span>
<span id="cb221-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb221-3"></a><span class="kw">ggplot</span>(Kenv.df, <span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">y =</span> obs)) <span class="op">+</span></span>
<span id="cb221-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb221-4"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lo, <span class="dt">ymax =</span> hi), <span class="dt">fill =</span> <span class="st">&quot;gray70&quot;</span>) <span class="op">+</span></span>
<span id="cb221-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb221-5"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb221-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb221-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> theo), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb221-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb221-7"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance (km)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;K(r)&quot;</span>) <span class="op">+</span></span>
<span id="cb221-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb221-8"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-113-1.png" width="672" /></p>
<p>We note that after a distance of about .15 units the empirical curve (black line) is outside the uncertainty band indicating the events are more clustered than CSR.</p>
<p>However when we use <code>fun = Kinhom</code> then the empirical curve is completely inside the uncertainty band.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb222-1"></a>Kenv &lt;-<span class="st"> </span><span class="kw">envelope</span>(X, </span>
<span id="cb222-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb222-2"></a>              <span class="dt">fun =</span> Kinhom, </span>
<span id="cb222-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb222-3"></a>              <span class="dt">nsim =</span> <span class="dv">99</span>, </span>
<span id="cb222-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb222-4"></a>              <span class="dt">rank =</span> <span class="dv">1</span>, </span>
<span id="cb222-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb222-5"></a>              <span class="dt">global =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
## 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80,
## 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.</code></pre>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb224-1"></a>Kenv.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(Kenv)</span>
<span id="cb224-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb224-2"></a></span>
<span id="cb224-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb224-3"></a><span class="kw">ggplot</span>(Kenv.df, <span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">y =</span> obs)) <span class="op">+</span></span>
<span id="cb224-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb224-4"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lo, <span class="dt">ymax =</span> hi), <span class="dt">fill =</span> <span class="st">&quot;gray70&quot;</span>) <span class="op">+</span></span>
<span id="cb224-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb224-5"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb224-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb224-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> theo), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb224-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb224-7"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance (km)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;K(r), Expected number of additional events</span><span class="ch">\n</span><span class="st"> within a distance r of an event&quot;</span>) <span class="op">+</span></span>
<span id="cb224-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb224-8"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-114-1.png" width="672" /></p>
<p>We conclude that the point pattern data are consistent with an inhomogeneous Poisson process without clustering.</p>
<p>Let’s return to the Kansas tornadoes (EF2+).</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb225-1"></a>Kenv &lt;-<span class="st"> </span><span class="kw">envelope</span>(ST.ppp,</span>
<span id="cb225-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb225-2"></a>                 <span class="dt">fun =</span> Kinhom,</span>
<span id="cb225-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb225-3"></a>                 <span class="dt">nsom =</span> <span class="dv">39</span>,</span>
<span id="cb225-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb225-4"></a>                 <span class="dt">rank =</span> <span class="dv">1</span>,</span>
<span id="cb225-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb225-5"></a>                 <span class="dt">global =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## Generating 99 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
## 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80,
## 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98,  99.
## 
## Done.</code></pre>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb227-1"></a>Kenv.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(Kenv)</span>
<span id="cb227-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb227-2"></a></span>
<span id="cb227-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb227-3"></a><span class="kw">ggplot</span>(Kenv.df, <span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">y =</span> obs)) <span class="op">+</span></span>
<span id="cb227-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb227-4"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lo, <span class="dt">ymax =</span> hi), <span class="dt">fill =</span> <span class="st">&quot;gray70&quot;</span>) <span class="op">+</span></span>
<span id="cb227-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb227-5"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb227-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb227-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> theo), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb227-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb227-7"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance (km)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;K(r)&quot;</span>) <span class="op">+</span></span>
<span id="cb227-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb227-8"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-115-1.png" width="672" /></p>
<p>We see some evidence of more clustered than CSR at short distances and some evidence of more regularity at long distances. This is likely the city/town effect that we noted last week.</p>
<p>But we would conclude from this plot that there is not strong evidence for clustering of tornado reports across the state of Kansas. We would be wrong.</p>
</div>
<div id="example-wildfires-in-florida" class="section level3" number="1.6.4">
<h3><span class="header-section-number">1.6.4</span> Example: Wildfires in Florida</h3>
<p>We import the Florida wildfire data as a simple feature data frame. Extract only fires occurring in Baker County (west of Duval County–Jacksonville). Include only wildfires started by lightning and select the fire size variable.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb228-1"></a>FL_Fires.sf &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="dt">dsn =</span> <span class="st">&quot;FL_Fires&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `FL_Fires&#39; from data source `/Users/jelsner/Desktop/Projects/ASSFG-Book/FL_Fires&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 90261 features and 37 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -9750382 ymin: 2824449 xmax: -8908899 ymax: 3632749
## proj4string:    +proj=merc +lon_0=0 +lat_ts=0 +x_0=0 +y_0=0 +a=6378137 +b=6378137 +units=m +no_defs</code></pre>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb230-1"></a><span class="kw">dim</span>(FL_Fires.sf)</span></code></pre></div>
<pre><code>## [1] 90261    38</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb232-1"></a>BakerFL.sf &lt;-<span class="st"> </span>maps<span class="op">::</span><span class="kw">map</span>(<span class="st">&quot;county&quot;</span>, <span class="dt">regions =</span> <span class="st">&quot;Florida&quot;</span>, <span class="dt">plot =</span> <span class="ot">FALSE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb232-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb232-2"></a><span class="st">  </span><span class="kw">st_as_sf</span>() <span class="op">%&gt;%</span></span>
<span id="cb232-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb232-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(ID <span class="op">==</span><span class="st"> &quot;florida,baker&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb232-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb232-4"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> <span class="kw">st_crs</span>(FL_Fires.sf))</span>
<span id="cb232-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb232-5"></a></span>
<span id="cb232-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb232-6"></a>Baker_Fires.sf &lt;-<span class="st"> </span><span class="kw">st_intersection</span>(FL_Fires.sf, BakerFL.sf) <span class="op">%&gt;%</span></span>
<span id="cb232-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb232-7"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(STAT_CAUSE <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></span>
<span id="cb232-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb232-8"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(FIRE_SIZE_)</span></code></pre></div>
<pre><code>## Warning: attribute variables are assumed to be spatially constant throughout all
## geometries</code></pre>
<p>Create a <code>ppp</code> object and an unmarked <code>ppp</code> object. Summarize the unmarked object and make a plot.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb234-1"></a>Baker_Fires.sp &lt;-<span class="st"> </span><span class="kw">as</span>(Baker_Fires.sf, <span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb234-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb234-2"></a>BF.ppp &lt;-<span class="st"> </span><span class="kw">as</span>(Baker_Fires.sp, <span class="st">&quot;ppp&quot;</span>)</span>
<span id="cb234-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb234-3"></a>BFU.ppp &lt;-<span class="st"> </span><span class="kw">unmark</span>(BF.ppp)</span>
<span id="cb234-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb234-4"></a><span class="kw">summary</span>(BFU.ppp)</span></code></pre></div>
<pre><code>## Planar point pattern:  344 points
## Average intensity 1.361674e-07 points per square unit
## 
## *Pattern contains duplicated points*
## 
## Coordinates are given to 1 decimal place
## i.e. rounded to the nearest multiple of 0.1 units
## 
## Window: rectangle = [-9179343, -9132435] x [3521558, 3575414] units
##                     (46910 x 53860 units)
## Window area = 2526300000 square units</code></pre>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb236-1"></a><span class="kw">plot</span>(BFU.ppp)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-117-1.png" width="672" /></p>
<p>The average intensity is 1.36 wildfires per 10 sq. km. But the intensity is based on a square domain.</p>
<p>Two points in a point pattern are identical if their x,y coordinates are the same, and their marks are the same (if they carry marks).</p>
<p>Remove duplicate points with the <code>unique()</code> function, set the window to the county border, and set the name for the unit of length.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb237-1"></a>BFU.ppp &lt;-<span class="st"> </span><span class="kw">unique</span>(BFU.ppp)</span>
<span id="cb237-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb237-2"></a></span>
<span id="cb237-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb237-3"></a>W.sp &lt;-<span class="st"> </span><span class="kw">as</span>(BakerFL.sf, <span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb237-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb237-4"></a>W &lt;-<span class="st"> </span><span class="kw">as</span>(W.sp, <span class="st">&#39;owin&#39;</span>)</span>
<span id="cb237-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb237-5"></a></span>
<span id="cb237-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb237-6"></a>BFU.ppp &lt;-<span class="st"> </span>BFU.ppp[W]</span>
<span id="cb237-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb237-7"></a></span>
<span id="cb237-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb237-8"></a><span class="kw">unitname</span>(BFU.ppp) &lt;-<span class="st"> &quot;meters&quot;</span></span>
<span id="cb237-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb237-9"></a></span>
<span id="cb237-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb237-10"></a><span class="kw">summary</span>(BFU.ppp)</span></code></pre></div>
<pre><code>## Planar point pattern:  335 points
## Average intensity 1.612727e-07 points per square meters
## 
## Coordinates are given to 1 decimal place
## i.e. rounded to the nearest multiple of 0.1 meters
## 
## Window: polygonal boundary
## single connected closed polygon with 17 vertices
## enclosing rectangle: [-9179415, -9132216] x [3521247, 3577422] meters
##                      (47200 x 56170 meters)
## Window area = 2077230000 square meters
## Unit of length: 1 meters
## Fraction of frame area: 0.783</code></pre>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb239-1"></a><span class="kw">plot</span>(BFU.ppp)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-118-1.png" width="672" /></p>
<p>The average intensity is 1.6 wildfires per 10 sq. km.</p>
<p>Ripley’s K function.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb240-1"></a>K.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">Kest</span>(BFU.ppp))</span>
<span id="cb240-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb240-2"></a><span class="kw">ggplot</span>(K.df, <span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">y =</span> iso <span class="op">*</span><span class="st"> </span><span class="kw">summary</span>(BFU.ppp)<span class="op">$</span>intensity)) <span class="op">+</span></span>
<span id="cb240-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb240-3"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb240-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb240-4"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> theo <span class="op">*</span><span class="st"> </span><span class="kw">summary</span>(BFU.ppp)<span class="op">$</span>intensity), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></span>
<span id="cb240-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb240-5"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance (m)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;K(r), Expected number of additional wildfires</span><span class="ch">\n</span><span class="st"> within a distance r of any wildfire&quot;</span>) <span class="op">+</span></span>
<span id="cb240-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb240-6"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-119-1.png" width="672" /></p>
<p>We see a difference, but is it significant against a null hypothesis of inhomogeneous Poisson?</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb241-1"></a>Kenv &lt;-<span class="st"> </span><span class="kw">envelope</span>(BFU.ppp, </span>
<span id="cb241-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb241-2"></a>              <span class="dt">fun =</span> Kinhom, </span>
<span id="cb241-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb241-3"></a>              <span class="dt">nsim =</span> <span class="dv">39</span>, </span>
<span id="cb241-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb241-4"></a>              <span class="dt">rank =</span> <span class="dv">1</span>, </span>
<span id="cb241-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb241-5"></a>              <span class="dt">global =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## Generating 39 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38,  39.
## 
## Done.</code></pre>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb243-1"></a>Kenv.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(Kenv)</span>
<span id="cb243-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb243-2"></a></span>
<span id="cb243-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb243-3"></a><span class="kw">ggplot</span>(Kenv.df, <span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">y =</span> obs)) <span class="op">+</span></span>
<span id="cb243-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb243-4"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> lo, <span class="dt">ymax =</span> hi), <span class="dt">fill =</span> <span class="st">&quot;gray70&quot;</span>) <span class="op">+</span></span>
<span id="cb243-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb243-5"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb243-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb243-6"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> theo), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb243-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb243-7"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance (m)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;K(r)&quot;</span>) <span class="op">+</span></span>
<span id="cb243-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb243-8"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-120-1.png" width="672" /></p>
<p>No.</p>
</div>
</div>
<div id="cluster-models" class="section level2" number="1.7">
<h2><span class="header-section-number">1.7</span> Cluster models</h2>
<p><strong>“It turns out that style matters in programming for the same reason that it matters in writing. It makes for better reading.”</strong> – Douglas Crockford</p>
<p>[Clean up this discuss a bit]</p>
<p>Cluster models are needed to describe point pattern data when event interactions violate the assumption of a homogenous Poisson process. Recall that event interaction implies that an event at one location changes the probability of an event or events nearby.</p>
<p>Cluster models can be derived from a Poisson process so as to retain some of their nice features. For example, with a Poisson cluster process, we begin with a Poisson process <span class="math inline">\(Y\)</span> describing a set of ‘parent’ events. Each parent <span class="math inline">\(y_i\)</span> in <span class="math inline">\(Y\)</span> produces to a finite set <span class="math inline">\(x_i\)</span> of ‘offspring’ events according to some random (read: stochastic) mechanism. Then the set of all offsprings forms a clustered point process <span class="math inline">\(X\)</span>. Only <span class="math inline">\(X\)</span> is observed and it will not be adequately described by homogeneous Poisson process (CSR).</p>
<p>Said another way, the model is homogeneous Poisson at an unobserved level but clustered at the level of the observations. Note: “model is homogeneous Poisson” refers to the idea that events locations generated from the model will be indistinguishable from a homogeneous Poisson process.</p>
<p>The Matern cluster process is one such example. Parent events come from a homogeneous Poisson process with intensity <span class="math inline">\(\kappa\)</span> and each parent has a Poisson (<span class="math inline">\(\mu\)</span>) number of offspring that are independently and uniformly distributed (iid) within a disc of radius <span class="math inline">\(r\)</span> centered on the parent.</p>
<p>For instance here we use the <code>rMatClust()</code> function from the {spatstat} package to produce a clustered <code>ppp</code> object. We use a disc radius of .1 units and an offspring rate equal to 5 (<code>mu = 5</code>).</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb244-1"></a><span class="kw">library</span>(spatstat)</span>
<span id="cb244-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb244-2"></a></span>
<span id="cb244-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb244-3"></a><span class="kw">plot</span>(<span class="kw">rMatClust</span>(<span class="dt">kappa =</span> <span class="dv">10</span>, </span>
<span id="cb244-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb244-4"></a>               <span class="dt">r =</span> <span class="fl">.1</span>, </span>
<span id="cb244-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb244-5"></a>               <span class="dt">mu =</span> <span class="dv">5</span>), <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-121-1.png" width="672" /></p>
<p>The result is a point pattern described as doubly Poisson. We can vary <span class="math inline">\(\kappa\)</span>, <span class="math inline">\(r\)</span>, and <span class="math inline">\(\mu\)</span> to generate more or fewer events.</p>
<p>Other clustered Poisson processes include:</p>
<ul>
<li>Thomas process: each cluster consists of a Poisson number of random events with each event having an isotropic Gaussian displacement from its parent.<br />
</li>
<li>Gauss-Poisson process: each cluster is either a single event or a pair of events.<br />
</li>
<li>Neyman-Scott process: the cluster mechanism is arbitrary.</li>
</ul>
<p>A Cox point process is a homogeneous Poisson process but with a random intensity function. Let <span class="math inline">\(\Lambda(s)\)</span> be a random function with non-negative values defined at all locations <span class="math inline">\(s\)</span> inside the domain. Then, conditional on <span class="math inline">\(\Lambda\)</span> let <span class="math inline">\(X\)</span> be a Poisson process with an intensity function <span class="math inline">\(\Lambda\)</span>. Then <span class="math inline">\(X\)</span> is a Cox process.</p>
<p>An example of a Cox process is the mixed Poisson process in which we generate a random variable <span class="math inline">\(\Lambda\)</span> and, conditional on <span class="math inline">\(\Lambda\)</span>, we generate a homogeneous Poisson process with intensity <span class="math inline">\(\Lambda\)</span>. Following are two realizations of a Cox point process:</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb245-1"></a><span class="kw">set.seed</span>(<span class="dv">3042</span>)</span>
<span id="cb245-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb245-2"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb245-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb245-3"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>){</span>
<span id="cb245-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb245-4"></a>  lambda &lt;-<span class="st"> </span><span class="kw">rexp</span>(<span class="dt">n =</span> <span class="dv">1</span>, <span class="dt">rate =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">100</span>)</span>
<span id="cb245-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb245-5"></a>  X &lt;-<span class="st"> </span><span class="kw">rpoispp</span>(lambda)</span>
<span id="cb245-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb245-6"></a>  <span class="kw">plot</span>(X)</span>
<span id="cb245-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb245-7"></a>}</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-122-1.png" width="672" /></p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb246-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code></pre></div>
<p>The statistical moments of Cox processes are defined in terms of the moments of <span class="math inline">\(\Lambda\)</span>. For instance, the intensity function of <span class="math inline">\(X\)</span> is <span class="math inline">\(\lambda(s)\)</span> = E[<span class="math inline">\(\Lambda(s)\)</span>], where E[] is the expected value.</p>
<p>Cox processes provide convenient models for clustered point patterns. A Cox model is over dispersed relative to a Poisson process (i.e. the variance of the number of events falling in any region of size A, is greater than the mean number of events in those regions). The Matern cluster and Thomas process are Cox processes.</p>
<p>One such class of processes is the log-Gaussian Cox processes (LGCP) in which logarithm of <span class="math inline">\(\Lambda(s)\)</span> is a Gaussian random function.</p>
<p>If we have a way of generating realizations of a random function <span class="math inline">\(\Lambda\)</span> of interest, then we can use the <code>rpoispp()</code> function to generate the Cox process. The intensity argument <code>lambda</code> of <code>rpoispp()</code> can be a function of x or y or a pixel image.</p>
<div id="thinned-processes" class="section level3" number="1.7.1">
<h3><span class="header-section-number">1.7.1</span> Thinned processes</h3>
<p>Another way to generate clustered point pattern data is by ‘thinning’. Thinning refers to deleting some of the events. With ‘independent thinning’ the fate of each event is independent of the fate of the other events. When independent thinning is applied to a homogeneous Poisson point pattern, the resulting point pattern consisting of the retained events is also Poisson.</p>
<p>To get a non-Poisson process we need some kind of dependent thinning mechanism.</p>
<p>An example of this is Matern’s Model I process. Here a homogeneous Poisson process <span class="math inline">\(Y\)</span> first generates a point pattern, then any event in <span class="math inline">\(Y\)</span> that lies closer than a distance <span class="math inline">\(r\)</span> from another event is deleted. This results in point pattern data where close neighbor events do not exist.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb247-1"></a><span class="kw">plot</span>(<span class="kw">rMaternI</span>(<span class="dt">kappa =</span> <span class="dv">70</span>, </span>
<span id="cb247-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb247-2"></a>              <span class="dt">r =</span> <span class="fl">.05</span>), <span class="dt">main =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-123-1.png" width="672" /></p>
<p>Changing <span class="math inline">\(\kappa\)</span> and <span class="math inline">\(r\)</span> will change the event intensity.</p>
</div>
<div id="markov-point-process-models" class="section level3" number="1.7.2">
<h3><span class="header-section-number">1.7.2</span> Markov point process models</h3>
<p>Expanding on the earlier notation we write that a homogeneous Poisson process with intensity <span class="math inline">\(\lambda &gt; 0\)</span> has intensity <span class="math display">\[\lambda(s, x) = \lambda\]</span> where <span class="math inline">\(s\)</span> is any location in the window W and <span class="math inline">\(x\)</span> is the set of events.</p>
<p>Then an inhomogeneous Poisson process has conditional intensity <span class="math display">\[\lambda(s, x) = \lambda(s)\]</span>. The intensity <span class="math inline">\(\lambda(s)\)</span> depends on a spatial trend or on a covariate.</p>
<p>There is also a class of Markov point process models that allow for clustering (or regularity) due to event interaction. Markov refers to the fact that the interaction is limited to nearest neighbors. Said another way, a Markov point process generalizes a Poisson process in the case where events are pairwise dependent.</p>
<p>A Markov process with parameters <span class="math inline">\(\beta &gt; 0\)</span> and <span class="math inline">\(0 &lt; \gamma &lt; \infty\)</span> with interaction radius <span class="math inline">\(r &gt; 0\)</span> has conditional intensity <span class="math inline">\(\lambda(s, x)\)</span> given by
<span class="math display">\[
\lambda(s, x) = \beta \gamma^{t(s, x)}
\]</span>
where <span class="math inline">\(t(s, x)\)</span> is the number of events that lie within a distance <span class="math inline">\(r\)</span> of location <span class="math inline">\(s\)</span>.</p>
<p>Three cases:</p>
<ol style="list-style-type: decimal">
<li>If <span class="math inline">\(\gamma = 1\)</span>, then <span class="math inline">\(\lambda(s, x) = \beta\)</span> No interaction between events, <span class="math inline">\(\beta\)</span> can vary with <span class="math inline">\(s\)</span>.</li>
<li>If <span class="math inline">\(\gamma &lt; 1\)</span>, then <span class="math inline">\(\lambda(s, x) &lt; \beta\)</span>. Events inhibit nearby events.</li>
<li>If <span class="math inline">\(\gamma &gt; 1\)</span>, then <span class="math inline">\(\lambda(s, x) &gt; \beta\)</span>. Events encourage nearby events.</li>
</ol>
<p>Note the distinction between the interaction term <span class="math inline">\(\gamma\)</span> and the trend term <span class="math inline">\(\beta\)</span>. As we saw earlier in the semester, a similar distinction exists between autocorrelation <span class="math inline">\(\rho\)</span> and trend <span class="math inline">\(\beta\)</span> in spatial regression models.</p>
</div>
<div id="fitting-models-to-point-pattern-data" class="section level3" number="1.7.3">
<h3><span class="header-section-number">1.7.3</span> Fitting models to point pattern data</h3>
<p>The {spatstat} package contains functions for fitting statistical models to point pattern data. Models can include trend, covariates, and event interactions of any order (interactions are not restricted to pairwise). Models are fit with maximum likelihood and minimum contrast procedures.</p>
<p>The method of minimum contrasts derives a cost function between the theoretical and empirical <span class="math inline">\(K\)</span> function. Parameter values are those that minimize this cost function.</p>
<p>The <code>ppm()</code> function is used to fit a spatial point pattern model. The syntax has the form <code>ppm(X, formula, interaction, ...)</code> where <code>X</code> is the point pattern object of class <code>ppp</code>, <code>formula</code> describes the systematic (trend and covariate) part of the model, and <code>interaction</code> describes the stochastic dependence between events (e.g., Matern process).</p>
<p>More generally, we write the logarithm of the conditional intensity <span class="math inline">\(\log[\lambda(s, x)]\)</span> as linear expression with two components.<br />
<span class="math display">\[
\log\big[\lambda(s, x)\big] = \theta_1 B(s) + \theta_2 C(s, x)
\]</span>
where the <span class="math inline">\(\theta\)</span>’s are model parameters that need to be estimated.</p>
<p>The term <span class="math inline">\(B(s)\)</span> depends only on location so it represents trend and covariate effects. It is the ‘systematic component’ of the model. The term <span class="math inline">\(C(s, x)\)</span> represents stochastic interactions (dependency) between events.</p>
<p>Recall a plot of the Swedish pine saplings. There was no indication of a trend. That is, no systematic variation in the intensity of saplings.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb248-1"></a>SP &lt;-<span class="st"> </span>swedishpines</span>
<span id="cb248-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb248-2"></a><span class="kw">plot</span>(SP)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-124-1.png" width="672" /></p>
<p>A plot of the nearest neighborhood distance function indicated some regularity. The regularity appeared at scales between at least 3 and 10 units of distance. Let’s take a look again.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb249-1"></a><span class="kw">plot</span>(<span class="kw">Kest</span>(SP))</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-125-1.png" width="672" /></p>
<p>The Strauss process is a simple interaction model. Inhibition is constant with a fixed radius (r) around each event. The amount of inhibition ranges from zero to complete (zero probability of a nearby event). In the case of no inhibition the process is equivalent to a homogeneous Poisson process.</p>
<p>To model the process we set the trend term to a constant (<code>~ 1</code>) and the Strauss interaction radius to 10 units. The <code>rbord =</code> argument specifies a distance from the window for border corrections.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb250-1"></a>modelSP &lt;-<span class="st"> </span><span class="kw">ppm</span>(SP, </span>
<span id="cb250-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb250-2"></a>               <span class="dt">trend =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, </span>
<span id="cb250-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb250-3"></a>               <span class="dt">interaction =</span> <span class="kw">Strauss</span>(<span class="dt">r =</span> <span class="dv">10</span>), </span>
<span id="cb250-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb250-4"></a>               <span class="dt">rbord =</span> <span class="dv">10</span>)</span></code></pre></div>
<p>The value for <code>r</code> in the <code>Strauss()</code> function is based on our visual inspection of the plot of <code>Kest()</code>. A value is chosen that represents the distance at which there is the largest departure from a CSR model.</p>
<p>We inspect the model by typing the object name.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb251-1"></a>modelSP</span></code></pre></div>
<pre><code>## Stationary Strauss process
## 
## First order term:  beta = 0.07567442
## 
## Interaction distance:    10
## Fitted interaction parameter gamma:   0.2752048
## 
## Relevant coefficients:
## Interaction 
##    -1.29024 
## 
## For standard errors, type coef(summary(x))</code></pre>
<p>The first-order term (<code>beta</code>) has a value of .076. This is the intensity of the ‘proposal’ events. Here beta exceeds the average intensity (here .0074) by a factor of ten.</p>
<p>The interaction parameter (<code>gamma</code>) is .275. It is less than one, indicating an inhibition process. The logarithm of gamma, called the interaction coefficient (<code>Interaction</code>), is -1.29. Interaction coefficients less than zero imply inhibition.</p>
<p>A table with the coefficients including the standard errors and uncertainty ranges is obtained with the <code>coef()</code> method.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb253-1"></a><span class="kw">coef</span>(<span class="kw">summary</span>(modelSP))</span></code></pre></div>
<pre><code>##              Estimate      S.E.   CI95.lo    CI95.hi Ztest      Zval
## (Intercept) -2.581315 0.4524077 -3.468018 -1.6946123   *** -5.705728
## Interaction -1.290240 0.2375515 -1.755832 -0.8246475   *** -5.431411</code></pre>
<p>We again see the <code>Interaction</code> coefficient along with it’s standard error (<code>S.E.</code>) and the associated 95% uncertainty interval. The ratio of the <code>Interaction</code> coefficient to its standard error is the <code>Zval</code>. A large z-value (in absolute magnitude) translates to a low <span class="math inline">\(p\)</span>-value and a rejection of the null hypothesis of no interaction between events.</p>
<p>We also see here an estimated value for the <code>(Intercept)</code>. It is the logarithm of the beta value, so exp(-2.58) = .076 is the intensity of the proposal events.</p>
<p>The model is interpreted as follows. The process producing the spatial pattern of pine saplings is such that we should see .076 saplings per unit area [unobserved (latent) rate]. But because of event inhibition, where saplings nearby other saplings fail to grow, the number of saplings is reduced to .0074 per unit area. Thus the spatial pattern is suggestive of sibling-sibling interaction. Adults have many off-springs, but only some survive due to limited resources.</p>
<p>Let’s compare this to the maple trees in the Lansing woods dataset (<code>lansing</code>). We extract the events marked as <code>maple</code> and put them in a separate <code>ppp</code> object called <code>MT</code>.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb255-1"></a>MT &lt;-<span class="st"> </span><span class="kw">unmark</span>(lansing[lansing<span class="op">$</span>marks <span class="op">==</span><span class="st"> &quot;maple&quot;</span>])</span>
<span id="cb255-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb255-2"></a><span class="kw">summary</span>(MT)</span></code></pre></div>
<pre><code>## Planar point pattern:  514 points
## Average intensity 514 points per square unit (one unit = 924 feet)
## 
## Coordinates are given to 3 decimal places
## i.e. rounded to the nearest multiple of 0.001 units (one unit = 924 feet)
## 
## Window: rectangle = [0, 1] x [0, 1] units
## Window area = 1 square unit
## Unit of length: 924 feet</code></pre>
<p>There are 514 maples over this square region (924 x 924) square feet.</p>
<p>A plot of the tree locations and the local intensity articulates the first-order property of this point pattern data.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb257-1"></a><span class="kw">plot</span>(<span class="kw">density</span>(MT))</span>
<span id="cb257-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb257-2"></a><span class="kw">plot</span>(MT, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-130-1.png" width="672" /></p>
<p>We see there are more maple trees across the southern part of the domain than across the nothern part of the domain.</p>
<p>A plot of the <span class="math inline">\(G\)</span> function summarizes the second-order properties under the assumption of no trend.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb258-1"></a><span class="kw">library</span>(dplyr) </span>
<span id="cb258-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb258-2"></a></span>
<span id="cb258-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb258-3"></a>G &lt;-<span class="st"> </span><span class="kw">Gest</span>(MT)</span>
<span id="cb258-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb258-4"></a>G.df &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(G) <span class="op">%&gt;%</span></span>
<span id="cb258-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb258-5"></a><span class="st">  </span><span class="kw">filter</span>(r <span class="op">&lt;</span><span class="st"> </span><span class="fl">.033</span>) <span class="op">%&gt;%</span></span>
<span id="cb258-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb258-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">r =</span> r <span class="op">*</span><span class="st"> </span><span class="dv">924</span>)</span>
<span id="cb258-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb258-7"></a></span>
<span id="cb258-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb258-8"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb258-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb258-9"></a></span>
<span id="cb258-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb258-10"></a><span class="kw">ggplot</span>(G.df, <span class="kw">aes</span>(<span class="dt">x =</span> r, <span class="dt">y =</span> km)) <span class="op">+</span></span>
<span id="cb258-11"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb258-11"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb258-12"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb258-12"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> theo), <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></span>
<span id="cb258-13"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb258-13"></a><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="fl">18.5</span>, <span class="dt">lty =</span> <span class="st">&#39;dashed&#39;</span>) <span class="op">+</span></span>
<span id="cb258-14"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb258-14"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Distance (ft)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;G(r): Cumulative % of distances within a distance r of another maple&quot;</span>) <span class="op">+</span></span>
<span id="cb258-15"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb258-15"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-131-1.png" width="672" /></p>
<p>The cumulative event-to-event distances indicate clustering. The empirical curve is above the theoretical curve. For example about 74% of the maple trees are within 18.5 feet of another maple tree. If the process resulted in trees was CSR then only 49% of the trees would be within 18.5 feet of another maple.</p>
<p>Model the event interaction as a Strauss process with interaction distance of .025 units (23 ft).</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb259-1"></a><span class="kw">ppm</span>(MT, <span class="dt">trend =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, </span>
<span id="cb259-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb259-2"></a>        <span class="dt">interaction =</span> <span class="kw">Strauss</span>(<span class="dt">r =</span> <span class="fl">.025</span>))</span></code></pre></div>
<pre><code>## Stationary Strauss process
## 
## First order term:  beta = 301.1416
## 
## Interaction distance:    0.025
## Fitted interaction parameter gamma:   1.4718595
## 
## Relevant coefficients:
## Interaction 
##   0.3865265 
## 
## For standard errors, type coef(summary(x))
## 
## *** Model is not valid ***
## *** Interaction parameters are outside valid range ***</code></pre>
<p>Here the first order term beta is 301. It is the ‘latent’ rate of maple trees per unit area. This rate is less than the 514 actual maple trees. The fitted interaction parameter (gamma) is 1.47. It is greater than one as expected since the trees are clustered. The logarithm of gamma is .387.</p>
<p>The model is interpreted as follows. The process producing the maple trees is such that we expect to see about 301 maples. Because of clustering, maples are more likely near other maples, so the number of maples increases to 514 per unit area.</p>
<p>Here the physical explanation may not be about event interaction. As the clustering in the pattern of maple tree locations can be explained by the presence of hickories (cross event interaction).</p>
<p>Note: The Strauss process is for inhibition models. So although we use it here for diagnostics, we need to fit a cluster model (thus the <code>*** Model is not valid ***</code> warning).</p>
<p>For a cluster model the spatial intensity <span class="math display">\[\lambda(s) = \kappa \mu(s)\]</span> where <span class="math inline">\(\kappa\)</span> is the average number of clusters and where <span class="math inline">\(\mu(s)\)</span> is the spatial varying cluster size (number events per cluster).</p>
<p>Cluster models are fit using the <code>kppm()</code> function. Here we specify the cluster process as <code>clusters = "Thomas"</code>. That means each cluster consists of a Poisson number of maple trees, with each tree in the cluster being placed isotropically a distance from the parent tree where smaller distances are more likely based on a Gaussian distribution.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb261-1"></a>modelMT &lt;-<span class="st"> </span><span class="kw">kppm</span>(MT, </span>
<span id="cb261-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb261-2"></a>                <span class="dt">trend =</span> <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,</span>
<span id="cb261-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb261-3"></a>                <span class="dt">clusters =</span> <span class="st">&quot;Thomas&quot;</span>)</span>
<span id="cb261-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb261-4"></a>modelMT</span></code></pre></div>
<pre><code>## Stationary cluster point process model
## Fitted to point pattern dataset &#39;MT&#39;
## Fitted by minimum contrast
##  Summary statistic: K-function
## 
## Uniform intensity:   514
## 
## Cluster model: Thomas process
## Fitted cluster parameters:
##       kappa       scale 
## 21.74724000  0.06752791 
## Mean cluster size:  23.63518 points</code></pre>
<p>Here <span class="math inline">\(\kappa\)</span> is 21.75 and <span class="math inline">\(\bar \mu(s)\)</span> (mean cluster size) is 23.64. The product of these two parameters is the number of events. It is a parent-child process. The number of parents is about 22. The distribution of the parents can be described as CSR. Each parent produces about 24 offspring distributed randomly about the location of the parent within a characteristic distance. Again, the physical process might be different from the point pattern process used to describe it.</p>
<p>The cluster scale parameter is <span class="math inline">\(\sigma^2\)</span>. The cluster scale indicates the characteristic size (area units) of the cluster.</p>
<p>A <code>plot()</code> method verifies that the cluster process statistically ‘explains’ the spatial correlation.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb263-1"></a><span class="kw">plot</span>(modelMT, <span class="dt">what =</span> <span class="st">&quot;statistic&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-134-1.png" width="672" /></p>
<p>This is seen by the fact that the model fit (black line) is very close to the cluster process line (red line).</p>
<p>The spatial scale of the clustering is visualized with the <code>what = "cluster"</code> argument.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb264-1"></a><span class="kw">plot</span>(modelMT, <span class="dt">what =</span> <span class="st">&quot;cluster&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-135-1.png" width="672" /></p>
</div>
<div id="steps-in-fitting-a-point-process-model" class="section level3" number="1.7.4">
<h3><span class="header-section-number">1.7.4</span> Steps in fitting a point process model</h3>
<ul>
<li>Analyze/plot the first and second order characteristics of the event pattern. The intensity and nearest neighbor stastistics.</li>
<li>Select a spatial point process model (trend, interaction distance, etc) for pattern, informed by the results of step 1</li>
<li>Fit the model to the event pattern</li>
<li>Assess the model’s goodness-of-fit by running simulations and comparing the simulated point patterns with the original point pattern</li>
</ul>
<p>The model should be capable of generating data that looks like the actual data used to fit the model.</p>
<p>The development of spatial point process methods has largely been theory driven (not by actual problems/data). More work needs to be done to apply the theory to environmental data with spatial heterogeneity, properties at the individual level (marks), and with time information.</p>
</div>
<div id="model-diagnostics" class="section level3" number="1.7.5">
<h3><span class="header-section-number">1.7.5</span> Model diagnostics</h3>
<p>The <code>envelope()</code> function computes the upper and lower values of a nearest-neighbor statistic from simulated realizations of a point pattern model. This is used as a test of the goodness-of-fit for the model.</p>
<p>We start with the pine sapling model. Here we use the <span class="math inline">\(L\)</span> function (variance stablized Ripley’s <span class="math inline">\(K\)</span>) estimated with <code>Lest()</code>.</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb265-1"></a><span class="kw">plot</span>(<span class="kw">envelope</span>(modelSP, Lest, </span>
<span id="cb265-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb265-2"></a>              <span class="dt">nsim =</span> <span class="dv">39</span>, </span>
<span id="cb265-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb265-3"></a>              <span class="dt">global =</span> <span class="ot">TRUE</span>, </span>
<span id="cb265-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb265-4"></a>              <span class="dt">correction =</span> <span class="st">&#39;border&#39;</span>), </span>
<span id="cb265-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb265-5"></a>     <span class="dt">legend =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## Generating 78 simulated realisations of fitted Gibbs model (39 to estimate the 
## mean and 39 to calculate envelopes) ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
## 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77,  78.
## 
## Done.</code></pre>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-136-1.png" width="672" /></p>
<p>The empirical curve is in black and the model is in red. The kink is the result of specifying 10 units for the interaction distance. From the results we conclude that an inhibition model is sufficient for describing the pine sapling data.</p>
<p>What about the maple trees? Our model is saved as <code>modelMT</code>.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb267-1"></a><span class="kw">plot</span>(<span class="kw">envelope</span>(modelMT, Lest, </span>
<span id="cb267-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb267-2"></a>              <span class="dt">nsim =</span> <span class="dv">39</span>, </span>
<span id="cb267-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb267-3"></a>              <span class="dt">global =</span> <span class="ot">TRUE</span>, </span>
<span id="cb267-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb267-4"></a>              <span class="dt">correction =</span> <span class="st">&#39;border&#39;</span>),</span>
<span id="cb267-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb267-5"></a>     <span class="dt">legend =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## Generating 78 simulated realisations of fitted cluster model (39 to estimate 
## the mean and 39 to calculate envelopes) ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
## 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77,  78.
## 
## Done.</code></pre>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-137-1.png" width="672" /></p>
<p>In the case of the maple trees, a cluster model is sufficient. However, it is not satisfying since we know about the cross correlation with hickories. Also there appears to be more trees in the south. So we are not finished modeling these data.</p>
<p>Here we model the intensity as a function of distance in the north-south direction.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb269-1"></a>modelMT2 &lt;-<span class="st"> </span><span class="kw">kppm</span>(MT, </span>
<span id="cb269-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb269-2"></a>                 <span class="dt">trend =</span> <span class="op">~</span><span class="st"> </span>y,</span>
<span id="cb269-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb269-3"></a>                 <span class="dt">clusters =</span> <span class="st">&quot;Thomas&quot;</span>)</span>
<span id="cb269-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb269-4"></a>modelMT2</span></code></pre></div>
<pre><code>## Inhomogeneous cluster point process model
## Fitted to point pattern dataset &#39;MT&#39;
## Fitted by minimum contrast
##  Summary statistic: inhomogeneous K-function
## 
## Log intensity:  ~y
## 
## Fitted trend coefficients:
## (Intercept)           y 
##    6.894933   -1.486252 
## 
## Cluster model: Thomas process
## Fitted cluster parameters:
##       kappa       scale 
## 26.95657283  0.05358307 
## Mean cluster size:  [pixel image]</code></pre>
<p>This is a inhomogeneous cluster point process model. The logarithm of the intensity depends on y. The coefficient is negative as expected with fewer trees as we move north (increasing y). There is one spatial unit in the north-south direction so we interpret this coefficient to mean there are 77% fewer trees in the north than in the south [1 - exp(-1.486) = .77].</p>
<p>The average number of clusters (<code>kappa</code>) increases to about 27. The cluster scale parameter (<code>sigma</code>), indicating the characteristic size of the cluster (in distance units) decreases to .0536. That makes sense since some of the event-to-event distances are accounted for by the trend term.</p>
<p>To examine if spatial covariates are needed in the case of inhibition models we use the <code>diagnose.ppm()</code> function to plot the residuals. Returning to our pine sapling model.</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb271-1"></a><span class="kw">diagnose.ppm</span>(modelSP)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-139-1.png" width="672" /></p>
<pre><code>## Model diagnostics (raw residuals)
## Diagnostics available:
##  four-panel plot
##  mark plot 
##  smoothed residual field
##  x cumulative residuals
##  y cumulative residuals
##  sum of all residuals
## sum of raw residuals in clipped window = -4.461e-11
## area of clipped window = 6080
## quadrature area = 6333
## range of smoothed field =  [-0.007589, 0.008798]</code></pre>
<p>The point pattern data is shown in the top-left panel along with an estimate of the local spatial intensity using kernel density smoothing (blue shading). A plot of the residuals is shown in the lower-right panel. Blue indicates over prediction by the model and orange indicates under prediction. The observed occurrence of saplings is underestimated in the southeast and west-central part of the domain but the departures are not large nor are they systematic.</p>
<p>The margin plots show the cumulative residuals in the north-south direction (top right) and east-west direction (bottom left). Imagine a vertical line (in the case of the x-coordinate) that sweeps from left to right across the window. The progressive total residual to the left of the line is plotted against the position of the line. The idea is to detect a lurking variable not included in the model. Negative residuals begin to accumulate at about 50 but they are not large.</p>
<p>Given a point process model fitted to a point pattern, the function <code>qqplot.ppm</code> produces a quantile-quantile (Q-Q) plot based on residuals from the model. The residuals from the model are plotted (‘data’) as quantiles against quantiles from the theoretical distribution, which are estimated using simulation.</p>
<p>For a good-fitting model the points should be near the diagonal (between the uncertainty lines).</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb273-1"></a><span class="kw">qqplot.ppm</span>(modelSP, <span class="dt">nsim =</span> <span class="dv">39</span>)</span></code></pre></div>
<pre><code>## Extracting model information...Evaluating trend...done.
## Simulating 39 realisations... 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38,  39.
## 
## Diagnostic info:
##  simulated patterns contained an average of 73.0769230769231 points.
## Calculating quantiles...averaging.....Done.</code></pre>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-140-1.png" width="672" /></p>
<p>This is indeed the case with this model for the pine sapling dataset.</p>
<p>We might be done at this point. Let’s simulate a fake point pattern data using the model.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb275-1"></a><span class="kw">plot</span>(<span class="kw">simulate</span>(modelMT2))</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-141-1.png" width="672" /></p>
<p>It looks reasonable.</p>
</div>
<div id="example-1-tropical-trees-1" class="section level3" number="1.7.6">
<h3><span class="header-section-number">1.7.6</span> Example 1: Tropical trees</h3>
<p>If the intensity of events depends on spatial location as it does with the maple trees we can include a trend and covariate term in the model.</p>
<p>For a trend term, the <code>formula ~ x</code> corresponds to a spatial trend of the form <span class="math inline">\(\lambda(x) = \exp(a + bx)\)</span>, while <code>~ x + y</code> corresponds to <span class="math inline">\(\lambda(x, y) = \exp(a + bx + cy)\)</span> where <code>x</code>, <code>y</code> are the spatial coordinates. For a covariate term, the formula is <code>~ covariate1 + covariate2</code>.</p>
<p>Consider the <code>bei</code> data from the {spatstat} package containing the locations of 3605 trees in a tropical rain forest.</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb276-1"></a><span class="kw">plot</span>(bei)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-142-1.png" width="672" /></p>
<p>Accompanied by covariate data giving the elevation (altitude) and slope of elevation in the study region. The data <code>bei.extra</code> is a list containing two pixel images, <code>elev</code> (elevation in meters) and <code>grad</code> (norm of elevation gradient). These pixel images are objects of class <code>im</code>, see <code>im.object</code>.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb277-1"></a><span class="kw">image</span>(bei.extra)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-143-1.png" width="672" /></p>
<p>Compute and plot the <span class="math inline">\(L\)</span> function to examine spatial autocorrelation. The method computes the <span class="math inline">\(L\)</span> function from data generated by a homogeneous Poisson model (<code>nsim = 39</code> different data sets) and compares it to the L function computed from the actual data. By default the gray area includes the maximum and minimum value of <span class="math inline">\(L\)</span> at each radius from the generated data.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb278-1"></a><span class="kw">plot</span>(<span class="kw">envelope</span>(bei, </span>
<span id="cb278-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb278-2"></a>              Lest, </span>
<span id="cb278-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb278-3"></a>              <span class="dt">nsim =</span> <span class="dv">39</span>, </span>
<span id="cb278-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb278-4"></a>              <span class="dt">global =</span> <span class="ot">TRUE</span>, </span>
<span id="cb278-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb278-5"></a>              <span class="dt">correction =</span> <span class="st">&quot;border&quot;</span>), </span>
<span id="cb278-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb278-6"></a>     <span class="dt">legend =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## Generating 39 simulations of CSR  ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38,  39.
## 
## Done.</code></pre>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-144-1.png" width="672" /></p>
<p>There is significant clustering indicated by the black line far above the CSR line. There are more trees in the vicinity (r = 0 to 100 m) of other trees than expected by chance.</p>
<p>But how much of the clustering is due to terrain (elevation and slope)?.</p>
<p>Fit a model that includes elevation and gradient as covariates. This is done with the <code>trend =</code> argument naming the image variables and including the argument <code>covariates =</code> indicating a data frame or, in this case, a list whose entries are image functions.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb280-1"></a>modelBEI.ppm &lt;-<span class="st"> </span><span class="kw">ppm</span>(bei, </span>
<span id="cb280-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb280-2"></a>                    <span class="dt">trend =</span> <span class="op">~</span><span class="st"> </span>elev <span class="op">+</span><span class="st"> </span>grad, </span>
<span id="cb280-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb280-3"></a>                    <span class="dt">covariates =</span> bei.extra)</span></code></pre></div>
<p>We check to see if the covariates are significant to the model.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb281-1"></a><span class="kw">summary</span>(modelBEI.ppm)</span></code></pre></div>
<pre><code>## Point process model
## Fitting method: maximum likelihood (Berman-Turner approximation)
## Model was fitted using glm()
## Algorithm converged
## Call:
## ppm.ppp(Q = bei, trend = ~elev + grad, covariates = bei.extra)
## Edge correction: &quot;border&quot;
##  [border correction distance r = 0 ]
## --------------------------------------------------------------------------------
## Quadrature scheme (Berman-Turner) = data + dummy + weights
## 
## Data pattern:
## Planar point pattern:  3604 points
## Average intensity 0.00721 points per square metre
## Window: rectangle = [0, 1000] x [0, 500] metres
## Window area = 5e+05 square metres
## Unit of length: 1 metre
## 
## Dummy quadrature points:
##      130 x 130 grid of dummy points, plus 4 corner points
##      dummy spacing: 7.692308 x 3.846154 metres
## 
## Original dummy parameters: =
## Planar point pattern:  16904 points
## Average intensity 0.0338 points per square metre
## Window: rectangle = [0, 1000] x [0, 500] metres
## Window area = 5e+05 square metres
## Unit of length: 1 metre
## Quadrature weights:
##      (counting weights based on 130 x 130 array of rectangular tiles)
## All weights:
##  range: [1.64, 29.6] total: 5e+05
## Weights on data points:
##  range: [1.64, 14.8] total: 41000
## Weights on dummy points:
##  range: [1.64, 29.6] total: 459000
## --------------------------------------------------------------------------------
## FITTED MODEL:
## 
## Nonstationary Poisson process
## 
## ---- Intensity: ----
## 
## Log intensity: ~elev + grad
## Model depends on external covariates &#39;elev&#39; and &#39;grad&#39;
## Covariates provided:
##  elev: im
##  grad: im
## 
## Fitted trend coefficients:
## (Intercept)        elev        grad 
## -8.56355220  0.02143995  5.84646680 
## 
##                Estimate        S.E.     CI95.lo     CI95.hi Ztest       Zval
## (Intercept) -8.56355220 0.341113849 -9.23212306 -7.89498134   *** -25.104675
## elev         0.02143995 0.002287866  0.01695581  0.02592408   ***   9.371155
## grad         5.84646680 0.255781018  5.34514522  6.34778838   ***  22.857313
## 
## ----------- gory details -----
## 
## Fitted regular parameters (theta):
## (Intercept)        elev        grad 
## -8.56355220  0.02143995  5.84646680 
## 
## Fitted exp(theta):
##  (Intercept)         elev         grad 
## 1.909398e-04 1.021671e+00 3.460097e+02</code></pre>
<p>The output shows that both elevation and elevation gradient are significant in explaining the spatial varying intensity of the trees.</p>
<p>Since the conditional intensity is on a log scale we interpret the elevation coefficient as follows: For a one meter increase in elevation the local spatial intensity increases by a amount equal to exp(.021) or 2%.</p>
<p>Check how well the model fits the data. This is done with the <code>envelope()</code> function using the model object as the first argument. The second argument is the name of the distance function. Here the variance stablized Ripley’s <span class="math inline">\(K\)</span> function (<span class="math inline">\(L\)</span>).</p>
<p>The method computes the <span class="math inline">\(L\)</span> function from data generated by the model (<code>nsim = 39</code> different data sets) and compares it to the <span class="math inline">\(L\)</span> function computed from the actual data. By default the gray area includes the maximum and minimum value of <span class="math inline">\(L\)</span> at each radius from the generated data.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb283-1"></a>E &lt;-<span class="st"> </span><span class="kw">envelope</span>(modelBEI.ppm, Lest, </span>
<span id="cb283-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb283-2"></a>              <span class="dt">nsim =</span> <span class="dv">39</span>,</span>
<span id="cb283-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb283-3"></a>              <span class="dt">correction =</span> <span class="st">&quot;border&quot;</span>,</span>
<span id="cb283-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb283-4"></a>              <span class="dt">global =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## Generating 78 simulated realisations of fitted Poisson model (39 to estimate 
## the mean and 39 to calculate envelopes) ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
## 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77,  78.
## 
## Done.</code></pre>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb285-1"></a><span class="kw">plot</span>(E, <span class="dt">main =</span> <span class="st">&quot;Inhomogeneous Poisson Model&quot;</span>, </span>
<span id="cb285-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb285-2"></a>     <span class="dt">legend =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-147-1.png" width="672" /></p>
<p>Better, but not by much.</p>
<p>An improvement is made by adding a cluster process to the model. This is done with the function <code>kppm()</code>.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb286-1"></a>modelBEI.kppm &lt;-<span class="st"> </span><span class="kw">kppm</span>(bei, </span>
<span id="cb286-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb286-2"></a>                      <span class="dt">trend =</span> <span class="op">~</span><span class="st"> </span>elev <span class="op">+</span><span class="st"> </span>grad, </span>
<span id="cb286-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb286-3"></a>                      <span class="dt">covariates =</span> bei.extra, </span>
<span id="cb286-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb286-4"></a>                      <span class="dt">clusters =</span> <span class="st">&quot;Thomas&quot;</span>)</span>
<span id="cb286-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb286-5"></a>E &lt;-<span class="st"> </span><span class="kw">envelope</span>(modelBEI.kppm, Lest, <span class="dt">nsim =</span> <span class="dv">39</span>, </span>
<span id="cb286-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb286-6"></a>             <span class="dt">global =</span> <span class="ot">TRUE</span>, </span>
<span id="cb286-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb286-7"></a>             <span class="dt">correction =</span> <span class="st">&quot;border&quot;</span>)</span></code></pre></div>
<pre><code>## Generating 78 simulated realisations of fitted cluster model (39 to estimate 
## the mean and 39 to calculate envelopes) ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
## 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77,  78.
## 
## Done.</code></pre>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb288-1"></a><span class="kw">plot</span>(E, <span class="dt">main =</span> <span class="st">&quot;Clustered Inhomogeneous Model&quot;</span>, </span>
<span id="cb288-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb288-2"></a>     <span class="dt">legend =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-148-1.png" width="672" /></p>
<p>The uncertainty band is much wider. The empirical curve fits completely inside the band. The inhomogeneous cluster process appears to be an adequate description of the point pattern data.</p>
</div>
<div id="example-2-violent-tornado-occurrence" class="section level3" number="1.7.7">
<h3><span class="header-section-number">1.7.7</span> Example 2: Violent tornado occurrence</h3>
<p>The vast majority of tornadoes have winds of less than 60 m/s (120 mph). A violent tornado, with winds exceeding 90 m/s, is rare. Most of these potentially destructive and deadly tornadoes occur from rotating thunderstorms called supercells, with formation contingent on local (storm-scale) meteorological conditions.</p>
<p>The long-term risk of a tornado at a given location is assessed using historical records, however, the rarity of the most violent tornadoes make these rate estimates unstable. Here we use the more stable rate estimates from the larger set of less violent tornadoes to create more reliable estimates of violent tornado frequency.</p>
<p>For this exercise we restrict our attention to tornadoes occurring in Kansas over the period 1954–2018.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb289-1"></a><span class="kw">library</span>(sf)</span>
<span id="cb289-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb289-2"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb289-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb289-3"></a></span>
<span id="cb289-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb289-4"></a>Torn.sf &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="dt">dsn =</span> <span class="st">&quot;1950-2018-torn-initpoint&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb289-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb289-5"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> <span class="dv">3082</span>) <span class="op">%&gt;%</span></span>
<span id="cb289-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb289-6"></a><span class="st">  </span><span class="kw">filter</span>(mag <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>, yr <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1954</span>) <span class="op">%&gt;%</span></span>
<span id="cb289-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb289-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">EF =</span> mag,</span>
<span id="cb289-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb289-8"></a>         <span class="dt">EFf =</span> <span class="kw">as.factor</span>(EF)) <span class="op">%&gt;%</span></span>
<span id="cb289-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb289-9"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(yr, EF, EFf)</span></code></pre></div>
<pre><code>## Reading layer `1950-2018-torn-initpoint&#39; from data source `/Users/jelsner/Desktop/Projects/ASSFG-Book/1950-2018-torn-initpoint&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 63645 features and 22 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -163.53 ymin: 18.13 xmax: -64.9 ymax: 61.02
## CRS:            4326</code></pre>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb291-1"></a><span class="kw">library</span>(USAboundaries)</span>
<span id="cb291-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb291-2"></a><span class="kw">library</span>(maptools)</span>
<span id="cb291-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb291-3"></a></span>
<span id="cb291-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb291-4"></a>KS.sfc &lt;-<span class="st"> </span><span class="kw">us_states</span>(<span class="dt">states =</span> <span class="st">&quot;Kansas&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb291-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb291-5"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> <span class="kw">st_crs</span>(Torn.sf))</span>
<span id="cb291-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb291-6"></a>Torn.sf &lt;-<span class="st"> </span>Torn.sf[KS.sfc, ]</span></code></pre></div>
<p>Create a <code>owin</code> and <code>ppp</code> objects. Note that although we’ve already subsetted by Kansas tornadoes above we need to subset on the <code>ppp</code> object to assign the KS boundary as the analysis window.</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb292-1"></a>KS.sp &lt;-<span class="st"> </span><span class="kw">as</span>(KS.sfc, <span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb292-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb292-2"></a>KS.win &lt;-<span class="st"> </span><span class="kw">as</span>(KS.sp, <span class="st">&#39;owin&#39;</span>)</span>
<span id="cb292-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb292-3"></a></span>
<span id="cb292-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb292-4"></a>Torn.sp &lt;-<span class="st"> </span><span class="kw">as</span>(Torn.sf, <span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb292-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb292-5"></a>T.ppp &lt;-<span class="st"> </span><span class="kw">as</span>(Torn.sp[<span class="st">&quot;EF&quot;</span>], <span class="st">&quot;ppp&quot;</span>)</span>
<span id="cb292-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb292-6"></a></span>
<span id="cb292-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb292-7"></a>T.ppp &lt;-<span class="st"> </span>T.ppp[KS.win]</span>
<span id="cb292-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb292-8"></a></span>
<span id="cb292-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb292-9"></a><span class="kw">summary</span>(T.ppp)</span></code></pre></div>
<pre><code>## Marked planar point pattern:  4079 points
## Average intensity 1.890201e-08 points per square unit
## 
## *Pattern contains duplicated points*
## 
## Coordinates are given to 1 decimal place
## i.e. rounded to the nearest multiple of 0.1 units
## 
## marks are numeric, of type &#39;double&#39;
## Summary:
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  0.0000  0.0000  0.0000  0.6122  1.0000  5.0000 
## 
## Window: polygonal boundary
## single connected closed polygon with 170 vertices
## enclosing rectangle: [1317675.9, 1980294.8] x [7114969, 7458570] units
##                      (662600 x 343600 units)
## Window area = 2.15797e+11 square units
## Fraction of frame area: 0.948</code></pre>
<p>There are 4079 tornadoes over the period with an average intensity of 189 per 100 square km (multiply the average intensity in square meters by 10^10).</p>
<p>Here we separate the point pattern data into non-violent tornadoes and violent tornadoes. The non-violent tornadoes include those with an EF rating of 0, 1, 2 or 3. The violent tornadoes include those with an EF rating of 4 or 5.</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb294-1"></a>NV.ppp &lt;-<span class="st"> </span><span class="kw">unmark</span>(T.ppp[T.ppp<span class="op">$</span>marks <span class="op">&lt;=</span><span class="st"> </span><span class="dv">3</span> <span class="op">&amp;</span><span class="st"> </span>T.ppp<span class="op">$</span>marks <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>])</span>
<span id="cb294-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb294-2"></a><span class="kw">summary</span>(NV.ppp)</span></code></pre></div>
<pre><code>## Planar point pattern:  4039 points
## Average intensity 1.871665e-08 points per square unit
## 
## *Pattern contains duplicated points*
## 
## Coordinates are given to 1 decimal place
## i.e. rounded to the nearest multiple of 0.1 units
## 
## Window: polygonal boundary
## single connected closed polygon with 170 vertices
## enclosing rectangle: [1317675.9, 1980294.8] x [7114969, 7458570] units
##                      (662600 x 343600 units)
## Window area = 2.15797e+11 square units
## Fraction of frame area: 0.948</code></pre>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb296-1"></a>V.ppp &lt;-<span class="st"> </span><span class="kw">unmark</span>(T.ppp[T.ppp<span class="op">$</span>marks <span class="op">&gt;=</span><span class="st"> </span><span class="dv">4</span>])</span>
<span id="cb296-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb296-2"></a><span class="kw">summary</span>(V.ppp)</span></code></pre></div>
<pre><code>## Planar point pattern:  40 points
## Average intensity 1.853593e-10 points per square unit
## 
## Coordinates are given to 1 decimal place
## i.e. rounded to the nearest multiple of 0.1 units
## 
## Window: polygonal boundary
## single connected closed polygon with 170 vertices
## enclosing rectangle: [1317675.9, 1980294.8] x [7114969, 7458570] units
##                      (662600 x 343600 units)
## Window area = 2.15797e+11 square units
## Fraction of frame area: 0.948</code></pre>
<p>The spatial intensity of the non-violent tornadoes is 187 per 100 sq km. The spatial intensity of the violent tornadoes is 1.9 per 100 sq km.</p>
<p>Locations of the violent tornadoes.</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb298-1"></a><span class="kw">plot</span>(V.ppp)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-152-1.png" width="672" /></p>
<p>In Lesson 14 we saw that the spatial intensity of tornado reports was a function of distance to nearest city. So we want to include this as a confounding variable. Import the data, set the CRS, and transform the CRS to match that of the tornadoes. Exclude cities with fewer than 1000 people.</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb299-1"></a><span class="kw">download.file</span>(<span class="st">&quot;http://myweb.fsu.edu/jelsner/temp/data/ci08au12.zip&quot;</span>,</span>
<span id="cb299-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb299-2"></a>              <span class="st">&quot;ci08au12.zip&quot;</span>)</span>
<span id="cb299-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb299-3"></a><span class="kw">unzip</span>(<span class="st">&quot;ci08au12.zip&quot;</span>)</span>
<span id="cb299-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb299-4"></a></span>
<span id="cb299-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb299-5"></a>C.sf &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="dt">dsn =</span> <span class="st">&quot;.&quot;</span>,</span>
<span id="cb299-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb299-6"></a>                <span class="dt">layer =</span> <span class="st">&quot;ci08au12&quot;</span>,</span>
<span id="cb299-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb299-7"></a>                <span class="dt">quiet =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb299-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb299-8"></a><span class="st">  </span><span class="kw">st_set_crs</span>(<span class="dv">4326</span>) <span class="op">%&gt;%</span></span>
<span id="cb299-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb299-9"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> <span class="kw">st_crs</span>(Torn.sf)) <span class="op">%&gt;%</span></span>
<span id="cb299-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb299-10"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">filter</span>(POP_<span class="dv">1990</span> <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1000</span>)</span></code></pre></div>
<p>Then create a <code>ppp</code> object of events from the city/town locations. First create an S4 class spatial data frame and convert this data frame to a <code>ppp</code> object before removing the marks. Then subset the events by the window.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb300-1"></a>C.sp &lt;-<span class="st"> </span><span class="kw">as</span>(C.sf, <span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb300-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb300-2"></a>C.ppp &lt;-<span class="st"> </span><span class="kw">as</span>(C.sp, <span class="st">&quot;ppp&quot;</span>)</span>
<span id="cb300-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb300-3"></a>C.ppp &lt;-<span class="st"> </span><span class="kw">unmark</span>(C.ppp[KS.win])</span>
<span id="cb300-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb300-4"></a><span class="kw">plot</span>(C.ppp)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-154-1.png" width="672" /></p>
<p>Next create a distance map of the city/town locations using the <code>distmap()</code> function.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb301-1"></a>Zc &lt;-<span class="st"> </span><span class="kw">distmap</span>(C.ppp)</span>
<span id="cb301-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb301-2"></a><span class="kw">plot</span>(Zc)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-155-1.png" width="672" /></p>
<p>The resulting object an <code>im</code> class indicating a pixeled image. Pixel values are distances is meters. Blue indicates locations that are less than 20 km from a city or town with a population of at least 1000.</p>
<p>Our interest lies with the distance to nearest non-violent tornado. We check to see if this might be a useful variable in a model.</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb302-1"></a>Znv &lt;-<span class="st"> </span><span class="kw">distmap</span>(NV.ppp)</span>
<span id="cb302-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb302-2"></a>rhat &lt;-<span class="st"> </span><span class="kw">rhohat</span>(V.ppp, Znv, </span>
<span id="cb302-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb302-3"></a>               <span class="dt">adjust =</span> <span class="fl">1.3</span>, </span>
<span id="cb302-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb302-4"></a>               <span class="dt">smoother =</span> <span class="st">&quot;kernel&quot;</span>, </span>
<span id="cb302-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb302-5"></a>               <span class="dt">method =</span> <span class="st">&quot;transform&quot;</span>)</span>
<span id="cb302-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb302-6"></a></span>
<span id="cb302-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb302-7"></a>dist &lt;-<span class="st"> </span>rhat<span class="op">$</span>Znv</span>
<span id="cb302-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb302-8"></a>rho &lt;-<span class="st"> </span>rhat<span class="op">$</span>rho</span>
<span id="cb302-9"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb302-9"></a>hi &lt;-<span class="st"> </span>rhat<span class="op">$</span>hi</span>
<span id="cb302-10"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb302-10"></a>lo &lt;-<span class="st"> </span>rhat<span class="op">$</span>lo</span>
<span id="cb302-11"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb302-11"></a>Rho.df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">dist =</span> dist, <span class="dt">rho =</span> rho, <span class="dt">hi =</span> hi, <span class="dt">lo =</span> lo)</span>
<span id="cb302-12"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb302-12"></a></span>
<span id="cb302-13"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb302-13"></a><span class="kw">ggplot</span>(Rho.df) <span class="op">+</span><span class="st"> </span></span>
<span id="cb302-14"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb302-14"></a><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dist, <span class="dt">ymin =</span> lo, <span class="dt">ymax =</span> hi), <span class="dt">alpha =</span> <span class="fl">.3</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb302-15"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb302-15"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dist, <span class="dt">y =</span> rho), <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb302-16"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb302-16"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Spatial intensity of violent tornadoes&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;Distance from nearest non-violent tornado (m)&quot;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb302-17"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb302-17"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-156-1.png" width="672" /></p>
<p>This shows that regions that get non-violent tornadoes also see higher rates of violent tornadoes.</p>
<p>So our model includes two trend terms.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb303-1"></a>model &lt;-<span class="st"> </span><span class="kw">ppm</span>(V.ppp, </span>
<span id="cb303-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb303-2"></a>             <span class="dt">trend =</span> <span class="op">~</span><span class="st"> </span>Zc <span class="op">+</span><span class="st"> </span>Znv, </span>
<span id="cb303-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb303-3"></a>             <span class="dt">covariates =</span> <span class="kw">list</span>(<span class="dt">Zc =</span> Zc, <span class="dt">Znv =</span> Znv))</span>
<span id="cb303-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb303-4"></a></span>
<span id="cb303-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb303-5"></a><span class="kw">coef</span>(<span class="kw">summary</span>(model))</span></code></pre></div>
<pre><code>##                  Estimate         S.E.       CI95.lo       CI95.hi Ztest
## (Intercept) -2.087422e+01 3.784490e-01 -2.161597e+01 -2.013247e+01   ***
## Zc          -4.614373e-05 1.957117e-05 -8.450252e-05 -7.784945e-06     *
## Znv         -2.389478e-04 8.986687e-05 -4.150836e-04 -6.281195e-05    **
##                   Zval
## (Intercept) -55.157281
## Zc           -2.357740
## Znv          -2.658908</code></pre>
<p>As expected the model shows fewer violent tornadoes with increasing distance from the nearest city (negative coefficient on <code>Zc</code>) and fewer violent tornadoes with increasing distance from a non-violent tornado (negative coefficient on <code>Znv</code>).</p>
<p>Since the spatial unit is meters the coefficient of -4.6e-05 is interpreted as a [1 - exp(-.046)] * 100% or 4% decrease in violent tornado reports per kilometer of distance from a city. Similarly the coefficient on distance from nearest non-violent tornado is interpreted as a 21% decrease in violent tornado reports per kilometer of distance from nearest non-violent tornado.</p>
<p>We check if there is any residual nearest neighbor correlation.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb305-1"></a>E &lt;-<span class="st"> </span><span class="kw">envelope</span>(model, </span>
<span id="cb305-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb305-2"></a>              <span class="dt">fun =</span> Lest, </span>
<span id="cb305-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb305-3"></a>              <span class="dt">nsim =</span> <span class="dv">39</span>,</span>
<span id="cb305-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb305-4"></a>              <span class="dt">global =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## Generating 78 simulated realisations of fitted Poisson model (39 to estimate 
## the mean and 39 to calculate envelopes) ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
## 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77,  78.
## 
## Done.</code></pre>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb307-1"></a><span class="kw">plot</span>(E, <span class="dt">main =</span> <span class="st">&quot;Inhomogeneous Poisson Model&quot;</span>, <span class="dt">legend =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-158-1.png" width="672" /></p>
<p>There appears to be a bit of regularity at smaller scales. The empirical curve (black line) falls slightly below the model (dashed red line). There are fewer nearby violent tornadoes than one would expect.</p>
<p>To see if this is statistically significant, we add an inhibition process to the model.</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb308-1"></a>model2 &lt;-<span class="st"> </span><span class="kw">ppm</span>(V.ppp, </span>
<span id="cb308-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb308-2"></a>              <span class="dt">trend =</span> <span class="op">~</span><span class="st"> </span>Zc <span class="op">+</span><span class="st"> </span>Znv, </span>
<span id="cb308-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb308-3"></a>              <span class="dt">covariates =</span> <span class="kw">list</span>(<span class="dt">Zc =</span> Zc, <span class="dt">Znv =</span> Znv),</span>
<span id="cb308-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb308-4"></a>              <span class="dt">interaction =</span> <span class="kw">Strauss</span>(<span class="dt">r =</span> <span class="dv">40000</span>))</span>
<span id="cb308-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb308-5"></a></span>
<span id="cb308-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb308-6"></a><span class="kw">coef</span>(<span class="kw">summary</span>(model2))</span></code></pre></div>
<pre><code>##                  Estimate         S.E.       CI95.lo       CI95.hi Ztest
## (Intercept) -2.049386e+01 6.983113e-01 -2.186253e+01 -1.912520e+01   ***
## Zc          -3.236850e-05 2.329140e-05 -7.801880e-05  1.328180e-05      
## Znv         -2.643220e-04 9.913796e-05 -4.586289e-04 -7.001520e-05    **
## Interaction -4.753741e-01 4.336389e-01 -1.325291e+00  3.745425e-01      
##                   Zval
## (Intercept) -29.347750
## Zc           -1.389719
## Znv          -2.666204
## Interaction  -1.096244</code></pre>
<p>We see a negative sign on the interaction coefficient as expected from the above plot, but the standard error is relatively large so it is not significant.</p>
<p>Remove the inhibition process and add a trend term in the east-west direction.</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb310-1"></a>model3 &lt;-<span class="st"> </span><span class="kw">ppm</span>(V.ppp, </span>
<span id="cb310-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb310-2"></a>              <span class="dt">trend =</span> <span class="op">~</span><span class="st"> </span>Zc <span class="op">+</span><span class="st"> </span>Znv <span class="op">+</span><span class="st"> </span>x, </span>
<span id="cb310-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb310-3"></a>              <span class="dt">covariates =</span> <span class="kw">list</span>(<span class="dt">Zc =</span> Zc, <span class="dt">Znv =</span> Znv))</span>
<span id="cb310-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb310-4"></a></span>
<span id="cb310-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb310-5"></a><span class="kw">coef</span>(<span class="kw">summary</span>(model3))</span></code></pre></div>
<pre><code>##                  Estimate         S.E.       CI95.lo       CI95.hi Ztest
## (Intercept) -2.434688e+01 1.753031e+00 -2.778276e+01 -2.091100e+01   ***
## Zc          -3.224884e-05 2.071846e-05 -7.285627e-05  8.358595e-06      
## Znv         -2.523907e-04 8.943257e-05 -4.276753e-04 -7.710610e-05    **
## x            1.967285e-06 9.548089e-07  9.589369e-08  3.838676e-06     *
##                   Zval
## (Intercept) -13.888447
## Zc           -1.556527
## Znv          -2.822134
## x             2.060396</code></pre>
<p>There is a significant eastward trend but it appears to confound the distance to city term. Why is this?</p>
<p>Plot simulated data.</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb312-1"></a><span class="kw">plot</span>(V.ppp)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-161-1.png" width="672" /></p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb313-1"></a><span class="kw">plot</span>(<span class="kw">simulate</span>(model, <span class="dt">nsim =</span> <span class="dv">6</span>))</span></code></pre></div>
<pre><code>## Generating 6 simulated patterns ...1, 2, 3, 4, 5,  6.</code></pre>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-161-2.png" width="672" /></p>
</div>
<div id="example-3-does-terrain-roughness-affect-tornado-occurrence-rates" class="section level3" number="1.7.8">
<h3><span class="header-section-number">1.7.8</span> Example 3: Does terrain roughness affect tornado occurrence rates?</h3>
<p>Most thunderstorms fail to produce tornadoes. Tornado initiation is sensitive to an interplay of processes across a range of spatial scales, including the scale of a few hundred meters where the air flow near the ground is converging inward toward the tornado. It stands to reason that the underlying surface can affect this convergent inflow.</p>
<p>To make the analysis and modeling run faster we consider only Kansas tornadoes with an EF2 or higher rating.</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb315-1"></a>T.ppp25 &lt;-<span class="st"> </span><span class="kw">unmark</span>(T.ppp[T.ppp<span class="op">$</span>marks <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2</span>])</span>
<span id="cb315-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb315-2"></a></span>
<span id="cb315-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb315-3"></a><span class="kw">summary</span>(T.ppp25)</span></code></pre></div>
<pre><code>## Planar point pattern:  626 points
## Average intensity 2.900873e-09 points per square unit
## 
## *Pattern contains duplicated points*
## 
## Coordinates are given to 1 decimal place
## i.e. rounded to the nearest multiple of 0.1 units
## 
## Window: polygonal boundary
## single connected closed polygon with 170 vertices
## enclosing rectangle: [1317675.9, 1980294.8] x [7114969, 7458570] units
##                      (662600 x 343600 units)
## Window area = 2.15797e+11 square units
## Fraction of frame area: 0.948</code></pre>
<p>There are 626 tornadoes with an average intensity of 29 per 100 sq. km.</p>
<p>Plot the spatial varying intensity.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb317-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb317-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb317-2"></a><span class="kw">plot</span>(<span class="kw">density</span>(T.ppp25))</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-163-1.png" width="672" /></p>
<p>To quantify the relationship between distance to city and tornado report density we use a model.</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb318-1"></a>model0 &lt;-<span class="st"> </span><span class="kw">ppm</span>(T.ppp25, </span>
<span id="cb318-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb318-2"></a>              <span class="dt">trend =</span> <span class="op">~</span><span class="st"> </span>Zc, </span>
<span id="cb318-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb318-3"></a>              <span class="dt">covariates =</span> <span class="kw">list</span>(<span class="dt">Zc =</span> Zc))</span>
<span id="cb318-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb318-4"></a>model0</span></code></pre></div>
<pre><code>## Nonstationary Poisson process
## 
## Log intensity:  ~Zc
## 
## Fitted trend coefficients:
##   (Intercept)            Zc 
## -1.907438e+01 -3.687080e-05 
## 
##                  Estimate         S.E.       CI95.lo       CI95.hi Ztest
## (Intercept) -1.907438e+01 7.934728e-02 -1.922990e+01 -1.891886e+01   ***
## Zc          -3.687080e-05 4.763165e-06 -4.620644e-05 -2.753517e-05   ***
##                    Zval
## (Intercept) -240.391099
## Zc            -7.740821</code></pre>
<p>As expected the model shows a decreasing trend with increasing distance from cities (negative value on the <code>Zc</code> coefficient). The value is on the log scale so we do some arithmetic.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb320-1"></a><span class="dv">100</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(<span class="kw">coef</span>(model0)[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span><span class="dv">1000</span>))</span></code></pre></div>
<pre><code>##       Zc 
## 3.619935</code></pre>
<p>The coefficient is interpreted as a 3.7% decrease in the number of tornado reports per kilometer of distance from a city (on average).</p>
<p>Can we do better? Statistically: is the model adequate? Here we check model adequacy by examining model residuals against the assumption of homogeneous Poisson.</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb322-1"></a>E &lt;-<span class="st"> </span><span class="kw">envelope</span>(model0, </span>
<span id="cb322-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb322-2"></a>              <span class="dt">fun =</span> Lest, </span>
<span id="cb322-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb322-3"></a>              <span class="dt">nsim =</span> <span class="dv">39</span>,</span>
<span id="cb322-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb322-4"></a>              <span class="dt">global =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## Generating 78 simulated realisations of fitted Poisson model (39 to estimate 
## the mean and 39 to calculate envelopes) ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
## 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77,  78.
## 
## Done.</code></pre>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb324-1"></a><span class="kw">plot</span>(E, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>, <span class="dt">legend =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-166-1.png" width="672" /></p>
<p>We find that, after accounting for distance from nearest town, there is a tendency for tornado reports to cluster at all distances.</p>
<div id="elevation-and-elevation-roughness-as-a-covariates" class="section level4" number="1.7.8.1">
<h4><span class="header-section-number">1.7.8.1</span> Elevation and elevation roughness as a covariates</h4>
<p>Elevation might be a factor in tornado occurrence rates. In particular the roughness of the underlying surface might make some areas more or less prone to tornadoes. Here we investigate this possibility using elevation data.</p>
<p>Digital elevation data are available from <a href="http://www.viewfinderpanoramas.org" class="uri">http://www.viewfinderpanoramas.org</a>. The data has been uploaded to my website. Download and unzip the data.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb325-1"></a><span class="kw">download.file</span>(<span class="dt">url =</span> <span class="st">&quot;http://myweb.fsu.edu/jelsner/temp/data/15-H.tif.zip&quot;</span>,</span>
<span id="cb325-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb325-2"></a>              <span class="dt">destfile =</span> <span class="st">&quot;15-H.tif.zip&quot;</span>)</span>
<span id="cb325-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb325-3"></a><span class="kw">unzip</span>(<span class="st">&quot;15-H.tif.zip&quot;</span>)</span></code></pre></div>
<p>Import the elevation raster and crop it to the extent of Kansas.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb326-1"></a><span class="kw">library</span>(raster)</span>
<span id="cb326-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb326-2"></a></span>
<span id="cb326-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb326-3"></a>Elev &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;15-H.tif&quot;</span>)</span>
<span id="cb326-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb326-4"></a></span>
<span id="cb326-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb326-5"></a>KS.sp2 &lt;-<span class="st"> </span><span class="kw">spTransform</span>(KS.sp, <span class="kw">CRS</span>(<span class="kw">projection</span>(Elev)))</span>
<span id="cb326-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb326-6"></a>Elev &lt;-<span class="st"> </span><span class="kw">crop</span>(Elev, KS.sp2)</span></code></pre></div>
<p>Map the elevation.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb327-1"></a><span class="kw">library</span>(tmap)</span>
<span id="cb327-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb327-2"></a></span>
<span id="cb327-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb327-3"></a><span class="kw">tm_shape</span>(Elev) <span class="op">+</span></span>
<span id="cb327-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb327-4"></a><span class="st">  </span><span class="kw">tm_raster</span>() <span class="op">+</span></span>
<span id="cb327-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb327-5"></a><span class="kw">tm_shape</span>(KS.sp2) <span class="op">+</span></span>
<span id="cb327-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb327-6"></a><span class="st">  </span><span class="kw">tm_borders</span>() <span class="op">+</span></span>
<span id="cb327-7"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb327-7"></a><span class="kw">tm_layout</span>(<span class="dt">title =</span> <span class="st">&quot;Elevation (m)&quot;</span>, </span>
<span id="cb327-8"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb327-8"></a>          <span class="dt">legend.outside =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-168-1.png" width="672" /></p>
<p>Get elevation roughness using the <code>terrain()</code> function from the <strong>raster</strong> package. Use the <code>projectRaster()</code> function to change the native projection to the projection of the tornado data. This takes a few seconds since the projection is not conformal and the grid spacing needs to be preserved.</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb328-1"></a>TR &lt;-<span class="st"> </span><span class="kw">terrain</span>(Elev, <span class="dt">opt =</span> <span class="st">&#39;roughness&#39;</span>)</span>
<span id="cb328-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb328-2"></a>ElevP &lt;-<span class="st"> </span><span class="kw">projectRaster</span>(Elev, <span class="dt">crs =</span> <span class="kw">st_crs</span>(Torn.sf)<span class="op">$</span>proj4string)</span>
<span id="cb328-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb328-3"></a>TRP &lt;-<span class="st"> </span><span class="kw">projectRaster</span>(TR, <span class="dt">crs =</span> <span class="kw">st_crs</span>(Torn.sf)<span class="op">$</span>proj4string)</span>
<span id="cb328-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb328-4"></a></span>
<span id="cb328-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb328-5"></a><span class="co">#writeRaster(ElevP, filename = &quot;ElevP&quot;)</span></span>
<span id="cb328-6"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb328-6"></a><span class="co">#writeRaster(TRP, filename = &quot;TRP&quot;)</span></span></code></pre></div>
<p>Read projected rasters since the <code>projectRaster()</code> function did not work in RStudio Cloud.</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb329-1"></a>ElevP &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;ElevP&quot;</span>)</span>
<span id="cb329-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb329-2"></a>TRP &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;TRP&quot;</span>)</span></code></pre></div>
<p>Create image objects from the elevation and roughness rasters. First convert the rasters to a S4 class spatial grid data frame.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb330-1"></a>Elev.grd &lt;-<span class="st"> </span><span class="kw">as</span>(ElevP, <span class="st">&quot;SpatialGridDataFrame&quot;</span>)</span>
<span id="cb330-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb330-2"></a>TR.grd &lt;-<span class="st"> </span><span class="kw">as</span>(TRP, <span class="st">&quot;SpatialGridDataFrame&quot;</span>)</span>
<span id="cb330-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb330-3"></a>El &lt;-<span class="st"> </span><span class="kw">as</span>(Elev.grd, <span class="st">&quot;im&quot;</span>)</span>
<span id="cb330-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb330-4"></a>Tr &lt;-<span class="st"> </span><span class="kw">as</span>(TR.grd, <span class="st">&quot;im&quot;</span>)</span></code></pre></div>
<p>Model the tornado events.</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb331-1"></a>model1 &lt;-<span class="st"> </span><span class="kw">ppm</span>(T.ppp25, </span>
<span id="cb331-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb331-2"></a>             <span class="dt">trend =</span> <span class="op">~</span><span class="st"> </span>Zc <span class="op">+</span><span class="st"> </span>El <span class="op">+</span><span class="st"> </span>Tr, </span>
<span id="cb331-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb331-3"></a>             <span class="dt">covariates =</span> <span class="kw">list</span>(<span class="dt">Zc =</span> Zc, <span class="dt">El =</span> El, <span class="dt">Tr =</span> Tr))</span>
<span id="cb331-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb331-4"></a><span class="kw">summary</span>(model1)</span></code></pre></div>
<pre><code>## Point process model
## Fitting method: maximum likelihood (Berman-Turner approximation)
## Model was fitted using glm()
## Algorithm converged
## Call:
## ppm.ppp(Q = T.ppp25, trend = ~Zc + El + Tr, covariates = list(Zc = Zc, 
##     El = El, Tr = Tr))
## Edge correction: &quot;border&quot;
##  [border correction distance r = 0 ]
## --------------------------------------------------------------------------------
## Quadrature scheme (Berman-Turner) = data + dummy + weights
## 
## Data pattern:
## Planar point pattern:  626 points
## Average intensity 2.9e-09 points per square unit
## Window: polygonal boundary
## single connected closed polygon with 170 vertices
## enclosing rectangle: [1317675.9, 1980294.8] x [7114969, 7458570] units
##                      (662600 x 343600 units)
## Window area = 2.15797e+11 square units
## Fraction of frame area: 0.948
## 
## Dummy quadrature points:
##      64 x 64 grid of dummy points, plus 4 corner points
##      dummy spacing: 10353.421 x  5368.763 units
## 
## Original dummy parameters: =
## Planar point pattern:  3950 points
## Average intensity 1.83e-08 points per square unit
## Window: polygonal boundary
## single connected closed polygon with 170 vertices
## enclosing rectangle: [1317675.9, 1980294.8] x [7114969, 7458570] units
##                      (662600 x 343600 units)
## Window area = 2.15797e+11 square units
## Fraction of frame area: 0.948
## Quadrature weights:
##      (counting weights based on 64 x 64 array of rectangular tiles)
## All weights:
##  range: [4440000, 55600000]  total: 2.16e+11
## Weights on data points:
##  range: [4440000, 27800000]  total: 1.59e+10
## Weights on dummy points:
##  range: [6800000, 55600000]  total: 2e+11
## --------------------------------------------------------------------------------
## FITTED MODEL:
## 
## Nonstationary Poisson process
## 
## ---- Intensity: ----
## 
## Log intensity: ~Zc + El + Tr
## Model depends on external covariates &#39;Zc&#39;, &#39;El&#39; and &#39;Tr&#39;
## Covariates provided:
##  Zc: im
##  El: im
##  Tr: im
## 
## Fitted trend coefficients:
##   (Intercept)            Zc            El            Tr 
## -1.863231e+01 -2.918036e-05 -6.657957e-04 -1.578727e-02 
## 
##                  Estimate         S.E.       CI95.lo       CI95.hi Ztest
## (Intercept) -1.863231e+01 1.311762e-01 -1.888941e+01 -1.837521e+01   ***
## Zc          -2.918036e-05 5.167045e-06 -3.930758e-05 -1.905314e-05   ***
## El          -6.657957e-04 1.916568e-04 -1.041436e-03 -2.901552e-04   ***
## Tr          -1.578727e-02 5.295607e-03 -2.616647e-02 -5.408071e-03    **
##                    Zval
## (Intercept) -142.040316
## Zc            -5.647398
## El            -3.473895
## Tr            -2.981201
## 
## ----------- gory details -----
## 
## Fitted regular parameters (theta):
##   (Intercept)            Zc            El            Tr 
## -1.863231e+01 -2.918036e-05 -6.657957e-04 -1.578727e-02 
## 
## Fitted exp(theta):
##  (Intercept)           Zc           El           Tr 
## 8.092655e-09 9.999708e-01 9.993344e-01 9.843367e-01</code></pre>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb333-1"></a><span class="kw">AIC</span>(model0); <span class="kw">AIC</span>(model1)</span></code></pre></div>
<pre><code>## [1] 25801.44</code></pre>
<pre><code>## [1] 25787.91</code></pre>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb336-1"></a><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(<span class="kw">as.numeric</span>(<span class="kw">logLik</span>(model1)) <span class="op">-</span><span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">logLik</span>(model0)))<span class="op">/</span>T.ppp25<span class="op">$</span>n</span></code></pre></div>
<pre><code>## [1] 0.02799492</code></pre>
<table>
<thead>
<tr class="header">
<th>diff</th>
<th>interpretation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>huge</td>
</tr>
<tr class="even">
<td>.1</td>
<td>large</td>
</tr>
<tr class="odd">
<td>.01</td>
<td>good</td>
</tr>
<tr class="even">
<td>.001</td>
<td>okay</td>
</tr>
</tbody>
</table>
<p>So we conclude that <code>model1</code> is an improvement over <code>model0</code> which is an improvement over a CSR.</p>
<p>Diagnostics.</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb338-1"></a><span class="kw">plot</span>(<span class="kw">envelope</span>(model1, </span>
<span id="cb338-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb338-2"></a>              <span class="dt">fun =</span> Lest, </span>
<span id="cb338-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb338-3"></a>              <span class="dt">nsim =</span> <span class="dv">39</span>, </span>
<span id="cb338-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb338-4"></a>              <span class="dt">global =</span> <span class="ot">TRUE</span>), </span>
<span id="cb338-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb338-5"></a>     <span class="dt">legend =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## Generating 78 simulated realisations of fitted Poisson model (39 to estimate 
## the mean and 39 to calculate envelopes) ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
## 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77,  78.
## 
## Done.</code></pre>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-172-1.png" width="672" /></p>
<p>The model is shown in red with the 95% uncertainty bands.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb340-1"></a>model2 &lt;-<span class="st"> </span><span class="kw">kppm</span>(T.ppp25, </span>
<span id="cb340-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb340-2"></a>               <span class="dt">trend =</span> <span class="op">~</span><span class="st"> </span>Zc <span class="op">+</span><span class="st"> </span>El <span class="op">+</span><span class="st"> </span>Tr, </span>
<span id="cb340-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb340-3"></a>               <span class="dt">covariates =</span> <span class="kw">list</span>(<span class="dt">Zc =</span> Zc, <span class="dt">El =</span> El, <span class="dt">Tr =</span> Tr),</span>
<span id="cb340-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb340-4"></a>               <span class="dt">clusters =</span> <span class="st">&quot;Thomas&quot;</span>)</span>
<span id="cb340-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb340-5"></a>model2</span></code></pre></div>
<pre><code>## Inhomogeneous cluster point process model
## Fitted to point pattern dataset &#39;T.ppp25&#39;
## Fitted by minimum contrast
##  Summary statistic: inhomogeneous K-function
## 
## Log intensity:  ~Zc + El + Tr
## 
## Fitted trend coefficients:
##   (Intercept)            Zc            El            Tr 
## -1.863231e+01 -2.918036e-05 -6.657957e-04 -1.578727e-02 
## 
## Cluster model: Thomas process
## Fitted cluster parameters:
##        kappa        scale 
## 1.456875e-09 1.358041e+04 
## Mean cluster size:  [pixel image]</code></pre>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb342-1"></a><span class="kw">plot</span>(<span class="kw">envelope</span>(model2, </span>
<span id="cb342-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb342-2"></a>              <span class="dt">fun =</span> Lest, </span>
<span id="cb342-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb342-3"></a>              <span class="dt">nsim =</span> <span class="dv">39</span>, </span>
<span id="cb342-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb342-4"></a>              <span class="dt">global =</span> <span class="ot">TRUE</span>), </span>
<span id="cb342-5"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb342-5"></a>     <span class="dt">legend =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## Generating 78 simulated realisations of fitted cluster model (39 to estimate 
## the mean and 39 to calculate envelopes) ...
## 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
## 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77,  78.
## 
## Done.</code></pre>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-174-1.png" width="672" /></p>
<p>Simulate point patterns from the model.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb344-1"></a>X &lt;-<span class="st"> </span><span class="kw">simulate.kppm</span>(model2, <span class="dt">nsim =</span> <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## Generating 4 simulations... 1, 2, 3,  4.
## Done.</code></pre>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb346-1"></a><span class="kw">plot</span>(X)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-175-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="spatial-logistic-regression" class="section level2" number="1.8">
<h2><span class="header-section-number">1.8</span> Spatial logistic regression</h2>
<p>Spatial logistic regression is a popular model for point pattern data. The study domain is divided into a grid of cells; each cell is assigned the value one if it contains at least one event, and zero otherwise.</p>
<p>Then a logistic regression models the presence probability <span class="math inline">\(p = P(Y = 1)\)</span> as a function of explanatory variables <span class="math inline">\(X\)</span> in the (matrix) form
<span class="math display">\[
\log \frac{p}{1-p} = \beta X
\]</span>
where the left-hand side is the logit (log of the odds ratio) and the <span class="math inline">\(\beta\)</span> are the coefficients to be determined.</p>
<p>If your data are stored as <code>ppp</code> objects, a spatial logistic model can be fit directly using functions from the <strong>spatstat</strong> package.</p>
<p>Let’s consider a canned example from the package (a good strategy in general).</p>
<div id="example-copper-ore-deposits" class="section level3" number="1.8.1">
<h3><span class="header-section-number">1.8.1</span> Example: Copper ore deposits</h3>
<p>Consider the locations of 57 copper ore deposits (events) and 146 line segments representing geological ‘lineaments.’ Lineaments are linear features that consist of geological faults.</p>
<p>It is of interest to be able to predict the probability of a copper ore from the lineament pattern. The data are stored as a list in <code>copper</code>. The list contains a <code>ppp</code> object for the ore deposits and a <code>psp</code> object for the lineaments.</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb347-1"></a><span class="kw">library</span>(spatstat)</span>
<span id="cb347-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb347-2"></a><span class="kw">data</span>(copper)</span>
<span id="cb347-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb347-3"></a><span class="kw">plot</span>(copper<span class="op">$</span>SouthPoints)</span>
<span id="cb347-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb347-4"></a><span class="kw">plot</span>(copper<span class="op">$</span>SouthLines, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-176-1.png" width="672" /></p>
<p>For convenience we first rotate the events (points and lines) by 90 degrees in the anticlockwise direction and save them as separate objects.</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb348-1"></a>C &lt;-<span class="st"> </span>spatstat<span class="op">::</span><span class="kw">rotate</span>(copper<span class="op">$</span>SouthPoints, pi<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb348-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb348-2"></a>L &lt;-<span class="st"> </span>spatstat<span class="op">::</span><span class="kw">rotate</span>(copper<span class="op">$</span>SouthLines, pi<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb348-3"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb348-3"></a><span class="kw">plot</span>(C)</span>
<span id="cb348-4"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb348-4"></a><span class="kw">plot</span>(L, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-177-1.png" width="672" /></p>
<p>We summarize the planar point pattern <code>C</code> that we want to model.</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb349-1"></a><span class="kw">summary</span>(C)</span></code></pre></div>
<pre><code>## Planar point pattern:  57 points
## Average intensity 0.01020691 points per square km
## 
## Coordinates are given to 2 decimal places
## i.e. rounded to the nearest multiple of 0.01 km
## 
## Window: rectangle = [-158.233, -0.19] x [-0.335, 35] km
##                     (158 x 35.34 km)
## Window area = 5584.45 square km
## Unit of length: 1 km</code></pre>
<p>There are 57 ore deposits over a region of size 5584 square km resulting in an intensity of about .01 ore deposits per square km.</p>
<p>Next we create a distance map of the lineaments to be used as a covariate.</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb351-1"></a>D &lt;-<span class="st"> </span><span class="kw">distmap</span>(L)</span>
<span id="cb351-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb351-2"></a><span class="kw">plot</span>(D)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-179-1.png" width="672" /></p>
<p>Models are fit with the <code>slrm()</code> function from the <strong>spatstat</strong> package.</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb352-1"></a>model &lt;-<span class="st"> </span><span class="kw">slrm</span>(C <span class="op">~</span><span class="st"> </span>D)</span>
<span id="cb352-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb352-2"></a>model</span></code></pre></div>
<pre><code>## Fitted spatial logistic regression model
## Formula: C ~ D
## Fitted coefficients:
## (Intercept)           D 
## -4.72337865  0.07811134</code></pre>
<p>The model says that the odds of a copper ore along a lineament (D = 0) is exp(-4.723) = .00888. This is slightly less than the overall intensity of .01.</p>
<p>The model also says that for every one unit (one kilometer) increase in distance from a lineament the expected change in the log odds is .0781 [exp(.0781) = 1.0812] or an 8.1% increase in the odds. Ore deposits are more likely between the lineaments.</p>
<p>The fitted method produces an image (raster) of the window giving the local probability of an ore deposit. The values are the probability of a random ore deposit in each pixel.</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb354-1"></a><span class="kw">plot</span>(<span class="kw">fitted</span>(model))</span>
<span id="cb354-2"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb354-2"></a><span class="kw">plot</span>(C, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-181-1.png" width="672" /></p>
<p>Integrating the predictions over the area equals the observed number of ore deposits.</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="analyzing-and-modeling-spatial-point-pattern-data.html#cb355-1"></a><span class="kw">sum</span>(<span class="kw">fitted</span>(model))</span></code></pre></div>
<pre><code>## [1] 57</code></pre>
</div>
<div id="challenge-problem" class="section level3" number="1.8.2">
<h3><span class="header-section-number">1.8.2</span> Challenge problem</h3>
<p>Fit a spatial logistic regression model to the Kansas tornado data (<code>T.ppp25</code>) using distance to nearest city, terrain roughness, and elevation as explanatory variables. Use the argument <code>eps = 10000</code> to specify 10-km-square pixels. Use the <code>AIC()</code> function to compare the model to a simpler model that has the elevation variable removed. What model is better? Plot the predictions from the better model as a probability raster with the actual tornado event locations overlayed.</p>
</div>
</div>
<div id="machine-learning-on-spatial-data" class="section level2" number="1.9">
<h2><span class="header-section-number">1.9</span> Machine learning on spatial data</h2>
<p><a href="https://geocompr.robinlovelace.net/spatial-cv.html" class="uri">https://geocompr.robinlovelace.net/spatial-cv.html</a></p>
</div>
<div id="problem-set-4" class="section level2" number="1.10">
<h2><span class="header-section-number">1.10</span> Problem Set #4</h2>
<ol style="list-style-type: decimal">
<li><p>Create a planar point pattern object (<code>ppp</code>) from the tornado reports (genesis points) across Oklahoma over the period 1950–2018 as the event locations. The data are in the shapefile <code>1950-2018-torn-initpoint</code>. Create an <code>owin</code> object from the state border after projecting the border to an Albers equal area conic projection (EPSG:26975). (15)</p></li>
<li><p>Rescale the units to kilometers. Estimate the annual tornado intensity per 100 square kilometers. (5)</p></li>
<li><p>Create a map showing the spatially varying intensity of tornadoes across the state. Overlay the event locations on the map. (10)</p></li>
<li><p>Create a planar point pattern object from the locations of cities and towns with populations exceeding 500. Use the cities data set from my website (see Lessons 13 &amp; 14). Make a map showing the locations (20)</p></li>
<li><p>Plot the intensity of tornado reports as a function of distance from nearest town/city. Use an adjustment to the kernel bandwidth of 1.5. (10)</p></li>
<li><p>Using the tornado events compute and plot the nearest neighbor distance function. Test for clustering using a simulation envelope. Use 99 simulations. Describe the results. (10)</p></li>
<li><p>Create a multitype point pattern object by combining the tornado events with the town/city locations. Note: first remove the marks from the tornado point pattern data. Add “city” and “tornado” as factor marks to the multitype point pattern. Compute and plot Ripley’s K cross function and test for ‘interaction’ for distances less than 10 km. Use the <code>envelope()</code> function to create 99 simulations. Provide an interpretation for the results. (30)</p></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["assfg-book.pdf", "assfg-book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
