<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1 Statistical Spatial Interpolation | Applied Spatial Statistics for Geographers</title>
  <meta name="description" content="1 Statistical Spatial Interpolation | Applied Spatial Statistics for Geographers" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="1 Statistical Spatial Interpolation | Applied Spatial Statistics for Geographers" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1 Statistical Spatial Interpolation | Applied Spatial Statistics for Geographers" />
  
  
  

<meta name="author" content="James B. Elsner" />


<meta name="date" content="2020-05-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>

<script src="libs/header-attrs-2.1/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/PopupTable-0.0.1/popup.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html"><i class="fa fa-check"></i><b>1</b> Statistical Spatial Interpolation</a>
<ul>
<li class="chapter" data-level="1.1" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#continuity-and-stationarity"><i class="fa fa-check"></i><b>1.1.1</b> Continuity and stationarity</a></li>
<li class="chapter" data-level="1.1.2" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#covariogram-and-correlogram"><i class="fa fa-check"></i><b>1.1.2</b> Covariogram and correlogram</a></li>
<li class="chapter" data-level="1.1.3" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#variogram"><i class="fa fa-check"></i><b>1.1.3</b> Variogram</a></li>
<li class="chapter" data-level="1.1.4" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#terminology"><i class="fa fa-check"></i><b>1.1.4</b> Terminology</a></li>
<li class="chapter" data-level="1.1.5" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#variogram-models"><i class="fa fa-check"></i><b>1.1.5</b> Variogram Models</a></li>
<li class="chapter" data-level="1.1.6" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#kriging"><i class="fa fa-check"></i><b>1.1.6</b> Kriging</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#working-with-geor-data"><i class="fa fa-check"></i><b>1.2</b> Working with {geoR} data</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#empirical-variograms"><i class="fa fa-check"></i><b>1.2.1</b> Empirical variograms</a></li>
<li class="chapter" data-level="1.2.2" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#wolfcamp-aquifer-data"><i class="fa fa-check"></i><b>1.2.2</b> Wolfcamp aquifer data</a></li>
<li class="chapter" data-level="1.2.3" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#variogram-cloud"><i class="fa fa-check"></i><b>1.2.3</b> Variogram cloud</a></li>
<li class="chapter" data-level="1.2.4" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#directional-variograms"><i class="fa fa-check"></i><b>1.2.4</b> Directional variograms</a></li>
<li class="chapter" data-level="1.2.5" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#another-example-a-variogram-model-for-april-temperatures-in-the-midwest"><i class="fa fa-check"></i><b>1.2.5</b> Another example: A variogram model for April temperatures in the Midwest</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#example-1-wolfcamp-aquifer-head-heights"><i class="fa fa-check"></i><b>1.3</b> Example 1: Wolfcamp Aquifer head heights</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#step-1-examine-the-data-for-trends-and-isotropy"><i class="fa fa-check"></i><b>1.3.1</b> Step 1: Examine the data for trends and isotropy</a></li>
<li class="chapter" data-level="1.3.2" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#step-2-compute-empirical-variograms-1"><i class="fa fa-check"></i><b>1.3.2</b> Step 2: Compute empirical variograms</a></li>
<li class="chapter" data-level="1.3.3" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#step-3-fit-a-variogram-model"><i class="fa fa-check"></i><b>1.3.3</b> Step 3: Fit a variogram model</a></li>
<li class="chapter" data-level="1.3.4" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#step-4-create-the-kriged-surface"><i class="fa fa-check"></i><b>1.3.4</b> Step 4: Create the kriged surface</a></li>
<li class="chapter" data-level="1.3.5" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#step-5-evaluate-the-prediction"><i class="fa fa-check"></i><b>1.3.5</b> Step 5: Evaluate the prediction</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#example-2-april-temperatures-in-the-midwest"><i class="fa fa-check"></i><b>1.4</b> Example 2: April temperatures in the Midwest</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#step-1-examine-the-data-for-spatial-trends-and-normality"><i class="fa fa-check"></i><b>1.4.1</b> Step 1: Examine the data for spatial trends and normality</a></li>
<li class="chapter" data-level="1.4.2" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#step-2-compute-empirical-variograms-2"><i class="fa fa-check"></i><b>1.4.2</b> Step 2: Compute empirical variograms</a></li>
<li class="chapter" data-level="1.4.3" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#step-3-fit-a-variogram-model-to-the-data"><i class="fa fa-check"></i><b>1.4.3</b> Step 3: Fit a variogram model to the data</a></li>
<li class="chapter" data-level="1.4.4" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#step-4-create-an-interpolated-surface"><i class="fa fa-check"></i><b>1.4.4</b> Step 4: Create an interpolated surface</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#synthetic-data"><i class="fa fa-check"></i><b>1.5</b> Synthetic data</a></li>
<li class="chapter" data-level="1.6" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#challenge-problem"><i class="fa fa-check"></i><b>1.6</b> Challenge problem</a></li>
<li class="chapter" data-level="1.7" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#spatial-interpolation-using-the-functions-in-the-gstat-package"><i class="fa fa-check"></i><b>1.7</b> Spatial interpolation using the functions in the {gstat} package</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#inverse-distance-weighted-interpolation"><i class="fa fa-check"></i><b>1.7.1</b> Inverse distance weighted interpolation</a></li>
<li class="chapter" data-level="1.7.2" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#create-a-geotif-file-that-can-be-read-into-envi-or-arcmap."><i class="fa fa-check"></i><b>1.7.2</b> Create a geoTIF file that can be read into ENVI or ArcMap.</a></li>
<li class="chapter" data-level="1.7.3" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#create-a-kml-file-that-can-be-read-by-google-earth"><i class="fa fa-check"></i><b>1.7.3</b> Create a KML file that can be read by Google Earth</a></li>
<li class="chapter" data-level="1.7.4" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#distance-to-river-as-a-covariate"><i class="fa fa-check"></i><b>1.7.4</b> Distance to river as a covariate</a></li>
<li class="chapter" data-level="1.7.5" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#empirical-variogram-analysis"><i class="fa fa-check"></i><b>1.7.5</b> Empirical variogram analysis</a></li>
<li class="chapter" data-level="1.7.6" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#variogram-maps"><i class="fa fa-check"></i><b>1.7.6</b> Variogram maps</a></li>
<li class="chapter" data-level="1.7.7" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#variogram-modeling"><i class="fa fa-check"></i><b>1.7.7</b> Variogram modeling</a></li>
<li class="chapter" data-level="1.7.8" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#kriging-1"><i class="fa fa-check"></i><b>1.7.8</b> Kriging</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#example-tropical-cyclone-rainfall"><i class="fa fa-check"></i><b>1.8</b> Example: Tropical cyclone rainfall</a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#empirical-variogram"><i class="fa fa-check"></i><b>1.8.1</b> Empirical variogram</a></li>
<li class="chapter" data-level="1.8.2" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#variogram-model"><i class="fa fa-check"></i><b>1.8.2</b> Variogram model</a></li>
<li class="chapter" data-level="1.8.3" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#kriging-2"><i class="fa fa-check"></i><b>1.8.3</b> Kriging</a></li>
<li class="chapter" data-level="1.8.4" data-path="statistical-spatial-interpolation.html"><a href="statistical-spatial-interpolation.html#uncertainty"><i class="fa fa-check"></i><b>1.8.4</b> Uncertainty</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Applied Spatial Statistics for Geographers</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="statistical-spatial-interpolation" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Statistical Spatial Interpolation</h1>
<p><strong>“Compassion isn’t about being nice, it’s about reducing suffering for others.”</strong> – April Wensel</p>
<div id="introduction" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Introduction</h2>
<p>Observations of the natural world are made at specific locations in space (and time). But we often want estimates of the observed values everywhere. This is the case when the observations are taken from a continuous field (surface). Data observed or measured at locations across a continuous field are called geostatistical data. Examples: concentrations of heavy metals across a farm field, surface air pressures measured by barometers at cities across the country, minimum air temperature values across the city on a clear, calm night.</p>
<p>Local averaging or spline functions are typically used for interpolation. If it is 20C here and 30C ten miles to the south, then it is 25C five miles to the south. That is a reasonable first-order assumption. But, these methods do not (1) take into account spatial autocorrelation and (2) do not estimate uncertainty about the interpolated values.</p>
<p>Kriging is statistical interpolation (usually spatial). It is the centerpiece of what is called ‘geostatistics.’ The resulting surface (kriged surface) is composed of three components. (1) Spatial trend: an increase or decrease in the values that depends on direction or a covariate (co-kriging); (2) Local spatial autocorrelation. (3) Random variation. Together the three components provide a model that is used to estimate values at any point in a specified domain.</p>
<p>Geostatistics is used to (1) quantify spatial correlation, (2) predict values at specific locations, (3) provide an estimate of uncertainty on the predicted values, and (4) simulation.</p>
<p>As we’ve done with areal averaged data and point pattern data (Moran’s I, Ripley’s K, etc), we begin with understanding how to quantify spatial autocorrelation. In geostatistics, this involves the covariance function, the correlogram function, and the variogram.</p>
<div id="continuity-and-stationarity" class="section level3" number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> Continuity and stationarity</h3>
<ul>
<li>Statistical interpolation assumes the observed values are spatially homogeneous. This implies stationarity and continuity.</li>
<li>Stationarity implies that the average difference in values between pairs of observations separated by a given distance (lag) is constant across the domain.</li>
<li>Continuity implies that the spatial autocorrelation depends only on the lag (and orientation) between observations. That is; spatial autocorrelation is independent of location.</li>
<li>Stationarity and continuity allow different parts of the domain to be treated as “independent” samples.</li>
<li>Spatial autocorrelation can be described by a single parametric function.</li>
</ul>
<p>Stationarity can be weak or intrinsic. Both assume the average of the difference in values at observations separated by a lag distance <span class="math inline">\(h\)</span> is zero. That is, E<span class="math inline">\([z_i - z_j]\)</span> = 0, where location <span class="math inline">\(i\)</span> and location <span class="math inline">\(j\)</span> are a (lag) distance <span class="math inline">\(h\)</span> apart. This implies that the interpolated surface <span class="math inline">\(Z(s)\)</span> is a random function with a constant mean (<span class="math inline">\(m\)</span>) and a residual (<span class="math inline">\(\varepsilon\)</span>).
<span class="math display">\[
Z(s) = m + \varepsilon(s).
\]</span>
The expected value (average across all values) in the domain is <span class="math inline">\(m\)</span>.</p>
<p>Weak stationarity assumes the covariance is a function of the lag distance <span class="math inline">\(h\)</span>.
<span class="math display">\[
\hbox{cov}(z_i, z_j) = \hbox{cov}(h)
\]</span>
where cov(<span class="math inline">\(h\)</span>) is called the covariogram.</p>
<p>Intrinsic stationarity assumes the variance of the difference in values is a function of the lag:
<span class="math display">\[
\hbox{var}(z_i - z_j) = \gamma(h),
\]</span>
where <span class="math inline">\(\gamma(h)\)</span> is called the variogram. This means that the variance of <span class="math inline">\(Z\)</span> is constant and that spatial correlation is independent of location.</p>
<p>These assumptions are needed to get started with statistical interpolation.</p>
</div>
<div id="covariogram-and-correlogram" class="section level3" number="1.1.2">
<h3><span class="header-section-number">1.1.2</span> Covariogram and correlogram</h3>
<p>Our interest will be on a parametric model for the variogram <span class="math inline">\(\gamma(h)\)</span>. But to help understand the variogram, let us first consider the covariogram.</p>
<p>To make things simple but with no loss in generality, we start with a 4 x 6 map of surface air temperatures in degrees C.</p>
<p>21 21 20 19 18 19</p>
<p>26 25 26 27 29 28</p>
<p>32 33 34 35 30 28</p>
<p>34 35 35 36 32 31</p>
<p>Put the values into a data vector and determine the mean and variance.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="statistical-spatial-interpolation.html#cb1-1"></a>temps &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">21</span>, <span class="dv">21</span>, <span class="dv">20</span>, <span class="dv">19</span>, <span class="dv">18</span>, <span class="dv">19</span>, </span>
<span id="cb1-2"><a href="statistical-spatial-interpolation.html#cb1-2"></a>           <span class="dv">26</span>, <span class="dv">25</span>, <span class="dv">26</span>, <span class="dv">27</span>, <span class="dv">29</span>, <span class="dv">28</span>, </span>
<span id="cb1-3"><a href="statistical-spatial-interpolation.html#cb1-3"></a>           <span class="dv">32</span>, <span class="dv">33</span>, <span class="dv">34</span>, <span class="dv">35</span>, <span class="dv">30</span>, <span class="dv">28</span>, </span>
<span id="cb1-4"><a href="statistical-spatial-interpolation.html#cb1-4"></a>           <span class="dv">34</span>, <span class="dv">35</span>, <span class="dv">35</span>, <span class="dv">36</span>, <span class="dv">32</span>, <span class="dv">31</span>)</span>
<span id="cb1-5"><a href="statistical-spatial-interpolation.html#cb1-5"></a><span class="kw">mean</span>(temps); <span class="kw">var</span>(temps)</span></code></pre></div>
<pre><code>## [1] 28.08333</code></pre>
<pre><code>## [1] 34.60145</code></pre>
<p>To start, we focus only on the north-south direction. To compute the sample covariance function we first compute the covariance between the observed values one distance unit apart.</p>
<p>Mathematically
<span class="math display">\[
\hbox{cov}(0, 1) = 1/|N(1)| \sum (z_i - Z)(z_j - Z)
\]</span>
where <span class="math inline">\(|N(1)|\)</span> is the number of distinct observation pairs with a distance separation of one unit in the north-south direction and where <span class="math inline">\(Z\)</span> is the average over all observations. Here we let zero in the cov(0, 1) refer to the direction and the one to the distance of one unit apart. Here <span class="math inline">\(|N(1)|\)</span> = 18.</p>
<p>The equation for the covariance can be simplified to:
<span class="math display">\[
\hbox{cov}(0, 1) = 1/|N(1)| \sum z_i z_j - m_{-1} m_{+1}
\]</span>
where <span class="math inline">\(m_{-1}\)</span> is the average temperature over all rows except the first (northern most) and <span class="math inline">\(m_{+1}\)</span> is the average temperature over all rows except the last (southern most).</p>
<p>To simplify the notation we re-index the grid of temperatures using lexicographic (reading) order.</p>
<p>1 2 3 4 5 6</p>
<p>7 8 9 10 11 12</p>
<p>13 14 15 16 17 18</p>
<p>19 20 21 22 23 24</p>
<p>Then</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="statistical-spatial-interpolation.html#cb4-1"></a>mp1 &lt;-<span class="st"> </span><span class="kw">mean</span>(temps[<span class="dv">1</span><span class="op">:</span><span class="dv">18</span>])</span>
<span id="cb4-2"><a href="statistical-spatial-interpolation.html#cb4-2"></a>mm1 &lt;-<span class="st"> </span><span class="kw">mean</span>(temps[<span class="dv">7</span><span class="op">:</span><span class="dv">24</span>])</span>
<span id="cb4-3"><a href="statistical-spatial-interpolation.html#cb4-3"></a>cc &lt;-<span class="st"> </span><span class="kw">sum</span>(temps[<span class="dv">1</span><span class="op">:</span><span class="dv">18</span>] <span class="op">*</span><span class="st"> </span>temps[<span class="dv">7</span><span class="op">:</span><span class="dv">24</span>])<span class="op">/</span><span class="dv">18</span></span>
<span id="cb4-4"><a href="statistical-spatial-interpolation.html#cb4-4"></a>cc <span class="op">-</span><span class="st"> </span>mm1 <span class="op">*</span><span class="st"> </span>mp1</span></code></pre></div>
<pre><code>## [1] 15.01852</code></pre>
<p>Or more generally</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="statistical-spatial-interpolation.html#cb6-1"></a>N &lt;-<span class="st"> </span><span class="dv">18</span></span>
<span id="cb6-2"><a href="statistical-spatial-interpolation.html#cb6-2"></a>k &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span>N</span>
<span id="cb6-3"><a href="statistical-spatial-interpolation.html#cb6-3"></a><span class="dv">1</span><span class="op">/</span>N <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>(temps[k] <span class="op">*</span><span class="st"> </span>temps[k <span class="op">+</span><span class="st"> </span><span class="dv">6</span>]) <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(temps[k]) <span class="op">*</span><span class="st"> </span><span class="kw">mean</span>(temps[k <span class="op">+</span><span class="st"> </span><span class="dv">6</span>])</span></code></pre></div>
<pre><code>## [1] 15.01852</code></pre>
<p>The covariance has units of the field variable squared (here <span class="math inline">\(^\circ C^2\)</span>).</p>
<p>We also have observation pairs two units of distance apart. So we compute the cov(0, 2) in a similar way.
<span class="math display">\[
\hbox{cov}(0, 2) = 1/|N(2)| \sum z_i z_j - m_{-2} m_{+2}
\]</span>
where <span class="math inline">\(m_{-2}\)</span> is the average temperature over all rows except the first two and <span class="math inline">\(m_{+2}\)</span> is the average temperature over all rows except the last two. <span class="math inline">\(|N(2)|\)</span> is the number of pairs two units apart.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="statistical-spatial-interpolation.html#cb8-1"></a>N &lt;-<span class="st"> </span><span class="dv">12</span></span>
<span id="cb8-2"><a href="statistical-spatial-interpolation.html#cb8-2"></a>k &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span>N</span>
<span id="cb8-3"><a href="statistical-spatial-interpolation.html#cb8-3"></a><span class="dv">1</span><span class="op">/</span>N <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>(temps[k] <span class="op">*</span><span class="st"> </span>temps[k <span class="op">+</span><span class="st"> </span><span class="dv">12</span>]) <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(temps[k]) <span class="op">*</span><span class="st"> </span><span class="kw">mean</span>(temps[k <span class="op">+</span><span class="st"> </span><span class="dv">12</span>])</span></code></pre></div>
<pre><code>## [1] 2.9375</code></pre>
<p>Similarly we have observation pairs three units apart so we compute cov(0, 3) as
<span class="math display">\[
\hbox{cov}(0, 3) = 1/|N(3)| \sum z_i z_j - m_{-3} m_{+3}
\]</span></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="statistical-spatial-interpolation.html#cb10-1"></a>N &lt;-<span class="st"> </span><span class="dv">6</span></span>
<span id="cb10-2"><a href="statistical-spatial-interpolation.html#cb10-2"></a>k &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span>N</span>
<span id="cb10-3"><a href="statistical-spatial-interpolation.html#cb10-3"></a><span class="dv">1</span><span class="op">/</span>N <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>(temps[k] <span class="op">*</span><span class="st"> </span>temps[k <span class="op">+</span><span class="st"> </span><span class="dv">18</span>]) <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(temps[k]) <span class="op">*</span><span class="st"> </span><span class="kw">mean</span>(temps[k <span class="op">+</span><span class="st"> </span><span class="dv">18</span>])</span></code></pre></div>
<pre><code>## [1] 0.9444444</code></pre>
<p>There are no observation pairs four units apart in the north-south direction so we are finished. The covariogram is a plot of the covariance values as a function of lagged distance. Let h be the lagged distance, then</p>
<table>
<thead>
<tr class="header">
<th>h</th>
<th>cov(h)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>(0, 1)</td>
<td>15</td>
</tr>
<tr class="even">
<td>(0, 2)</td>
<td>3</td>
</tr>
<tr class="odd">
<td>(0, 3)</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>It is convenient to have a measure of co-variability that is dimensionless. This is obtained by dividing the covariance at lagged distance <span class="math inline">\(h\)</span> by the covariance at lag zero. This is the correlogram. Values of the correlogram range from 0 to +1.</p>
</div>
<div id="variogram" class="section level3" number="1.1.3">
<h3><span class="header-section-number">1.1.3</span> Variogram</h3>
<p>The covariogram is a decreasing function of lag. The variogram is the multiplicative inverse of the covariogram.</p>
<p>Mathematically: var(<span class="math inline">\(z_i - z_j\)</span>) for locations i and j. The semivariogram is 1/2 the variogram. If location i is near location j, the difference in the values will be small and so too will the variance of their differences, in general. If location i is far from location j, the difference in values will be large and so too will the variance of their differences.</p>
<p>In practice we have a set of observations and we compute a variogram. We call this the sample (or empirical) variogram. Let <span class="math inline">\(t_i = (x_i, y_i)\)</span> be the ith location and <span class="math inline">\(h_{i,j} = t_j - t_i\)</span> be the vector connecting location <span class="math inline">\(t_i\)</span> with location <span class="math inline">\(t_j\)</span>. Then the sample variogram is defined as
<span class="math display">\[
\gamma(h) = \frac{1}{2N(h)} \sum^{N(h)} (z_i - z_j)^2
\]</span>
where <span class="math inline">\(N(h)\)</span> is the number of observation pairs a distance of <span class="math inline">\(h\)</span> units apart.</p>
<p>The variogram assumes intrinsic stationarity so the values need to be detrended first.</p>
<p>The sample variogram is characterized by a set of points the values of which generally increase as <span class="math inline">\(h\)</span> increases before leveling off (reaching a plateau).</p>
</div>
<div id="terminology" class="section level3" number="1.1.4">
<h3><span class="header-section-number">1.1.4</span> Terminology</h3>
<p>Let’s begin with a plot with labels. Make sure the {geoR} package is installed. The code is done using the base graphics commands and the plot method from the package.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="statistical-spatial-interpolation.html#cb12-1"></a><span class="kw">library</span>(geoR)</span></code></pre></div>
<pre><code>## --------------------------------------------------------------
##  Analysis of Geostatistical Data
##  For an Introduction to geoR go to http://www.leg.ufpr.br/geoR
##  geoR version 1.8-1 (built on 2020-02-08) is now loaded
## --------------------------------------------------------------</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="statistical-spatial-interpolation.html#cb14-1"></a><span class="kw">plot</span>(<span class="kw">variog</span>(s100, <span class="dt">max.dist =</span> <span class="dv">1</span>), </span>
<span id="cb14-2"><a href="statistical-spatial-interpolation.html#cb14-2"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Lagged Distance (h)&quot;</span>,</span>
<span id="cb14-3"><a href="statistical-spatial-interpolation.html#cb14-3"></a>     <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(gamma,<span class="st">&quot;(h)&quot;</span>)), </span>
<span id="cb14-4"><a href="statistical-spatial-interpolation.html#cb14-4"></a>     <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">pch =</span> <span class="dv">16</span>)</span></code></pre></div>
<pre><code>## variog: computing omnidirectional variogram</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="statistical-spatial-interpolation.html#cb16-1"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>)</span>
<span id="cb16-2"><a href="statistical-spatial-interpolation.html#cb16-2"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="fl">.15</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb16-3"><a href="statistical-spatial-interpolation.html#cb16-3"></a><span class="kw">arrows</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dt">x1 =</span> <span class="dv">0</span>, <span class="dt">y1 =</span> <span class="fl">.15</span>, <span class="dt">length =</span> <span class="fl">.1</span>)</span>
<span id="cb16-4"><a href="statistical-spatial-interpolation.html#cb16-4"></a><span class="kw">text</span>(<span class="dv">0</span>, <span class="dt">y =</span> <span class="fl">.05</span>, <span class="dt">labels =</span> <span class="st">&quot;nugget&quot;</span>, <span class="dt">pos=</span><span class="dv">4</span>)</span>
<span id="cb16-5"><a href="statistical-spatial-interpolation.html#cb16-5"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="fl">.9</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb16-6"><a href="statistical-spatial-interpolation.html#cb16-6"></a><span class="kw">arrows</span>(<span class="dv">0</span>, <span class="fl">.15</span>, <span class="dt">x1 =</span> <span class="dv">0</span>, <span class="dt">y1 =</span> <span class="fl">.9</span>, <span class="dt">length =</span> <span class="fl">.1</span>)</span>
<span id="cb16-7"><a href="statistical-spatial-interpolation.html#cb16-7"></a><span class="kw">text</span>(<span class="dv">0</span>, <span class="dt">y =</span> <span class="fl">.8</span>, <span class="dt">labels=</span><span class="st">&quot;sill (partial sill)&quot;</span>, <span class="dt">pos=</span><span class="dv">4</span>)</span>
<span id="cb16-8"><a href="statistical-spatial-interpolation.html#cb16-8"></a><span class="kw">abline</span>(<span class="dt">v =</span> <span class="fl">.6</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb16-9"><a href="statistical-spatial-interpolation.html#cb16-9"></a><span class="kw">arrows</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">x1 =</span> <span class="fl">.6</span>, <span class="dt">y1 =</span> <span class="dv">1</span>, <span class="dt">length =</span> <span class="fl">.1</span>)</span>
<span id="cb16-10"><a href="statistical-spatial-interpolation.html#cb16-10"></a><span class="kw">text</span>(.<span class="dv">4</span>, <span class="dt">y =</span> <span class="fl">1.04</span>, <span class="dt">labels =</span> <span class="st">&quot;range&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<ul>
<li>Lag (lag distance): Relative distance between observation locations.</li>
<li>Nugget (nugget, nugget variance, or nugget effect): The height of the variogram at zero lag. The nugget is the variation in the values at the observation locations without regard to spatial variation. Related to the observation (or measurement) precision.</li>
<li>Sill: The height of the variogram at which the values are uncorrelated.</li>
<li>Relative nugget effect: The ratio of the nugget to the sill expressed as a percentage.</li>
<li>Range: The distance beyond which the values are uncorrelated. The range is indicated on the empirical variogram as the position along the horizontal axis where values of the variogram reach a constant height.</li>
</ul>
<p>Additional terms.
* Isotropy: The condition in which spatial correlation is the same in all directions.
* Anisotropy: (an-I-so-trop-y) spatial correlation is stronger or more persistent in some directions.
* Directional variogram: Distance and direction are important in characterizing the spatial correlations. Otherwise the variogram is called omni-directional.
* Azimuth (<span class="math inline">\(\theta\)</span>): Defines the direction of the variogram in degrees.The azimuth is measured clockwise from north.
* Lag spacing: The distance between successive lags is called the lag spacing or lag increment.
* Lag tolerance: The distance allowable for observational pairs at a specified lag. With arbitrary observation locations there will be no observations exactly a lag distance from any observation. Lag tolerance provides a range of distances to be used for computing values of the variogram at a specified lag.</p>
</div>
<div id="variogram-models" class="section level3" number="1.1.5">
<h3><span class="header-section-number">1.1.5</span> Variogram Models</h3>
<p>Computing the sample variogram is the first step in modeling geostatistical data. The next step is to fit a model to these variogram estimates. We replace a scatter of points with a statistical model.</p>
<p>The model is important since the sample variogram is made only at specified lag distances (with specified lag tolerance and azimuth). We need a continuous function that varies smoothly across all lags.</p>
<p>Variogram models come from different families. The decision includes (1) choosing the model family and (2) determining the parameters: nugget, sill, and range.</p>
<p>The exponential model family reaches the sill asymptotically. The range (a) is defined as the lag distance at which gamma reaches 95% of the sill.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="statistical-spatial-interpolation.html#cb17-1"></a>c0 &lt;-<span class="st"> </span><span class="fl">.1</span></span>
<span id="cb17-2"><a href="statistical-spatial-interpolation.html#cb17-2"></a>c1 &lt;-<span class="st"> </span><span class="fl">2.1</span></span>
<span id="cb17-3"><a href="statistical-spatial-interpolation.html#cb17-3"></a>a &lt;-<span class="st"> </span><span class="fl">1.3</span></span>
<span id="cb17-4"><a href="statistical-spatial-interpolation.html#cb17-4"></a><span class="kw">curve</span>(c0 <span class="op">+</span><span class="st"> </span>c1<span class="op">*</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span><span class="dv">3</span><span class="op">*</span>x<span class="op">/</span>a)), </span>
<span id="cb17-5"><a href="statistical-spatial-interpolation.html#cb17-5"></a>      <span class="dt">from =</span> <span class="fl">.01</span>, <span class="dt">to =</span> <span class="dv">3</span>, </span>
<span id="cb17-6"><a href="statistical-spatial-interpolation.html#cb17-6"></a>      <span class="dt">xlab =</span> <span class="st">&quot;h&quot;</span>, </span>
<span id="cb17-7"><a href="statistical-spatial-interpolation.html#cb17-7"></a>      <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">hat</span>(gamma), <span class="st">&quot;(h)&quot;</span>)), </span>
<span id="cb17-8"><a href="statistical-spatial-interpolation.html#cb17-8"></a>      <span class="dt">las =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>The spherical model family is piece wise reaching the sill at x = 1 (here).</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="statistical-spatial-interpolation.html#cb18-1"></a><span class="kw">curve</span>(c0 <span class="op">+</span><span class="st"> </span>c1<span class="op">*</span>(<span class="dv">3</span><span class="op">*</span>x<span class="op">/</span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span>x<span class="op">^</span><span class="dv">3</span><span class="op">/</span><span class="dv">2</span>),</span>
<span id="cb18-2"><a href="statistical-spatial-interpolation.html#cb18-2"></a>      <span class="dt">from =</span> <span class="fl">.01</span>, <span class="dt">to =</span> <span class="dv">1</span>,</span>
<span id="cb18-3"><a href="statistical-spatial-interpolation.html#cb18-3"></a>      <span class="dt">xlab =</span> <span class="st">&quot;h&quot;</span>,</span>
<span id="cb18-4"><a href="statistical-spatial-interpolation.html#cb18-4"></a>      <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">hat</span>(gamma), <span class="st">&quot;(h)&quot;</span>)), </span>
<span id="cb18-5"><a href="statistical-spatial-interpolation.html#cb18-5"></a>      <span class="dt">las =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>The Gaussian model family is sigmoidal. It is used when the data exhibit strong correlations at the shortest lag distances. The inflection point of the model occurs at <span class="math inline">\(\sqrt{a/6}\)</span>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="statistical-spatial-interpolation.html#cb19-1"></a><span class="kw">curve</span>(c0 <span class="op">+</span><span class="st"> </span>c1<span class="op">*</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span><span class="dv">3</span><span class="op">*</span>x<span class="op">^</span><span class="dv">2</span><span class="op">/</span>a<span class="op">^</span><span class="dv">2</span>)),</span>
<span id="cb19-2"><a href="statistical-spatial-interpolation.html#cb19-2"></a>      <span class="dt">from =</span> <span class="fl">.01</span>, <span class="dt">to =</span> <span class="dv">3</span>, </span>
<span id="cb19-3"><a href="statistical-spatial-interpolation.html#cb19-3"></a>      <span class="dt">xlab =</span> <span class="st">&quot;h&quot;</span>, </span>
<span id="cb19-4"><a href="statistical-spatial-interpolation.html#cb19-4"></a>      <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="kw">hat</span>(gamma), <span class="st">&quot;(h)&quot;</span>)),</span>
<span id="cb19-5"><a href="statistical-spatial-interpolation.html#cb19-5"></a>      <span class="dt">las =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Other families include</p>
<ul>
<li>Linear models: <span class="math inline">\(\hat \gamma(h)\)</span> = c0 + b * h.</li>
<li>Power models: <span class="math inline">\(\hat \gamma(h)\)</span> = c0 + b * h<span class="math inline">\(^\lambda\)</span>.</li>
</ul>
<p>These models have no sill.</p>
<p>Choosing a variogram family is largely done by eyeballing the shape of the sample variogram. Then, given a sample variogram computed from a set of spatial observations and a choice of family, the parameters of the variogram model are determined by a weighted least-squares (WLS) algorithm. There are other ways to determine the parameters including by eye, and by the method of maximum likelihoods, but WLS is less erratic than other methods and it requires fewer assumptions about the distribution of the data.</p>
</div>
<div id="kriging" class="section level3" number="1.1.6">
<h3><span class="header-section-number">1.1.6</span> Kriging</h3>
<p>The final step is kriging. Kriging interpolates the observed data using the variogram model. It was developed by a South African miner (D.G. Krige) as a way to improve estimates of where ore reserves might be located. Extraction costs are reduced substantially if good predictions can be made of where the ore resides given samples taken across the mine.</p>
<p>A kriged estimate is a weighted average of the observations where the weights are based on the variogram model. The kriged estimates are optimal in the sense that they minimize the error variance. The type of kriging depends on the characteristics of the observations and the purpose of interpolation.</p>
<ul>
<li>Simple kriging assumes a known constant mean for the domain.<br />
</li>
<li>Ordinary kriging assumes an unknown constant mean.<br />
</li>
<li>Universal kriging assumes an unknown linear or nonlinear trend in the mean.</li>
</ul>
<p>The steps are:</p>
<ol style="list-style-type: decimal">
<li>Examine the observations for trends and isotropy.</li>
<li>Compute an empirical variogram.</li>
<li>Fit a variogram model to the empirical variogram.</li>
<li>Create an interpolated surface using kriging.</li>
</ol>
</div>
</div>
<div id="working-with-geor-data" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Working with {geoR} data</h2>
<p>The {geoR} package has functions for doing geostatistics. There are others but it was one of the first and it is useful for learning how things work.</p>
<p>Suppose we have the following set of observations (<code>zobs</code>) at locations (<code>sx</code>, <code>sy</code>).</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="statistical-spatial-interpolation.html#cb20-1"></a>sx &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.1</span>, <span class="fl">3.2</span>, <span class="fl">2.1</span>, <span class="fl">4.9</span>, <span class="fl">5.5</span>, <span class="dv">7</span>, <span class="fl">7.8</span>, <span class="dv">9</span>, <span class="fl">2.3</span>, <span class="fl">6.9</span>)</span>
<span id="cb20-2"><a href="statistical-spatial-interpolation.html#cb20-2"></a>sy &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="fl">3.5</span>, <span class="dv">6</span>, <span class="fl">1.5</span>, <span class="fl">5.5</span>, <span class="fl">3.2</span>, <span class="dv">1</span>, <span class="fl">4.5</span>, <span class="dv">1</span>, <span class="dv">7</span>)</span>
<span id="cb20-3"><a href="statistical-spatial-interpolation.html#cb20-3"></a>zobs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="fl">0.6117</span>, <span class="fl">-2.4232</span>, <span class="fl">-0.42</span>, <span class="fl">-0.2522</span>, <span class="fl">-2.0362</span>, <span class="fl">0.9814</span>, <span class="fl">1.842</span>,</span>
<span id="cb20-4"><a href="statistical-spatial-interpolation.html#cb20-4"></a>         <span class="fl">0.1723</span>, <span class="fl">-0.0811</span>, <span class="fl">-0.3896</span>)</span></code></pre></div>
<p>Create a data frame and plot the observed values at the locations using the <code>geom_text()</code> function.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="statistical-spatial-interpolation.html#cb21-1"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(sx, sy, zobs)</span>
<span id="cb21-2"><a href="statistical-spatial-interpolation.html#cb21-2"></a></span>
<span id="cb21-3"><a href="statistical-spatial-interpolation.html#cb21-3"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb21-4"><a href="statistical-spatial-interpolation.html#cb21-4"></a></span>
<span id="cb21-5"><a href="statistical-spatial-interpolation.html#cb21-5"></a><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> sx, <span class="dt">y =</span> sy, <span class="dt">label =</span> zobs)) <span class="op">+</span></span>
<span id="cb21-6"><a href="statistical-spatial-interpolation.html#cb21-6"></a><span class="st">  </span><span class="kw">geom_text</span>() <span class="op">+</span></span>
<span id="cb21-7"><a href="statistical-spatial-interpolation.html#cb21-7"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Lag distance (distance between locations) is the independent variable in the variogram function. We get all pairwise distances by applying the <code>dist()</code> function to a matrix of spatial coordinates.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="statistical-spatial-interpolation.html#cb22-1"></a><span class="kw">dist</span>(<span class="kw">cbind</span>(sx, sy))</span></code></pre></div>
<pre><code>##           1        2        3        4        5        6        7        8
## 2  2.158703                                                               
## 3  3.162278 2.731300                                                      
## 4  4.085340 2.624881 5.300000                                             
## 5  5.060632 3.047950 3.436568 4.044750                                    
## 6  5.903389 3.811824 5.643580 2.701851 2.745906                           
## 7  6.992138 5.235456 7.582216 2.942788 5.053712 2.340940                  
## 8  8.041144 5.885576 7.061161 5.080354 3.640055 2.385372 3.700000         
## 9  2.332381 2.657066 5.003998 2.647640 5.521775 5.189412 5.500000 7.559100
## 10 7.045566 5.093133 4.903060 5.852350 2.051828 3.801316 6.067125 3.264966
##           9
## 2          
## 3          
## 4          
## 5          
## 6          
## 7          
## 8          
## 9          
## 10 7.560423</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="statistical-spatial-interpolation.html#cb24-1"></a><span class="kw">max</span>(<span class="kw">dist</span>(<span class="kw">cbind</span>(sx, sy)))</span></code></pre></div>
<pre><code>## [1] 8.041144</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="statistical-spatial-interpolation.html#cb26-1"></a><span class="kw">min</span>(<span class="kw">dist</span>(<span class="kw">cbind</span>(sx, sy)))</span></code></pre></div>
<pre><code>## [1] 2.051828</code></pre>
<p>The function computes a pairwise distance matrix. The distance between the first and second observation is 2.16 units and so on. The largest lag distance is 8.04 units and the smallest lag distance is 2.05 units.</p>
<p>The functions in the {geoR} package work with objects of class <code>geodata</code>. Thus we first need to convert the data frame of observations and locations into a <code>geodata</code> object.</p>
<p>This is done with the <code>as.geodata()</code> function. The default for the function is to assume that the first two columns of the data frame contain the coordinates and the third column contains the observed data values. This is the way we constructed the data frame so we can use the defaults.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="statistical-spatial-interpolation.html#cb28-1"></a><span class="kw">library</span>(geoR)</span>
<span id="cb28-2"><a href="statistical-spatial-interpolation.html#cb28-2"></a></span>
<span id="cb28-3"><a href="statistical-spatial-interpolation.html#cb28-3"></a>gdf &lt;-<span class="st"> </span><span class="kw">as.geodata</span>(df)</span>
<span id="cb28-4"><a href="statistical-spatial-interpolation.html#cb28-4"></a><span class="kw">str</span>(gdf)</span></code></pre></div>
<pre><code>## List of 2
##  $ sx           , sy           : num [1:10, 1:2] 1.1 3.2 2.1 4.9 5.5 7 7.8 9 2.3 6.9 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 2
##   .. ..$ : NULL
##   .. ..$ : chr [1:2] &quot;sx&quot; &quot;sy&quot;
##  $ data         : num [1:10] -0.612 -2.423 -0.42 -0.252 -2.036 ...
##  - attr(*, &quot;class&quot;)= chr &quot;geodata&quot;</code></pre>
<p>An object of class <code>geodata</code> contains two lists: the coordinates of the locations and the observed values as <code>data</code>. It may contain other elements like coordinate boundaries but unlike working with <code>ppp</code> objects with functions from the {spatstat} package a boundary defining the domain is not required.</p>
<p>For an arbitrary data frame we can specify where the coordinate and data columns by column numbers. For example, if the location coordinates are in columns five and six and the observed values are in column eight then use <code>coords.col = c(5, 6)</code> and <code>data.col = 8</code>.</p>
<p>With the class set to <code>geodata</code> methods like <code>summary</code> and <code>plot</code> provide attribute and spatial information about the observations. For example the <code>summary()</code> method outputs the number of observations, a summary of the coordinates and a summary of the observed values.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="statistical-spatial-interpolation.html#cb30-1"></a><span class="kw">summary</span>(gdf)</span></code></pre></div>
<pre><code>## Number of data points: 10 
## 
## Coordinates summary
##      sx sy
## min 1.1  1
## max 9.0  7
## 
## Distance summary
##      min      max 
## 2.051828 8.041144 
## 
## Data summary
##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
## -2.423200 -0.563775 -0.320900 -0.321830  0.108950  1.842000</code></pre>
<p>We access the coordinates and the data using the <code>$</code> operator.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="statistical-spatial-interpolation.html#cb32-1"></a>gdf<span class="op">$</span>coords</span></code></pre></div>
<pre><code>##        sx  sy
##  [1,] 1.1 3.0
##  [2,] 3.2 3.5
##  [3,] 2.1 6.0
##  [4,] 4.9 1.5
##  [5,] 5.5 5.5
##  [6,] 7.0 3.2
##  [7,] 7.8 1.0
##  [8,] 9.0 4.5
##  [9,] 2.3 1.0
## [10,] 6.9 7.0</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="statistical-spatial-interpolation.html#cb34-1"></a>gdf<span class="op">$</span>data</span></code></pre></div>
<pre><code>##  [1] -0.6117 -2.4232 -0.4200 -0.2522 -2.0362  0.9814  1.8420  0.1723 -0.0811
## [10] -0.3896</code></pre>
<p>The <code>plot()</code> method produces a four panel plot.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="statistical-spatial-interpolation.html#cb36-1"></a><span class="kw">plot</span>(gdf)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>The upper left panel is a map with the locations of the observations given by colors and symbols according to their values. Green triangles have the smallest values and red crosses have the largest values. We can see an upward trend in values from northwest to southeast.</p>
<p>This trend is decomposed in the upper right and lower left panels. The upper-right panel shows the north-south (Y Coord) coordinate plotted against the data values. As the data values increase to the right the north-south coordinate decreases (smaller data values are in the north). The lower-left panel shows the data plotted against the east-west (X Coord). Moving from west to east we see the data values tend to increase.</p>
<p>The lower right panel is a non-spatial distribution of the data values shown with a histogram, and density curve, and a rug plot.</p>
<p>To plot the trend in the east-west direction, type</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="statistical-spatial-interpolation.html#cb37-1"></a><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> sx, <span class="dt">y =</span> zobs)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb37-2"><a href="statistical-spatial-interpolation.html#cb37-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb37-3"><a href="statistical-spatial-interpolation.html#cb37-3"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> lm, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb37-4"><a href="statistical-spatial-interpolation.html#cb37-4"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>The data can be plotted with the trend removed. The <code>trend = "1st"</code> refers to a linear (first-order) trend.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="statistical-spatial-interpolation.html#cb39-1"></a><span class="kw">plot</span>(gdf, <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Now the plots show the residuals from the first-order trend model.</p>
<p>As another example, consider the dataset called <code>topo</code> from the {MASS} package. The data are topographic heights (feet) within a 310 sq ft domain.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="statistical-spatial-interpolation.html#cb40-1"></a><span class="kw">library</span>(MASS)</span>
<span id="cb40-2"><a href="statistical-spatial-interpolation.html#cb40-2"></a></span>
<span id="cb40-3"><a href="statistical-spatial-interpolation.html#cb40-3"></a><span class="kw">data</span>(topo)</span>
<span id="cb40-4"><a href="statistical-spatial-interpolation.html#cb40-4"></a>topo.gdf &lt;-<span class="st"> </span><span class="kw">as.geodata</span>(topo)</span>
<span id="cb40-5"><a href="statistical-spatial-interpolation.html#cb40-5"></a><span class="kw">plot</span>(topo.gdf)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Note the trend in the north-south direction and the skewness in the observed values.</p>
<p>Examine the residuals after removing a first-order trend from the observations.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="statistical-spatial-interpolation.html#cb41-1"></a><span class="kw">plot</span>(topo.gdf, <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>The north-south trend is removed and the observations have a more symmetric distribution. There appears to be some non-linear trend in the east-west direction.</p>
<p>Examine the residuals after removing a second-order trend.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="statistical-spatial-interpolation.html#cb42-1"></a><span class="kw">plot</span>(topo.gdf, <span class="dt">trend =</span> <span class="st">&quot;2nd&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>The residuals from a second-order polynomial fit are symmetric and the trends are gone. However, the residuals appear to show spatial autocorrelations (areas with above and below residuals).</p>
<div id="empirical-variograms" class="section level3" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> Empirical variograms</h3>
<p>Consider the dataset <code>s100</code> available from the {geoR} package. The <code>points.geodata()</code> function produces a bubble plot showing the locations of the observations and the relative magnitude of the <code>z</code> variable.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="statistical-spatial-interpolation.html#cb43-1"></a><span class="kw">data</span>(s100)</span>
<span id="cb43-2"><a href="statistical-spatial-interpolation.html#cb43-2"></a><span class="kw">points.geodata</span>(s100) </span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>The <code>variog()</code> function computes the empirical variogram. Here we save it in the object <code>s100.v</code>.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="statistical-spatial-interpolation.html#cb44-1"></a>s100.v &lt;-<span class="st"> </span><span class="kw">variog</span>(s100)</span></code></pre></div>
<pre><code>## variog: computing omnidirectional variogram</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="statistical-spatial-interpolation.html#cb46-1"></a><span class="kw">str</span>(s100.v)</span></code></pre></div>
<pre><code>## List of 20
##  $ u               : num [1:13] 0.0492 0.1475 0.2458 0.3441 0.4424 ...
##  $ v               : num [1:13] 0.271 0.372 0.553 0.596 0.609 ...
##  $ n               : num [1:13] 140 341 524 691 667 707 573 474 415 257 ...
##  $ sd              : num [1:13] 0.417 0.499 0.829 0.876 0.934 ...
##  $ bins.lim        : num [1:14] 1.00e-12 9.83e-02 1.97e-01 2.95e-01 3.93e-01 ...
##  $ ind.bin         : logi [1:13] TRUE TRUE TRUE TRUE TRUE TRUE ...
##  $ var.mark        : num 0.732
##  $ beta.ols        : num 0.931
##  $ output.type     : chr &quot;bin&quot;
##  $ max.dist        : num 1.28
##  $ estimator.type  : chr &quot;classical&quot;
##  $ n.data          : int 100
##  $ lambda          : num 1
##  $ trend           : chr &quot;cte&quot;
##  $ pairs.min       : num 2
##  $ nugget.tolerance: num 1e-12
##  $ direction       : chr &quot;omnidirectional&quot;
##  $ tolerance       : chr &quot;none&quot;
##  $ uvec            : num [1:13] 0.0492 0.1475 0.2458 0.3441 0.4424 ...
##  $ call            : language variog(geodata = s100)
##  - attr(*, &quot;class&quot;)= chr &quot;variogram&quot;</code></pre>
<p>Information in the variogram object includes the lag distances (<code>u</code>), the values of the variogram at those distances (<code>v</code>), the number of distance pairs used to compute the variogram values at each lag (<code>n</code>), the standard deviation of the variogram values, and the coefficients of the trend surface (with no trend, the value is the overall mean of the data) (<code>beta.ols</code>) among other information.</p>
<p>Note: Mathematically lag distance is denoted with <span class="math inline">\(h\)</span> but in the {geoR} package it is <code>u</code>.</p>
<p>Verify the mean value.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="statistical-spatial-interpolation.html#cb48-1"></a><span class="kw">mean</span>(s100<span class="op">$</span>data)</span></code></pre></div>
<pre><code>## [1] 0.9307179</code></pre>
<p>Plot the variogram.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="statistical-spatial-interpolation.html#cb50-1"></a><span class="kw">plot</span>(s100.v)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>The semivariance (<span class="math inline">\(\gamma(u)\)</span>) is plotted against lag distance (<span class="math inline">\(u\)</span>). Values increase with increasing lag until a lag distance of about 1.</p>
<p>At large lags there are fewer estimates so the values have greater variance. A model for the semivariance is fit only for the the increasing portion of the graph.</p>
<p>Another example: variogram of the <code>topo</code> dataset.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="statistical-spatial-interpolation.html#cb51-1"></a>topo.v &lt;-<span class="st"> </span><span class="kw">variog</span>(topo.gdf)</span></code></pre></div>
<pre><code>## variog: computing omnidirectional variogram</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="statistical-spatial-interpolation.html#cb53-1"></a><span class="kw">plot</span>(topo.v, <span class="dt">xlab =</span> <span class="st">&quot;Lagged Distance&quot;</span>, </span>
<span id="cb53-2"><a href="statistical-spatial-interpolation.html#cb53-2"></a>     <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(gamma, <span class="st">&quot;(u) [ft&quot;</span>, {}<span class="op">^</span><span class="dv">2</span>, <span class="st">&quot;]&quot;</span>)),</span>
<span id="cb53-3"><a href="statistical-spatial-interpolation.html#cb53-3"></a>     <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">pch =</span> <span class="dv">16</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>The variogram values have units of square feet and are calculated using point pairs at lag distances within a lag tolerance. The number of point pairs depends on the lag so the variogram values are less precise at large distance.</p>
<p>Plot the number of point pairs used as a function of lag distance.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="statistical-spatial-interpolation.html#cb54-1"></a><span class="kw">ggplot</span>(<span class="kw">data.frame</span>(<span class="dt">u =</span> topo.v<span class="op">$</span>u, <span class="dt">n =</span> topo.v<span class="op">$</span>n), <span class="kw">aes</span>(<span class="dt">x =</span> u, <span class="dt">y =</span> n)) <span class="op">+</span></span>
<span id="cb54-2"><a href="statistical-spatial-interpolation.html#cb54-2"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb54-3"><a href="statistical-spatial-interpolation.html#cb54-3"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Lag Distance&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Number of Observation Pairs&quot;</span>) <span class="op">+</span></span>
<span id="cb54-4"><a href="statistical-spatial-interpolation.html#cb54-4"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
</div>
<div id="wolfcamp-aquifer-data" class="section level3" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> Wolfcamp aquifer data</h3>
<p>Some years ago there were three nuclear waste repository sites being proposed in Nevada, Texas, and Washington. The site needs to be larger enough for more than 68,000 high-level waste containers placed underground, about 9 m (~30 feet) apart, in trenches surrounded by salt. In July of 2002 the Congress approved <a href="https://en.wikipedia.org/wiki/Yucca_Mountain_nuclear_waste_repository">Yucca Mountain</a>, Nevada, as the nation’s first long-term geological repository for spent nuclear fuel and high-level radioactive waste.</p>
<p>The site must isolate the waste for 10,000 years. Leaks could occur, however, or radioactive heat could cause tiny quantities of water in the salt to migrate toward the heat until eventually each canister is surrounded by 22.5 liters of water (~6 gallons). A chemical reaction of salt and water can create hydrochloric acid that might corrode the canisters.</p>
<p>The piezometric-head data at the site were obtained by drilling a narrow pipe into the aquifer and letting water seeks its own level in the pipe (piezometer).</p>
<p>The head measurements, given in units of feet above sea level, are from drill stem tests and indicate the total energy of the water in units of height. The higher the head height, the greater the potential energy.</p>
<p>Water flows away from areas of high potential energy so aquifer discharge is proportional to the gradient of the piezometric head.</p>
<p>The data are in <code>wolfcamp.csv</code> on my website.</p>
<div id="step-1-examine-the-observed-data-for-trends-check-for-normality" class="section level4" number="1.2.2.1">
<h4><span class="header-section-number">1.2.2.1</span> Step 1: Examine the observed data for trends, check for normality</h4>
<p>Get the data.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="statistical-spatial-interpolation.html#cb55-1"></a>L &lt;-<span class="st"> &quot;http://myweb.fsu.edu/jelsner/temp/data/wolfcamp.csv&quot;</span></span>
<span id="cb55-2"><a href="statistical-spatial-interpolation.html#cb55-2"></a>wca.df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(L, <span class="dt">header =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p>Create a simple feature data frame and then map the locations and head heights.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="statistical-spatial-interpolation.html#cb56-1"></a><span class="kw">library</span>(sf)</span></code></pre></div>
<pre><code>## Linking to GEOS 3.7.2, GDAL 2.4.2, PROJ 5.2.0</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="statistical-spatial-interpolation.html#cb58-1"></a>wca.sf &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(<span class="dt">x =</span> wca.df, </span>
<span id="cb58-2"><a href="statistical-spatial-interpolation.html#cb58-2"></a>                   <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>),</span>
<span id="cb58-3"><a href="statistical-spatial-interpolation.html#cb58-3"></a>                   <span class="dt">crs =</span> <span class="st">&quot;+proj=longlat +datum=WGS84&quot;</span>)</span>
<span id="cb58-4"><a href="statistical-spatial-interpolation.html#cb58-4"></a></span>
<span id="cb58-5"><a href="statistical-spatial-interpolation.html#cb58-5"></a><span class="kw">library</span>(mapview)</span>
<span id="cb58-6"><a href="statistical-spatial-interpolation.html#cb58-6"></a><span class="kw">mapView</span>(wca.sf, </span>
<span id="cb58-7"><a href="statistical-spatial-interpolation.html#cb58-7"></a>        <span class="dt">zcol =</span> <span class="st">&quot;head&quot;</span>)</span></code></pre></div>
<div id="htmlwidget-d31bc671c4fe60de84e3" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-d31bc671c4fe60de84e3">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron",1,"CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter",2,"CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["OpenStreetMap",3,"OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["Esri.WorldImagery",4,"Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"addProviderTiles","args":["OpenTopoMap",5,"OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false}]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[[35.25,34.71,34.62,34.49,34.32,34.59,34.2,33.95,33.86,34.2,33.89,33.98,34.24,36.09,35.05,33.76,33.65,33.56,33.58,34.95,34.78,34.99,34.16,34.28,34.04,35.54,34.08,33.96,33.81,33.87,33.87,34.54,35.95,35.9,35.7,35.71,33.59,33.51,33.69,33.62,35.95,33.71,33.71,33.67,33.83,33.81,33.8,33.93,33.95,33.65,33.85,33.87,33.87,35.59,35.4,35.31,35.39,35.42,35.24,34.95,35.89,35.79,35.98,35.74,35.77,35.87,35.93,35.93,34.53,34.51,35.43,35.31,33.53,33.78,34.66,34.64,34.5,34.56,34.17,34,34,33.97,34.05,33.9,33.8],[-101.25,-102.48,-102.02,-102.33,-100.31,-100.1,-100.45,-100.42,-100.37,-100.29,-100.41,-100.38,-100.25,-102.42,-102.46,-101.01,-100.72,-100.59,-100.59,-100.79,-100.66,-100.87,-101.24,-101.31,-100.02,-101.05,-101.89,-102.07,-102.04,-102.04,-102.04,-100.89,-102.19,-102.33,-102.68,-100.54,-102.38,-102.41,-102.35,-102.29,-101.48,-100.23,-100.22,-100.19,-102.25,-102.32,-102.32,-102.17,-102.21,-101.8,-100.92,-100.78,-100.83,-102.64,-102.34,-102.37,-102.39,-101.63,-101.87,-102.15,-101.01,-100.96,-100.79,-100.76,-100.72,-100.95,-100.91,-100.88,-101.9,-101.68,-100.5,-100.16,-103.78,-104.55,-103.3,-103.66,-103.56,-104.11,-103.51,-103.28,-103.76,-103.38,-103.47,-103.68,-103.54],6,null,"wca.sf - head",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":2,"opacity":[0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9],"fill":true,"fillColor":["#404588","#21A685","#25838E","#1E9D89","#33638D","#365D8D","#31668E","#31668E","#34608D","#404588","#34608D","#39558C","#34608D","#3F4889","#23898E","#2A778E","#365D8D","#31668E","#365D8D","#453781","#34608D","#404588","#30698E","#26818E","#34608D","#3A538B","#28AE80","#21A685","#21A685","#1F978B","#1F978B","#33638D","#424186","#443A83","#34608D","#433E85","#2FB47C","#34B679","#2FB47C","#1F9A8A","#481769","#39558C","#3C4F8A","#3A538B","#21A685","#1F948C","#20A287","#23A983","#1E9D89","#28AE80","#34608D","#375A8C","#2F6C8E","#2F6C8E","#33638D","#3A538B","#33638D","#424186","#3E4C8A","#2A778E","#433E85","#482070","#433E85","#481769","#482070","#482778","#424186","#472F7D","#20928C","#228C8D","#481769","#443A83","#CFE11C","#C7E020","#23A983","#28AE80","#20A287","#D7E219","#38B977","#2FB47C","#76D153","#21A685","#38B977","#2CB17E","#4FC36B"],"fillOpacity":[0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6]},null,null,["<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>1&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1464&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>2&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2553&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>3&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2158&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>4&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2455&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>5&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1756&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>6&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1702&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>7&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1805&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>8&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1797&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>9&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1714&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>10&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1466&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>11&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1729&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>12&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1638&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>13&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1736&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>14&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1476&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>15&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2200&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>16&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1999&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>17&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1680&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>18&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1806&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>19&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1682&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>20&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1306&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>21&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1722&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>22&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1437&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>23&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1828&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>24&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2118&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>25&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1725&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>26&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1606&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>27&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2648&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>28&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2560&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>29&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2544&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>30&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2386&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>31&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2400&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>32&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1757&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>33&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1402&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>34&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1364&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>35&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1735&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>36&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1376&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>37&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2729&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>38&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2766&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>39&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2736&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>40&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2432&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>41&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1024&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>42&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1611&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>43&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1548&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>44&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1591&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>45&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2540&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>46&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2352&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>47&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2528&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>48&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2575&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>49&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2468&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>50&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2646&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>51&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1739&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>52&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1674&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>53&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1868&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>54&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1865&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>55&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1777&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>56&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1579&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>57&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1771&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>58&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1408&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>59&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1527&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>60&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2003&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>61&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1386&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>62&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1089&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>63&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1384&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>64&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1030&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>65&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1092&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>66&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1161&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>67&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1415&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>68&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1231&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>69&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2300&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>70&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2238&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>71&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1038&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>72&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>1332&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>73&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>3510&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>74&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>3490&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>75&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2594&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>76&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2650&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>77&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2533&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>78&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>3571&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>79&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2811&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>80&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2728&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>81&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>3136&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>82&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2553&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>83&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2798&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>84&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2691&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>","<html><head><link rel=\"stylesheet\" type=\"text/css\" href=\"lib/popup/popup.css\"><\/head><body><div class=\"scrollableContainer\"><table class=\"popup scrollable\" id=\"popup\"><tr class='coord'><td><\/td><td><b>Feature ID<\/b><\/td><td align='right'>85&emsp;<\/td><\/tr><tr class='alt'><td>1<\/td><td><b>head&emsp;<\/b><\/td><td align='right'>2946&emsp;<\/td><\/tr><tr><td>2<\/td><td><b>geometry&emsp;<\/b><\/td><td align='right'>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div><\/body><\/html>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["1464","2553","2158","2455","1756","1702","1805","1797","1714","1466","1729","1638","1736","1476","2200","1999","1680","1806","1682","1306","1722","1437","1828","2118","1725","1606","2648","2560","2544","2386","2400","1757","1402","1364","1735","1376","2729","2766","2736","2432","1024","1611","1548","1591","2540","2352","2528","2575","2468","2646","1739","1674","1868","1865","1777","1579","1771","1408","1527","2003","1386","1089","1384","1030","1092","1161","1415","1231","2300","2238","1038","1332","3510","3490","2594","2650","2533","3571","2811","2728","3136","2553","2798","2691","2946"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-104.55,33.51,-100.02,36.09,"wca.sf - head","Zoom to wca.sf - head","<strong> wca.sf - head <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"wca.sf - head",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#440154 , #424086 18.6886533176286%, #2B738E 38.3195916764821%, #20A287 57.9505300353357%, #6BCE59 77.5814683941892%, #ECE51B 97.2124067530428%, #FDE725 "],"labels":["1,500","2,000","2,500","3,000","3,500"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"numeric","title":"wca.sf - head","extra":{"p_1":0.186886533176286,"p_n":0.972124067530428},"layerId":null,"className":"info legend","group":"wca.sf - head"}]}],"limits":{"lat":[33.51,36.09],"lng":[-104.55,-100.02]}},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p>Convert the data frame to a <code>geodata</code> object. Note there is no method to do this from a simple feature.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="statistical-spatial-interpolation.html#cb59-1"></a>wca.gdf &lt;-<span class="st"> </span><span class="kw">as.geodata</span>(wca.df, </span>
<span id="cb59-2"><a href="statistical-spatial-interpolation.html#cb59-2"></a>                      <span class="dt">coords.col =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, </span>
<span id="cb59-3"><a href="statistical-spatial-interpolation.html#cb59-3"></a>                      <span class="dt">data.col =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## as.geodata: 1 replicated data locations found. 
##  Consider using jitterDupCoords() for jittering replicated locations. 
## WARNING: there are data at coincident or very closed locations, some of the geoR&#39;s functions may not work.
##  Use function dup.coords() to locate duplicated coordinates.
##  Consider using jitterDupCoords() for jittering replicated locations</code></pre>
<p>Find the duplicate location(s).</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="statistical-spatial-interpolation.html#cb61-1"></a><span class="kw">dup.coords</span>(wca.gdf)</span></code></pre></div>
<pre><code>##    dup     lon   lat data
## 30   1 -102.04 33.87 2386
## 31   2 -102.04 33.87 2400</code></pre>
<p>The locations are the same, but the data values are different. This may represent an error or multiple measurements at this one location.</p>
<p>We can average the values or we can exclude a row. Here we remove the row 30 observation.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="statistical-spatial-interpolation.html#cb63-1"></a>wca.gdf &lt;-<span class="st"> </span><span class="kw">as.geodata</span>(wca.df[<span class="op">-</span><span class="dv">30</span>, ], </span>
<span id="cb63-2"><a href="statistical-spatial-interpolation.html#cb63-2"></a>                      <span class="dt">coords.col =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, </span>
<span id="cb63-3"><a href="statistical-spatial-interpolation.html#cb63-3"></a>                      <span class="dt">data.col =</span> <span class="dv">3</span>)</span>
<span id="cb63-4"><a href="statistical-spatial-interpolation.html#cb63-4"></a><span class="kw">summary</span>(wca.gdf)</span></code></pre></div>
<pre><code>## Number of data points: 84 
## 
## Coordinates summary
##         lon   lat
## min -104.55 33.51
## max -100.02 36.09
## 
## Distance summary
##      min      max 
## 0.010000 4.648978 
## 
## Data summary
##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## 1024.000 1542.750 1787.000 1997.714 2541.000 3571.000</code></pre>
<p>There are 84 well sites. The spatial bounding box is given under coordinates summary. The minimum distance between sites is .01 degrees and the maximum distance is 4.6 degrees.</p>
<p>The data values are summarized. The values are piezometric head heights in units of feet.</p>
<p>The <code>plot()</code> method for <code>geodata</code> provides a panel of plots with information about the data useful for modeling them.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="statistical-spatial-interpolation.html#cb65-1"></a><span class="kw">plot</span>(wca.gdf)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p>The upper left panel is a graph of the observed locations with symbols reflecting quartiles of the observed piezometric head heights. There is a clear trend in the data with the highest potential energy over the southwest (red crosses) and lowest over the northeast (blue circles).</p>
<p>The nature of this trend can be seen in the upper right and lower left panels. The upper right panel plots the data against the y coordinate and the lower left panel plots the data against the x coordinate. Both graphs indicate a linear trend.</p>
<p>A histogram of the head heights is shown in the lower right panel. The rug locates the values along the data axis. The data are bi-modal and skewed to the right.</p>
<p>Repeat the plot after removing the 1st order trend. What happens?</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="statistical-spatial-interpolation.html#cb66-1"></a><span class="kw">plot</span>(wca.gdf, <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>With the trend removed the variation of values appears to be roughly symmetric and the high and low values are mixed. However, there is some spatial grouping to the residuals.</p>
</div>
<div id="step-2-compute-empirical-variograms" class="section level4" number="1.2.2.2">
<h4><span class="header-section-number">1.2.2.2</span> Step 2: Compute empirical variograms</h4>
<p>We noted the maximum distance between any two locations is 4.6 degrees. It is a good idea to plot the variogram values for distances only between 0 and about 1/2 the maximum distance.</p>
<p>Since there is a linear trend in the data over the spatial domain it is removed (trend argument) before computing the variogram values.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="statistical-spatial-interpolation.html#cb67-1"></a><span class="kw">plot</span>(<span class="kw">variog</span>(wca.gdf, </span>
<span id="cb67-2"><a href="statistical-spatial-interpolation.html#cb67-2"></a>            <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>, </span>
<span id="cb67-3"><a href="statistical-spatial-interpolation.html#cb67-3"></a>            <span class="dt">max.dist =</span> <span class="fl">2.3</span>))</span></code></pre></div>
<pre><code>## variog: computing omnidirectional variogram</code></pre>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>Here we see an increase in the variance with distance until about one degree, then the values fluctuate about a variance of about 41000 (ft<span class="math inline">\(^2\)</span>).</p>
<p>What does the variogram look like if we do not first remove the trend?</p>
<p>This continuously increasing set of variances with little fluctuation about a best fit curve indicates a trend in the data that must be removed before the variogram is modeled.</p>
<p>There are two sources of variation in the field values: trend and spatial correlation. Trends are modeled with smooth curves and correlations are modeled with the variogram.</p>
<p>The <code>variog()</code> function has options for specifying a classical or modulus estimator. By default the function uses the classical estimator. To override this, include the <code>estimator.type = "modulus"</code> argument. The modulus estimator of the variogram is more resistant to outliers in the data.</p>
<p>Compare the classical with the modulus variograms for the Wolfcamp aquifer data.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="statistical-spatial-interpolation.html#cb69-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb69-2"><a href="statistical-spatial-interpolation.html#cb69-2"></a><span class="kw">plot</span>(<span class="kw">variog</span>(wca.gdf, <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>, </span>
<span id="cb69-3"><a href="statistical-spatial-interpolation.html#cb69-3"></a>            <span class="dt">max.dist =</span> <span class="fl">2.3</span>), </span>
<span id="cb69-4"><a href="statistical-spatial-interpolation.html#cb69-4"></a>     <span class="dt">main =</span> <span class="st">&quot;Classical&quot;</span>)</span></code></pre></div>
<pre><code>## variog: computing omnidirectional variogram</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="statistical-spatial-interpolation.html#cb71-1"></a><span class="kw">plot</span>(<span class="kw">variog</span>(wca.gdf, <span class="dt">trend  =</span><span class="st">&quot;1st&quot;</span>, </span>
<span id="cb71-2"><a href="statistical-spatial-interpolation.html#cb71-2"></a>            <span class="dt">max.dist =</span> <span class="fl">2.3</span>, </span>
<span id="cb71-3"><a href="statistical-spatial-interpolation.html#cb71-3"></a>            <span class="dt">estimator.type =</span> <span class="st">&quot;modulus&quot;</span>),</span>
<span id="cb71-4"><a href="statistical-spatial-interpolation.html#cb71-4"></a>     <span class="dt">main =</span> <span class="st">&quot;Modulus&quot;</span>)</span></code></pre></div>
<pre><code>## variog: computing omnidirectional variogram</code></pre>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<p>The two variograms are nearly identical.</p>
</div>
</div>
<div id="variogram-cloud" class="section level3" number="1.2.3">
<h3><span class="header-section-number">1.2.3</span> Variogram cloud</h3>
<p>We can examine the makeup of the variogram in more detail using a ‘variogram cloud’. Consider again the simulated data set <code>s100</code>.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="statistical-spatial-interpolation.html#cb73-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb73-2"><a href="statistical-spatial-interpolation.html#cb73-2"></a><span class="kw">plot</span>(s100)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>There appears to be a trend in the east-west direction with higher values in the east. This is seen clearly in the bottom left panel.</p>
<p>Remove this first-order trend.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="statistical-spatial-interpolation.html#cb74-1"></a><span class="kw">plot</span>(s100, </span>
<span id="cb74-2"><a href="statistical-spatial-interpolation.html#cb74-2"></a>     <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>We can see that the trend is adequately modeled with a 1st-order surface. Residuals appear symmetric about zero.</p>
<p>A summary of the data indicates the maximum lagged distance of 1.3 so the <code>max.dist</code> argument is set to .6.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="statistical-spatial-interpolation.html#cb75-1"></a><span class="kw">summary</span>(s100)</span></code></pre></div>
<pre><code>## Number of data points: 100 
## 
## Coordinates summary
##         Coord.X    Coord.Y
## min 0.005638006 0.01091027
## max 0.983920544 0.99124979
## 
## Distance summary
##         min         max 
## 0.007640962 1.278175109 
## 
## Data summary
##       Min.    1st Qu.     Median       Mean    3rd Qu.       Max. 
## -1.1676955  0.2729882  1.1045936  0.9307179  1.6101707  2.8678969 
## 
## Other elements in the geodata object
## [1] &quot;cov.model&quot; &quot;nugget&quot;    &quot;cov.pars&quot;  &quot;kappa&quot;     &quot;lambda&quot;</code></pre>
<p>Here we specify the eleven variogram estimates between 0 and .6 using the <code>uvec</code> argument.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="statistical-spatial-interpolation.html#cb77-1"></a><span class="kw">plot</span>(<span class="kw">variog</span>(s100, </span>
<span id="cb77-2"><a href="statistical-spatial-interpolation.html#cb77-2"></a>            <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>, </span>
<span id="cb77-3"><a href="statistical-spatial-interpolation.html#cb77-3"></a>            <span class="dt">uvec =</span> <span class="dv">11</span>, </span>
<span id="cb77-4"><a href="statistical-spatial-interpolation.html#cb77-4"></a>            <span class="dt">max.dist =</span> <span class="fl">.6</span>))</span></code></pre></div>
<pre><code>## variog: computing omnidirectional variogram</code></pre>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<p>We ‘decompose’ the variogram estimates with the <code>option = "cloud"</code>.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="statistical-spatial-interpolation.html#cb79-1"></a>c1 &lt;-<span class="st"> </span><span class="kw">variog</span>(s100, <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>, </span>
<span id="cb79-2"><a href="statistical-spatial-interpolation.html#cb79-2"></a>             <span class="dt">option =</span> <span class="st">&quot;cloud&quot;</span>, </span>
<span id="cb79-3"><a href="statistical-spatial-interpolation.html#cb79-3"></a>             <span class="dt">max.dist =</span> <span class="fl">.6</span>)</span></code></pre></div>
<pre><code>## variog: computing omnidirectional variogram</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="statistical-spatial-interpolation.html#cb81-1"></a><span class="kw">plot</span>(c1)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>Each point on the plot is the difference (absolute value) between two observed values (y-axis) a lag distance apart (x-axis). There are 100 observations so there are 100 * 99/2 = 4950 possible points on this plot. Actually here only 3131 since we limit the distance to less than .6 degrees.</p>
<p>There is a tendency for more large differences as the lag increases but most differences are small for a given lag. The variability in observational differences is quite large especially for longer lag distances.</p>
<p>The variogram computes the sum of the squared differences as a function of lag distance grouped by a lag tolerance. Here we indirectly specify the lag tolerance with the <code>uvec</code> argument and compare the variogram with the variogram cloud.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="statistical-spatial-interpolation.html#cb82-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb82-2"><a href="statistical-spatial-interpolation.html#cb82-2"></a>v1 &lt;-<span class="st"> </span><span class="kw">variog</span>(s100, <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>, </span>
<span id="cb82-3"><a href="statistical-spatial-interpolation.html#cb82-3"></a>            <span class="dt">uvec =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">.6</span>, <span class="dt">l =</span> <span class="dv">11</span>))</span></code></pre></div>
<pre><code>## variog: computing omnidirectional variogram</code></pre>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="statistical-spatial-interpolation.html#cb84-1"></a><span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">ncol =</span> <span class="dv">2</span>), </span>
<span id="cb84-2"><a href="statistical-spatial-interpolation.html#cb84-2"></a>       <span class="dt">respect =</span> <span class="ot">TRUE</span>)</span>
<span id="cb84-3"><a href="statistical-spatial-interpolation.html#cb84-3"></a><span class="kw">plot</span>(v1); <span class="kw">plot</span>(c1)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<p>Note the difference in the scale on the y-axis between the variogram cloud and the variogram is a factor of 10.</p>
<p>The variogram cloud can be grouped into lag distance classes (bins) and displayed with a box plot. This gives an idea of the general shape the variogram model should take.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="statistical-spatial-interpolation.html#cb85-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb85-2"><a href="statistical-spatial-interpolation.html#cb85-2"></a>b1 &lt;-<span class="st"> </span><span class="kw">variog</span>(s100, <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>, </span>
<span id="cb85-3"><a href="statistical-spatial-interpolation.html#cb85-3"></a>            <span class="dt">max.dist =</span> <span class="fl">.6</span>, </span>
<span id="cb85-4"><a href="statistical-spatial-interpolation.html#cb85-4"></a>            <span class="dt">bin.cloud =</span> <span class="ot">TRUE</span>, </span>
<span id="cb85-5"><a href="statistical-spatial-interpolation.html#cb85-5"></a>            <span class="dt">estimator.type =</span> <span class="st">&quot;classical&quot;</span>)</span></code></pre></div>
<pre><code>## variog: computing omnidirectional variogram</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="statistical-spatial-interpolation.html#cb87-1"></a><span class="kw">plot</span>(b1, <span class="dt">bin.cloud =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<p>The box plot summarizes the squared differences for a given lag (and lag tolerance) with the median. There is a box plot for each lag but the lag distance is given as a bin number.</p>
<p>This summary information helps us anticipate the type of variogram model. As an aside, note how to use the expression and paste functions to include symbols as part of the axis label.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="statistical-spatial-interpolation.html#cb88-1"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">u =</span> b1<span class="op">$</span>u, <span class="dt">v =</span> b1<span class="op">$</span>v)</span>
<span id="cb88-2"><a href="statistical-spatial-interpolation.html#cb88-2"></a><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(u, v)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb88-3"><a href="statistical-spatial-interpolation.html#cb88-3"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></span>
<span id="cb88-4"><a href="statistical-spatial-interpolation.html#cb88-4"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">span =</span> <span class="fl">.8</span>) <span class="op">+</span></span>
<span id="cb88-5"><a href="statistical-spatial-interpolation.html#cb88-5"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.6</span>)) <span class="op">+</span></span>
<span id="cb88-6"><a href="statistical-spatial-interpolation.html#cb88-6"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Variogram [&quot;</span>, gamma,<span class="st">&quot;(h)]&quot;</span>))) <span class="op">+</span></span>
<span id="cb88-7"><a href="statistical-spatial-interpolation.html#cb88-7"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Lagged distance (h)&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<p>The blue line is a least-squares regression smoother through the variogram estimates. The fact that it is not horizontal indicates spatial autocorrelation in the values that is separate from the first-order trend. The shape of the blue line gives an idea of the type of variogram family of models we should consider.</p>
<p>Now we can guess at a family for the variogram model and eyeball the parameters. Recall the plot from Lesson 18. This is called variography. We will discuss this in Lesson 20.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="statistical-spatial-interpolation.html#cb90-1"></a><span class="kw">plot</span>(<span class="kw">variog</span>(s100, <span class="dt">max.dist =</span> <span class="dv">1</span>), </span>
<span id="cb90-2"><a href="statistical-spatial-interpolation.html#cb90-2"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Lagged Distance (h)&quot;</span>,</span>
<span id="cb90-3"><a href="statistical-spatial-interpolation.html#cb90-3"></a>     <span class="dt">ylab =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(gamma,<span class="st">&quot;(h)&quot;</span>)), </span>
<span id="cb90-4"><a href="statistical-spatial-interpolation.html#cb90-4"></a>     <span class="dt">las =</span> <span class="dv">1</span>, <span class="dt">pch =</span> <span class="dv">16</span>)</span></code></pre></div>
<pre><code>## variog: computing omnidirectional variogram</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="statistical-spatial-interpolation.html#cb92-1"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="dv">0</span>)</span>
<span id="cb92-2"><a href="statistical-spatial-interpolation.html#cb92-2"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="fl">.15</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb92-3"><a href="statistical-spatial-interpolation.html#cb92-3"></a><span class="kw">arrows</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dt">x1 =</span> <span class="dv">0</span>, <span class="dt">y1 =</span> <span class="fl">.15</span>, <span class="dt">length =</span> <span class="fl">.1</span>)</span>
<span id="cb92-4"><a href="statistical-spatial-interpolation.html#cb92-4"></a><span class="kw">text</span>(<span class="dv">0</span>, <span class="dt">y =</span> <span class="fl">.05</span>, <span class="dt">labels =</span> <span class="st">&quot;nugget&quot;</span>, <span class="dt">pos=</span><span class="dv">4</span>)</span>
<span id="cb92-5"><a href="statistical-spatial-interpolation.html#cb92-5"></a><span class="kw">abline</span>(<span class="dt">h =</span> <span class="fl">.9</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb92-6"><a href="statistical-spatial-interpolation.html#cb92-6"></a><span class="kw">arrows</span>(<span class="dv">0</span>, <span class="fl">.15</span>, <span class="dt">x1 =</span> <span class="dv">0</span>, <span class="dt">y1 =</span> <span class="fl">.9</span>, <span class="dt">length =</span> <span class="fl">.1</span>)</span>
<span id="cb92-7"><a href="statistical-spatial-interpolation.html#cb92-7"></a><span class="kw">text</span>(<span class="dv">0</span>, <span class="dt">y =</span> <span class="fl">.8</span>, <span class="dt">labels=</span><span class="st">&quot;sill (partial sill)&quot;</span>, <span class="dt">pos=</span><span class="dv">4</span>)</span>
<span id="cb92-8"><a href="statistical-spatial-interpolation.html#cb92-8"></a><span class="kw">abline</span>(<span class="dt">v =</span> <span class="fl">.6</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb92-9"><a href="statistical-spatial-interpolation.html#cb92-9"></a><span class="kw">arrows</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">x1 =</span> <span class="fl">.6</span>, <span class="dt">y1 =</span> <span class="dv">1</span>, <span class="dt">length =</span> <span class="fl">.1</span>)</span>
<span id="cb92-10"><a href="statistical-spatial-interpolation.html#cb92-10"></a><span class="kw">text</span>(.<span class="dv">4</span>, <span class="dt">y =</span> <span class="fl">1.04</span>, <span class="dt">labels =</span> <span class="st">&quot;range&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<ul>
<li>Lag (lag distance): Relative distance between observation locations.</li>
<li>Nugget (nugget, nugget variance, or nugget effect): The height of the variogram at zero lag. The nugget is the variation in the values at the observation locations without regard to spatial variation. Related to the observation (or measurement) precision.</li>
<li>Sill: The height of the variogram at which the values are uncorrelated.</li>
<li>Relative nugget effect: The ratio of the nugget to the sill expressed as a percentage.</li>
<li>Range: The distance beyond which the values are uncorrelated. The range is indicated on the empirical variogram as the position along the horizontal axis where values of the variogram reach a constant height.</li>
</ul>
</div>
<div id="directional-variograms" class="section level3" number="1.2.4">
<h3><span class="header-section-number">1.2.4</span> Directional variograms</h3>
<p>Recall that the assumption of isotropy implies the same spatial autocorrelation function regardless of direction.</p>
<p>To examine the assumption of isotropy we compute variograms using observational pairs located along the same orientation. Instead of considering all observational pairs within a lag distance <span class="math inline">\(h\)</span> and lag tolerance <span class="math inline">\(\delta h\)</span>, we consider only pairs within a wedge-shaped segment of this annulus.</p>
<p>This is done with the <code>variog()</code> function and specifying a <code>direction =</code> argument in units of radians. Radians are fractions of <code>pi</code>. We also need to specify the angle tolerance.</p>
<p>For example to compute and plot the variogram for the direction of 45 degrees (NE to SW) with a default tolerance of 22.5 degrees (default), type</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="statistical-spatial-interpolation.html#cb93-1"></a>v45 &lt;-<span class="st"> </span><span class="kw">variog</span>(wca.gdf, </span>
<span id="cb93-2"><a href="statistical-spatial-interpolation.html#cb93-2"></a>              <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>, </span>
<span id="cb93-3"><a href="statistical-spatial-interpolation.html#cb93-3"></a>              <span class="dt">max.dist =</span> <span class="fl">2.3</span>, </span>
<span id="cb93-4"><a href="statistical-spatial-interpolation.html#cb93-4"></a>              <span class="dt">direction =</span> pi<span class="op">/</span><span class="dv">4</span>)</span></code></pre></div>
<pre><code>## variog: computing variogram for direction = 45 degrees (0.785 radians)
##         tolerance angle = 22.5 degrees (0.393 radians)</code></pre>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="statistical-spatial-interpolation.html#cb95-1"></a><span class="kw">plot</span>(v45)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<p>Repeat for the other three quadrants (increments of <span class="math inline">\(\pi\)</span>/4).</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="statistical-spatial-interpolation.html#cb96-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb96-2"><a href="statistical-spatial-interpolation.html#cb96-2"></a><span class="kw">plot</span>(<span class="kw">variog</span>(wca.gdf, <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>, </span>
<span id="cb96-3"><a href="statistical-spatial-interpolation.html#cb96-3"></a>            <span class="dt">max.dist =</span> <span class="fl">2.3</span>, <span class="dt">direction =</span> <span class="dv">0</span>),</span>
<span id="cb96-4"><a href="statistical-spatial-interpolation.html#cb96-4"></a>     <span class="dt">main =</span> <span class="kw">expression</span>(<span class="dv">0</span> <span class="op">*</span><span class="st"> </span>degree))</span></code></pre></div>
<pre><code>## variog: computing variogram for direction = 0 degrees (0 radians)
##         tolerance angle = 22.5 degrees (0.393 radians)</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="statistical-spatial-interpolation.html#cb98-1"></a><span class="kw">plot</span>(<span class="kw">variog</span>(wca.gdf, <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>, </span>
<span id="cb98-2"><a href="statistical-spatial-interpolation.html#cb98-2"></a>            <span class="dt">max.dist =</span> <span class="fl">2.3</span>, <span class="dt">direction =</span> pi<span class="op">/</span><span class="dv">4</span>),</span>
<span id="cb98-3"><a href="statistical-spatial-interpolation.html#cb98-3"></a>     <span class="dt">main =</span> <span class="kw">expression</span>(<span class="dv">45</span> <span class="op">*</span><span class="st"> </span>degree))</span></code></pre></div>
<pre><code>## variog: computing variogram for direction = 45 degrees (0.785 radians)
##         tolerance angle = 22.5 degrees (0.393 radians)</code></pre>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="statistical-spatial-interpolation.html#cb100-1"></a><span class="kw">plot</span>(<span class="kw">variog</span>(wca.gdf, <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>, </span>
<span id="cb100-2"><a href="statistical-spatial-interpolation.html#cb100-2"></a>            <span class="dt">max.dist =</span> <span class="fl">2.3</span>, <span class="dt">direction =</span> pi<span class="op">/</span><span class="dv">2</span>),</span>
<span id="cb100-3"><a href="statistical-spatial-interpolation.html#cb100-3"></a>     <span class="dt">main =</span> <span class="kw">expression</span>(<span class="dv">90</span> <span class="op">*</span><span class="st"> </span>degree))</span></code></pre></div>
<pre><code>## variog: computing variogram for direction = 90 degrees (1.571 radians)
##         tolerance angle = 22.5 degrees (0.393 radians)</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="statistical-spatial-interpolation.html#cb102-1"></a><span class="kw">plot</span>(<span class="kw">variog</span>(wca.gdf, <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>, </span>
<span id="cb102-2"><a href="statistical-spatial-interpolation.html#cb102-2"></a>            <span class="dt">max.dist =</span> <span class="fl">2.3</span>, <span class="dt">direction =</span> <span class="dv">3</span> <span class="op">*</span><span class="st"> </span>pi<span class="op">/</span><span class="dv">4</span>),</span>
<span id="cb102-3"><a href="statistical-spatial-interpolation.html#cb102-3"></a>     <span class="dt">main =</span> <span class="kw">expression</span>(<span class="dv">135</span> <span class="op">*</span><span class="st"> </span>degree))</span></code></pre></div>
<pre><code>## variog: computing variogram for direction = 135 degrees (2.356 radians)
##         tolerance angle = 22.5 degrees (0.393 radians)</code></pre>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p>The variograms appear similar but it’s difficult to tell since the vertical scales are not all the same. The <code>variog4()</code> function makes the comparison easier by plotting them on the same graph. It works like <code>variog()</code> but takes a vector of directions. The default directions are 0, 45, 90, and 135 degrees.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="statistical-spatial-interpolation.html#cb104-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb104-2"><a href="statistical-spatial-interpolation.html#cb104-2"></a>v4 &lt;-<span class="st"> </span><span class="kw">variog4</span>(wca.gdf, </span>
<span id="cb104-3"><a href="statistical-spatial-interpolation.html#cb104-3"></a>              <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>,</span>
<span id="cb104-4"><a href="statistical-spatial-interpolation.html#cb104-4"></a>              <span class="dt">max.dist =</span> <span class="fl">2.3</span>)</span></code></pre></div>
<pre><code>## variog: computing variogram for direction = 0 degrees (0 radians)
##         tolerance angle = 22.5 degrees (0.393 radians)
## variog: computing variogram for direction = 45 degrees (0.785 radians)
##         tolerance angle = 22.5 degrees (0.393 radians)
## variog: computing variogram for direction = 90 degrees (1.571 radians)
##         tolerance angle = 22.5 degrees (0.393 radians)
## variog: computing variogram for direction = 135 degrees (2.356 radians)
##         tolerance angle = 22.5 degrees (0.393 radians)
## variog: computing omnidirectional variogram</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="statistical-spatial-interpolation.html#cb106-1"></a><span class="kw">plot</span>(v4)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<p>This plot makes it clear that the assumption of isotropy is reasonable.</p>
<div id="step-3-fit-a-variogram-model-to-the-empirical-variogram" class="section level4" number="1.2.4.1">
<h4><span class="header-section-number">1.2.4.1</span> Step 3: Fit a variogram model to the empirical variogram</h4>
<p>Next we fit a curve through the set of points that make up the empirical variogram. The curve is called the variogram model.</p>
<p>Since the <code>s100</code> data were generated using a variogram model, we already know the answer. The model is exponential with a sill (partial) of 1, a range of .3, and a nugget of 0.</p>
<p>Plot the empirical variogram values and overlay the curve corresponding to the exponential model with the <code>lines.variomodel()</code> function. The sill and range parameters are given in order using the <code>cov.pars</code> argument.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="statistical-spatial-interpolation.html#cb107-1"></a><span class="kw">plot</span>(<span class="kw">variog</span>(s100, <span class="dt">uvec =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">l =</span> <span class="dv">21</span>)))</span></code></pre></div>
<pre><code>## variog: computing omnidirectional variogram</code></pre>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="statistical-spatial-interpolation.html#cb109-1"></a><span class="kw">lines.variomodel</span>(<span class="dt">cov.model =</span> <span class="st">&quot;exp&quot;</span>, </span>
<span id="cb109-2"><a href="statistical-spatial-interpolation.html#cb109-2"></a>                 <span class="dt">cov.pars =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">.3</span>), <span class="dt">nugget =</span> <span class="dv">0</span>, </span>
<span id="cb109-3"><a href="statistical-spatial-interpolation.html#cb109-3"></a>                 <span class="dt">max.dist =</span> <span class="fl">1.2</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
<p>Note that the practical range for the exponential model is the distance along the horizontal axis at which the curve reaches 95% of the sill which is 3 times the range specified in the <code>cov.pars</code> argument.</p>
<p>The <code>uvec =</code> argument allows control over the range of distance values and the number of variogram estimates. We specify the maximum distance in the <code>lines.variomodel()</code> function.</p>
<p>With observed data we don’t know the model so we estimate the parameters using information from the empirical variogram.</p>
<ul>
<li>By eye: Trial and error over several models and parameter values. The <code>lines.variomodel()</code> function can help.<br />
</li>
<li>By least squares fit: Using ordinary least squares (OLS) or weighted least squares (WLS) methods available through the <code>variofit()</code> function.<br />
</li>
<li>By maximum likelihood methods: Options for maximum likelihood (ML) and restricted maximum likelihood (REML) are available through the <code>likfit()</code> function.</li>
</ul>
<p>Try various curves and choosing the one that looks the best. Here we plot three models on top of the <code>s100</code> empirical variogram.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="statistical-spatial-interpolation.html#cb110-1"></a><span class="kw">plot</span>(<span class="kw">variog</span>(s100, <span class="dt">max.dist =</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## variog: computing omnidirectional variogram</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="statistical-spatial-interpolation.html#cb112-1"></a><span class="kw">lines.variomodel</span>(<span class="dt">cov.model =</span> <span class="st">&quot;exp&quot;</span>, </span>
<span id="cb112-2"><a href="statistical-spatial-interpolation.html#cb112-2"></a>                 <span class="dt">cov.pars =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">.3</span>), </span>
<span id="cb112-3"><a href="statistical-spatial-interpolation.html#cb112-3"></a>                 <span class="dt">nug =</span> <span class="dv">0</span>, <span class="dt">max.dist =</span> <span class="dv">1</span>)</span>
<span id="cb112-4"><a href="statistical-spatial-interpolation.html#cb112-4"></a><span class="kw">lines.variomodel</span>(<span class="dt">cov.model =</span> <span class="st">&quot;exp&quot;</span>, </span>
<span id="cb112-5"><a href="statistical-spatial-interpolation.html#cb112-5"></a>                 <span class="dt">cov.pars =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">.5</span>),</span>
<span id="cb112-6"><a href="statistical-spatial-interpolation.html#cb112-6"></a>                 <span class="dt">nug =</span> <span class="fl">.1</span>, <span class="dt">max.dist =</span> <span class="dv">1</span>, </span>
<span id="cb112-7"><a href="statistical-spatial-interpolation.html#cb112-7"></a>                 <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb112-8"><a href="statistical-spatial-interpolation.html#cb112-8"></a><span class="kw">lines.variomodel</span>(<span class="dt">cov.model =</span> <span class="st">&quot;sph&quot;</span>, </span>
<span id="cb112-9"><a href="statistical-spatial-interpolation.html#cb112-9"></a>                 <span class="dt">cov.pars =</span> <span class="kw">c</span>(.<span class="dv">8</span>, <span class="fl">.8</span>),</span>
<span id="cb112-10"><a href="statistical-spatial-interpolation.html#cb112-10"></a>                 <span class="dt">nug =</span> <span class="fl">.1</span>, <span class="dt">max.dist =</span> <span class="dv">1</span>, </span>
<span id="cb112-11"><a href="statistical-spatial-interpolation.html#cb112-11"></a>                 <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
<p>The black line is the model used to generate the <code>s100</code> dataset. The red line is based on the same exponential (exp) function but has a range of .5 and a nugget of .1. The blue line is based on a spherical function with a sill and range of .8 and a nugget of .1. All three models fit the points reasonably well. This is important: In practice the choice often makes little difference in the quality of the spatial interpolation.</p>
<p>A function to help with the fitting is <code>eyefit</code>. This opens a widget with radio buttons and slider bars making it easier to see how the model changes through various parameter sets. CAUTION: Mac users must have X11 installed. X11 is no longer included in OSX.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="statistical-spatial-interpolation.html#cb113-1"></a><span class="kw">eyefit</span>(<span class="kw">variog</span>(s100))</span></code></pre></div>
</div>
<div id="variogram-model-for-the-wolfcamp-aquifer-data" class="section level4" number="1.2.4.2">
<h4><span class="header-section-number">1.2.4.2</span> Variogram model for the Wolfcamp aquifer data</h4>
<p>Let’s fit a variogram model to the Wolfcamp aquifer data. First plot the empirical variogram. We’ve seen that directional variograms are not needed.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="statistical-spatial-interpolation.html#cb114-1"></a>wca.v &lt;-<span class="st"> </span><span class="kw">variog</span>(wca.gdf, </span>
<span id="cb114-2"><a href="statistical-spatial-interpolation.html#cb114-2"></a>                <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>, </span>
<span id="cb114-3"><a href="statistical-spatial-interpolation.html#cb114-3"></a>                <span class="dt">max.dist =</span> <span class="fl">2.3</span>)</span></code></pre></div>
<pre><code>## variog: computing omnidirectional variogram</code></pre>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="statistical-spatial-interpolation.html#cb116-1"></a><span class="kw">plot</span>(wca.v)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
<p>Begin with a spherical model with a range of .8, a sill of 40000, and a nugget of 10000.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="statistical-spatial-interpolation.html#cb117-1"></a><span class="kw">plot</span>(wca.v)</span>
<span id="cb117-2"><a href="statistical-spatial-interpolation.html#cb117-2"></a><span class="kw">lines.variomodel</span>(<span class="dt">cov.model =</span> <span class="st">&quot;sph&quot;</span>, </span>
<span id="cb117-3"><a href="statistical-spatial-interpolation.html#cb117-3"></a>                 <span class="dt">cov.pars =</span> <span class="kw">c</span>(<span class="dv">30000</span>, <span class="fl">.8</span>),</span>
<span id="cb117-4"><a href="statistical-spatial-interpolation.html#cb117-4"></a>                 <span class="dt">nug =</span> <span class="dv">10000</span>, <span class="dt">max.dist =</span> <span class="fl">2.3</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
<p>In the <code>cov.pars</code> argument the first value is the “partial” sill and the second is the range. With the nugget set at 10000 and partial sill at 30000, the sill is 400000. The sill and nugget are variance measures so they have units of square feet. The range is distance so it has the corresponding spatial units.</p>
<p>The model looks reasonable. Perhaps the sill should be a bit higher, say 43000. We increase the partial sill accordingly,</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="statistical-spatial-interpolation.html#cb118-1"></a><span class="kw">plot</span>(wca.v)</span>
<span id="cb118-2"><a href="statistical-spatial-interpolation.html#cb118-2"></a><span class="kw">lines.variomodel</span>(<span class="dt">cov.model=</span><span class="st">&quot;sph&quot;</span>, </span>
<span id="cb118-3"><a href="statistical-spatial-interpolation.html#cb118-3"></a>                 <span class="dt">cov.pars =</span> <span class="kw">c</span>(<span class="dv">33000</span>, <span class="fl">.8</span>),</span>
<span id="cb118-4"><a href="statistical-spatial-interpolation.html#cb118-4"></a>                 <span class="dt">nug =</span> <span class="dv">10000</span>, <span class="dt">max.dist =</span> <span class="fl">2.3</span>,</span>
<span id="cb118-5"><a href="statistical-spatial-interpolation.html#cb118-5"></a>                 <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<p>Better still. We try an exponential model with the same sill but the same range.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="statistical-spatial-interpolation.html#cb119-1"></a><span class="kw">plot</span>(wca.v)</span>
<span id="cb119-2"><a href="statistical-spatial-interpolation.html#cb119-2"></a><span class="kw">lines.variomodel</span>(<span class="dt">cov.model =</span> <span class="st">&quot;exp&quot;</span>, </span>
<span id="cb119-3"><a href="statistical-spatial-interpolation.html#cb119-3"></a>                 <span class="dt">cov.pars =</span> <span class="kw">c</span>(<span class="dv">33000</span>, <span class="fl">.8</span><span class="op">/</span><span class="dv">3</span>),</span>
<span id="cb119-4"><a href="statistical-spatial-interpolation.html#cb119-4"></a>                 <span class="dt">nug =</span> <span class="dv">10000</span>, <span class="dt">max.dist =</span> <span class="fl">2.3</span>,</span>
<span id="cb119-5"><a href="statistical-spatial-interpolation.html#cb119-5"></a>                 <span class="dt">col =</span> <span class="st">&quot;green&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<p>Not as good. The exponential model does not have the sharp turn at the sill. We settle on the spherical model with a sill of 43000, a range of .8, and a nugget of 10000.</p>
</div>
<div id="fine-tune-the-parameter-values" class="section level4" number="1.2.4.3">
<h4><span class="header-section-number">1.2.4.3</span> Fine tune the parameter values</h4>
<p>Next we tune the parameter estimates using the <code>variofit()</code> function. The function takes a set of initial parameter values and improves upon them using the method of weighted least squares. Alternatively we can use the <code>likfit()</code> function to fine tune the parameters. Here we use it to adjust the variogram model parameters estimated above. We save the model in the object <code>wca.vm</code>.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="statistical-spatial-interpolation.html#cb120-1"></a>wca.vm &lt;-<span class="st"> </span><span class="kw">likfit</span>(wca.gdf, </span>
<span id="cb120-2"><a href="statistical-spatial-interpolation.html#cb120-2"></a>                 <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>, </span>
<span id="cb120-3"><a href="statistical-spatial-interpolation.html#cb120-3"></a>                 <span class="dt">ini =</span> <span class="kw">c</span>(<span class="dv">33000</span>, <span class="fl">.8</span>),</span>
<span id="cb120-4"><a href="statistical-spatial-interpolation.html#cb120-4"></a>                 <span class="dt">nug =</span> <span class="dv">10000</span>, </span>
<span id="cb120-5"><a href="statistical-spatial-interpolation.html#cb120-5"></a>                 <span class="dt">cov.model =</span> <span class="st">&quot;spherical&quot;</span>)</span></code></pre></div>
<pre><code>## kappa not used for the spherical correlation function
## ---------------------------------------------------------------
## likfit: likelihood maximisation using the function optim.
## likfit: Use control() to pass additional
##          arguments for the maximisation function.
##         For further details see documentation for optim.
## likfit: It is highly advisable to run this function several
##         times with different initial values for the parameters.
## likfit: WARNING: This step can be time demanding!
## ---------------------------------------------------------------
## likfit: end of numerical maximisation.</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="statistical-spatial-interpolation.html#cb122-1"></a>wca.vm</span></code></pre></div>
<pre><code>## likfit: estimated model parameters:
##       beta0       beta1       beta2       tausq     sigmasq         phi 
## &quot;-23631.36&quot; &quot;  -400.41&quot; &quot;  -435.60&quot; &quot; 13194.64&quot; &quot; 34569.94&quot; &quot;     1.14&quot; 
## Practical Range with cor=0.05 for asymptotic range: 1.139606
## 
## likfit: maximised log-likelihood = -553</code></pre>
<p>The function improves on the initial set of model parameters until the log-likelihood value is maximized. Any other set of parameters will produce a log likelihood value smaller than -553.</p>
<p>The output includes values for the trend surface. It is a linear trend in two dimensions so it’s represented by a plane with a single z-intercept value (<code>beta0</code>) and two slope values corresponding to the x (<code>beta1</code>) and y (<code>beta2</code>) directions.</p>
<p>The units on the slope parameters are data units per unit spatial distance. Thus the <code>beta1</code> value is -400 ft/deg longitude. For every one deg longitude east, the piezometric head height decreases by 400 ft. We saw a trend in the SW-NE direction (exploratory plot). The <code>beta1</code> (<code>beta2</code>) value quantifies this slope in the east-west (north-south) direction.</p>
<p>The output also includes the parameter values for the nugget (<code>tausq</code>), the partial sill (<code>sigmasq</code>) and the range (<code>phi</code>).</p>
<p>Overlay the maximum likelihood solution to the spherical model by typing</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="statistical-spatial-interpolation.html#cb124-1"></a><span class="kw">plot</span>(<span class="kw">variog</span>(wca.gdf, </span>
<span id="cb124-2"><a href="statistical-spatial-interpolation.html#cb124-2"></a>            <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>, </span>
<span id="cb124-3"><a href="statistical-spatial-interpolation.html#cb124-3"></a>            <span class="dt">max.dist =</span> <span class="fl">2.3</span>))</span></code></pre></div>
<pre><code>## variog: computing omnidirectional variogram</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="statistical-spatial-interpolation.html#cb126-1"></a><span class="kw">lines.variomodel</span>(<span class="dt">cov.model =</span> <span class="st">&quot;sph&quot;</span>, </span>
<span id="cb126-2"><a href="statistical-spatial-interpolation.html#cb126-2"></a>                 <span class="dt">cov.pars =</span> <span class="kw">c</span>(<span class="dv">33000</span>, <span class="fl">.8</span>),</span>
<span id="cb126-3"><a href="statistical-spatial-interpolation.html#cb126-3"></a>                 <span class="dt">nug =</span> <span class="dv">10000</span>, <span class="dt">max.dist =</span> <span class="fl">2.3</span>,</span>
<span id="cb126-4"><a href="statistical-spatial-interpolation.html#cb126-4"></a>                 <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb126-5"><a href="statistical-spatial-interpolation.html#cb126-5"></a><span class="kw">lines</span>(wca.vm, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<p>We see the maximum likelihood solution is better at fitting the points at lag distances between .5 and 1. At these lags, the variogram estimates are most reliable as n (number of observation pairs) is largest.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="statistical-spatial-interpolation.html#cb127-1"></a><span class="kw">variog</span>(wca.gdf)<span class="op">$</span>n</span></code></pre></div>
<pre><code>## variog: computing omnidirectional variogram</code></pre>
<pre><code>##  [1] 194 298 324 395 608 572 393 258 205 155  49  24  10</code></pre>
<p>The <code>likfit()</code> function is iterative and should find the same solution using somewhat different starting values. Try it using a partial sill of 30000 a nugget of 5000 and a range of 1.</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="statistical-spatial-interpolation.html#cb130-1"></a><span class="kw">likfit</span>(wca.gdf, </span>
<span id="cb130-2"><a href="statistical-spatial-interpolation.html#cb130-2"></a>                 <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>, </span>
<span id="cb130-3"><a href="statistical-spatial-interpolation.html#cb130-3"></a>                 <span class="dt">ini =</span> <span class="kw">c</span>(<span class="dv">30000</span>, <span class="dv">1</span>),</span>
<span id="cb130-4"><a href="statistical-spatial-interpolation.html#cb130-4"></a>                 <span class="dt">nug =</span> <span class="dv">5000</span>, </span>
<span id="cb130-5"><a href="statistical-spatial-interpolation.html#cb130-5"></a>                 <span class="dt">cov.model =</span> <span class="st">&quot;spherical&quot;</span>)</span></code></pre></div>
<pre><code>## kappa not used for the spherical correlation function
## ---------------------------------------------------------------
## likfit: likelihood maximisation using the function optim.
## likfit: Use control() to pass additional
##          arguments for the maximisation function.
##         For further details see documentation for optim.
## likfit: It is highly advisable to run this function several
##         times with different initial values for the parameters.
## likfit: WARNING: This step can be time demanding!
## ---------------------------------------------------------------
## likfit: end of numerical maximisation.</code></pre>
<pre><code>## likfit: estimated model parameters:
##       beta0       beta1       beta2       tausq     sigmasq         phi 
## &quot;-23631.31&quot; &quot;  -400.41&quot; &quot;  -435.60&quot; &quot; 13194.57&quot; &quot; 34569.77&quot; &quot;     1.14&quot; 
## Practical Range with cor=0.05 for asymptotic range: 1.139588
## 
## likfit: maximised log-likelihood = -553</code></pre>
<p>A summary function on the <code>likfit</code> output provides more information about the fitted variogram model.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="statistical-spatial-interpolation.html#cb133-1"></a><span class="kw">summary</span>(wca.vm)</span></code></pre></div>
<pre><code>## Summary of the parameter estimation
## -----------------------------------
## Estimation method: maximum likelihood 
## 
## Parameters of the mean component (trend):
##       beta0       beta1       beta2 
## -23631.3641   -400.4081   -435.6035 
## 
## Parameters of the spatial component:
##    correlation function: spherical
##       (estimated) variance parameter sigmasq (partial sill) =  34570
##       (estimated) cor. fct. parameter phi (range parameter)  =  1.14
##    anisotropy parameters:
##       (fixed) anisotropy angle = 0  ( 0 degrees )
##       (fixed) anisotropy ratio = 1
## 
## Parameter of the error component:
##       (estimated) nugget =  13195
## 
## Transformation parameter:
##       (fixed) Box-Cox parameter = 1 (no transformation)
## 
## Practical Range with cor=0.05 for asymptotic range: 1.139606
## 
## Maximised Likelihood:
##    log.L n.params      AIC      BIC 
##   &quot;-553&quot;      &quot;6&quot;   &quot;1118&quot;   &quot;1133&quot; 
## 
## non spatial model:
##    log.L n.params      AIC      BIC 
## &quot;-564.6&quot;      &quot;4&quot;   &quot;1137&quot;   &quot;1147&quot; 
## 
## Call:
## likfit(geodata = wca.gdf, trend = &quot;1st&quot;, ini.cov.pars = c(33000, 
##     0.8), nugget = 10000, cov.model = &quot;spherical&quot;)</code></pre>
<p>The summary provides parameters of the trend model and values of the spatial model parameters. Importantly the summary gives the log likelihood along with the AIC and BIC values. It also gives those values for a non-spatial model. A non-spatial model in this context is the trend plus spatially uncorrelated random variation.</p>
<p>Since the log likelihood value is larger for the spatial model and the AIC and BIC values are smaller, it is clear that a spatial model is better than the non-spatial model.</p>
</div>
<div id="profile-likelihood" class="section level4" number="1.2.4.4">
<h4><span class="header-section-number">1.2.4.4</span> Profile likelihood</h4>
<p>The <code>proflik()</code> function gives a matrix of log likelihood values for a range of model parameters. The matrix can then be plotted to get a synoptic view of the relationship between the parameters and the likelihood. This can take a few seconds to compute.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="statistical-spatial-interpolation.html#cb135-1"></a>prof &lt;-<span class="st"> </span><span class="kw">proflik</span>(wca.vm, <span class="dt">geodata =</span> wca.gdf, </span>
<span id="cb135-2"><a href="statistical-spatial-interpolation.html#cb135-2"></a>                <span class="dt">sill.val =</span> <span class="kw">seq</span>(<span class="dv">30000</span>, <span class="dv">60000</span>, <span class="dt">length =</span> <span class="dv">6</span>),</span>
<span id="cb135-3"><a href="statistical-spatial-interpolation.html#cb135-3"></a>                <span class="dt">range.val =</span> <span class="kw">seq</span>(.<span class="dv">3</span>, <span class="fl">2.3</span>, <span class="dt">length =</span> <span class="dv">6</span>), </span>
<span id="cb135-4"><a href="statistical-spatial-interpolation.html#cb135-4"></a>                <span class="dt">nug.val =</span> <span class="dv">10000</span>, <span class="dt">uni.only =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## proflik: computing profile likelihood for the sill
## proflik: computing profile likelihood for the range
## proflik: computing 2-D profile likelihood for the sill and range parameters</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="statistical-spatial-interpolation.html#cb137-1"></a><span class="kw">plot</span>(prof, <span class="dt">nlevels =</span> <span class="dv">16</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-60-1.png" width="672" /><img src="assfg-book_files/figure-html/unnamed-chunk-60-2.png" width="672" /><img src="assfg-book_files/figure-html/unnamed-chunk-60-3.png" width="672" /></p>
<p>The horizontal axis is the partial sill (<span class="math inline">\(\sigma^2\)</span>) and the vertical axis is the range (<span class="math inline">\(\phi\)</span>). The nugget is set at 10000. The best fit parameters are indicated by the circle. At this location the log-likelihood is maximized. The likelihood is near the maximum for a broad set of range and partial sill values.</p>
<p>The marginal profiles are also available and can be plotted alongside the contour plot using</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="statistical-spatial-interpolation.html#cb138-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb138-2"><a href="statistical-spatial-interpolation.html#cb138-2"></a><span class="kw">plot</span>(prof, <span class="dt">nlevels =</span> <span class="dv">8</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
</div>
</div>
<div id="another-example-a-variogram-model-for-april-temperatures-in-the-midwest" class="section level3" number="1.2.5">
<h3><span class="header-section-number">1.2.5</span> Another example: A variogram model for April temperatures in the Midwest</h3>
<p>Let’s finish with another example.</p>
<p>The data in <code>MidwestTemps.txt</code> are average temperatures in and around the state of Iowa for the month of April.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="statistical-spatial-interpolation.html#cb139-1"></a>L &lt;-<span class="st"> &quot;http://myweb.fsu.edu/jelsner/temp/data/MidwestTemps.txt&quot;</span></span>
<span id="cb139-2"><a href="statistical-spatial-interpolation.html#cb139-2"></a>t.df &lt;-<span class="st"> </span><span class="kw">read.table</span>(L, <span class="dt">header =</span> <span class="ot">TRUE</span>)</span>
<span id="cb139-3"><a href="statistical-spatial-interpolation.html#cb139-3"></a><span class="kw">summary</span>(t.df)</span></code></pre></div>
<pre><code>##       lon              lat             temp      
##  Min.   :-98.47   Min.   :38.59   Min.   :41.50  
##  1st Qu.:-96.22   1st Qu.:40.22   1st Qu.:47.15  
##  Median :-93.72   Median :41.55   Median :51.30  
##  Mean   :-93.62   Mean   :41.77   Mean   :50.61  
##  3rd Qu.:-90.77   3rd Qu.:43.36   3rd Qu.:53.85  
##  Max.   :-88.55   Max.   :45.46   Max.   :58.60</code></pre>
<p>Map the data values. Create a <code>geodata</code> object. Plot the empirical variogram using the residuals from a 2nd-order trend model. Fit an exponential model to the variogram using the <code>likfit()</code> function and starting values of 3 for the sill and 4 for the range.</p>
<p>Map the values.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="statistical-spatial-interpolation.html#cb141-1"></a><span class="kw">library</span>(tmap)</span>
<span id="cb141-2"><a href="statistical-spatial-interpolation.html#cb141-2"></a></span>
<span id="cb141-3"><a href="statistical-spatial-interpolation.html#cb141-3"></a>t.sf &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(<span class="dt">x =</span> t.df, </span>
<span id="cb141-4"><a href="statistical-spatial-interpolation.html#cb141-4"></a>                 <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>),</span>
<span id="cb141-5"><a href="statistical-spatial-interpolation.html#cb141-5"></a>                 <span class="dt">crs =</span> <span class="st">&quot;+proj=longlat +datum=WGS84&quot;</span>)</span>
<span id="cb141-6"><a href="statistical-spatial-interpolation.html#cb141-6"></a></span>
<span id="cb141-7"><a href="statistical-spatial-interpolation.html#cb141-7"></a><span class="kw">library</span>(USAboundaries)</span>
<span id="cb141-8"><a href="statistical-spatial-interpolation.html#cb141-8"></a></span>
<span id="cb141-9"><a href="statistical-spatial-interpolation.html#cb141-9"></a>sts &lt;-<span class="st"> </span><span class="kw">us_states</span>()</span>
<span id="cb141-10"><a href="statistical-spatial-interpolation.html#cb141-10"></a></span>
<span id="cb141-11"><a href="statistical-spatial-interpolation.html#cb141-11"></a><span class="kw">tm_shape</span>(t.sf) <span class="op">+</span></span>
<span id="cb141-12"><a href="statistical-spatial-interpolation.html#cb141-12"></a><span class="st">  </span><span class="kw">tm_text</span>(<span class="dt">text =</span> <span class="st">&quot;temp&quot;</span>, <span class="dt">size =</span> <span class="fl">.6</span>) <span class="op">+</span></span>
<span id="cb141-13"><a href="statistical-spatial-interpolation.html#cb141-13"></a><span class="kw">tm_shape</span>(sts) <span class="op">+</span></span>
<span id="cb141-14"><a href="statistical-spatial-interpolation.html#cb141-14"></a><span class="st">  </span><span class="kw">tm_borders</span>() </span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-63-1.png" width="672" /></p>
<p>Create a <code>geodata</code> object from the data frame.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="statistical-spatial-interpolation.html#cb142-1"></a>t.gdf &lt;-<span class="st"> </span><span class="kw">as.geodata</span>(t.df)</span>
<span id="cb142-2"><a href="statistical-spatial-interpolation.html#cb142-2"></a><span class="kw">summary</span>(t.gdf)</span></code></pre></div>
<pre><code>## Number of data points: 131 
## 
## Coordinates summary
##        lon   lat
## min -98.47 38.59
## max -88.55 45.46
## 
## Distance summary
##        min        max 
##  0.1004988 11.5354237 
## 
## Data summary
##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## 41.50000 47.15000 51.30000 50.61298 53.85000 58.60000</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="statistical-spatial-interpolation.html#cb144-1"></a><span class="kw">plot</span>(t.gdf)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-64-1.png" width="672" /></p>
<p>Remove the trends and examine the residuals.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="statistical-spatial-interpolation.html#cb145-1"></a><span class="kw">plot</span>(t.gdf, <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="statistical-spatial-interpolation.html#cb146-1"></a><span class="kw">plot</span>(t.gdf, <span class="dt">trend =</span> <span class="st">&quot;2nd&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-65-2.png" width="672" /></p>
<p>Plot the empirical variogram.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="statistical-spatial-interpolation.html#cb147-1"></a><span class="kw">plot</span>(<span class="kw">variog</span>(t.gdf, </span>
<span id="cb147-2"><a href="statistical-spatial-interpolation.html#cb147-2"></a>            <span class="dt">trend =</span> <span class="st">&quot;2nd&quot;</span>, </span>
<span id="cb147-3"><a href="statistical-spatial-interpolation.html#cb147-3"></a>            <span class="dt">max.dist =</span> <span class="fl">5.5</span>))</span></code></pre></div>
<pre><code>## variog: computing omnidirectional variogram</code></pre>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
<p>Fit a variogram model.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="statistical-spatial-interpolation.html#cb149-1"></a>iv &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>)  </span>
<span id="cb149-2"><a href="statistical-spatial-interpolation.html#cb149-2"></a></span>
<span id="cb149-3"><a href="statistical-spatial-interpolation.html#cb149-3"></a>( t.vm &lt;-<span class="st"> </span><span class="kw">likfit</span>(t.gdf, </span>
<span id="cb149-4"><a href="statistical-spatial-interpolation.html#cb149-4"></a>                 <span class="dt">trend =</span> <span class="st">&quot;2nd&quot;</span>,</span>
<span id="cb149-5"><a href="statistical-spatial-interpolation.html#cb149-5"></a>                 <span class="dt">ini =</span> iv, </span>
<span id="cb149-6"><a href="statistical-spatial-interpolation.html#cb149-6"></a>                 <span class="dt">cov.model =</span> <span class="st">&quot;exp&quot;</span>) )</span></code></pre></div>
<pre><code>## kappa not used for the exponential correlation function
## ---------------------------------------------------------------
## likfit: likelihood maximisation using the function optim.
## likfit: Use control() to pass additional
##          arguments for the maximisation function.
##         For further details see documentation for optim.
## likfit: It is highly advisable to run this function several
##         times with different initial values for the parameters.
## likfit: WARNING: This step can be time demanding!
## ---------------------------------------------------------------
## likfit: end of numerical maximisation.</code></pre>
<pre><code>## likfit: estimated model parameters:
##      beta0      beta1      beta2      beta3      beta4      beta5      tausq 
## &quot;599.2532&quot; &quot; 14.8991&quot; &quot;  8.5793&quot; &quot;  0.0811&quot; &quot; -0.1224&quot; &quot;  0.0025&quot; &quot;  0.0000&quot; 
##    sigmasq        phi 
## &quot;  2.1140&quot; &quot;  0.4139&quot; 
## Practical Range with cor=0.05 for asymptotic range: 1.239937
## 
## likfit: maximised log-likelihood = -226.6</code></pre>
<p>The beta values refer to the second order trend. The nugget is <code>tausq</code> the partial sill is <code>sigmasq</code> and the range is <code>phi</code>.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="statistical-spatial-interpolation.html#cb152-1"></a><span class="kw">plot</span>(<span class="kw">variog</span>(t.gdf, </span>
<span id="cb152-2"><a href="statistical-spatial-interpolation.html#cb152-2"></a>            <span class="dt">trend =</span> <span class="st">&quot;2nd&quot;</span>, </span>
<span id="cb152-3"><a href="statistical-spatial-interpolation.html#cb152-3"></a>            <span class="dt">max.dist =</span> <span class="fl">5.5</span>))</span></code></pre></div>
<pre><code>## variog: computing omnidirectional variogram</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="statistical-spatial-interpolation.html#cb154-1"></a><span class="kw">lines</span>(t.vm, <span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
</div>
</div>
<div id="example-1-wolfcamp-aquifer-head-heights" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Example 1: Wolfcamp Aquifer head heights</h2>
<p>We’ve been examining piezometric head heights from the Wolfcamp Aquifer. Head heights measurements indicate the potential energy of the water in units of height.</p>
<p>The data are in <code>wolfcamp.csv</code> on my website.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="statistical-spatial-interpolation.html#cb155-1"></a>L &lt;-<span class="st"> &quot;http://myweb.fsu.edu/jelsner/temp/data/wolfcamp.csv&quot;</span></span>
<span id="cb155-2"><a href="statistical-spatial-interpolation.html#cb155-2"></a>wca.df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(L, <span class="dt">header =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<div id="step-1-examine-the-data-for-trends-and-isotropy" class="section level3" number="1.3.1">
<h3><span class="header-section-number">1.3.1</span> Step 1: Examine the data for trends and isotropy</h3>
<p>Convert the data frame to a <code>geodata</code> object. The duplicate measurement is removed with the subset operator when converting from a <code>data.frame</code> to a <code>geodata</code> object.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="statistical-spatial-interpolation.html#cb156-1"></a>wca.gdf &lt;-<span class="st"> </span><span class="kw">as.geodata</span>(wca.df[<span class="op">-</span><span class="dv">30</span>, ], </span>
<span id="cb156-2"><a href="statistical-spatial-interpolation.html#cb156-2"></a>                      <span class="dt">coords.col =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, </span>
<span id="cb156-3"><a href="statistical-spatial-interpolation.html#cb156-3"></a>                      <span class="dt">data.col =</span> <span class="dv">3</span>)</span></code></pre></div>
<p>Plot the residuals after removing the 1st-order trend.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="statistical-spatial-interpolation.html#cb157-1"></a><span class="kw">plot</span>(wca.gdf, <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-71-1.png" width="672" /></p>
</div>
<div id="step-2-compute-empirical-variograms-1" class="section level3" number="1.3.2">
<h3><span class="header-section-number">1.3.2</span> Step 2: Compute empirical variograms</h3>
<p>To compute and plot the variogram on the residuals from a 1st-order trend type</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="statistical-spatial-interpolation.html#cb158-1"></a>wca.v &lt;-<span class="st"> </span><span class="kw">variog</span>(wca.gdf, </span>
<span id="cb158-2"><a href="statistical-spatial-interpolation.html#cb158-2"></a>                <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>,</span>
<span id="cb158-3"><a href="statistical-spatial-interpolation.html#cb158-3"></a>                <span class="dt">max.dist =</span> <span class="fl">2.3</span>)</span></code></pre></div>
<pre><code>## variog: computing omnidirectional variogram</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="statistical-spatial-interpolation.html#cb160-1"></a><span class="kw">plot</span>(wca.v)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
</div>
<div id="step-3-fit-a-variogram-model" class="section level3" number="1.3.3">
<h3><span class="header-section-number">1.3.3</span> Step 3: Fit a variogram model</h3>
<p>Eyeball the initial values for the nugget, partial sill and range. Then use the <code>likfit()</code> function together with the initial estimates to get a variogram model. Here we assign the model to the object <code>wca.vm</code>.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="statistical-spatial-interpolation.html#cb161-1"></a>wca.vm &lt;-<span class="st"> </span><span class="kw">likfit</span>(wca.gdf, </span>
<span id="cb161-2"><a href="statistical-spatial-interpolation.html#cb161-2"></a>                 <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>, </span>
<span id="cb161-3"><a href="statistical-spatial-interpolation.html#cb161-3"></a>                 <span class="dt">ini =</span> <span class="kw">c</span>(<span class="dv">33000</span>, <span class="fl">.8</span>),</span>
<span id="cb161-4"><a href="statistical-spatial-interpolation.html#cb161-4"></a>                 <span class="dt">nug =</span> <span class="dv">10000</span>, </span>
<span id="cb161-5"><a href="statistical-spatial-interpolation.html#cb161-5"></a>                 <span class="dt">cov.model =</span> <span class="st">&quot;spherical&quot;</span>)</span></code></pre></div>
<pre><code>## kappa not used for the spherical correlation function
## ---------------------------------------------------------------
## likfit: likelihood maximisation using the function optim.
## likfit: Use control() to pass additional
##          arguments for the maximisation function.
##         For further details see documentation for optim.
## likfit: It is highly advisable to run this function several
##         times with different initial values for the parameters.
## likfit: WARNING: This step can be time demanding!
## ---------------------------------------------------------------
## likfit: end of numerical maximisation.</code></pre>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="statistical-spatial-interpolation.html#cb163-1"></a>wca.vm</span></code></pre></div>
<pre><code>## likfit: estimated model parameters:
##       beta0       beta1       beta2       tausq     sigmasq         phi 
## &quot;-23631.36&quot; &quot;  -400.41&quot; &quot;  -435.60&quot; &quot; 13194.64&quot; &quot; 34569.94&quot; &quot;     1.14&quot; 
## Practical Range with cor=0.05 for asymptotic range: 1.139606
## 
## likfit: maximised log-likelihood = -553</code></pre>
</div>
<div id="step-4-create-the-kriged-surface" class="section level3" number="1.3.4">
<h3><span class="header-section-number">1.3.4</span> Step 4: Create the kriged surface</h3>
<p>Kriging uses the variogram model and the observed data to estimate data values at any location of interest. The kriged estimates are a weighted average of the neighborhood values where the weights are taken from the variogram model.</p>
<p>Estimates are often made at locations defined on a regular grid.</p>
<ol style="list-style-type: lower-alpha">
<li>First create a grid of locations across the domain. Here we use the <code>expand.grid()</code> function. The coordinates names of the grid are those defined in the <code>geodata</code> object (here <code>lon</code> and <code>lat</code>). Grid spacing is defined by the <code>l =</code> argument in the sequence function.</li>
</ol>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="statistical-spatial-interpolation.html#cb165-1"></a>pgrid.df &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">lon =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">105</span>, <span class="dv">-100</span>, <span class="dt">l =</span> <span class="dv">61</span>),</span>
<span id="cb165-2"><a href="statistical-spatial-interpolation.html#cb165-2"></a>                        <span class="dt">lat =</span> <span class="kw">seq</span>(<span class="dv">33</span>, <span class="dv">37</span>, <span class="dt">l =</span> <span class="dv">61</span>))</span>
<span id="cb165-3"><a href="statistical-spatial-interpolation.html#cb165-3"></a><span class="kw">head</span>(pgrid.df)</span></code></pre></div>
<pre><code>##         lon lat
## 1 -105.0000  33
## 2 -104.9167  33
## 3 -104.8333  33
## 4 -104.7500  33
## 5 -104.6667  33
## 6 -104.5833  33</code></pre>
<p>The resulting data frame is a series of locations specified as in a raster starting in the southwest corner. Plot the grid. First convert it to a simple feature data frame. Do the same for the observations.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="statistical-spatial-interpolation.html#cb167-1"></a><span class="kw">library</span>(sf)</span>
<span id="cb167-2"><a href="statistical-spatial-interpolation.html#cb167-2"></a>pgrid.sf &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(<span class="dt">x =</span> pgrid.df,</span>
<span id="cb167-3"><a href="statistical-spatial-interpolation.html#cb167-3"></a>                     <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>),</span>
<span id="cb167-4"><a href="statistical-spatial-interpolation.html#cb167-4"></a>                     <span class="dt">crs =</span> <span class="st">&quot;+proj=longlat +datum=WGS84&quot;</span>)</span>
<span id="cb167-5"><a href="statistical-spatial-interpolation.html#cb167-5"></a>wca.sf &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(<span class="dt">x =</span> wca.df, </span>
<span id="cb167-6"><a href="statistical-spatial-interpolation.html#cb167-6"></a>                   <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>),</span>
<span id="cb167-7"><a href="statistical-spatial-interpolation.html#cb167-7"></a>                   <span class="dt">crs =</span> <span class="st">&quot;+proj=longlat +datum=WGS84&quot;</span>)</span>
<span id="cb167-8"><a href="statistical-spatial-interpolation.html#cb167-8"></a></span>
<span id="cb167-9"><a href="statistical-spatial-interpolation.html#cb167-9"></a><span class="kw">library</span>(USAboundaries)</span>
<span id="cb167-10"><a href="statistical-spatial-interpolation.html#cb167-10"></a>sts &lt;-<span class="st"> </span><span class="kw">us_states</span>()</span>
<span id="cb167-11"><a href="statistical-spatial-interpolation.html#cb167-11"></a></span>
<span id="cb167-12"><a href="statistical-spatial-interpolation.html#cb167-12"></a><span class="kw">library</span>(tmap)</span>
<span id="cb167-13"><a href="statistical-spatial-interpolation.html#cb167-13"></a><span class="kw">tm_shape</span>(wca.sf) <span class="op">+</span></span>
<span id="cb167-14"><a href="statistical-spatial-interpolation.html#cb167-14"></a><span class="st">  </span><span class="kw">tm_bubbles</span>(<span class="dt">size =</span> <span class="fl">.25</span>) <span class="op">+</span></span>
<span id="cb167-15"><a href="statistical-spatial-interpolation.html#cb167-15"></a><span class="kw">tm_shape</span>(pgrid.sf) <span class="op">+</span></span>
<span id="cb167-16"><a href="statistical-spatial-interpolation.html#cb167-16"></a><span class="st">  </span><span class="kw">tm_dots</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Next predict the head heights at the grid locations.</li>
</ol>
<p>The <code>krige.conv()</code> function performs the kriging. Predictions are made at the grid locations using the data and the variogram model (<code>wca.vm</code>). We specify a 1st-order trend in the data (<code>trend.d</code>) and we want the predictions to include the trend (<code>trend.l</code>) so these are included as parameters in the <code>krige.control()</code> function.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="statistical-spatial-interpolation.html#cb168-1"></a>wca.ks &lt;-<span class="st"> </span><span class="kw">krige.conv</span>(wca.gdf, </span>
<span id="cb168-2"><a href="statistical-spatial-interpolation.html#cb168-2"></a>                     <span class="dt">loc =</span> pgrid.df, </span>
<span id="cb168-3"><a href="statistical-spatial-interpolation.html#cb168-3"></a>                     <span class="dt">krige =</span> <span class="kw">krige.control</span>(<span class="dt">trend.d =</span> <span class="st">&quot;1st&quot;</span>, </span>
<span id="cb168-4"><a href="statistical-spatial-interpolation.html#cb168-4"></a>                                           <span class="dt">trend.l =</span> <span class="st">&quot;1st&quot;</span>, </span>
<span id="cb168-5"><a href="statistical-spatial-interpolation.html#cb168-5"></a>                                           <span class="dt">obj.m =</span> wca.vm))  </span></code></pre></div>
<pre><code>## krige.conv: model with mean given by a 1st order polynomial on the coordinates
## krige.conv: Kriging performed using global neighbourhood</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="statistical-spatial-interpolation.html#cb170-1"></a><span class="kw">str</span>(wca.ks)</span></code></pre></div>
<pre><code>## List of 6
##  $ predict     : num [1:3721] 4033 3998 3964 3930 3899 ...
##  $ krige.var   : num [1:3721] 67964 66863 65821 64864 63918 ...
##  $ beta.est    : Named num [1:3] -23631 -400 -436
##   ..- attr(*, &quot;names&quot;)= chr [1:3] &quot;beta0&quot; &quot;beta1&quot; &quot;beta2&quot;
##  $ distribution: chr &quot;normal&quot;
##  $ message     : chr &quot;krige.conv: Kriging performed using global neighbourhood&quot;
##  $ call        : language krige.conv(geodata = wca.gdf, locations = pgrid.df, krige = krige.control(trend.d = &quot;1st&quot;,      trend.l = &quot;1st&quot;, | __truncated__
##  - attr(*, &quot;sp.dim&quot;)= chr &quot;2d&quot;
##  - attr(*, &quot;prediction.locations&quot;)= symbol pgrid.df
##  - attr(*, &quot;parent.env&quot;)=&lt;environment: R_GlobalEnv&gt; 
##  - attr(*, &quot;data.locations&quot;)= language wca.gdf$coords
##  - attr(*, &quot;class&quot;)= chr &quot;kriging&quot;</code></pre>
<p>The fitted values (<code>predict</code>) and the uncertainty (<code>krige.var</code>) are output as a vector of length 61 x 61 = 3721. The uncertainty is the standard deviation squared of the predicted value. Kriging performed using global neighborhood.</p>
<ol start="3" style="list-style-type: lower-alpha">
<li>Plot the results.</li>
</ol>
<p>First add the fitted and uncertainty values as columns to the <code>pgrid.df</code> data frame.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="statistical-spatial-interpolation.html#cb172-1"></a>pgrid.df<span class="op">$</span>height &lt;-<span class="st"> </span>wca.ks<span class="op">$</span>predict</span>
<span id="cb172-2"><a href="statistical-spatial-interpolation.html#cb172-2"></a>pgrid.df<span class="op">$</span>var &lt;-<span class="st"> </span>wca.ks<span class="op">$</span>krige.var</span></code></pre></div>
<p>Map the predicted values and the uncertainty values using <code>ggplot()</code>.</p>
<p>Start with the predicted values. Here we use the <code>geom_raster()</code> function.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="statistical-spatial-interpolation.html#cb173-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb173-2"><a href="statistical-spatial-interpolation.html#cb173-2"></a></span>
<span id="cb173-3"><a href="statistical-spatial-interpolation.html#cb173-3"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> pgrid.df, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb173-4"><a href="statistical-spatial-interpolation.html#cb173-4"></a><span class="st">  </span><span class="kw">geom_raster</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> height)) <span class="op">+</span></span>
<span id="cb173-5"><a href="statistical-spatial-interpolation.html#cb173-5"></a><span class="st">  </span><span class="kw">scale_fill_viridis_c</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-78-1.png" width="672" /></p>
<p>The map shows the predicted values as a combination of the spatial gradient and spatial autocorrelation.</p>
<p>Or use {tmap}. First convert the grid data frame to a spatial pixels data frame (S4 spatial object). Then convert the spatial pixels data frame to a raster.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="statistical-spatial-interpolation.html#cb174-1"></a><span class="kw">library</span>(sp)</span>
<span id="cb174-2"><a href="statistical-spatial-interpolation.html#cb174-2"></a>spdf &lt;-<span class="st"> </span>pgrid.df</span>
<span id="cb174-3"><a href="statistical-spatial-interpolation.html#cb174-3"></a><span class="kw">coordinates</span>(spdf) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>)</span>
<span id="cb174-4"><a href="statistical-spatial-interpolation.html#cb174-4"></a>spdf &lt;-<span class="st"> </span><span class="kw">as</span>(spdf, <span class="st">&quot;SpatialPixelsDataFrame&quot;</span>)</span>
<span id="cb174-5"><a href="statistical-spatial-interpolation.html#cb174-5"></a><span class="kw">proj4string</span>(spdf) &lt;-<span class="st"> </span><span class="kw">st_crs</span>(wca.sf)<span class="op">$</span>proj4string</span>
<span id="cb174-6"><a href="statistical-spatial-interpolation.html#cb174-6"></a></span>
<span id="cb174-7"><a href="statistical-spatial-interpolation.html#cb174-7"></a><span class="kw">library</span>(raster)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;raster&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:MASS&#39;:
## 
##     area, select</code></pre>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="statistical-spatial-interpolation.html#cb177-1"></a>r &lt;-<span class="st"> </span><span class="kw">raster</span>(spdf)</span>
<span id="cb177-2"><a href="statistical-spatial-interpolation.html#cb177-2"></a></span>
<span id="cb177-3"><a href="statistical-spatial-interpolation.html#cb177-3"></a><span class="kw">tm_shape</span>(r) <span class="op">+</span></span>
<span id="cb177-4"><a href="statistical-spatial-interpolation.html#cb177-4"></a><span class="st">  </span><span class="kw">tm_raster</span>(<span class="dt">n =</span> <span class="dv">9</span>) <span class="op">+</span></span>
<span id="cb177-5"><a href="statistical-spatial-interpolation.html#cb177-5"></a><span class="kw">tm_shape</span>(wca.sf) <span class="op">+</span></span>
<span id="cb177-6"><a href="statistical-spatial-interpolation.html#cb177-6"></a><span class="st">  </span><span class="kw">tm_text</span>(<span class="st">&quot;head&quot;</span>, <span class="dt">size =</span> <span class="fl">.5</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-79-1.png" width="672" /></p>
<p>Plot the uncertainty.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="statistical-spatial-interpolation.html#cb178-1"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> pgrid.df, <span class="kw">aes</span>(lon, lat)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb178-2"><a href="statistical-spatial-interpolation.html#cb178-2"></a><span class="st">  </span><span class="kw">geom_raster</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> var)) <span class="op">+</span></span>
<span id="cb178-3"><a href="statistical-spatial-interpolation.html#cb178-3"></a><span class="st">  </span><span class="kw">scale_fill_gradient</span>() <span class="op">+</span></span>
<span id="cb178-4"><a href="statistical-spatial-interpolation.html#cb178-4"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> wca.df, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat))</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<p>The map shows that the prediction variances are smallest in regions surrounding the observations. This makes sense since what we know about the field comes from the observations.</p>
</div>
<div id="step-5-evaluate-the-prediction" class="section level3" number="1.3.5">
<h3><span class="header-section-number">1.3.5</span> Step 5: Evaluate the prediction</h3>
<p>How do we evaluate how good the interpolated surface is? If we use the variogram model to predict at the observation locations, we will get the observed values back when the nugget is fixed at zero. So this is not helpful. Instead we use cross validation.</p>
<p>Cross validation is a procedure for assessing how well a model will do at predicting values when observations specific to the prediction are removed. The procedure first partitions the data into disjoint subsets. The model is then fit to one subset of the data (training set) and the model is validated on a different subset (testing set).</p>
<p>Leave-one-out cross validation uses all but one observation for fitting and the left-out observation for testing. The procedure is repeated with every observation taking turns in being left out.</p>
<p>K-fold cross validation uses K observations for fitting and N-K for testing. With large K there are many ways to slice the sample so the procedure is not exhaustive like hold-one-out.</p>
<p>With kriging, the data is used in two ways (1) to fit the variogram model, and (2) to interpolate the values. Thus cross validation has two cases: weak and strong. Weak cross validation uses the entire dataset to estimate the variogram model. Then kriging is performed N times using a leave-one-out strategy with the predicted value saved only for the observation left out.</p>
<p>The <code>xvalid()</code> function from the {geoR} package computes the cross-validated prediction error of the Wolfcamp aquifer interpolation in this weak sense.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="statistical-spatial-interpolation.html#cb179-1"></a>xv.wk &lt;-<span class="st"> </span><span class="kw">xvalid</span>(wca.gdf, <span class="dt">model =</span> wca.vm)</span></code></pre></div>
<pre><code>## xvalid: number of data locations       = 84
## xvalid: number of validation locations = 84
## xvalid: performing cross-validation at location ... 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 
## xvalid: end of cross-validation</code></pre>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="statistical-spatial-interpolation.html#cb181-1"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">observed =</span> xv.wk<span class="op">$</span>data, </span>
<span id="cb181-2"><a href="statistical-spatial-interpolation.html#cb181-2"></a>                 <span class="dt">predicted =</span> xv.wk<span class="op">$</span>predicted)</span>
<span id="cb181-3"><a href="statistical-spatial-interpolation.html#cb181-3"></a></span>
<span id="cb181-4"><a href="statistical-spatial-interpolation.html#cb181-4"></a><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(<span class="dt">x =</span> observed, <span class="dt">y =</span> predicted)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb181-5"><a href="statistical-spatial-interpolation.html#cb181-5"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb181-6"><a href="statistical-spatial-interpolation.html#cb181-6"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb181-7"><a href="statistical-spatial-interpolation.html#cb181-7"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> lm, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></span>
<span id="cb181-8"><a href="statistical-spatial-interpolation.html#cb181-8"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Predicted head heights (ft)&quot;</span>) <span class="op">+</span></span>
<span id="cb181-9"><a href="statistical-spatial-interpolation.html#cb181-9"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Observed head heights (ft)&quot;</span>) <span class="op">+</span></span>
<span id="cb181-10"><a href="statistical-spatial-interpolation.html#cb181-10"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Weak Cross Validation&quot;</span>) <span class="op">+</span></span>
<span id="cb181-11"><a href="statistical-spatial-interpolation.html#cb181-11"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-81-1.png" width="672" /></p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="statistical-spatial-interpolation.html#cb183-1"></a><span class="kw">mean</span>(xv.wk<span class="op">$</span>error<span class="op">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 30635.95</code></pre>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="statistical-spatial-interpolation.html#cb185-1"></a><span class="kw">mean</span>(<span class="kw">abs</span>(xv.wk<span class="op">$</span>error))</span></code></pre></div>
<pre><code>## [1] 136.9617</code></pre>
<p>The mean squared cross-validated prediction error is 30636 ft^2 and the mean absolute cross-validated prediction error is 137 ft.</p>
<p>Strong cross validation requires that the variogram be re-estimated each time an observation is removed. The model must be fit using the <code>variofit()</code> function and the call must include the empirical variogram object. This is done with the argument <code>reestimate = TRUE</code>.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="statistical-spatial-interpolation.html#cb187-1"></a>xv.st &lt;-<span class="st"> </span><span class="kw">xvalid</span>(wca.gdf, <span class="dt">model =</span> wca.vm,</span>
<span id="cb187-2"><a href="statistical-spatial-interpolation.html#cb187-2"></a>               <span class="dt">variog.obj =</span> wca.v,</span>
<span id="cb187-3"><a href="statistical-spatial-interpolation.html#cb187-3"></a>               <span class="dt">reestimate =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## xvalid: number of data locations       = 84
## xvalid: number of validation locations = 84
## xvalid: performing cross-validation at location ... 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 
## xvalid: end of cross-validation</code></pre>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="statistical-spatial-interpolation.html#cb189-1"></a>df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">observed =</span> xv.st<span class="op">$</span>data, </span>
<span id="cb189-2"><a href="statistical-spatial-interpolation.html#cb189-2"></a>                 <span class="dt">predicted =</span> xv.st<span class="op">$</span>predicted)</span>
<span id="cb189-3"><a href="statistical-spatial-interpolation.html#cb189-3"></a></span>
<span id="cb189-4"><a href="statistical-spatial-interpolation.html#cb189-4"></a><span class="kw">mean</span>(xv.st<span class="op">$</span>error<span class="op">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 31606.59</code></pre>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="statistical-spatial-interpolation.html#cb191-1"></a><span class="kw">mean</span>(<span class="kw">abs</span>(xv.st<span class="op">$</span>error))</span></code></pre></div>
<pre><code>## [1] 139.0616</code></pre>
<p>Strong cross validation will result in an error estimate that is larger than the error estimate from a weak cross validation.</p>
</div>
</div>
<div id="example-2-april-temperatures-in-the-midwest" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Example 2: April temperatures in the Midwest</h2>
<p>The data in <code>MidwestTemps.txt</code> are average temperatures in and around the state of Iowa for the month of April. The goal is a spatial interpolation of these values onto a 56 by 35 grid.</p>
<div id="step-1-examine-the-data-for-spatial-trends-and-normality" class="section level3" number="1.4.1">
<h3><span class="header-section-number">1.4.1</span> Step 1: Examine the data for spatial trends and normality</h3>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="statistical-spatial-interpolation.html#cb193-1"></a>L &lt;-<span class="st"> &quot;http://myweb.fsu.edu/jelsner/temp/data/MidwestTemps.txt&quot;</span></span>
<span id="cb193-2"><a href="statistical-spatial-interpolation.html#cb193-2"></a>t.df &lt;-<span class="st"> </span><span class="kw">read.table</span>(L, <span class="dt">header =</span> <span class="ot">TRUE</span>)</span>
<span id="cb193-3"><a href="statistical-spatial-interpolation.html#cb193-3"></a><span class="kw">summary</span>(t.df)</span></code></pre></div>
<pre><code>##       lon              lat             temp      
##  Min.   :-98.47   Min.   :38.59   Min.   :41.50  
##  1st Qu.:-96.22   1st Qu.:40.22   1st Qu.:47.15  
##  Median :-93.72   Median :41.55   Median :51.30  
##  Mean   :-93.62   Mean   :41.77   Mean   :50.61  
##  3rd Qu.:-90.77   3rd Qu.:43.36   3rd Qu.:53.85  
##  Max.   :-88.55   Max.   :45.46   Max.   :58.60</code></pre>
<p>Map the values.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="statistical-spatial-interpolation.html#cb195-1"></a>t.sf &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(<span class="dt">x =</span> t.df, </span>
<span id="cb195-2"><a href="statistical-spatial-interpolation.html#cb195-2"></a>                 <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>),</span>
<span id="cb195-3"><a href="statistical-spatial-interpolation.html#cb195-3"></a>                 <span class="dt">crs =</span> <span class="st">&quot;+proj=longlat +datum=WGS84&quot;</span>)</span>
<span id="cb195-4"><a href="statistical-spatial-interpolation.html#cb195-4"></a></span>
<span id="cb195-5"><a href="statistical-spatial-interpolation.html#cb195-5"></a><span class="kw">tm_shape</span>(t.sf) <span class="op">+</span></span>
<span id="cb195-6"><a href="statistical-spatial-interpolation.html#cb195-6"></a><span class="st">  </span><span class="kw">tm_text</span>(<span class="dt">text =</span> <span class="st">&quot;temp&quot;</span>, <span class="dt">size =</span> <span class="fl">.6</span>) <span class="op">+</span></span>
<span id="cb195-7"><a href="statistical-spatial-interpolation.html#cb195-7"></a><span class="kw">tm_shape</span>(sts) <span class="op">+</span></span>
<span id="cb195-8"><a href="statistical-spatial-interpolation.html#cb195-8"></a><span class="st">  </span><span class="kw">tm_borders</span>() </span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-84-1.png" width="672" /></p>
<p>Create a <code>geodata</code> object from the data frame.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="statistical-spatial-interpolation.html#cb196-1"></a>t.gdf &lt;-<span class="st"> </span><span class="kw">as.geodata</span>(t.df)</span>
<span id="cb196-2"><a href="statistical-spatial-interpolation.html#cb196-2"></a><span class="kw">summary</span>(t.gdf)</span></code></pre></div>
<pre><code>## Number of data points: 131 
## 
## Coordinates summary
##        lon   lat
## min -98.47 38.59
## max -88.55 45.46
## 
## Distance summary
##        min        max 
##  0.1004988 11.5354237 
## 
## Data summary
##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## 41.50000 47.15000 51.30000 50.61298 53.85000 58.60000</code></pre>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="statistical-spatial-interpolation.html#cb198-1"></a><span class="kw">plot</span>(t.gdf)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-85-1.png" width="672" /></p>
<p>The maximum pairwise distance is 11.5 degrees. There is a pronounced 1st order trend in the north/south direction as we might expect with air temperatures.</p>
<p>Remove the trend and examine the residuals.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="statistical-spatial-interpolation.html#cb199-1"></a><span class="kw">plot</span>(t.gdf, <span class="dt">trend =</span> <span class="st">&quot;1st&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-86-1.png" width="672" /></p>
<p>There is some evidence of a 2nd-order trend in the west-east direction.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="statistical-spatial-interpolation.html#cb200-1"></a><span class="kw">plot</span>(t.gdf, <span class="dt">trend =</span> <span class="st">&quot;2nd&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-87-1.png" width="672" /></p>
<p>By specifying a higher order trend, the lower order trends are taken care of. The distribution of residuals is approximately normal as we might expect. The data are monthly means.</p>
</div>
<div id="step-2-compute-empirical-variograms-2" class="section level3" number="1.4.2">
<h3><span class="header-section-number">1.4.2</span> Step 2: Compute empirical variograms</h3>
<p>Check for anisotropy by plotting directional variograms.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="statistical-spatial-interpolation.html#cb201-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb201-2"><a href="statistical-spatial-interpolation.html#cb201-2"></a><span class="kw">plot</span>(<span class="kw">variog4</span>(t.gdf, <span class="dt">trend =</span> <span class="st">&quot;2nd&quot;</span>, </span>
<span id="cb201-3"><a href="statistical-spatial-interpolation.html#cb201-3"></a>             <span class="dt">max.dist =</span> <span class="fl">5.5</span>), </span>
<span id="cb201-4"><a href="statistical-spatial-interpolation.html#cb201-4"></a>     <span class="dt">omni =</span> <span class="ot">TRUE</span>, <span class="dt">legend =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## variog: computing variogram for direction = 0 degrees (0 radians)
##         tolerance angle = 22.5 degrees (0.393 radians)
## variog: computing variogram for direction = 45 degrees (0.785 radians)
##         tolerance angle = 22.5 degrees (0.393 radians)
## variog: computing variogram for direction = 90 degrees (1.571 radians)
##         tolerance angle = 22.5 degrees (0.393 radians)
## variog: computing variogram for direction = 135 degrees (2.356 radians)
##         tolerance angle = 22.5 degrees (0.393 radians)
## variog: computing omnidirectional variogram</code></pre>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-88-1.png" width="672" /></p>
<p>There is no strong evidence to reject isotropy.</p>
</div>
<div id="step-3-fit-a-variogram-model-to-the-data" class="section level3" number="1.4.3">
<h3><span class="header-section-number">1.4.3</span> Step 3: Fit a variogram model to the data</h3>
<p>Here we consider several likelihood fits to an exponential model and examine the AIC for final parameter selection.</p>
<p>The AIC is used as a selection criterion and is a function of the maximized likelihood function but includes a penalty for model complexity that favors simpler models. Recall the best fit has the largest log-likelihood and smallest AIC.</p>
<p>Set initial values for the sill and range. From the variograms start with 3 for the sill and 4 for the range.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="statistical-spatial-interpolation.html#cb203-1"></a>iv &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>)  </span>
<span id="cb203-2"><a href="statistical-spatial-interpolation.html#cb203-2"></a><span class="kw">summary</span>(<span class="kw">likfit</span>(t.gdf, </span>
<span id="cb203-3"><a href="statistical-spatial-interpolation.html#cb203-3"></a>               <span class="dt">ini =</span> iv, </span>
<span id="cb203-4"><a href="statistical-spatial-interpolation.html#cb203-4"></a>               <span class="dt">cov.model =</span> <span class="st">&quot;exp&quot;</span>, </span>
<span id="cb203-5"><a href="statistical-spatial-interpolation.html#cb203-5"></a>               <span class="dt">trend =</span> <span class="st">&quot;2nd&quot;</span>,</span>
<span id="cb203-6"><a href="statistical-spatial-interpolation.html#cb203-6"></a>               <span class="dt">fix.nug =</span> <span class="ot">TRUE</span>, </span>
<span id="cb203-7"><a href="statistical-spatial-interpolation.html#cb203-7"></a>               <span class="dt">message =</span> <span class="ot">FALSE</span>))<span class="op">$</span>likelihood<span class="op">$</span>AIC</span></code></pre></div>
<pre><code>## [1] 469.2366</code></pre>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="statistical-spatial-interpolation.html#cb205-1"></a><span class="kw">summary</span>(<span class="kw">likfit</span>(t.gdf, </span>
<span id="cb205-2"><a href="statistical-spatial-interpolation.html#cb205-2"></a>               <span class="dt">ini =</span> iv, </span>
<span id="cb205-3"><a href="statistical-spatial-interpolation.html#cb205-3"></a>               <span class="dt">cov.model =</span> <span class="st">&quot;exp&quot;</span>, </span>
<span id="cb205-4"><a href="statistical-spatial-interpolation.html#cb205-4"></a>               <span class="dt">trend =</span> <span class="st">&quot;2nd&quot;</span>,</span>
<span id="cb205-5"><a href="statistical-spatial-interpolation.html#cb205-5"></a>               <span class="dt">fix.nug =</span> <span class="ot">FALSE</span>, </span>
<span id="cb205-6"><a href="statistical-spatial-interpolation.html#cb205-6"></a>               <span class="dt">message =</span> <span class="ot">FALSE</span>))<span class="op">$</span>likelihood<span class="op">$</span>AIC</span></code></pre></div>
<pre><code>## [1] 471.2366</code></pre>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="statistical-spatial-interpolation.html#cb207-1"></a><span class="kw">summary</span>(<span class="kw">likfit</span>(t.gdf, <span class="dt">ini =</span> iv, </span>
<span id="cb207-2"><a href="statistical-spatial-interpolation.html#cb207-2"></a>               <span class="dt">cov.model =</span> <span class="st">&quot;sph&quot;</span>, </span>
<span id="cb207-3"><a href="statistical-spatial-interpolation.html#cb207-3"></a>               <span class="dt">trend =</span> <span class="st">&quot;2nd&quot;</span>,</span>
<span id="cb207-4"><a href="statistical-spatial-interpolation.html#cb207-4"></a>               <span class="dt">fix.nug =</span> <span class="ot">TRUE</span>, </span>
<span id="cb207-5"><a href="statistical-spatial-interpolation.html#cb207-5"></a>               <span class="dt">message =</span> <span class="ot">FALSE</span>))<span class="op">$</span>likelihood<span class="op">$</span>AIC</span></code></pre></div>
<pre><code>## [1] 494.8665</code></pre>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="statistical-spatial-interpolation.html#cb209-1"></a><span class="kw">summary</span>(<span class="kw">likfit</span>(t.gdf, <span class="dt">ini =</span> iv, </span>
<span id="cb209-2"><a href="statistical-spatial-interpolation.html#cb209-2"></a>               <span class="dt">cov.model =</span> <span class="st">&quot;sph&quot;</span>, </span>
<span id="cb209-3"><a href="statistical-spatial-interpolation.html#cb209-3"></a>               <span class="dt">trend =</span> <span class="st">&quot;2nd&quot;</span>,</span>
<span id="cb209-4"><a href="statistical-spatial-interpolation.html#cb209-4"></a>               <span class="dt">fix.nug =</span> <span class="ot">FALSE</span>, </span>
<span id="cb209-5"><a href="statistical-spatial-interpolation.html#cb209-5"></a>               <span class="dt">message =</span> <span class="ot">FALSE</span>))<span class="op">$</span>likelihood<span class="op">$</span>AIC</span></code></pre></div>
<pre><code>## [1] 469.5015</code></pre>
<p>It appears that a good variogram model would be on the residuals of a 2nd order trend using an exponential function with fixed nugget equal to zero. A spherical function with a nugget is also a reasonable model.</p>
<p>To obtain the model parameters, type</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="statistical-spatial-interpolation.html#cb211-1"></a><span class="kw">likfit</span>(t.gdf, <span class="dt">ini =</span> iv, <span class="dt">cov.model =</span> <span class="st">&quot;exp&quot;</span>, </span>
<span id="cb211-2"><a href="statistical-spatial-interpolation.html#cb211-2"></a>       <span class="dt">trend =</span> <span class="st">&quot;2nd&quot;</span>, <span class="dt">fix.nug =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## kappa not used for the exponential correlation function
## ---------------------------------------------------------------
## likfit: likelihood maximisation using the function optimize.
## likfit: Use control() to pass additional
##          arguments for the maximisation function.
##         For further details see documentation for optimize.
## likfit: It is highly advisable to run this function several
##         times with different initial values for the parameters.
## likfit: WARNING: This step can be time demanding!
## ---------------------------------------------------------------
## likfit: end of numerical maximisation.</code></pre>
<pre><code>## likfit: estimated model parameters:
##      beta0      beta1      beta2      beta3      beta4      beta5    sigmasq 
## &quot;599.2478&quot; &quot; 14.8990&quot; &quot;  8.5793&quot; &quot;  0.0811&quot; &quot; -0.1224&quot; &quot;  0.0025&quot; &quot;  2.1140&quot; 
##        phi 
## &quot;  0.4139&quot; 
## Practical Range with cor=0.05 for asymptotic range: 1.239984
## 
## likfit: maximised log-likelihood = -226.6</code></pre>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="statistical-spatial-interpolation.html#cb214-1"></a><span class="kw">likfit</span>(t.gdf, <span class="dt">ini =</span> iv, <span class="dt">cov.model =</span> <span class="st">&quot;sph&quot;</span>, </span>
<span id="cb214-2"><a href="statistical-spatial-interpolation.html#cb214-2"></a>       <span class="dt">trend =</span> <span class="st">&quot;2nd&quot;</span>, <span class="dt">fix.nug =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## kappa not used for the spherical correlation function
## ---------------------------------------------------------------
## likfit: likelihood maximisation using the function optim.
## likfit: Use control() to pass additional
##          arguments for the maximisation function.
##         For further details see documentation for optim.
## likfit: It is highly advisable to run this function several
##         times with different initial values for the parameters.
## likfit: WARNING: This step can be time demanding!
## ---------------------------------------------------------------
## likfit: end of numerical maximisation.</code></pre>
<pre><code>## likfit: estimated model parameters:
##      beta0      beta1      beta2      beta3      beta4      beta5      tausq 
## &quot;600.7907&quot; &quot; 14.9147&quot; &quot;  8.5701&quot; &quot;  0.0810&quot; &quot; -0.1230&quot; &quot;  0.0020&quot; &quot;  0.5032&quot; 
##    sigmasq        phi 
## &quot;  1.6381&quot; &quot;  1.3071&quot; 
## Practical Range with cor=0.05 for asymptotic range: 1.307142
## 
## likfit: maximised log-likelihood = -225.8</code></pre>
<p>Plot the competing models on the empirical variogram.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="statistical-spatial-interpolation.html#cb217-1"></a><span class="kw">plot</span>(<span class="kw">variog</span>(t.gdf, <span class="dt">trend =</span> <span class="st">&quot;2nd&quot;</span>, </span>
<span id="cb217-2"><a href="statistical-spatial-interpolation.html#cb217-2"></a>            <span class="dt">uvec =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">5.5</span>, <span class="dt">l =</span> <span class="dv">29</span>)))</span></code></pre></div>
<pre><code>## variog: computing omnidirectional variogram</code></pre>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="statistical-spatial-interpolation.html#cb219-1"></a><span class="kw">lines.variomodel</span>(<span class="dt">cov.model =</span> <span class="st">&quot;exp&quot;</span>, </span>
<span id="cb219-2"><a href="statistical-spatial-interpolation.html#cb219-2"></a>                 <span class="dt">cov.pars =</span> <span class="kw">c</span>(<span class="fl">2.114</span>, <span class="fl">.4139</span>), </span>
<span id="cb219-3"><a href="statistical-spatial-interpolation.html#cb219-3"></a>                 <span class="dt">nug =</span> <span class="dv">0</span>, <span class="dt">max.dist =</span> <span class="fl">5.5</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb219-4"><a href="statistical-spatial-interpolation.html#cb219-4"></a><span class="kw">lines.variomodel</span>(<span class="dt">cov.model =</span> <span class="st">&quot;sph&quot;</span>, </span>
<span id="cb219-5"><a href="statistical-spatial-interpolation.html#cb219-5"></a>                 <span class="dt">cov.pars =</span> <span class="kw">c</span>(<span class="fl">1.638</span>, <span class="fl">1.307</span>),</span>
<span id="cb219-6"><a href="statistical-spatial-interpolation.html#cb219-6"></a>                 <span class="dt">nug =</span>.<span class="dv">5</span>, <span class="dt">max.dist =</span> <span class="fl">5.5</span>, <span class="dt">col =</span> <span class="st">&quot;green&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-91-1.png" width="672" /></p>
<p>Save the models.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="statistical-spatial-interpolation.html#cb220-1"></a>modelE &lt;-<span class="st"> </span><span class="kw">likfit</span>(t.gdf, <span class="dt">ini =</span> iv, <span class="dt">cov.model =</span> <span class="st">&quot;exp&quot;</span>, </span>
<span id="cb220-2"><a href="statistical-spatial-interpolation.html#cb220-2"></a>                  <span class="dt">trend =</span> <span class="st">&quot;2nd&quot;</span>, <span class="dt">fix.nug =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## kappa not used for the exponential correlation function
## ---------------------------------------------------------------
## likfit: likelihood maximisation using the function optimize.
## likfit: Use control() to pass additional
##          arguments for the maximisation function.
##         For further details see documentation for optimize.
## likfit: It is highly advisable to run this function several
##         times with different initial values for the parameters.
## likfit: WARNING: This step can be time demanding!
## ---------------------------------------------------------------
## likfit: end of numerical maximisation.</code></pre>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="statistical-spatial-interpolation.html#cb222-1"></a>modelS &lt;-<span class="st"> </span><span class="kw">likfit</span>(t.gdf, <span class="dt">ini =</span> iv, <span class="dt">cov.model =</span> <span class="st">&quot;sph&quot;</span>, </span>
<span id="cb222-2"><a href="statistical-spatial-interpolation.html#cb222-2"></a>                  <span class="dt">trend =</span> <span class="st">&quot;2nd&quot;</span>, <span class="dt">fix.nug =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## kappa not used for the spherical correlation function
## ---------------------------------------------------------------
## likfit: likelihood maximisation using the function optim.
## likfit: Use control() to pass additional
##          arguments for the maximisation function.
##         For further details see documentation for optim.
## likfit: It is highly advisable to run this function several
##         times with different initial values for the parameters.
## likfit: WARNING: This step can be time demanding!
## ---------------------------------------------------------------
## likfit: end of numerical maximisation.</code></pre>
</div>
<div id="step-4-create-an-interpolated-surface" class="section level3" number="1.4.4">
<h3><span class="header-section-number">1.4.4</span> Step 4: Create an interpolated surface</h3>
<p>We create a grid of locations at which we want the temperatures to be interpolated. Here we use the <code>expand.grid</code> function where the arguments are the sequence of longitudes and latitudes, respectively. We then use the <code>krige.conv()</code> function to interpolate the values to the grid. We save the interpolation in <code>kcE</code> when we use the exponential variogram model to weight the observations and save the interpolation in <code>kcS</code> when we use the spherical model to weight the observations.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="statistical-spatial-interpolation.html#cb224-1"></a>pgrid.df&lt;-<span class="st"> </span><span class="kw">expand.grid</span>(<span class="dt">lon =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">99</span>, <span class="dv">-88</span>, <span class="dt">l =</span> <span class="dv">224</span>), </span>
<span id="cb224-2"><a href="statistical-spatial-interpolation.html#cb224-2"></a>                       <span class="dt">lat =</span> <span class="kw">seq</span>(<span class="fl">38.4</span>, <span class="fl">45.4</span>, <span class="dt">l =</span> <span class="dv">136</span>))</span>
<span id="cb224-3"><a href="statistical-spatial-interpolation.html#cb224-3"></a>kcE &lt;-<span class="st"> </span><span class="kw">krige.conv</span>(t.gdf, </span>
<span id="cb224-4"><a href="statistical-spatial-interpolation.html#cb224-4"></a>                  <span class="dt">loc =</span> pgrid.df, </span>
<span id="cb224-5"><a href="statistical-spatial-interpolation.html#cb224-5"></a>                  <span class="dt">krige =</span> <span class="kw">krige.control</span>(<span class="dt">trend.d =</span> <span class="st">&quot;2nd&quot;</span>, </span>
<span id="cb224-6"><a href="statistical-spatial-interpolation.html#cb224-6"></a>                                       <span class="dt">trend.l =</span> <span class="st">&quot;2nd&quot;</span>,</span>
<span id="cb224-7"><a href="statistical-spatial-interpolation.html#cb224-7"></a>                                       <span class="dt">obj.m =</span> modelE))</span></code></pre></div>
<pre><code>## krige.conv: model with mean given by a 2nd order polynomial on the coordinates
## krige.conv: Kriging performed using global neighbourhood</code></pre>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="statistical-spatial-interpolation.html#cb226-1"></a>kcS &lt;-<span class="st"> </span><span class="kw">krige.conv</span>(t.gdf, </span>
<span id="cb226-2"><a href="statistical-spatial-interpolation.html#cb226-2"></a>                  <span class="dt">loc =</span> pgrid.df,</span>
<span id="cb226-3"><a href="statistical-spatial-interpolation.html#cb226-3"></a>                  <span class="dt">krige =</span> <span class="kw">krige.control</span>(<span class="dt">trend.d =</span> <span class="st">&quot;2nd&quot;</span>, </span>
<span id="cb226-4"><a href="statistical-spatial-interpolation.html#cb226-4"></a>                                       <span class="dt">trend.l =</span> <span class="st">&quot;2nd&quot;</span>,</span>
<span id="cb226-5"><a href="statistical-spatial-interpolation.html#cb226-5"></a>                                       <span class="dt">obj.m =</span> modelS))</span></code></pre></div>
<pre><code>## krige.conv: model with mean given by a 2nd order polynomial on the coordinates
## krige.conv: Kriging performed using global neighbourhood</code></pre>
<p>Plot the interpolated surface generated using the exponential variogram. function.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="statistical-spatial-interpolation.html#cb228-1"></a>pgrid.df<span class="op">$</span>temp &lt;-<span class="st"> </span>kcE<span class="op">$</span>predict</span>
<span id="cb228-2"><a href="statistical-spatial-interpolation.html#cb228-2"></a>pgrid.df<span class="op">$</span>var &lt;-<span class="st"> </span>kcE<span class="op">$</span>krige.var</span>
<span id="cb228-3"><a href="statistical-spatial-interpolation.html#cb228-3"></a></span>
<span id="cb228-4"><a href="statistical-spatial-interpolation.html#cb228-4"></a>spdf &lt;-<span class="st"> </span>pgrid.df</span>
<span id="cb228-5"><a href="statistical-spatial-interpolation.html#cb228-5"></a><span class="kw">coordinates</span>(spdf) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>)</span>
<span id="cb228-6"><a href="statistical-spatial-interpolation.html#cb228-6"></a>spdf &lt;-<span class="st"> </span><span class="kw">as</span>(spdf, <span class="st">&quot;SpatialPixelsDataFrame&quot;</span>)</span>
<span id="cb228-7"><a href="statistical-spatial-interpolation.html#cb228-7"></a><span class="kw">proj4string</span>(spdf) &lt;-<span class="st"> </span><span class="kw">st_crs</span>(t.sf)<span class="op">$</span>proj4string</span>
<span id="cb228-8"><a href="statistical-spatial-interpolation.html#cb228-8"></a></span>
<span id="cb228-9"><a href="statistical-spatial-interpolation.html#cb228-9"></a><span class="kw">library</span>(raster)</span>
<span id="cb228-10"><a href="statistical-spatial-interpolation.html#cb228-10"></a>r &lt;-<span class="st"> </span><span class="kw">raster</span>(spdf)</span>
<span id="cb228-11"><a href="statistical-spatial-interpolation.html#cb228-11"></a></span>
<span id="cb228-12"><a href="statistical-spatial-interpolation.html#cb228-12"></a><span class="kw">tm_shape</span>(r) <span class="op">+</span></span>
<span id="cb228-13"><a href="statistical-spatial-interpolation.html#cb228-13"></a><span class="st">  </span><span class="kw">tm_raster</span>(<span class="dt">n =</span> <span class="dv">9</span>, <span class="dt">palette =</span> <span class="st">&quot;OrRd&quot;</span>) <span class="op">+</span></span>
<span id="cb228-14"><a href="statistical-spatial-interpolation.html#cb228-14"></a><span class="kw">tm_shape</span>(sts) <span class="op">+</span></span>
<span id="cb228-15"><a href="statistical-spatial-interpolation.html#cb228-15"></a><span class="st">  </span><span class="kw">tm_borders</span>() <span class="op">+</span></span>
<span id="cb228-16"><a href="statistical-spatial-interpolation.html#cb228-16"></a><span class="kw">tm_shape</span>(t.sf) <span class="op">+</span></span>
<span id="cb228-17"><a href="statistical-spatial-interpolation.html#cb228-17"></a><span class="st">  </span><span class="kw">tm_text</span>(<span class="st">&quot;temp&quot;</span>, <span class="dt">size =</span> <span class="fl">.5</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-94-1.png" width="672" /></p>
<p>Plot the interpolated surface generated using the spherical variogram.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="statistical-spatial-interpolation.html#cb229-1"></a>pgrid.df<span class="op">$</span>temp &lt;-<span class="st"> </span>kcS<span class="op">$</span>predict</span>
<span id="cb229-2"><a href="statistical-spatial-interpolation.html#cb229-2"></a>pgrid.df<span class="op">$</span>var &lt;-<span class="st"> </span>kcS<span class="op">$</span>krige.var</span>
<span id="cb229-3"><a href="statistical-spatial-interpolation.html#cb229-3"></a></span>
<span id="cb229-4"><a href="statistical-spatial-interpolation.html#cb229-4"></a>spdf &lt;-<span class="st"> </span>pgrid.df</span>
<span id="cb229-5"><a href="statistical-spatial-interpolation.html#cb229-5"></a><span class="kw">coordinates</span>(spdf) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>)</span>
<span id="cb229-6"><a href="statistical-spatial-interpolation.html#cb229-6"></a>spdf &lt;-<span class="st"> </span><span class="kw">as</span>(spdf, <span class="st">&quot;SpatialPixelsDataFrame&quot;</span>)</span>
<span id="cb229-7"><a href="statistical-spatial-interpolation.html#cb229-7"></a><span class="kw">proj4string</span>(spdf) &lt;-<span class="st"> </span><span class="kw">st_crs</span>(t.sf)<span class="op">$</span>proj4string</span>
<span id="cb229-8"><a href="statistical-spatial-interpolation.html#cb229-8"></a></span>
<span id="cb229-9"><a href="statistical-spatial-interpolation.html#cb229-9"></a><span class="kw">library</span>(raster)</span>
<span id="cb229-10"><a href="statistical-spatial-interpolation.html#cb229-10"></a>r &lt;-<span class="st"> </span><span class="kw">raster</span>(spdf)</span>
<span id="cb229-11"><a href="statistical-spatial-interpolation.html#cb229-11"></a></span>
<span id="cb229-12"><a href="statistical-spatial-interpolation.html#cb229-12"></a><span class="kw">tm_shape</span>(r) <span class="op">+</span></span>
<span id="cb229-13"><a href="statistical-spatial-interpolation.html#cb229-13"></a><span class="st">  </span><span class="kw">tm_raster</span>(<span class="dt">n =</span> <span class="dv">9</span>, <span class="dt">palette =</span> <span class="st">&quot;OrRd&quot;</span>) <span class="op">+</span></span>
<span id="cb229-14"><a href="statistical-spatial-interpolation.html#cb229-14"></a><span class="kw">tm_shape</span>(sts) <span class="op">+</span></span>
<span id="cb229-15"><a href="statistical-spatial-interpolation.html#cb229-15"></a><span class="st">  </span><span class="kw">tm_borders</span>() <span class="op">+</span></span>
<span id="cb229-16"><a href="statistical-spatial-interpolation.html#cb229-16"></a><span class="kw">tm_shape</span>(t.sf) <span class="op">+</span></span>
<span id="cb229-17"><a href="statistical-spatial-interpolation.html#cb229-17"></a><span class="st">  </span><span class="kw">tm_text</span>(<span class="st">&quot;temp&quot;</span>, <span class="dt">size =</span> <span class="fl">.5</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-95-1.png" width="672" /></p>
<p>The model with a non-zero nugget is smoother. The greater the nugget relative to the sill (relative nugget effect), the smoother the interpolation.</p>
</div>
</div>
<div id="synthetic-data" class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> Synthetic data</h2>
<p>Synthetic data are useful as input to a deterministic model. An example is rainfall as input to spatially-distributed rainfall-runoff model. Interpolated values of precipitation and their variances might be of little value, but running the rainfall-runoff model with a large number of simulated rainfall fields can give a realistic assessment of the uncertainty in runoff arising from the variability in the rainfall.</p>
<p>The <code>grf()</code> function in the {geoR} package generates synthetic data from Gaussian random fields on regular or irregular sets of locations. For example, to generate 100 randomly spaced points with values at the points being a sample from a Gaussian random field with an exponential variogram (default with zero nugget) having a sill of 1 and a range of .25, type</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="statistical-spatial-interpolation.html#cb230-1"></a><span class="kw">set.seed</span>(<span class="dv">3042</span>)</span>
<span id="cb230-2"><a href="statistical-spatial-interpolation.html#cb230-2"></a>sim1 &lt;-<span class="st"> </span><span class="kw">grf</span>(<span class="dv">100</span>, <span class="dt">cov.pars =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">.25</span>))</span></code></pre></div>
<pre><code>## grf: simulation(s) on randomly chosen locations with  100  points
## grf: process with  1  covariance structure(s)
## grf: nugget effect is: tausq= 0 
## grf: covariance model 1 is: exponential(sigmasq=1, phi=0.25)
## grf: decomposition algorithm used is:  cholesky 
## grf: End of simulation procedure. Number of realizations: 1</code></pre>
<p>Plot the points and the variograms.</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="statistical-spatial-interpolation.html#cb232-1"></a><span class="kw">layout</span>(<span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">byrow =</span> <span class="ot">TRUE</span>, <span class="dt">ncol =</span> <span class="dv">2</span>), </span>
<span id="cb232-2"><a href="statistical-spatial-interpolation.html#cb232-2"></a>       <span class="dt">respect =</span> <span class="ot">TRUE</span>)</span>
<span id="cb232-3"><a href="statistical-spatial-interpolation.html#cb232-3"></a><span class="kw">points.geodata</span>(sim1, </span>
<span id="cb232-4"><a href="statistical-spatial-interpolation.html#cb232-4"></a>               <span class="dt">main =</span> <span class="st">&quot;simulated locations and values&quot;</span>)</span>
<span id="cb232-5"><a href="statistical-spatial-interpolation.html#cb232-5"></a><span class="kw">plot</span>(sim1, <span class="dt">max.dist =</span> <span class="fl">.5</span>, </span>
<span id="cb232-6"><a href="statistical-spatial-interpolation.html#cb232-6"></a>     <span class="dt">main =</span> <span class="st">&quot;true and empirical variograms&quot;</span>)</span></code></pre></div>
<pre><code>## variog: computing omnidirectional variogram</code></pre>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-97-1.png" width="672" /></p>
<p>The random fields can be put on a regular grid.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="statistical-spatial-interpolation.html#cb234-1"></a>sim2 &lt;-<span class="st"> </span><span class="kw">grf</span>(<span class="dv">441</span>, <span class="dt">grid =</span> <span class="st">&quot;reg&quot;</span>, <span class="dt">cov.pars =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">.25</span>))</span></code></pre></div>
<pre><code>## grf: generating grid  21  *  21  with  441  points
## grf: process with  1  covariance structure(s)
## grf: nugget effect is: tausq= 0 
## grf: covariance model 1 is: exponential(sigmasq=1, phi=0.25)
## grf: decomposition algorithm used is:  cholesky 
## grf: End of simulation procedure. Number of realizations: 1</code></pre>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="statistical-spatial-interpolation.html#cb236-1"></a><span class="kw">image</span>(sim2, <span class="dt">col =</span> <span class="kw">gray</span>(<span class="kw">seq</span>(<span class="dv">1</span>, <span class="fl">.1</span>, <span class="dt">l =</span> <span class="dv">30</span>)))</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-98-1.png" width="672" /></p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="statistical-spatial-interpolation.html#cb237-1"></a>sim3 &lt;-<span class="st"> </span><span class="kw">grf</span>(<span class="dv">4441</span>, <span class="dt">grid =</span> <span class="st">&quot;reg&quot;</span>, <span class="dt">cov.pars =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">.25</span>))</span></code></pre></div>
<pre><code>## grf: generating grid  67  *  67  with  4489  points
## grf: process with  1  covariance structure(s)
## grf: nugget effect is: tausq= 0 
## grf: covariance model 1 is: exponential(sigmasq=1, phi=0.25)
## grf: simulation using the function GaussRF from package RandomFields 
## grf: End of simulation procedure. Number of realizations: 1</code></pre>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="statistical-spatial-interpolation.html#cb239-1"></a><span class="kw">image</span>(sim3, <span class="dt">col =</span> <span class="kw">gray</span>(<span class="kw">seq</span>(<span class="dv">1</span>, <span class="fl">.1</span>, <span class="dt">l =</span> <span class="dv">30</span>)))</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-98-2.png" width="672" /></p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="statistical-spatial-interpolation.html#cb240-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code></pre></div>
<p>For an even higher resolution simulation it is necessary to have the {RandomFields} package.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="statistical-spatial-interpolation.html#cb241-1"></a><span class="kw">library</span>(RandomFields)</span>
<span id="cb241-2"><a href="statistical-spatial-interpolation.html#cb241-2"></a>sim4 &lt;-<span class="st"> </span><span class="kw">grf</span>(<span class="dv">40401</span>, <span class="dt">grid =</span> <span class="st">&quot;reg&quot;</span>, <span class="dt">cov.pars =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="fl">.2</span>))</span>
<span id="cb241-3"><a href="statistical-spatial-interpolation.html#cb241-3"></a><span class="kw">image</span>(sim4, <span class="dt">main =</span> <span class="st">&quot;simulation on a fine grid&quot;</span>, </span>
<span id="cb241-4"><a href="statistical-spatial-interpolation.html#cb241-4"></a>      <span class="dt">col =</span> <span class="kw">gray</span>(<span class="kw">seq</span>(<span class="dv">1</span>, <span class="fl">.1</span>, <span class="dt">l =</span> <span class="dv">30</span>)))</span></code></pre></div>
</div>
<div id="challenge-problem" class="section level2" number="1.6">
<h2><span class="header-section-number">1.6</span> Challenge problem</h2>
<p>Consider the data set <code>parana</code> from the {geoR} package containing rainfall values from the state of Paran`a. The data are average rainfall (mm) over the period May-June.</p>
<ol style="list-style-type: decimal">
<li>Plot the values. Plot the residuals after a 1st order trend is removed.</li>
<li>Compute and plot an empirical variogram on the residuals after removing the 1st-order trend. Check for anisotropy.</li>
<li>Fit a variogram model from the gaussian family to the empirical variogram. Assume isotropy. Set the initial values of the nugget to 500, the partial sill to 800 and the range to 100. Plot the modeled variogram on top of the empirical variogram.</li>
<li>Create a kriged surface by interpolating the rainfall values to locations on a regular grid. Use the <code>pred_grid(parana$borders, by = 2)</code> function to generate the grid.</li>
<li>Plot the interpolated surface. Note this can be done with the <code>image()</code> function. Use <code>col = rev(terrain.colors(21))</code>.</li>
<li>Compute the cross-validated prediction errors assuming a constant variogram model. Plot the observed versus predicted values as a scatter plot. Include the best fit line and the y = x line.</li>
</ol>
</div>
<div id="spatial-interpolation-using-the-functions-in-the-gstat-package" class="section level2" number="1.7">
<h2><span class="header-section-number">1.7</span> Spatial interpolation using the functions in the {gstat} package</h2>
<p><strong>“Commenting your code is like cleaning your bathroom - you never want to do it, but it really does create a more pleasant experience for you and your guests.”</strong> — Ryan Cambell</p>
<p>We start with the Meuse river data from Burrough and McDonnell (1998). The data are part of {gstat}.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="statistical-spatial-interpolation.html#cb242-1"></a><span class="kw">library</span>(gstat)</span>
<span id="cb242-2"><a href="statistical-spatial-interpolation.html#cb242-2"></a><span class="kw">library</span>(sp)</span>
<span id="cb242-3"><a href="statistical-spatial-interpolation.html#cb242-3"></a></span>
<span id="cb242-4"><a href="statistical-spatial-interpolation.html#cb242-4"></a><span class="kw">data</span>(meuse)</span>
<span id="cb242-5"><a href="statistical-spatial-interpolation.html#cb242-5"></a><span class="kw">head</span>(meuse)</span></code></pre></div>
<pre><code>##        x      y cadmium copper lead zinc  elev       dist   om ffreq soil lime
## 1 181072 333611    11.7     85  299 1022 7.909 0.00135803 13.6     1    1    1
## 2 181025 333558     8.6     81  277 1141 6.983 0.01222430 14.0     1    1    1
## 3 181165 333537     6.5     68  199  640 7.800 0.10302900 13.0     1    1    1
## 4 181298 333484     2.6     81  116  257 7.655 0.19009400  8.0     1    2    0
## 5 181307 333330     2.8     48  117  269 7.480 0.27709000  8.7     1    2    0
## 6 181390 333260     3.0     61  137  281 7.791 0.36406700  7.8     1    2    0
##   landuse dist.m
## 1      Ah     50
## 2      Ah     30
## 3      Ah    150
## 4      Ga    270
## 5      Ah    380
## 6      Ga    470</code></pre>
<p>The data are topsoil heavy metal concentrations along with a number of soil and landscape variables at locations in a flood plain of the river Meuse near the town of Stein (NL).</p>
<p>Heavy metal concentrations are composite samples of an area of approximately 15 m x 15 m. The dataset also gives local elevation (m) above local river bed and distance to river normalized to a value between 0 and 1.</p>
<p>Create a spatial points data frame (S4 class) and map the concentration of zinc in the soil on a log scale as a bubble plot.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="statistical-spatial-interpolation.html#cb244-1"></a><span class="kw">coordinates</span>(meuse) &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>y</span>
<span id="cb244-2"><a href="statistical-spatial-interpolation.html#cb244-2"></a><span class="kw">proj4string</span>(meuse) &lt;-<span class="st"> </span><span class="kw">CRS</span>(<span class="st">&quot;+init=epsg:28992&quot;</span>)</span>
<span id="cb244-3"><a href="statistical-spatial-interpolation.html#cb244-3"></a><span class="kw">class</span>(meuse)</span></code></pre></div>
<pre><code>## [1] &quot;SpatialPointsDataFrame&quot;
## attr(,&quot;package&quot;)
## [1] &quot;sp&quot;</code></pre>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="statistical-spatial-interpolation.html#cb246-1"></a><span class="kw">bubble</span>(meuse, <span class="st">&quot;zinc&quot;</span>, </span>
<span id="cb246-2"><a href="statistical-spatial-interpolation.html#cb246-2"></a>       <span class="dt">do.log =</span> <span class="ot">TRUE</span>, </span>
<span id="cb246-3"><a href="statistical-spatial-interpolation.html#cb246-3"></a>       <span class="dt">key.space =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-101-1.png" width="672" /></p>
<p>Zinc in the soil is concentrated along the east bank of the Meuse river.</p>
<div id="inverse-distance-weighted-interpolation" class="section level3" number="1.7.1">
<h3><span class="header-section-number">1.7.1</span> Inverse distance weighted interpolation</h3>
<p>We begin by creating an interpolated surface with the method of inverse distance weighting (IDW). Here the average of the observed values for any location is weighted inversely based on how far the observation points are from the location of interest. An exponent on the weights matrix determines the degree to which nearer observations are weighted more than more distant ones.</p>
<p>A regular grid where the interpolated values of zinc are made is given in the data frame <code>meuse.grid</code>.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="statistical-spatial-interpolation.html#cb247-1"></a><span class="kw">data</span>(meuse.grid)</span>
<span id="cb247-2"><a href="statistical-spatial-interpolation.html#cb247-2"></a><span class="kw">head</span>(meuse.grid)</span></code></pre></div>
<pre><code>##        x      y part.a part.b      dist soil ffreq
## 1 181180 333740      1      0 0.0000000    1     1
## 2 181140 333700      1      0 0.0000000    1     1
## 3 181180 333700      1      0 0.0122243    1     1
## 4 181220 333700      1      0 0.0434678    1     1
## 5 181100 333660      1      0 0.0000000    1     1
## 6 181140 333660      1      0 0.0122243    1     1</code></pre>
<p>Convert the grid as a data frame to a spatial pixels data frame. Note this is done first by converting the data frame to spatial points then to spatial pixels.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="statistical-spatial-interpolation.html#cb249-1"></a><span class="kw">coordinates</span>(meuse.grid) &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>y</span>
<span id="cb249-2"><a href="statistical-spatial-interpolation.html#cb249-2"></a><span class="kw">proj4string</span>(meuse.grid) &lt;-<span class="st"> </span><span class="kw">CRS</span>(<span class="st">&quot;+init=epsg:28992&quot;</span>)</span>
<span id="cb249-3"><a href="statistical-spatial-interpolation.html#cb249-3"></a>meuse.grid2 &lt;-<span class="st"> </span><span class="kw">as</span>(meuse.grid, <span class="st">&quot;SpatialPixelsDataFrame&quot;</span>) </span>
<span id="cb249-4"><a href="statistical-spatial-interpolation.html#cb249-4"></a><span class="kw">head</span>(meuse.grid2)</span></code></pre></div>
<pre><code>##   part.a part.b      dist soil ffreq
## 1      1      0 0.0000000    1     1
## 2      1      0 0.0000000    1     1
## 3      1      0 0.0122243    1     1
## 4      1      0 0.0434678    1     1
## 5      1      0 0.0000000    1     1
## 6      1      0 0.0122243    1     1</code></pre>
<p>As mentioned last time, the above conversion works since the locations have a spatial ordering. It will not work for a data frame with an arbitrary ordering of locations.</p>
<p>Here we plot the pixel locations using the attribute <code>dist</code> indicating distance to the river.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="statistical-spatial-interpolation.html#cb251-1"></a><span class="kw">library</span>(tmap)</span>
<span id="cb251-2"><a href="statistical-spatial-interpolation.html#cb251-2"></a></span>
<span id="cb251-3"><a href="statistical-spatial-interpolation.html#cb251-3"></a><span class="kw">tm_shape</span>(meuse.grid2) <span class="op">+</span></span>
<span id="cb251-4"><a href="statistical-spatial-interpolation.html#cb251-4"></a><span class="st">  </span><span class="kw">tm_raster</span>(<span class="st">&quot;dist&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-104-1.png" width="672" /></p>
<p>Interpolate the zinc values to the pixel locations using IDW. The <code>idp =</code> argument is the exponent on the weights. The larger the exponent, the more variation there is in the interpolated values.</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="statistical-spatial-interpolation.html#cb252-1"></a>zinc.idw &lt;-<span class="st"> </span><span class="kw">idw</span>(zinc <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, </span>
<span id="cb252-2"><a href="statistical-spatial-interpolation.html#cb252-2"></a>                meuse, </span>
<span id="cb252-3"><a href="statistical-spatial-interpolation.html#cb252-3"></a>                <span class="dt">newdata =</span> meuse.grid2, </span>
<span id="cb252-4"><a href="statistical-spatial-interpolation.html#cb252-4"></a>                <span class="dt">idp =</span> <span class="fl">2.5</span>)</span></code></pre></div>
<pre><code>## [inverse distance weighted interpolation]</code></pre>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="statistical-spatial-interpolation.html#cb254-1"></a><span class="kw">str</span>(zinc.idw, <span class="dt">max.level =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Formal class &#39;SpatialPixelsDataFrame&#39; [package &quot;sp&quot;] with 7 slots
##   ..@ data       :&#39;data.frame&#39;:  3103 obs. of  2 variables:
##   .. ..$ var1.pred: num [1:3103] 702 800 724 655 942 ...
##   .. ..$ var1.var : num [1:3103] NA NA NA NA NA NA NA NA NA NA ...
##   ..@ coords.nrs : int [1:2] 1 2
##   ..@ grid       :Formal class &#39;GridTopology&#39; [package &quot;sp&quot;] with 3 slots
##   ..@ grid.index : int [1:3103] 69 146 147 148 223 224 225 226 300 301 ...
##   ..@ coords     : num [1:3103, 1:2] 181180 181140 181180 181220 181100 ...
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   ..@ bbox       : num [1:2, 1:2] 178440 329600 181560 333760
##   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
##   ..@ proj4string:Formal class &#39;CRS&#39; [package &quot;sp&quot;] with 1 slot</code></pre>
<p>Note the formula. Here <code>zinc ~ 1</code>, where <code>zinc</code> is the field variable that is to be interpolated and 1 indicates a IDW interpolation (no autocorrelation and no trend or covariates).</p>
<p>The saved object (<code>zinc.idw</code>) inherits the class of the interpolation grid (here <code>SpatialPixelDataFrame</code>). The interpolated values are saved in the data frame slot with variable name <code>var1.pred</code>. The other variable is <code>var1.var</code> which is an estimate of the interpolation errors. With IDW they are <code>NA</code>.</p>
<p>IDW results in a surface that is often similar to a kriged surface. But interpolations may show undesired effects if the observation locations have a non-uniform distribution.</p>
<p>Map the results. Start with an image plot, then add a bubble plot of the observed concentrations and a legend. Here the size of the point character (circle) is set by the <code>cex = argument</code>.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="statistical-spatial-interpolation.html#cb256-1"></a><span class="kw">tm_shape</span>(zinc.idw) <span class="op">+</span></span>
<span id="cb256-2"><a href="statistical-spatial-interpolation.html#cb256-2"></a><span class="st">  </span><span class="kw">tm_raster</span>(<span class="st">&quot;var1.pred&quot;</span>) <span class="op">+</span></span>
<span id="cb256-3"><a href="statistical-spatial-interpolation.html#cb256-3"></a><span class="kw">tm_shape</span>(meuse) <span class="op">+</span></span>
<span id="cb256-4"><a href="statistical-spatial-interpolation.html#cb256-4"></a><span class="st">  </span><span class="kw">tm_bubbles</span>(<span class="st">&quot;zinc&quot;</span>, <span class="dt">alpha =</span> <span class="fl">.3</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-106-1.png" width="672" /></p>
<p>IDW tends to generate ‘bulls-eye’ patterns.</p>
<p>The spatial class makes it easier to create maps and export them to different platforms.</p>
</div>
<div id="create-a-geotif-file-that-can-be-read-into-envi-or-arcmap." class="section level3" number="1.7.2">
<h3><span class="header-section-number">1.7.2</span> Create a geoTIF file that can be read into ENVI or ArcMap.</h3>
<p>Here you repeat the analysis but this time use a planar projection for the interpolation grid, interpolate the logarithm of the zinc, and create a <code>geoTIF</code> file for output.</p>
<p>Again make <code>meuse.grid</code> a spatial pixels data frame.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="statistical-spatial-interpolation.html#cb257-1"></a><span class="kw">data</span>(meuse.grid)</span>
<span id="cb257-2"><a href="statistical-spatial-interpolation.html#cb257-2"></a><span class="kw">coordinates</span>(meuse.grid) &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>y</span>
<span id="cb257-3"><a href="statistical-spatial-interpolation.html#cb257-3"></a><span class="kw">gridded</span>(meuse.grid) &lt;-<span class="st"> </span><span class="ot">TRUE</span></span>
<span id="cb257-4"><a href="statistical-spatial-interpolation.html#cb257-4"></a><span class="kw">proj4string</span>(meuse.grid) &lt;-<span class="st"> </span><span class="kw">CRS</span>(<span class="kw">paste</span>(<span class="st">&quot;+init=epsg:28992&quot;</span>, </span>
<span id="cb257-5"><a href="statistical-spatial-interpolation.html#cb257-5"></a>                                     <span class="st">&quot;+towgs84=565.237,50.0087,465.658,-0.406857,0.350733,-1.87035,4.0812&quot;</span>))</span></code></pre></div>
<p>Make <code>meuse</code> a spatial points data frame with the same projection.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="statistical-spatial-interpolation.html#cb258-1"></a><span class="kw">data</span>(meuse)</span>
<span id="cb258-2"><a href="statistical-spatial-interpolation.html#cb258-2"></a><span class="kw">coordinates</span>(meuse) &lt;-<span class="st"> </span><span class="er">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>y</span>
<span id="cb258-3"><a href="statistical-spatial-interpolation.html#cb258-3"></a><span class="kw">proj4string</span>(meuse) &lt;-<span class="st"> </span><span class="kw">CRS</span>(<span class="kw">proj4string</span>(meuse.grid))</span></code></pre></div>
<p>Use the <code>krige</code> function in the {gstat} package and perform inverse-distance predictions. Since no variogram is specified in the function, the method defaults to inverse-distance weighting.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="statistical-spatial-interpolation.html#cb259-1"></a>logZinc &lt;-<span class="st"> </span><span class="kw">krige</span>(<span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, </span>
<span id="cb259-2"><a href="statistical-spatial-interpolation.html#cb259-2"></a>                meuse, </span>
<span id="cb259-3"><a href="statistical-spatial-interpolation.html#cb259-3"></a>                meuse.grid)[<span class="st">&quot;var1.pred&quot;</span>]</span></code></pre></div>
<pre><code>## [inverse distance weighted interpolation]</code></pre>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="statistical-spatial-interpolation.html#cb261-1"></a><span class="kw">summary</span>(logZinc)</span></code></pre></div>
<pre><code>## Object of class SpatialPixelsDataFrame
## Coordinates:
##      min    max
## x 178440 181560
## y 329600 333760
## Is projected: TRUE 
## proj4string :
## [+init=epsg:28992
## +towgs84=565.237,50.0087,465.658,-0.406857,0.350733,-1.87035,4.0812
## +proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889
## +k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs]
## Number of points: 3103
## Grid attributes:
##   cellcentre.offset cellsize cells.dim
## x            178460       40        78
## y            329620       40       104
## Data attributes:
##    var1.pred    
##  Min.   :4.791  
##  1st Qu.:5.484  
##  Median :5.694  
##  Mean   :5.777  
##  3rd Qu.:6.041  
##  Max.   :7.482</code></pre>
</div>
<div id="create-a-kml-file-that-can-be-read-by-google-earth" class="section level3" number="1.7.3">
<h3><span class="header-section-number">1.7.3</span> Create a KML file that can be read by Google Earth</h3>
<p>We export a colored raster of interpolated log zinc ppm values to a PNG file with an alpha channel for viewing it in Google Earth. Since GE requires geographical coordinates, a number of steps are needed.</p>
<p>First we make a polygon to bound the study area and project it to geographical coordinates.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="statistical-spatial-interpolation.html#cb263-1"></a><span class="kw">library</span>(maptools)</span></code></pre></div>
<pre><code>## Checking rgeos availability: TRUE</code></pre>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="statistical-spatial-interpolation.html#cb265-1"></a>grd &lt;-<span class="st"> </span><span class="kw">as</span>(meuse.grid, <span class="st">&quot;SpatialPolygons&quot;</span>)</span>
<span id="cb265-2"><a href="statistical-spatial-interpolation.html#cb265-2"></a><span class="kw">proj4string</span>(grd) &lt;-<span class="st"> </span><span class="kw">CRS</span>(<span class="kw">proj4string</span>(meuse.grid))</span>
<span id="cb265-3"><a href="statistical-spatial-interpolation.html#cb265-3"></a>grd.union &lt;-<span class="st"> </span><span class="kw">unionSpatialPolygons</span>(grd, <span class="kw">rep</span>(<span class="st">&quot;x&quot;</span>, <span class="kw">length</span>(<span class="kw">slot</span>(grd, <span class="st">&quot;polygons&quot;</span>))))  </span>
<span id="cb265-4"><a href="statistical-spatial-interpolation.html#cb265-4"></a>ll &lt;-<span class="st"> </span><span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +datum=WGS84&quot;</span>)</span>
<span id="cb265-5"><a href="statistical-spatial-interpolation.html#cb265-5"></a>grd.union.ll &lt;-<span class="st"> </span><span class="kw">spTransform</span>(grd.union, ll)</span>
<span id="cb265-6"><a href="statistical-spatial-interpolation.html#cb265-6"></a><span class="kw">plot</span>(grd.union.ll, <span class="dt">axes =</span> <span class="ot">TRUE</span>) </span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-110-1.png" width="672" /></p>
<p>The result is a single polygon as the union of all polygons in grd in geographic coordinates. Next, we construct a grid in geographical coordinates as our target object for export using the <code>GE_SpatialGrid</code> function. This grid is the container for the output PNG graphics file. <code>GE_SpatialGrid</code> returns values that will be used in setting up the PNG graphics device.</p>
<p>We use the <code>over()</code> method to set grid cells outside the river bank area to NA and then discard them by coercion.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="statistical-spatial-interpolation.html#cb266-1"></a>llGRD &lt;-<span class="st"> </span><span class="kw">GE_SpatialGrid</span>(grd.union.ll)</span>
<span id="cb266-2"><a href="statistical-spatial-interpolation.html#cb266-2"></a>llGRD_in &lt;-<span class="st"> </span><span class="kw">over</span>(llGRD<span class="op">$</span>SG, grd.union.ll)</span>
<span id="cb266-3"><a href="statistical-spatial-interpolation.html#cb266-3"></a>llSGDF &lt;-<span class="st"> </span><span class="kw">SpatialGridDataFrame</span>(<span class="dt">grid =</span> <span class="kw">slot</span>(llGRD<span class="op">$</span>SG, <span class="st">&quot;grid&quot;</span>), </span>
<span id="cb266-4"><a href="statistical-spatial-interpolation.html#cb266-4"></a>                              <span class="dt">proj4string =</span> <span class="kw">CRS</span>(<span class="kw">proj4string</span>(llGRD<span class="op">$</span>SG)), </span>
<span id="cb266-5"><a href="statistical-spatial-interpolation.html#cb266-5"></a>                              <span class="dt">data =</span> <span class="kw">data.frame</span>(<span class="dt">in0 =</span> llGRD_in))</span>
<span id="cb266-6"><a href="statistical-spatial-interpolation.html#cb266-6"></a>llSPix &lt;-<span class="st"> </span><span class="kw">as</span>(llSGDF, <span class="st">&quot;SpatialPixelsDataFrame&quot;</span>)</span></code></pre></div>
<p>Next we interpolate. Here again we use the <code>idw</code> function to make an inverse-distance weighted interpolation of zinc values in ppm.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="statistical-spatial-interpolation.html#cb267-1"></a>meuse_ll &lt;-<span class="st"> </span><span class="kw">spTransform</span>(meuse, </span>
<span id="cb267-2"><a href="statistical-spatial-interpolation.html#cb267-2"></a>                       <span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +datum=WGS84&quot;</span>))</span>
<span id="cb267-3"><a href="statistical-spatial-interpolation.html#cb267-3"></a>llSPix<span class="op">$</span>pred &lt;-<span class="st"> </span><span class="kw">idw</span>(<span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, </span>
<span id="cb267-4"><a href="statistical-spatial-interpolation.html#cb267-4"></a>                   meuse_ll, </span>
<span id="cb267-5"><a href="statistical-spatial-interpolation.html#cb267-5"></a>                   llSPix)<span class="op">$</span>var1.pred</span></code></pre></div>
<pre><code>## [inverse distance weighted interpolation]</code></pre>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="statistical-spatial-interpolation.html#cb269-1"></a><span class="kw">spplot</span>(llSPix[<span class="st">&quot;pred&quot;</span>])</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-112-1.png" width="672" /></p>
<p>Since <code>GE_SpatialGrid</code> was set to the size of an PNG graphics device, we can use it with the <code>image()</code> function. Other base graphics methods and functions can be used to create an image overlay. First open the graphics device, then set the plotting margins, then use <code>image</code>, and finally turn off the device.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="statistical-spatial-interpolation.html#cb270-1"></a><span class="kw">png</span>(file &lt;-<span class="st"> &quot;zincIDW.png&quot;</span>, <span class="dt">width =</span> llGRD<span class="op">$</span>width, </span>
<span id="cb270-2"><a href="statistical-spatial-interpolation.html#cb270-2"></a>    <span class="dt">height =</span> llGRD<span class="op">$</span>height, <span class="dt">bg =</span> <span class="st">&quot;transparent&quot;</span>)</span>
<span id="cb270-3"><a href="statistical-spatial-interpolation.html#cb270-3"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">xaxs =</span> <span class="st">&quot;i&quot;</span>, <span class="dt">yaxs =</span> <span class="st">&quot;i&quot;</span>)</span>
<span id="cb270-4"><a href="statistical-spatial-interpolation.html#cb270-4"></a><span class="kw">image</span>(llSPix, <span class="st">&quot;pred&quot;</span>, <span class="dt">col =</span> <span class="kw">bpy.colors</span>(<span class="dv">20</span>))</span>
<span id="cb270-5"><a href="statistical-spatial-interpolation.html#cb270-5"></a><span class="kw">dev.off</span>()</span></code></pre></div>
<pre><code>## quartz_off_screen 
##                 2</code></pre>
<p>After closing the graphics device, we use the <code>kmlOverlay</code> to write the interpolated grid to a KML file giving the location of the overlay. This will load the image at the position when opened in Google Earth.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="statistical-spatial-interpolation.html#cb272-1"></a><span class="kw">kmlOverlay</span>(llGRD, <span class="st">&quot;zincIDW.kml&quot;</span>, <span class="st">&quot;zincIDW.png&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;&quot;                                                                                                        
## [2] &quot;&lt;kml xmlns=&#39;http://earth.google.com/kml/2.0&#39;&gt;&quot;                                                                                                 
## [3] &quot;&lt;GroundOverlay&gt;&quot;                                                                                                                               
## [4] &quot;&lt;name&gt;R image&lt;/name&gt;&quot;                                                                                                                          
## [5] &quot;&lt;Icon&gt;&lt;href&gt;zincIDW.png&lt;/href&gt;&lt;viewBoundScale&gt;0.75&lt;/viewBoundScale&gt;&lt;/Icon&gt;&quot;                                                                    
## [6] &quot;&lt;LatLonBox&gt;&lt;north&gt;50.9928974316667&lt;/north&gt;&lt;south&gt;50.955589349424&lt;/south&gt;&lt;east&gt;5.76545832043532&lt;/east&gt;&lt;west&gt;5.72082313681635&lt;/west&gt;&lt;/LatLonBox&gt;&quot;
## [7] &quot;&lt;/GroundOverlay&gt;&lt;/kml&gt;&quot;</code></pre>
<p>Open the <code>zincIDW.kml</code> file in Google Earth.</p>
</div>
<div id="distance-to-river-as-a-covariate" class="section level3" number="1.7.4">
<h3><span class="header-section-number">1.7.4</span> Distance to river as a covariate</h3>
<p>Here you use distance to river as a covariate. It is a trend model for the spatial variability of zinc using a covariate defined by the square root of the distance to river. This is not kriging since no variogram model is used.</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="statistical-spatial-interpolation.html#cb274-1"></a>zn.lm &lt;-<span class="st"> </span><span class="kw">krige</span>(<span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span><span class="kw">sqrt</span>(dist), </span>
<span id="cb274-2"><a href="statistical-spatial-interpolation.html#cb274-2"></a>               <span class="dt">locations =</span> meuse, </span>
<span id="cb274-3"><a href="statistical-spatial-interpolation.html#cb274-3"></a>               <span class="dt">newdata =</span> meuse.grid)</span></code></pre></div>
<pre><code>## [ordinary or weighted least squares prediction]</code></pre>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="statistical-spatial-interpolation.html#cb276-1"></a><span class="kw">tm_shape</span>(zn.lm) <span class="op">+</span></span>
<span id="cb276-2"><a href="statistical-spatial-interpolation.html#cb276-2"></a><span class="st">  </span><span class="kw">tm_raster</span>(<span class="st">&quot;var1.pred&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-115-1.png" width="672" /></p>
<p>Note that the spacing in colors is not linear.</p>
</div>
<div id="empirical-variogram-analysis" class="section level3" number="1.7.5">
<h3><span class="header-section-number">1.7.5</span> Empirical variogram analysis</h3>
<p>The <code>variogram()</code> function from {gstat} computes the empirical variogram. Here the trend is not in the cardinal directions but rather in distance to the river. The variogram is on the residuals from this trend.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="statistical-spatial-interpolation.html#cb277-1"></a>meuse.v &lt;-<span class="st"> </span><span class="kw">variogram</span>(<span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span><span class="kw">sqrt</span>(dist), </span>
<span id="cb277-2"><a href="statistical-spatial-interpolation.html#cb277-2"></a>                     <span class="dt">data =</span> meuse)</span>
<span id="cb277-3"><a href="statistical-spatial-interpolation.html#cb277-3"></a><span class="kw">plot</span>(meuse.v, <span class="dt">xlab =</span> <span class="st">&quot;Lag Distance (m)&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-116-1.png" width="672" /></p>
<p>The default cutoff lag (<code>cutoff</code>) and lag tolerance (<code>width</code>) can be changed. For example, type</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="statistical-spatial-interpolation.html#cb278-1"></a><span class="kw">plot</span>(<span class="kw">variogram</span>(<span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span><span class="kw">sqrt</span>(dist), </span>
<span id="cb278-2"><a href="statistical-spatial-interpolation.html#cb278-2"></a>               <span class="dt">data =</span> meuse, </span>
<span id="cb278-3"><a href="statistical-spatial-interpolation.html#cb278-3"></a>               <span class="dt">cutoff =</span> <span class="dv">1000</span>, </span>
<span id="cb278-4"><a href="statistical-spatial-interpolation.html#cb278-4"></a>               <span class="dt">width =</span> <span class="dv">50</span>), </span>
<span id="cb278-5"><a href="statistical-spatial-interpolation.html#cb278-5"></a>      <span class="dt">xlab =</span> <span class="st">&quot;Lag Distance (m)&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-117-1.png" width="672" /></p>
<p>For comparison, plot a variogram of residuals after removing a 1st-order trend in direction.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="statistical-spatial-interpolation.html#cb279-1"></a><span class="kw">plot</span>(<span class="kw">variogram</span>(<span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>y, </span>
<span id="cb279-2"><a href="statistical-spatial-interpolation.html#cb279-2"></a>               <span class="dt">data =</span> meuse, </span>
<span id="cb279-3"><a href="statistical-spatial-interpolation.html#cb279-3"></a>               <span class="dt">cutoff =</span> <span class="dv">1000</span>, </span>
<span id="cb279-4"><a href="statistical-spatial-interpolation.html#cb279-4"></a>               <span class="dt">width =</span> <span class="dv">50</span>), </span>
<span id="cb279-5"><a href="statistical-spatial-interpolation.html#cb279-5"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Lag Distance (m)&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-118-1.png" width="672" /></p>
<p>Directional variograms are estimated by adding the argument alpha.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="statistical-spatial-interpolation.html#cb280-1"></a><span class="kw">plot</span>(<span class="kw">variogram</span>(<span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>y, </span>
<span id="cb280-2"><a href="statistical-spatial-interpolation.html#cb280-2"></a>               <span class="dt">data =</span> meuse, </span>
<span id="cb280-3"><a href="statistical-spatial-interpolation.html#cb280-3"></a>               <span class="dt">cutoff =</span> <span class="dv">1000</span>, </span>
<span id="cb280-4"><a href="statistical-spatial-interpolation.html#cb280-4"></a>               <span class="dt">width =</span> <span class="dv">50</span>, </span>
<span id="cb280-5"><a href="statistical-spatial-interpolation.html#cb280-5"></a>               <span class="dt">alpha =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">45</span>, <span class="dv">90</span>, <span class="dv">135</span>)), </span>
<span id="cb280-6"><a href="statistical-spatial-interpolation.html#cb280-6"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Lag Distance (m)&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-119-1.png" width="672" /></p>
<p>The variogram in the sw-ne direction appears to be different. And there appears to be very little spatial autocorrelation in the n-s direction. This is partly due to the anistropy of the domain.</p>
</div>
<div id="variogram-maps" class="section level3" number="1.7.6">
<h3><span class="header-section-number">1.7.6</span> Variogram maps</h3>
<p>Another way of looking at directional dependence in semivariograms is with variogram maps. Instead of classifying point pairs <span class="math inline">\(Z(s)\)</span> and <span class="math inline">\(Z(s + h)\)</span> by direction and distance separately, they are classified jointly.</p>
<p>If <span class="math inline">\(h = (x, y)\)</span> is the two-dimensional coordinates of the separation vector, in the variogram map the semivariance contribution of each point pair <span class="math inline">\((Z(s) - Z(s + h))^2\)</span> is attributed to the grid cell in which <span class="math inline">\(h\)</span> lies. The map is centered at (0, 0), as <span class="math inline">\(h\)</span> is geographical distance rather than geographical location.</p>
<p>Cutoff and width correspond to map extent and cell size; the semivariance map is point symmetric around (0, 0), as <span class="math inline">\(\gamma(h) = \gamma(-h)\)</span>.</p>
<p>The variogram map is obtained with the <code>map = TRUE</code> argument. The threshold assures that only semivariogram map values based on at least 5 point pairs are shown, removing too noisy estimation.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="statistical-spatial-interpolation.html#cb281-1"></a>meuse.vmap &lt;-<span class="st"> </span><span class="kw">variogram</span>(<span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>y, </span>
<span id="cb281-2"><a href="statistical-spatial-interpolation.html#cb281-2"></a>                        <span class="dt">data =</span> meuse, </span>
<span id="cb281-3"><a href="statistical-spatial-interpolation.html#cb281-3"></a>                        <span class="dt">cutoff =</span> <span class="dv">1500</span>, </span>
<span id="cb281-4"><a href="statistical-spatial-interpolation.html#cb281-4"></a>                        <span class="dt">width =</span> <span class="dv">100</span>,</span>
<span id="cb281-5"><a href="statistical-spatial-interpolation.html#cb281-5"></a>                        <span class="dt">map =</span> <span class="ot">TRUE</span>)</span>
<span id="cb281-6"><a href="statistical-spatial-interpolation.html#cb281-6"></a><span class="kw">plot</span>(meuse.vmap, <span class="dt">threshold =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-120-1.png" width="672" /></p>
<p>The symmetry about the dx, dy = (0, 0) is apparent. The variances range from 0 to 2.5 and appear to elongate along the long axis of the domain.</p>
<p>Compare with a variogram map when the square root of the distance to river is used as a covariate.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="statistical-spatial-interpolation.html#cb282-1"></a>meuse.vmap &lt;-<span class="st"> </span><span class="kw">variogram</span>(<span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span><span class="kw">sqrt</span>(dist), </span>
<span id="cb282-2"><a href="statistical-spatial-interpolation.html#cb282-2"></a>                        <span class="dt">data =</span> meuse, </span>
<span id="cb282-3"><a href="statistical-spatial-interpolation.html#cb282-3"></a>                        <span class="dt">cutoff =</span> <span class="dv">1500</span>, </span>
<span id="cb282-4"><a href="statistical-spatial-interpolation.html#cb282-4"></a>                        <span class="dt">width =</span> <span class="dv">100</span>,</span>
<span id="cb282-5"><a href="statistical-spatial-interpolation.html#cb282-5"></a>                        <span class="dt">map =</span> <span class="ot">TRUE</span>)</span>
<span id="cb282-6"><a href="statistical-spatial-interpolation.html#cb282-6"></a><span class="kw">plot</span>(meuse.vmap, <span class="dt">threshold =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-121-1.png" width="672" /></p>
<p>The variances range from 0 to .8 and the directional dependence is much less obvious in this case.</p>
</div>
<div id="variogram-modeling" class="section level3" number="1.7.7">
<h3><span class="header-section-number">1.7.7</span> Variogram modeling</h3>
<p>A plot of the model families is available with the <code>show.vgms()</code> function.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="statistical-spatial-interpolation.html#cb283-1"></a><span class="kw">show.vgms</span>() </span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-122-1.png" width="672" /></p>
<p>We’ve seen the exponential (<code>Exp</code>), spherical (<code>Sph</code>), and Gaussian (<code>Gau</code>) families when working with the functions in the {geoR} package.</p>
<p>After choosing a family starting values are needed in the <code>fit.variogram()</code> function. The function calls the <code>vgm()</code> function that includes initial guesses for the partial sill (<code>psill</code>), the range (<code>range</code>), and the nugget (<code>nugget</code>) and uses a weighted least squares method.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="statistical-spatial-interpolation.html#cb284-1"></a>meuse.vm &lt;-<span class="st"> </span><span class="kw">fit.variogram</span>(meuse.v, </span>
<span id="cb284-2"><a href="statistical-spatial-interpolation.html#cb284-2"></a>                          <span class="kw">vgm</span>(<span class="dt">model =</span> <span class="st">&quot;Sph&quot;</span>, </span>
<span id="cb284-3"><a href="statistical-spatial-interpolation.html#cb284-3"></a>                              <span class="dt">psill =</span> <span class="fl">.15</span>,</span>
<span id="cb284-4"><a href="statistical-spatial-interpolation.html#cb284-4"></a>                              <span class="dt">range =</span> <span class="dv">800</span>, </span>
<span id="cb284-5"><a href="statistical-spatial-interpolation.html#cb284-5"></a>                              <span class="dt">nugget =</span> <span class="fl">.1</span>))</span>
<span id="cb284-6"><a href="statistical-spatial-interpolation.html#cb284-6"></a>meuse.vm</span></code></pre></div>
<pre><code>##   model      psill    range
## 1   Nug 0.07981564   0.0000
## 2   Sph 0.14905557 872.6622</code></pre>
<p>The output includes a 2 x 2 table with the first row giving information about the nugget and the second giving information about the rest of the model. Here the nugget is .08. By definition the range is zero. The partial sill is .15 with a range of 872.7 m. Plot the sample variogram and the variogram model.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="statistical-spatial-interpolation.html#cb286-1"></a><span class="kw">plot</span>(meuse.v, meuse.vm, </span>
<span id="cb286-2"><a href="statistical-spatial-interpolation.html#cb286-2"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Lag distance (m)&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-124-1.png" width="672" /></p>
<p>The <code>fit.variogram</code> function refines the initial estimates given in the <code>vgm</code> function. If our initial choice is poor the fit may not work. For example try</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="statistical-spatial-interpolation.html#cb287-1"></a><span class="kw">fit.variogram</span>(meuse.v, </span>
<span id="cb287-2"><a href="statistical-spatial-interpolation.html#cb287-2"></a>              <span class="kw">vgm</span>(<span class="dt">model =</span> <span class="st">&quot;Sph&quot;</span>,</span>
<span id="cb287-3"><a href="statistical-spatial-interpolation.html#cb287-3"></a>                  <span class="dt">psill =</span> <span class="dv">1</span>, </span>
<span id="cb287-4"><a href="statistical-spatial-interpolation.html#cb287-4"></a>                  <span class="dt">range =</span> <span class="dv">10</span>, </span>
<span id="cb287-5"><a href="statistical-spatial-interpolation.html#cb287-5"></a>                  <span class="dt">nugget =</span> <span class="dv">1</span>))</span></code></pre></div>
<pre><code>## Warning in fit.variogram(meuse.v, vgm(model = &quot;Sph&quot;, psill = 1, range = 10, :
## singular model in variogram fit</code></pre>
<pre><code>##   model psill range
## 1   Nug     1     0
## 2   Sph     1    10</code></pre>
<p>An argument for visual fitting over numerical fitting is when you have knowledge that goes beyond the information in the data. Information may come from other studies or derived from measurement error characteristics for a specific measuring device (nugget effect).</p>
</div>
<div id="kriging-1" class="section level3" number="1.7.8">
<h3><span class="header-section-number">1.7.8</span> Kriging</h3>
<p>Simple kriging is done when there is no trend and the mean height of the surface is provided. Because you know the mean exactly you also know the residuals exactly at the data locations. If you know the residuals exactly then you can do a better job of estimating the autocorrelation function (variogram). For ordinary kriging you estimate the mean so the residuals are also estimates.</p>
<p>Universal kriging is done when there is a trend. With universal kriging both the trend and spatial variability are estimated in tandem.</p>
<p>Here we apply kriging to the logarithm of the zinc concentration using the fitted variogram model.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="statistical-spatial-interpolation.html#cb290-1"></a>lz.sk &lt;-<span class="st"> </span><span class="kw">krige</span>(<span class="dt">formula =</span> <span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, </span>
<span id="cb290-2"><a href="statistical-spatial-interpolation.html#cb290-2"></a>               <span class="dt">locations =</span> meuse, </span>
<span id="cb290-3"><a href="statistical-spatial-interpolation.html#cb290-3"></a>               <span class="dt">newdata =</span> meuse.grid, </span>
<span id="cb290-4"><a href="statistical-spatial-interpolation.html#cb290-4"></a>               <span class="dt">model =</span> meuse.vm, </span>
<span id="cb290-5"><a href="statistical-spatial-interpolation.html#cb290-5"></a>               <span class="dt">beta =</span> <span class="fl">5.9</span>)</span></code></pre></div>
<pre><code>## [using simple kriging]</code></pre>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="statistical-spatial-interpolation.html#cb292-1"></a>lz.ok &lt;-<span class="st"> </span><span class="kw">krige</span>(<span class="dt">formula =</span> <span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, </span>
<span id="cb292-2"><a href="statistical-spatial-interpolation.html#cb292-2"></a>               <span class="dt">locations =</span> meuse, </span>
<span id="cb292-3"><a href="statistical-spatial-interpolation.html#cb292-3"></a>               <span class="dt">newdata =</span> meuse.grid, </span>
<span id="cb292-4"><a href="statistical-spatial-interpolation.html#cb292-4"></a>               <span class="dt">model =</span> meuse.vm)</span></code></pre></div>
<pre><code>## [using ordinary kriging]</code></pre>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="statistical-spatial-interpolation.html#cb294-1"></a>lz.uk &lt;-<span class="st"> </span><span class="kw">krige</span>(<span class="dt">formula =</span> <span class="kw">log</span>(zinc) <span class="op">~</span><span class="st"> </span><span class="kw">sqrt</span>(dist),</span>
<span id="cb294-2"><a href="statistical-spatial-interpolation.html#cb294-2"></a>               <span class="dt">locations =</span> meuse, </span>
<span id="cb294-3"><a href="statistical-spatial-interpolation.html#cb294-3"></a>               <span class="dt">newdata =</span> meuse.grid, </span>
<span id="cb294-4"><a href="statistical-spatial-interpolation.html#cb294-4"></a>               <span class="dt">model =</span> meuse.vm)</span></code></pre></div>
<pre><code>## [using universal kriging]</code></pre>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="statistical-spatial-interpolation.html#cb296-1"></a>m1 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(lz.sk) <span class="op">+</span></span>
<span id="cb296-2"><a href="statistical-spatial-interpolation.html#cb296-2"></a><span class="st">        </span><span class="kw">tm_raster</span>(<span class="st">&quot;var1.pred&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Simple&quot;</span>)</span>
<span id="cb296-3"><a href="statistical-spatial-interpolation.html#cb296-3"></a></span>
<span id="cb296-4"><a href="statistical-spatial-interpolation.html#cb296-4"></a>m2 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(lz.ok) <span class="op">+</span></span>
<span id="cb296-5"><a href="statistical-spatial-interpolation.html#cb296-5"></a><span class="st">        </span><span class="kw">tm_raster</span>(<span class="st">&quot;var1.pred&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Ordinary&quot;</span>)</span>
<span id="cb296-6"><a href="statistical-spatial-interpolation.html#cb296-6"></a></span>
<span id="cb296-7"><a href="statistical-spatial-interpolation.html#cb296-7"></a>m3 &lt;-<span class="st"> </span><span class="kw">tm_shape</span>(lz.uk) <span class="op">+</span></span>
<span id="cb296-8"><a href="statistical-spatial-interpolation.html#cb296-8"></a><span class="st">        </span><span class="kw">tm_raster</span>(<span class="st">&quot;var1.pred&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Universal&quot;</span>)</span>
<span id="cb296-9"><a href="statistical-spatial-interpolation.html#cb296-9"></a></span>
<span id="cb296-10"><a href="statistical-spatial-interpolation.html#cb296-10"></a><span class="kw">tmap_arrange</span>(m1, m2, m3, <span class="dt">ncol =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-126-1.png" width="672" /></p>
<p>Simple and ordinary kriging treat all spatial variation as autocorrelation. Universal kriging lets some of the variation be due to trend and covariates.</p>
<p>Predictive skill.</p>
</div>
</div>
<div id="example-tropical-cyclone-rainfall" class="section level2" number="1.8">
<h2><span class="header-section-number">1.8</span> Example: Tropical cyclone rainfall</h2>
<p>In 2008, Tropical Cyclone Fay formed from a tropical wave near the Dominican Republic, passed over the island of Hispaniola, Cuba, and the Florida Keys, then crossed the Florida peninsula and moved westward across portions of the panhandle producing heavy rains in parts of the state.</p>
<p>Storm total rainfall amounts from stations in and around the state are in <code>FayRain.txt</code>. They are a compilation of reports from the U.S. NOAA/NWS official weather sites and coop sites.</p>
<p>The coop sites are the Community Collaborative Rain, Hail and Snow Network (CoCoRaHS), a community-based, high density precipitation network made up of volunteers who take measurements of precipitation in their backyards. The data were obtained from NOAA/NCEP/HPC and from the Florida Climate Center.</p>
<p>Load the data.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="statistical-spatial-interpolation.html#cb297-1"></a>L &lt;-<span class="st"> &quot;http://myweb.fsu.edu/jelsner/temp/data/FayRain.txt&quot;</span></span>
<span id="cb297-2"><a href="statistical-spatial-interpolation.html#cb297-2"></a>FR.df &lt;-<span class="st"> </span><span class="kw">read.table</span>(L, <span class="dt">header =</span> <span class="ot">TRUE</span>)</span>
<span id="cb297-3"><a href="statistical-spatial-interpolation.html#cb297-3"></a><span class="kw">names</span>(FR.df)</span></code></pre></div>
<pre><code>## [1] &quot;lon&quot; &quot;lat&quot; &quot;tpi&quot; &quot;tpm&quot;</code></pre>
<p>The data frame contains 803 rainfall sites. Longitude and latitude coordinates of the sites are given in the first two columns and total rainfall in inches and millimeters are given in the second two columns. Create a spatial points data frame by specifying columns that contain the spatial coordinates. Then assign a geographic coordinate system and convert the rainfall from millimeters to centimeters.</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="statistical-spatial-interpolation.html#cb299-1"></a><span class="kw">library</span>(sf)</span>
<span id="cb299-2"><a href="statistical-spatial-interpolation.html#cb299-2"></a></span>
<span id="cb299-3"><a href="statistical-spatial-interpolation.html#cb299-3"></a>FR.sf &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(<span class="dt">x =</span> FR.df,</span>
<span id="cb299-4"><a href="statistical-spatial-interpolation.html#cb299-4"></a>                 <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;lon&quot;</span>, <span class="st">&quot;lat&quot;</span>),</span>
<span id="cb299-5"><a href="statistical-spatial-interpolation.html#cb299-5"></a>                 <span class="dt">crs =</span> <span class="dv">4326</span>)</span>
<span id="cb299-6"><a href="statistical-spatial-interpolation.html#cb299-6"></a></span>
<span id="cb299-7"><a href="statistical-spatial-interpolation.html#cb299-7"></a>FR.sf<span class="op">$</span>tpm &lt;-<span class="st"> </span>FR.sf<span class="op">$</span>tpm<span class="op">/</span><span class="dv">10</span></span>
<span id="cb299-8"><a href="statistical-spatial-interpolation.html#cb299-8"></a><span class="kw">summary</span>(FR.sf<span class="op">$</span>tpm)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   0.000   8.306  15.799  17.631  24.372  60.223</code></pre>
<p>The median value is 15.8 cm and the maximum is 60.2 cm.</p>
<p>Next get the Florida county boundaries from the {USAboundaries} package.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="statistical-spatial-interpolation.html#cb301-1"></a>FL.sf &lt;-<span class="st"> </span>USAboundaries<span class="op">::</span><span class="kw">us_counties</span>(<span class="dt">states =</span> <span class="st">&quot;Florida&quot;</span>)</span></code></pre></div>
<p>Next we create a character string specifying the tags for a planar projection and transform the geographic coordinates of the site locations and map polygons to the projected coordinates. Here we use Florida GDL Albers (EPSG:3087) with meter as the distance unit.</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="statistical-spatial-interpolation.html#cb302-1"></a>FR.sf &lt;-<span class="st"> </span><span class="kw">st_transform</span>(FR.sf, <span class="dt">crs =</span> <span class="dv">3087</span>)</span>
<span id="cb302-2"><a href="statistical-spatial-interpolation.html#cb302-2"></a>FL.sf &lt;-<span class="st"> </span><span class="kw">st_transform</span>(FL.sf, <span class="dt">crs =</span> <span class="dv">3087</span>)</span></code></pre></div>
<p>A map of the rainfall sites and storm totals with the state boundaries is made by typing</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="statistical-spatial-interpolation.html#cb303-1"></a><span class="kw">library</span>(tmap)</span>
<span id="cb303-2"><a href="statistical-spatial-interpolation.html#cb303-2"></a></span>
<span id="cb303-3"><a href="statistical-spatial-interpolation.html#cb303-3"></a><span class="kw">tm_shape</span>(FR.sf) <span class="op">+</span></span>
<span id="cb303-4"><a href="statistical-spatial-interpolation.html#cb303-4"></a><span class="st">  </span><span class="kw">tm_dots</span>(<span class="dt">col =</span> <span class="st">&quot;tpm&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb303-5"><a href="statistical-spatial-interpolation.html#cb303-5"></a><span class="kw">tm_shape</span>(FL.sf) <span class="op">+</span></span>
<span id="cb303-6"><a href="statistical-spatial-interpolation.html#cb303-6"></a><span class="st">  </span><span class="kw">tm_borders</span>()</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-131-1.png" width="672" /></p>
<p>Two areas of heavy rainfall are noted. One running north-south along the east coast and another across the north. Rainfall collection sites are clustered in and around cities. This will make it difficult to use a spline interpolation.</p>
<div id="empirical-variogram" class="section level3" number="1.8.1">
<h3><span class="header-section-number">1.8.1</span> Empirical variogram</h3>
<p>Rainfall is an example of geostatistical data. In principle it can be measured anywhere, but typically we have values at a sample of sites. The pattern of observation sites is not of much interest as it is a consequence of constraints (convenience, opportunity, economics, etc) unrelated to the phenomenon. Interest centers on inference about how much rain fell across the region.</p>
<p>The empirical variogram is computed using the <code>variogram()</code> function. The first argument is the model formula specifying the rainfall column from the data frame and the second argument is the data frame name. Here <code>~ 1</code> in the model formula indicates no covariates or trends in the data. Trends can be included by specifying coordinate names through the <code>st_coordinates()</code> function.</p>
<p>We compute the empirical variogram for Fay’s rainfall and save it by typing</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="statistical-spatial-interpolation.html#cb304-1"></a>FR.v &lt;-<span class="st"> </span><span class="kw">variogram</span>(tpm <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, </span>
<span id="cb304-2"><a href="statistical-spatial-interpolation.html#cb304-2"></a>                  <span class="dt">data =</span> FR.sf)</span></code></pre></div>
<p>We plot the variogram values as a function of lag distance and add text indicating the number of point pairs for each lag distance.</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="statistical-spatial-interpolation.html#cb305-1"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb305-2"><a href="statistical-spatial-interpolation.html#cb305-2"></a></span>
<span id="cb305-3"><a href="statistical-spatial-interpolation.html#cb305-3"></a>v.df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">dist =</span> FR.v<span class="op">$</span>dist<span class="op">/</span><span class="dv">1000</span>,</span>
<span id="cb305-4"><a href="statistical-spatial-interpolation.html#cb305-4"></a>                   <span class="dt">gamma =</span> FR.v<span class="op">$</span>gamma,</span>
<span id="cb305-5"><a href="statistical-spatial-interpolation.html#cb305-5"></a>                   <span class="dt">np =</span> FR.v<span class="op">$</span>np)</span>
<span id="cb305-6"><a href="statistical-spatial-interpolation.html#cb305-6"></a></span>
<span id="cb305-7"><a href="statistical-spatial-interpolation.html#cb305-7"></a>( pv &lt;-<span class="st"> </span><span class="kw">ggplot</span>(v.df, <span class="kw">aes</span>(<span class="dt">x =</span> dist, <span class="dt">y =</span> gamma)) <span class="op">+</span></span>
<span id="cb305-8"><a href="statistical-spatial-interpolation.html#cb305-8"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb305-9"><a href="statistical-spatial-interpolation.html#cb305-9"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> np), <span class="dt">nudge_y =</span> <span class="dv">-5</span>) <span class="op">+</span></span>
<span id="cb305-10"><a href="statistical-spatial-interpolation.html#cb305-10"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">220</span>)) <span class="op">+</span></span>
<span id="cb305-11"><a href="statistical-spatial-interpolation.html#cb305-11"></a><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">400</span>)) <span class="op">+</span></span>
<span id="cb305-12"><a href="statistical-spatial-interpolation.html#cb305-12"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Lagged distance (h) [km]&quot;</span>) <span class="op">+</span></span>
<span id="cb305-13"><a href="statistical-spatial-interpolation.html#cb305-13"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&quot;Semivariance (&quot;</span>, gamma, <span class="st">&quot;) [&quot;</span>, cm<span class="op">^</span><span class="dv">2</span>, <span class="st">&quot;]&quot;</span>))) <span class="op">+</span></span>
<span id="cb305-14"><a href="statistical-spatial-interpolation.html#cb305-14"></a><span class="st">  </span><span class="kw">theme_minimal</span>() )</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-133-1.png" width="672" /></p>
<p>Values start low (~50 cm<span class="math inline">\(^2\)</span>) at short lag distance, then increase to over 200 cm<span class="math inline">\(^2\)</span> at lag distance of about 200 km.</p>
<p>The zero-lag semivariance is called the ‘nugget’ and the semivariance at a level where the variogram values no longer increase is called the ‘sill.’ The lag distance to the sill is called the ‘range.’ These three parameters (nugget, sill, and range) are used to fit a model to the variogram.</p>
</div>
<div id="variogram-model" class="section level3" number="1.8.2">
<h3><span class="header-section-number">1.8.2</span> Variogram model</h3>
<p>Next we fit a model to the empirical variogram. The variogram model is a mathematical relationship defining the semivariance as a function of lag distance. We first save the family and the initial parameter guesses in a variogram model (<code>FR.vmi</code>) object by typing</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="statistical-spatial-interpolation.html#cb306-1"></a>FR.vmi &lt;-<span class="st"> </span><span class="kw">vgm</span>(<span class="dt">model =</span> <span class="st">&quot;Gau&quot;</span>, </span>
<span id="cb306-2"><a href="statistical-spatial-interpolation.html#cb306-2"></a>              <span class="dt">psill =</span> <span class="dv">150</span>, </span>
<span id="cb306-3"><a href="statistical-spatial-interpolation.html#cb306-3"></a>              <span class="dt">range =</span> <span class="dv">200</span> <span class="op">*</span><span class="st"> </span><span class="dv">1000</span>, </span>
<span id="cb306-4"><a href="statistical-spatial-interpolation.html#cb306-4"></a>              <span class="dt">nugget =</span> <span class="dv">50</span>)</span>
<span id="cb306-5"><a href="statistical-spatial-interpolation.html#cb306-5"></a>FR.vmi</span></code></pre></div>
<pre><code>##   model psill range
## 1   Nug    50 0e+00
## 2   Gau   150 2e+05</code></pre>
<p>The <code>psill</code> argument is the partial sill as the difference between the sill and the nugget. We get estimates of the parameter values from looking at the empirical variogram.</p>
<p>Next we use the <code>fit.variogram()</code> function to improve the fit. Given a set of initial parameter values, the method of weighted least squares improves the parameter estimates. Ordinary least squares is not appropriate as the semivariances are correlated across the lag distances and the precision on the estimates varies depending on the number of site pairs for a given lag.</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="statistical-spatial-interpolation.html#cb308-1"></a>FR.vm &lt;-<span class="st"> </span><span class="kw">fit.variogram</span>(<span class="dt">object =</span> FR.v, </span>
<span id="cb308-2"><a href="statistical-spatial-interpolation.html#cb308-2"></a>                       <span class="dt">model =</span> FR.vmi)</span>
<span id="cb308-3"><a href="statistical-spatial-interpolation.html#cb308-3"></a>FR.vm</span></code></pre></div>
<pre><code>##   model     psill    range
## 1   Nug  46.85311      0.0
## 2   Gau 157.15822 128799.1</code></pre>
<p>The result is a variogram model with a nugget of 46.8 cm<span class="math inline">\(^2\)</span>, a partial sill of 157 cm<span class="math inline">\(^2\)</span>, and a range on the sill of 129 km.</p>
<p>Let <span class="math inline">\(r\)</span> be the range, <span class="math inline">\(c\)</span> the partial sill and <span class="math inline">\(c_o\)</span> the nugget, then the equation defining the curve over the set of lag distances <span class="math inline">\(h\)</span> is
<span class="math display">\[
\gamma(h)=c\left(1-\exp\left(-\frac{h^2}{r^2}\right)\right)+c_o
\]</span></p>
<p>We create a data frame with values of h and gamma using this equation.</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="statistical-spatial-interpolation.html#cb310-1"></a>nug &lt;-<span class="st"> </span>FR.vm<span class="op">$</span>psill[<span class="dv">1</span>]</span>
<span id="cb310-2"><a href="statistical-spatial-interpolation.html#cb310-2"></a>ps &lt;-<span class="st"> </span>FR.vm<span class="op">$</span>psill[<span class="dv">2</span>]</span>
<span id="cb310-3"><a href="statistical-spatial-interpolation.html#cb310-3"></a>r &lt;-<span class="st"> </span>FR.vm<span class="op">$</span>range[<span class="dv">2</span>] <span class="op">/</span><span class="st"> </span><span class="dv">1000</span></span>
<span id="cb310-4"><a href="statistical-spatial-interpolation.html#cb310-4"></a>h &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">400</span>, <span class="fl">.2</span>)</span>
<span id="cb310-5"><a href="statistical-spatial-interpolation.html#cb310-5"></a>gamma &lt;-<span class="st"> </span>ps <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>h<span class="op">^</span><span class="dv">2</span> <span class="op">/</span><span class="st"> </span>(r<span class="op">^</span><span class="dv">2</span>))) <span class="op">+</span><span class="st"> </span>nug</span>
<span id="cb310-6"><a href="statistical-spatial-interpolation.html#cb310-6"></a></span>
<span id="cb310-7"><a href="statistical-spatial-interpolation.html#cb310-7"></a>vm.df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">dist =</span> h,</span>
<span id="cb310-8"><a href="statistical-spatial-interpolation.html#cb310-8"></a>                    <span class="dt">gamma =</span> gamma)</span>
<span id="cb310-9"><a href="statistical-spatial-interpolation.html#cb310-9"></a></span>
<span id="cb310-10"><a href="statistical-spatial-interpolation.html#cb310-10"></a>pv <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dist, <span class="dt">y =</span> gamma), <span class="dt">data =</span> vm.df)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-136-1.png" width="672" /></p>
<p>Check for anisotropy.</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="statistical-spatial-interpolation.html#cb311-1"></a><span class="kw">plot</span>(<span class="kw">variogram</span>(tpm <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, </span>
<span id="cb311-2"><a href="statistical-spatial-interpolation.html#cb311-2"></a>               <span class="dt">data =</span> FR.sf, </span>
<span id="cb311-3"><a href="statistical-spatial-interpolation.html#cb311-3"></a>               <span class="dt">alpha =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">45</span>, <span class="dv">90</span>, <span class="dv">135</span>)), </span>
<span id="cb311-4"><a href="statistical-spatial-interpolation.html#cb311-4"></a>     <span class="dt">xlab =</span> <span class="st">&quot;Lag Distance (m)&quot;</span>)</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-137-1.png" width="672" /></p>
<p>We see the range of correlations is longer (about 300 km) in the north-south direction (0 degrees). We refit the variogram defining an anistropy ellipse with the <code>anis =</code> argument. The first parameter is the direction of longest range and the second parameter is the ratio of the longest to shortest. Here about (200/300 = .67).</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="statistical-spatial-interpolation.html#cb312-1"></a>FR.vmi &lt;-<span class="st"> </span><span class="kw">vgm</span>(<span class="dt">model =</span> <span class="st">&quot;Gau&quot;</span>, </span>
<span id="cb312-2"><a href="statistical-spatial-interpolation.html#cb312-2"></a>              <span class="dt">psill =</span> <span class="dv">150</span>, </span>
<span id="cb312-3"><a href="statistical-spatial-interpolation.html#cb312-3"></a>              <span class="dt">range =</span> <span class="dv">300</span> <span class="op">*</span><span class="st"> </span><span class="dv">1000</span>, </span>
<span id="cb312-4"><a href="statistical-spatial-interpolation.html#cb312-4"></a>              <span class="dt">nugget =</span> <span class="dv">50</span>,</span>
<span id="cb312-5"><a href="statistical-spatial-interpolation.html#cb312-5"></a>              <span class="dt">anis =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">.67</span>))</span>
<span id="cb312-6"><a href="statistical-spatial-interpolation.html#cb312-6"></a>FR.vm &lt;-<span class="st"> </span><span class="kw">fit.variogram</span>(FR.v, FR.vmi)</span></code></pre></div>
</div>
<div id="kriging-2" class="section level3" number="1.8.3">
<h3><span class="header-section-number">1.8.3</span> Kriging</h3>
<p>The final step is to use the variogram model together with the rainfall values at the observation sites to create an interpolated surface. The process is called kriging. As Edzer Pebesma notes, ‘krige’ is to ‘kriging’ as ‘predict’ is to ‘predicting.’ Here we use ordinary kriging as there are no spatial trends in the rainfall.</p>
<p>Interpolation is done using the <code>krige()</code> function. The first argument is the model specification and the second is the data. Two other arguments are needed. One is the variogram model using the argument name model and the other is a set of locations identifying where the interpolations are to be made. This is specified with the argument name <code>newdata =</code>.</p>
<div id="interpolate-to-point-loctions" class="section level4" number="1.8.3.1">
<h4><span class="header-section-number">1.8.3.1</span> Interpolate to point loctions</h4>
<p>Here we interpolate to locations on a regular grid. We create a grid of locations within the boundary of Florida using the <code>st_sample()</code> function.</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="statistical-spatial-interpolation.html#cb313-1"></a>grid.sf &lt;-<span class="st"> </span><span class="kw">st_sample</span>(FL.sf,</span>
<span id="cb313-2"><a href="statistical-spatial-interpolation.html#cb313-2"></a>                     <span class="dt">size =</span> <span class="dv">5000</span>,</span>
<span id="cb313-3"><a href="statistical-spatial-interpolation.html#cb313-3"></a>                     <span class="dt">type =</span> <span class="st">&quot;regular&quot;</span>)</span></code></pre></div>
<p>We specify the number of locations using the argument <code>size =</code>. Note that the actual number of locations will be somewhat different because of the irregular boundary.</p>
<p>First we use the <code>krige()</code> function to interpolate the observed rainfall to the grid locations. Recall that for a given location, the interpolation is a weighted average of the rainfall across the entire region where the weights are determined by the variogram model.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="statistical-spatial-interpolation.html#cb314-1"></a>ipl &lt;-<span class="st"> </span><span class="kw">krige</span>(tpm <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, </span>
<span id="cb314-2"><a href="statistical-spatial-interpolation.html#cb314-2"></a>             <span class="dt">locations =</span> FR.sf, </span>
<span id="cb314-3"><a href="statistical-spatial-interpolation.html#cb314-3"></a>             <span class="dt">newdata =</span> grid.sf,</span>
<span id="cb314-4"><a href="statistical-spatial-interpolation.html#cb314-4"></a>             <span class="dt">model =</span> FR.vm)</span></code></pre></div>
<pre><code>## [using ordinary kriging]</code></pre>
<p>If the variogram model is not included then inverse distance weighted interpolation is performed. The function will not work if different values share the same location.</p>
<p>The saved object (<code>ipl</code>) inherits the spatial object specified in the <code>newdata</code> argument, but extends it to a spatial data frame. The data frame with two variables. The first <code>var1.pred</code> is the interpolated rainfall and the second <code>var1.var</code> is the prediction variance.</p>
<p>We plot the interpolated field.</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="statistical-spatial-interpolation.html#cb316-1"></a><span class="kw">tm_shape</span>(ipl) <span class="op">+</span></span>
<span id="cb316-2"><a href="statistical-spatial-interpolation.html#cb316-2"></a><span class="st">  </span><span class="kw">tm_dots</span>(<span class="st">&quot;var1.pred&quot;</span>,</span>
<span id="cb316-3"><a href="statistical-spatial-interpolation.html#cb316-3"></a>          <span class="dt">size =</span> <span class="fl">.1</span>,</span>
<span id="cb316-4"><a href="statistical-spatial-interpolation.html#cb316-4"></a>          <span class="dt">palette =</span> <span class="st">&quot;Greens&quot;</span>,</span>
<span id="cb316-5"><a href="statistical-spatial-interpolation.html#cb316-5"></a>          <span class="dt">title =</span> <span class="st">&quot;Rainfall (cm)&quot;</span>) <span class="op">+</span></span>
<span id="cb316-6"><a href="statistical-spatial-interpolation.html#cb316-6"></a><span class="st">  </span><span class="kw">tm_shape</span>(FL.sf) <span class="op">+</span></span>
<span id="cb316-7"><a href="statistical-spatial-interpolation.html#cb316-7"></a><span class="st">  </span><span class="kw">tm_borders</span>() <span class="op">+</span></span>
<span id="cb316-8"><a href="statistical-spatial-interpolation.html#cb316-8"></a><span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>),</span>
<span id="cb316-9"><a href="statistical-spatial-interpolation.html#cb316-9"></a>            <span class="dt">title =</span> <span class="st">&quot;Tropical Cyclone Fay (2008)&quot;</span>,</span>
<span id="cb316-10"><a href="statistical-spatial-interpolation.html#cb316-10"></a>            <span class="dt">title.position =</span> <span class="kw">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>))</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-141-1.png" width="672" /></p>
<p>Note that a portion of the data values where outside of the state but our interest is only to have values on a grid within the state.</p>
<p>The spatial interpolation shows that parts of east central and north Florida were deluged by Fay.</p>
</div>
<div id="interpolate-to-the-counties-block-kriging" class="section level4" number="1.8.3.2">
<h4><span class="header-section-number">1.8.3.2</span> Interpolate to the counties (block kriging)</h4>
<p>We use block kriging to estimate average rainfall within each county. The county-wide rainfall average is relevant for water resource managers. Block kriging produces a smoothed estimate of this area average, which will differ from a simple average over all sites within the county because of spatial autocorrelation.</p>
<p>We use the same function to interpolate but specify the spatial polygons rather than the spatial grid as the new data.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="statistical-spatial-interpolation.html#cb317-1"></a>ipl2 &lt;-<span class="st"> </span><span class="kw">krige</span>(tpm <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, </span>
<span id="cb317-2"><a href="statistical-spatial-interpolation.html#cb317-2"></a>              <span class="dt">locations =</span> FR.sf, </span>
<span id="cb317-3"><a href="statistical-spatial-interpolation.html#cb317-3"></a>              <span class="dt">newdata =</span> FL.sf, </span>
<span id="cb317-4"><a href="statistical-spatial-interpolation.html#cb317-4"></a>              <span class="dt">model =</span> FR.vm)</span></code></pre></div>
<pre><code>## [using ordinary kriging]</code></pre>
<p>Again we plot the interpolations.</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="statistical-spatial-interpolation.html#cb319-1"></a><span class="kw">tm_shape</span>(ipl2) <span class="op">+</span></span>
<span id="cb319-2"><a href="statistical-spatial-interpolation.html#cb319-2"></a><span class="st">  </span><span class="kw">tm_polygons</span>(<span class="dt">col =</span> <span class="st">&quot;var1.pred&quot;</span>,</span>
<span id="cb319-3"><a href="statistical-spatial-interpolation.html#cb319-3"></a>            <span class="dt">palette =</span> <span class="st">&quot;Greens&quot;</span>,</span>
<span id="cb319-4"><a href="statistical-spatial-interpolation.html#cb319-4"></a>            <span class="dt">title =</span> <span class="st">&quot;Rainfall (cm)&quot;</span>) <span class="op">+</span></span>
<span id="cb319-5"><a href="statistical-spatial-interpolation.html#cb319-5"></a><span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>),</span>
<span id="cb319-6"><a href="statistical-spatial-interpolation.html#cb319-6"></a>            <span class="dt">title =</span> <span class="st">&quot;Tropical Cyclone Fay (2008)&quot;</span>,</span>
<span id="cb319-7"><a href="statistical-spatial-interpolation.html#cb319-7"></a>            <span class="dt">title.position =</span> <span class="kw">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>))</span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-143-1.png" width="672" /></p>
<p>The overall pattern of rainfall from Fay featuring the largest amounts along the central east coast and over the eastern panhandle are similar in both maps.</p>
<p>We compare the kriged average with the simple average at the county level with <code>aggregate()</code> from the {sf} package.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="statistical-spatial-interpolation.html#cb320-1"></a>ipl3 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(FR.sf, <span class="dt">by =</span> FL.sf, <span class="dt">FUN =</span> mean)</span></code></pre></div>
<p>The function returns a simple feature data frame of the average rainfall in each county.</p>
<p>The state-wide mean of the kriged estimates at the county level is</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="statistical-spatial-interpolation.html#cb321-1"></a><span class="kw">round</span>(<span class="kw">mean</span>(ipl2<span class="op">$</span>var1.pred), <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 21.09</code></pre>
<p>This compares with a state-wide mean from the simple averages.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="statistical-spatial-interpolation.html#cb323-1"></a><span class="kw">round</span>(<span class="kw">mean</span>(ipl3<span class="op">$</span>tpm), <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 20.85</code></pre>
<p>The correlation between the two estimates across the 67 counties is</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="statistical-spatial-interpolation.html#cb325-1"></a><span class="kw">round</span>(<span class="kw">cor</span>(ipl3<span class="op">$</span>tpm, ipl2<span class="op">$</span>var1.pred), <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 0.87</code></pre>
<p>The variogram model reduces the standard deviation of the kriged estimate relative to the standard deviation of the simple averages because of the local smoothing.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="statistical-spatial-interpolation.html#cb327-1"></a><span class="kw">round</span>(<span class="kw">sd</span>(ipl2<span class="op">$</span>var1.pred), <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 8.05</code></pre>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="statistical-spatial-interpolation.html#cb329-1"></a><span class="kw">round</span>(<span class="kw">sd</span>(ipl3<span class="op">$</span>tpm), <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 9.83</code></pre>
<p>This can be seen with a scatter plot of simple averages versus kriged averages at the county level.</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="statistical-spatial-interpolation.html#cb331-1"></a>compare.df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">simpleAvg =</span> ipl3<span class="op">$</span>tpm,</span>
<span id="cb331-2"><a href="statistical-spatial-interpolation.html#cb331-2"></a>                         <span class="dt">krigeAvg =</span> ipl2<span class="op">$</span>var1.pred)</span>
<span id="cb331-3"><a href="statistical-spatial-interpolation.html#cb331-3"></a><span class="kw">ggplot</span>(compare.df, <span class="kw">aes</span>(<span class="dt">x =</span> simpleAvg,</span>
<span id="cb331-4"><a href="statistical-spatial-interpolation.html#cb331-4"></a>                       <span class="dt">y =</span> krigeAvg)) <span class="op">+</span></span>
<span id="cb331-5"><a href="statistical-spatial-interpolation.html#cb331-5"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb331-6"><a href="statistical-spatial-interpolation.html#cb331-6"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope =</span> <span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb331-7"><a href="statistical-spatial-interpolation.html#cb331-7"></a><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> lm, <span class="dt">se =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-149-1.png" width="672" /></p>
</div>
</div>
<div id="uncertainty" class="section level3" number="1.8.4">
<h3><span class="header-section-number">1.8.4</span> Uncertainty</h3>
<p>Another advantage of kriging as a method of spatial interpolation is the accompanying uncertainty estimates.</p>
<p>The prediction variances are listed in a column in the spatial data frame saved from apply the <code>krige()</code> function. Variances are smaller in regions with more rainfall observations.</p>
<p>Prediction variances are also smaller with block kriging as much of the variability within the county averages out. To compare the distribution characteristics of the prediction variances for the point and block kriging of the rainfall observations, type</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="statistical-spatial-interpolation.html#cb333-1"></a><span class="kw">round</span>(<span class="kw">summary</span>(ipl<span class="op">$</span>var1.var), <span class="dv">1</span>)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    47.7    49.4    50.4    51.4    52.5   109.7</code></pre>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="statistical-spatial-interpolation.html#cb335-1"></a><span class="kw">round</span>(<span class="kw">summary</span>(ipl2<span class="op">$</span>var1.var), <span class="dv">1</span>)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##     0.6     1.9     2.7     3.1     3.8     9.3</code></pre>
<p>The median prediction variance (in cm<span class="math inline">\(^2\)</span>) for our point kriging is close to the value of the nugget.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="statistical-spatial-interpolation.html#cb337-1"></a><span class="kw">round</span>(<span class="kw">fivenum</span>(ipl<span class="op">$</span>var1.var)[<span class="dv">3</span>], <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 50.4</code></pre>
<p>In contrast the median prediction variance for our block kriging is a much smaller</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="statistical-spatial-interpolation.html#cb339-1"></a><span class="kw">round</span>(<span class="kw">fivenum</span>(ipl2<span class="op">$</span>var1.var)[<span class="dv">3</span>], <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 2.7</code></pre>
<p>Simulations exploit this uncertainty and provide synthetic data for use in deterministic models.</p>
<p>Conditional simulation, where the simulated field (realization) is generated given the data and the variogram model, is done using the same <code>krige()</code> function by adding the argument <code>nsim</code> to specify the number of simulations.</p>
<p>For a large number it may be necessary to limit the number neighbors in the kriging. This is done using the <code>nmax</code> argument. For a given location, the weights assigned to observations far away are very small, so it is efficient to limit how many are used in the simulation.</p>
<p>As an example, here we generate four realizations of the county-level storm total rainfall for Fay and limit the neighborhood to 50 of the closest observation sites. Note that it may take a few seconds.</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="statistical-spatial-interpolation.html#cb341-1"></a>ipl.sim &lt;-<span class="st"> </span><span class="kw">krige</span>(tpm <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, </span>
<span id="cb341-2"><a href="statistical-spatial-interpolation.html#cb341-2"></a>                 <span class="dt">locations =</span> FR.sf, </span>
<span id="cb341-3"><a href="statistical-spatial-interpolation.html#cb341-3"></a>                 <span class="dt">newdata =</span> FL.sf, </span>
<span id="cb341-4"><a href="statistical-spatial-interpolation.html#cb341-4"></a>                 <span class="dt">model =</span> FR.vm, </span>
<span id="cb341-5"><a href="statistical-spatial-interpolation.html#cb341-5"></a>                 <span class="dt">nsim =</span> <span class="dv">4</span>, </span>
<span id="cb341-6"><a href="statistical-spatial-interpolation.html#cb341-6"></a>                 <span class="dt">nmax =</span> <span class="dv">50</span>)</span></code></pre></div>
<pre><code>## drawing 4 GLS realisations of beta...
## [using conditional Gaussian simulation]</code></pre>
<p>Simulations are conditional on the observed rainfall and the variogram model using block kriging on the counties.</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="statistical-spatial-interpolation.html#cb343-1"></a><span class="kw">library</span>(tmap)</span>
<span id="cb343-2"><a href="statistical-spatial-interpolation.html#cb343-2"></a></span>
<span id="cb343-3"><a href="statistical-spatial-interpolation.html#cb343-3"></a><span class="kw">tm_shape</span>(ipl.sim) <span class="op">+</span></span>
<span id="cb343-4"><a href="statistical-spatial-interpolation.html#cb343-4"></a><span class="st">    </span><span class="kw">tm_polygons</span>(<span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;sim1&quot;</span>, <span class="st">&quot;sim2&quot;</span>, <span class="st">&quot;sim3&quot;</span>, <span class="st">&quot;sim4&quot;</span>),</span>
<span id="cb343-5"><a href="statistical-spatial-interpolation.html#cb343-5"></a>                <span class="dt">palette =</span> <span class="st">&quot;Greens&quot;</span>,</span>
<span id="cb343-6"><a href="statistical-spatial-interpolation.html#cb343-6"></a>                <span class="dt">title =</span> <span class="st">&quot;Simulated Rainfall [cm]&quot;</span>) <span class="op">+</span></span>
<span id="cb343-7"><a href="statistical-spatial-interpolation.html#cb343-7"></a><span class="st">    </span><span class="kw">tm_facets</span>(<span class="dt">free.scales =</span> <span class="ot">FALSE</span>) </span></code></pre></div>
<p><img src="assfg-book_files/figure-html/unnamed-chunk-154-1.png" width="672" /></p>
<p>The overall pattern of rainfall remains the same, but there are differences especially in counties with fewer observations and in counties where the rainfall gradients are sharp.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["assfg-book.pdf", "assfg-book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
